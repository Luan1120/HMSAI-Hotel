{"ast":null,"code":"import _objectSpread from\"D:/DA_TichHop/HMS_AI Hotel/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useRef,useState}from'react';import'./HomePage.css';import{authHeaders,getUserRole}from'./auth';/* Quản lý Ưu đãi / Mã khuyến mãi\r\n   - Danh sách + tìm kiếm + lọc trạng thái\r\n   - Tạo mới / Chỉnh sửa / Bật tắt (isActive)\r\n   - Preview tính giảm theo số tiền đơn hàng nhập thử\r\n   Trạng thái hiển thị:\r\n     Active    => isActive=1 && now within [startDate,endDate]\r\n     Scheduled => isActive=1 && now < startDate\r\n     Expired   => now > endDate\r\n     Disabled  => isActive=0\r\n*/import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function AdminPromotions(){const role=getUserRole();const isAdminOrStaff=['Admin','Staff'].includes(role);const isAdmin=role==='Admin';const[items,setItems]=useState([]);// promotions\nconst[loading,setLoading]=useState(false);const[error,setError]=useState('');const[q,setQ]=useState('');const[statusFilter,setStatusFilter]=useState('all');const[createOpen,setCreateOpen]=useState(false);const[editing,setEditing]=useState(null);// row object being edited inline modal\nconst[saving,setSaving]=useState(false);const[creating,setCreating]=useState(false);const[previewAmount,setPreviewAmount]=useState('');const[page,setPage]=useState(1);const pageSize=20;const debounceRef=useRef(null);const now=useMemo(()=>new Date(),[]);const emptyForm={code:'',description:'',discountType:'PERCENT',discountValue:'',startDate:'',endDate:'',minOrderAmount:'',maxDiscount:'',isActive:true};const[form,setForm]=useState(emptyForm);const statusOf=p=>{if(!p)return'Unknown';const s=new Date(p.startDate);const e=new Date(p.endDate);if(!p.isActive)return'Disabled';if(now<s)return'Scheduled';if(now>e)return'Expired';return'Active';};const filtered=useMemo(()=>{const text=q.trim().toLowerCase();return items.filter(p=>{const st=statusOf(p);if(statusFilter!=='all'&&st.toLowerCase()!==statusFilter)return false;if(text&&!(\"\".concat(p.code).toLowerCase().includes(text)||(p.description||'').toLowerCase().includes(text)))return false;return true;});},[items,q,statusFilter]);const paged=useMemo(()=>{const start=(page-1)*pageSize;return filtered.slice(start,start+pageSize);},[filtered,page]);const pageCount=useMemo(()=>Math.max(1,Math.ceil(filtered.length/pageSize)),[filtered.length]);const computeDiscount=(promo,orderAmount)=>{const amt=Number(orderAmount||0);if(!promo||!(amt>0))return{discount:0,final:amt};if(promo.discountType==='PERCENT'){let raw=amt*(Number(promo.discountValue||0)/100);if(promo.maxDiscount)raw=Math.min(raw,Number(promo.maxDiscount));return{discount:raw,final:Math.max(0,amt-raw)};}const raw=Number(promo.discountValue||0);return{discount:Math.min(raw,amt),final:Math.max(0,amt-raw)};};const load=async()=>{if(!isAdminOrStaff)return;setLoading(true);setError('');try{// Tạm thời gọi thử endpoint nếu có, nếu 404 → giả lập mock\nconst res=await fetch('/api/admin/promotions',{headers:authHeaders(),cache:'no-store'});if(!res.ok)throw new Error('Không tải được danh sách ưu đãi');const j=await res.json();const list=Array.isArray(j.items)?j.items:Array.isArray(j.promotions)?j.promotions:[];setItems(list.map(r=>_objectSpread({},r)));}catch(e){console.warn('[AdminPromotions] load error:',e.message);setError(e.message||'Lỗi tải dữ liệu');// Không còn tự động tạo mock để tránh nhầm trạng thái thực tế vs giả lập\nsetItems([]);}finally{setLoading(false);}};useEffect(()=>{load();},[]);useEffect(()=>{if(debounceRef.current)clearTimeout(debounceRef.current);debounceRef.current=setTimeout(()=>setPage(1),300);return()=>debounceRef.current&&clearTimeout(debounceRef.current);},[q,statusFilter]);const openCreate=()=>{setForm(emptyForm);setCreateOpen(true);};const validateForm=data=>{if(!data.code.trim())return'Nhập mã ưu đãi';if(!/^[-A-Z0-9_]+$/i.test(data.code.trim()))return'Mã chỉ gồm chữ, số, -, _';if(!data.discountType)return'Chọn loại giảm';const val=Number(data.discountValue);if(!(val>0))return'Giá trị giảm phải > 0';if(data.discountType==='PERCENT'&&val>100)return'Phần trăm ≤ 100';// Normalize to date-only for validation (strip any time component)\nconst sDate=data.startDate?String(data.startDate).slice(0,10):'';const eDate=data.endDate?String(data.endDate).slice(0,10):'';if(!sDate||!eDate)return'Chọn thời gian hiệu lực';if(new Date(eDate)<=new Date(sDate))return'Ngày kết thúc phải sau ngày bắt đầu';if(data.minOrderAmount&&!(Number(data.minOrderAmount)>=0))return'Đơn tối thiểu không hợp lệ';if(data.discountType==='PERCENT'&&data.maxDiscount&&!(Number(data.maxDiscount)>0))return'Giảm tối đa phải > 0';return'';};const submitCreate=async()=>{const err=validateForm(form);if(err){alert(err);return;}setCreating(true);try{// Strip time component: send date-only (YYYY-MM-DD) to server/DB\nconst startDateOnly=form.startDate?String(form.startDate).slice(0,10):null;const endDateOnly=form.endDate?String(form.endDate).slice(0,10):null;const payload=_objectSpread(_objectSpread({},form),{},{discountValue:Number(form.discountValue),minOrderAmount:form.minOrderAmount?Number(form.minOrderAmount):null,maxDiscount:form.maxDiscount?Number(form.maxDiscount):null,startDate:startDateOnly,endDate:endDateOnly});const res=await fetch('/api/admin/promotions',{method:'POST',headers:_objectSpread({'Content-Type':'application/json'},authHeaders()),body:JSON.stringify(payload)});if(!res.ok)throw new Error('Tạo ưu đãi thất bại');setCreateOpen(false);setForm(emptyForm);load();}catch(e){alert(e.message||'Lỗi tạo');}finally{setCreating(false);}};const openEdit=row=>{var _row$startDate,_row$endDate;setEditing(row);setForm(_objectSpread(_objectSpread(_objectSpread({},emptyForm),row),{},{startDate:((_row$startDate=row.startDate)===null||_row$startDate===void 0?void 0:_row$startDate.slice(0,16))||'',endDate:((_row$endDate=row.endDate)===null||_row$endDate===void 0?void 0:_row$endDate.slice(0,16))||''}));setCreateOpen(true);};// Normalize edit values to date-only (YYYY-MM-DD)\nconst openEditNormalized=row=>{setEditing(row);setForm(_objectSpread(_objectSpread(_objectSpread({},emptyForm),row),{},{startDate:row.startDate?String(row.startDate).slice(0,10):'',endDate:row.endDate?String(row.endDate).slice(0,10):''}));setCreateOpen(true);};const submitEdit=async()=>{if(!editing)return;const err=validateForm(form);if(err){alert(err);return;}setSaving(true);try{// Send date-only values (YYYY-MM-DD) to avoid time components being stored\nconst startDateOnly=form.startDate?String(form.startDate).slice(0,10):null;const endDateOnly=form.endDate?String(form.endDate).slice(0,10):null;const payload={description:form.description,discountType:form.discountType,discountValue:Number(form.discountValue),startDate:startDateOnly,endDate:endDateOnly,minOrderAmount:form.minOrderAmount?Number(form.minOrderAmount):null,maxDiscount:form.maxDiscount?Number(form.maxDiscount):null,isActive:form.isActive};const res=await fetch(\"/api/admin/promotions/\".concat(editing.id),{method:'PUT',headers:_objectSpread({'Content-Type':'application/json'},authHeaders()),body:JSON.stringify(payload)});if(!res.ok)throw new Error('Cập nhật thất bại');setCreateOpen(false);setEditing(null);load();}catch(e){alert(e.message||'Lỗi cập nhật');}finally{setSaving(false);}};const toggleActive=async row=>{// Optimistic\nsetItems(prev=>prev.map(p=>p.id===row.id?_objectSpread(_objectSpread({},p),{},{isActive:!p.isActive}):p));try{const res=await fetch(\"/api/admin/promotions/\".concat(row.id,\"/activate\"),{method:'PATCH',headers:_objectSpread({'Content-Type':'application/json'},authHeaders()),body:JSON.stringify({isActive:!row.isActive})});if(!res.ok)throw new Error('Cập nhật trạng thái thất bại');}catch(e){setItems(prev=>prev.map(p=>p.id===row.id?_objectSpread(_objectSpread({},p),{},{isActive:row.isActive}):p));alert(e.message||'Lỗi');}};const del=async row=>{if(!window.confirm('Xóa ưu đãi này?'))return;try{const res=await fetch(\"/api/admin/promotions/\".concat(row.id),{method:'DELETE',headers:authHeaders()});if(!res.ok)throw new Error('Xóa thất bại');load();}catch(e){alert(e.message||'Lỗi xóa');}};if(!isAdminOrStaff)return/*#__PURE__*/_jsx(\"div\",{style:{padding:16},children:\"Ch\\u1EE9c n\\u0103ng d\\xE0nh cho qu\\u1EA3n tr\\u1ECB / nh\\xE2n vi\\xEAn.\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"af-container amenities-anim-root\",style:{padding:12},children:[/*#__PURE__*/_jsx(\"h2\",{className:\"home-rooms-title\",style:{textAlign:'left',marginTop:0},children:\"Qu\\u1EA3n l\\xFD \\u01B0u \\u0111\\xE3i / m\\xE3 khuy\\u1EBFn m\\xE3i\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"reports-toolbar af-toolbar\",style:{marginBottom:10,flexWrap:'wrap',gap:8},children:[/*#__PURE__*/_jsx(\"div\",{className:\"reports-field af-field-grow\",style:{minWidth:240},children:/*#__PURE__*/_jsx(\"input\",{className:\"reports-input\",placeholder:\"T\\xECm theo m\\xE3 ho\\u1EB7c m\\xF4 t\\u1EA3...\",value:q,onChange:e=>setQ(e.target.value)})}),/*#__PURE__*/_jsx(\"div\",{className:\"reports-field\",style:{minWidth:180},children:/*#__PURE__*/_jsxs(\"select\",{className:\"reports-select\",value:statusFilter,onChange:e=>setStatusFilter(e.target.value),style:{height:38},children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"T\\u1EA5t c\\u1EA3 tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(\"option\",{value:\"active\",children:\"Active\"}),/*#__PURE__*/_jsx(\"option\",{value:\"scheduled\",children:\"Scheduled\"}),/*#__PURE__*/_jsx(\"option\",{value:\"expired\",children:\"Expired\"}),/*#__PURE__*/_jsx(\"option\",{value:\"disabled\",children:\"Disabled\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"reports-field\",style:{display:'flex',gap:8},children:isAdmin&&/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn\",onClick:openCreate,children:\"+ Th\\xEAm \\u01B0u \\u0111\\xE3i\"})})]}),loading?/*#__PURE__*/_jsx(\"div\",{style:{color:'#666'},children:\"\\u0110ang t\\u1EA3i...\"}):error?/*#__PURE__*/_jsx(\"div\",{style:{color:'#b42318'},children:error}):/*#__PURE__*/_jsx(\"div\",{style:{overflowX:'auto'},children:/*#__PURE__*/_jsxs(\"table\",{className:\"ph-table-el af-table\",style:{width:'100%',minWidth:1080},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"M\\xE3\"}),/*#__PURE__*/_jsx(\"th\",{children:\"M\\xF4 t\\u1EA3\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Lo\\u1EA1i\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Gi\\xE1 tr\\u1ECB\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Hi\\u1EC7u l\\u1EF1c\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0110i\\u1EC1u ki\\u1EC7n\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(\"th\",{children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:paged.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:8,style:{textAlign:'center',color:'#666'},children:\"Kh\\xF4ng c\\xF3 \\u01B0u \\u0111\\xE3i.\"})}):paged.map(p=>{const st=statusOf(p);const amt=Number(previewAmount||0);const{discount,final}=computeDiscount(p,amt&&(!p.minOrderAmount||amt>=Number(p.minOrderAmount))?amt:0);return/*#__PURE__*/_jsxs(\"tr\",{className:\"amenity-row\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"ph-td\",style:{fontWeight:600},title:\"ID: \".concat(p.id),children:p.code}),/*#__PURE__*/_jsx(\"td\",{className:\"ph-td\",style:{maxWidth:220},title:p.description,children:p.description||'—'}),/*#__PURE__*/_jsx(\"td\",{className:\"ph-td\",children:p.discountType==='PERCENT'?'Phần trăm':'Cố định'}),/*#__PURE__*/_jsx(\"td\",{className:\"ph-td\",children:p.discountType==='PERCENT'?\"\".concat(p.discountValue,\"%\").concat(p.maxDiscount?\" (t\\u1ED1i \\u0111a \".concat(Number(p.maxDiscount).toLocaleString('vi-VN'),\"\\u0111)\"):''):\"\".concat(Number(p.discountValue).toLocaleString('vi-VN'),\" \\u0111\")}),/*#__PURE__*/_jsxs(\"td\",{className:\"ph-td\",style:{fontSize:12},children:[/*#__PURE__*/_jsx(\"div\",{children:p.startDate?new Date(p.startDate).toLocaleDateString('vi-VN'):'—'}),/*#__PURE__*/_jsx(\"div\",{style:{opacity:.8},children:p.endDate?new Date(p.endDate).toLocaleDateString('vi-VN'):'—'})]}),/*#__PURE__*/_jsxs(\"td\",{className:\"ph-td\",style:{fontSize:12},children:[p.minOrderAmount?/*#__PURE__*/_jsxs(\"div\",{children:[\"T\\u1ED1i thi\\u1EC3u: \",Number(p.minOrderAmount).toLocaleString('vi-VN'),\"\\u0111\"]}):/*#__PURE__*/_jsx(\"div\",{children:\"\\u2014\"}),p.discountType==='PERCENT'&&p.maxDiscount&&/*#__PURE__*/_jsxs(\"div\",{children:[\"Gi\\u1EA3m t\\u1ED1i \\u0111a: \",Number(p.maxDiscount).toLocaleString('vi-VN'),\"\\u0111\"]}),previewAmount&&discount>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:4,color:'#047857'},children:[\"Gi\\u1EA3m: \",Math.round(discount).toLocaleString('vi-VN'),\"\\u0111\",/*#__PURE__*/_jsx(\"br\",{}),\"C\\xF2n: \",Math.round(final).toLocaleString('vi-VN'),\"\\u0111\"]})]}),/*#__PURE__*/_jsx(\"td\",{className:\"ph-td\",style:{fontWeight:600},children:/*#__PURE__*/_jsx(\"span\",{className:\"promo-badge promo-\".concat(st.toLowerCase()),children:st})}),/*#__PURE__*/_jsxs(\"td\",{className:\"ph-td\",style:{whiteSpace:'nowrap'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn ph-btn--success\",onClick:()=>openEditNormalized(p),children:\"S\\u1EEDa\"}),/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn ph-btn--warning\",onClick:()=>toggleActive(p),children:p.isActive?'Tắt':'Bật'}),isAdmin&&/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn ph-btn--danger\",onClick:()=>del(p),children:\"X\\xF3a\"})]})]},p.id);})})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:10,display:'flex',gap:12,alignItems:'center',flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:6,alignItems:'center'},children:[/*#__PURE__*/_jsx(\"label\",{style:{fontSize:13},children:\"Xem th\\u1EED \\u0111\\u01A1n h\\xE0ng (VND):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",style:{width:140},value:previewAmount,onChange:e=>setPreviewAmount(e.target.value),placeholder:\"Nh\\u1EADp s\\u1ED1 ti\\u1EC1n\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'auto',display:'flex',gap:6,alignItems:'center'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn\",disabled:page<=1,onClick:()=>setPage(p=>Math.max(1,p-1)),children:\"\\u25C0\"}),/*#__PURE__*/_jsxs(\"span\",{style:{fontSize:13},children:[\"Trang \",page,\"/\",pageCount]}),/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn\",disabled:page>=pageCount,onClick:()=>setPage(p=>Math.min(pageCount,p+1)),children:\"\\u25B6\"})]})]}),createOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"profile-overlay\",onMouseDown:e=>{if(e.target===e.currentTarget){setCreateOpen(false);setEditing(null);}},children:/*#__PURE__*/_jsxs(\"div\",{className:\"profile-modal\",onMouseDown:e=>e.stopPropagation(),style:{width:720,maxWidth:'96%',background:'#fff',borderRadius:14,padding:18},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0,textAlign:'center'},children:editing?'Chỉnh sửa ưu đãi':'Tạo ưu đãi mới'}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(240px,1fr))',gap:16},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'column',gap:4},children:[\"M\\xE3 \\u01B0u \\u0111\\xE3i\",/*#__PURE__*/_jsx(\"input\",{value:form.code,disabled:!!editing,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{code:e.target.value.toUpperCase()})),placeholder:\"WELCOME10\"})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'column',gap:4},children:[\"Lo\\u1EA1i gi\\u1EA3m\",/*#__PURE__*/_jsxs(\"select\",{value:form.discountType,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{discountType:e.target.value})),children:[/*#__PURE__*/_jsx(\"option\",{value:\"PERCENT\",children:\"Ph\\u1EA7n tr\\u0103m\"}),/*#__PURE__*/_jsx(\"option\",{value:\"FIXED\",children:\"C\\u1ED1 \\u0111\\u1ECBnh\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'column',gap:4},children:[\"Gi\\xE1 tr\\u1ECB gi\\u1EA3m\",/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:form.discountValue,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{discountValue:e.target.value})),placeholder:\"10 ho\\u1EB7c 100000\"})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'column',gap:4},children:[\"Gi\\u1EA3m t\\u1ED1i \\u0111a (n\\u1EBFu %)\",/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:form.maxDiscount,disabled:form.discountType!=='PERCENT',onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{maxDiscount:e.target.value})),placeholder:\"200000\"})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'column',gap:4},children:[\"\\u0110\\u01A1n t\\u1ED1i thi\\u1EC3u\",/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:form.minOrderAmount,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{minOrderAmount:e.target.value})),placeholder:\"500000\"})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'column',gap:4},children:[\"Ng\\xE0y b\\u1EAFt \\u0111\\u1EA7u\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:form.startDate,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{startDate:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'column',gap:4},children:[\"Ng\\xE0y k\\u1EBFt th\\xFAc\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:form.endDate,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{endDate:e.target.value}))})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',flexDirection:'row',gap:8,alignItems:'center',marginTop:6},children:[\"K\\xEDch ho\\u1EA1t\",/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:!!form.isActive,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{isActive:e.target.checked}))})]}),/*#__PURE__*/_jsxs(\"label\",{style:{gridColumn:'1 / -1',display:'flex',flexDirection:'column',gap:4},children:[\"M\\xF4 t\\u1EA3\",/*#__PURE__*/_jsx(\"textarea\",{rows:3,value:form.description,onChange:e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{description:e.target.value})),placeholder:\"M\\xF4 t\\u1EA3 ng\\u1EAFn...\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12,background:'#f8fafc',padding:'10px 12px',borderRadius:10,fontSize:13},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Xem nhanh:\"}),' ',(()=>{const testAmt=Number(previewAmount||0);if(!(testAmt>0))return/*#__PURE__*/_jsx(\"span\",{children:\"Nh\\u1EADp s\\u1ED1 ti\\u1EC1n \\u0111\\u01A1n h\\xE0ng \\u1EDF d\\u01B0\\u1EDBi danh s\\xE1ch \\u0111\\u1EC3 xem m\\u1EE9c gi\\u1EA3m.\"});const mockPromo=_objectSpread(_objectSpread({},form),{},{discountValue:Number(form.discountValue||0),maxDiscount:form.maxDiscount?Number(form.maxDiscount):null});const{discount,final}=computeDiscount(mockPromo,testAmt);if(!discount)return/*#__PURE__*/_jsx(\"span\",{children:\"Kh\\xF4ng \\xE1p d\\u1EE5ng (ch\\u01B0a \\u0111\\u1EE7 \\u0111i\\u1EC1u ki\\u1EC7n ho\\u1EB7c d\\u1EEF li\\u1EC7u thi\\u1EBFu).\"});return/*#__PURE__*/_jsxs(\"span\",{children:[\"Gi\\u1EA3m \",Math.round(discount).toLocaleString('vi-VN'),\"\\u0111 c\\xF2n \",Math.round(final).toLocaleString('vi-VN'),\"\\u0111.\"]});})()]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:18,display:'flex',gap:12,justifyContent:'center'},children:editing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn\",onClick:submitEdit,disabled:saving,children:saving?'Đang lưu...':'Lưu thay đổi'}),/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn ph-btn--secondary\",onClick:()=>{setCreateOpen(false);setEditing(null);},children:\"H\\u1EE7y\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn\",onClick:submitCreate,disabled:creating,children:creating?'Đang tạo...':'Tạo mới'}),/*#__PURE__*/_jsx(\"button\",{className:\"ph-btn ph-btn--secondary\",onClick:()=>{setCreateOpen(false);setEditing(null);},children:\"H\\u1EE7y\"})]})})]})}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        .promo-badge { display:inline-block; padding:4px 8px; font-size:11px; line-height:1; border-radius:20px; letter-spacing:.3px; }\\n        .promo-active { background:#e6f7ec; color:#087443; border:1px solid #b2e7c9; }\\n        .promo-scheduled { background:#f0f4ff; color:#1d4ed8; border:1px solid #c7d8ff; }\\n        .promo-expired { background:#ffe8e6; color:#b42318; border:1px solid #f5b5ae; }\\n        .promo-disabled { background:#f1f5f9; color:#475569; border:1px solid #d3dce4; }\\n\\n        .af-table th, .af-table td { padding:6px 8px; vertical-align:middle; }\\n        .af-table input, .af-table select, .af-table textarea { font-size:14px; border:1px solid #d7dbe0; border-radius:6px; background:#fff; }\\n        .af-table input, .af-table select { height:32px; line-height:32px; padding:4px 8px; }\\n        .af-table textarea { padding:6px 8px; }\\n\\n        .ph-btn { cursor:pointer; }\\n        .profile-overlay { backdrop-filter: blur(2px); }\\n      \"})]});}","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","authHeaders","getUserRole","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AdminPromotions","role","isAdminOrStaff","includes","isAdmin","items","setItems","loading","setLoading","error","setError","q","setQ","statusFilter","setStatusFilter","createOpen","setCreateOpen","editing","setEditing","saving","setSaving","creating","setCreating","previewAmount","setPreviewAmount","page","setPage","pageSize","debounceRef","now","Date","emptyForm","code","description","discountType","discountValue","startDate","endDate","minOrderAmount","maxDiscount","isActive","form","setForm","statusOf","p","s","e","filtered","text","trim","toLowerCase","filter","st","concat","paged","start","slice","pageCount","Math","max","ceil","length","computeDiscount","promo","orderAmount","amt","Number","discount","final","raw","min","load","res","fetch","headers","cache","ok","Error","j","json","list","Array","isArray","promotions","map","r","_objectSpread","console","warn","message","current","clearTimeout","setTimeout","openCreate","validateForm","data","test","val","sDate","String","eDate","submitCreate","err","alert","startDateOnly","endDateOnly","payload","method","body","JSON","stringify","openEdit","row","_row$startDate","_row$endDate","openEditNormalized","submitEdit","id","toggleActive","prev","del","window","confirm","style","padding","children","className","textAlign","marginTop","marginBottom","flexWrap","gap","minWidth","placeholder","value","onChange","target","height","display","onClick","color","overflowX","width","colSpan","fontWeight","title","maxWidth","toLocaleString","fontSize","toLocaleDateString","opacity","round","whiteSpace","alignItems","type","marginLeft","disabled","onMouseDown","currentTarget","stopPropagation","background","borderRadius","gridTemplateColumns","flexDirection","f","toUpperCase","checked","gridColumn","rows","testAmt","mockPromo","justifyContent"],"sources":["D:/DA_TichHop/HMS_AI Hotel/client/src/AdminPromotions.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport './HomePage.css';\r\nimport { authHeaders, getUserRole } from './auth';\r\n\r\n/* Quản lý Ưu đãi / Mã khuyến mãi\r\n   - Danh sách + tìm kiếm + lọc trạng thái\r\n   - Tạo mới / Chỉnh sửa / Bật tắt (isActive)\r\n   - Preview tính giảm theo số tiền đơn hàng nhập thử\r\n   Trạng thái hiển thị:\r\n     Active    => isActive=1 && now within [startDate,endDate]\r\n     Scheduled => isActive=1 && now < startDate\r\n     Expired   => now > endDate\r\n     Disabled  => isActive=0\r\n*/\r\nexport default function AdminPromotions(){\r\n  const role = getUserRole();\r\n  const isAdminOrStaff = ['Admin','Staff'].includes(role);\r\n  const isAdmin = role === 'Admin';\r\n\r\n  const [items, setItems] = useState([]); // promotions\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [q, setQ] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('all');\r\n  const [createOpen, setCreateOpen] = useState(false);\r\n  const [editing, setEditing] = useState(null); // row object being edited inline modal\r\n  const [saving, setSaving] = useState(false);\r\n  const [creating, setCreating] = useState(false);\r\n  const [previewAmount, setPreviewAmount] = useState('');\r\n  const [page, setPage] = useState(1);\r\n  const pageSize = 20;\r\n  const debounceRef = useRef(null);\r\n  const now = useMemo(()=> new Date(), []);\r\n\r\n  const emptyForm = {\r\n    code: '',\r\n    description: '',\r\n    discountType: 'PERCENT',\r\n    discountValue: '',\r\n    startDate: '',\r\n    endDate: '',\r\n    minOrderAmount: '',\r\n    maxDiscount: '',\r\n    isActive: true\r\n  };\r\n  const [form, setForm] = useState(emptyForm);\r\n\r\n  const statusOf = (p) => {\r\n    if(!p) return 'Unknown';\r\n    const s = new Date(p.startDate);\r\n    const e = new Date(p.endDate);\r\n    if(!p.isActive) return 'Disabled';\r\n    if(now < s) return 'Scheduled';\r\n    if(now > e) return 'Expired';\r\n    return 'Active';\r\n  };\r\n\r\n  const filtered = useMemo(()=>{\r\n    const text = q.trim().toLowerCase();\r\n    return items.filter(p => {\r\n      const st = statusOf(p);\r\n      if(statusFilter !== 'all' && st.toLowerCase() !== statusFilter) return false;\r\n      if(text && !(`${p.code}`.toLowerCase().includes(text) || (p.description||'').toLowerCase().includes(text))) return false;\r\n      return true;\r\n    });\r\n  }, [items, q, statusFilter]);\r\n\r\n  const paged = useMemo(()=>{\r\n    const start = (page-1)*pageSize;\r\n    return filtered.slice(start, start+pageSize);\r\n  }, [filtered, page]);\r\n\r\n  const pageCount = useMemo(()=> Math.max(1, Math.ceil(filtered.length / pageSize)), [filtered.length]);\r\n\r\n  const computeDiscount = (promo, orderAmount) => {\r\n    const amt = Number(orderAmount||0); if(!promo || !(amt>0)) return { discount:0, final: amt };\r\n    if(promo.discountType === 'PERCENT') {\r\n      let raw = amt * (Number(promo.discountValue||0)/100);\r\n      if(promo.maxDiscount) raw = Math.min(raw, Number(promo.maxDiscount));\r\n      return { discount: raw, final: Math.max(0, amt - raw) };\r\n    }\r\n    const raw = Number(promo.discountValue||0);\r\n    return { discount: Math.min(raw, amt), final: Math.max(0, amt - raw) };\r\n  };\r\n\r\n  const load = async() => {\r\n    if(!isAdminOrStaff) return;\r\n    setLoading(true); setError('');\r\n    try {\r\n      // Tạm thời gọi thử endpoint nếu có, nếu 404 → giả lập mock\r\n      const res = await fetch('/api/admin/promotions', { headers: authHeaders(), cache:'no-store' });\r\n      if(!res.ok) throw new Error('Không tải được danh sách ưu đãi');\r\n      const j = await res.json();\r\n      const list = Array.isArray(j.items)? j.items: Array.isArray(j.promotions)? j.promotions: [];\r\n      setItems(list.map(r=> ({ ...r })));\r\n    } catch(e){\r\n      console.warn('[AdminPromotions] load error:', e.message);\r\n      setError(e.message || 'Lỗi tải dữ liệu');\r\n      // Không còn tự động tạo mock để tránh nhầm trạng thái thực tế vs giả lập\r\n      setItems([]);\r\n    } finally { setLoading(false); }\r\n  };\r\n  useEffect(()=>{ load(); }, []);\r\n\r\n  useEffect(()=>{ if(debounceRef.current) clearTimeout(debounceRef.current); debounceRef.current = setTimeout(()=> setPage(1), 300); return ()=> debounceRef.current && clearTimeout(debounceRef.current); }, [q, statusFilter]);\r\n\r\n  const openCreate = () => { setForm(emptyForm); setCreateOpen(true); };\r\n\r\n  const validateForm = (data) => {\r\n    if(!data.code.trim()) return 'Nhập mã ưu đãi';\r\n    if(!/^[-A-Z0-9_]+$/i.test(data.code.trim())) return 'Mã chỉ gồm chữ, số, -, _';\r\n    if(!data.discountType) return 'Chọn loại giảm';\r\n    const val = Number(data.discountValue); if(!(val>0)) return 'Giá trị giảm phải > 0';\r\n    if(data.discountType==='PERCENT' && val>100) return 'Phần trăm ≤ 100';\r\n    // Normalize to date-only for validation (strip any time component)\r\n    const sDate = data.startDate ? String(data.startDate).slice(0,10) : '';\r\n    const eDate = data.endDate ? String(data.endDate).slice(0,10) : '';\r\n    if(!sDate || !eDate) return 'Chọn thời gian hiệu lực';\r\n    if(new Date(eDate) <= new Date(sDate)) return 'Ngày kết thúc phải sau ngày bắt đầu';\r\n    if(data.minOrderAmount && !(Number(data.minOrderAmount)>=0)) return 'Đơn tối thiểu không hợp lệ';\r\n    if(data.discountType==='PERCENT' && data.maxDiscount && !(Number(data.maxDiscount)>0)) return 'Giảm tối đa phải > 0';\r\n    return '';\r\n  };\r\n\r\n  const submitCreate = async () => {\r\n    const err = validateForm(form); if(err){ alert(err); return; }\r\n    setCreating(true);\r\n    try {\r\n      // Strip time component: send date-only (YYYY-MM-DD) to server/DB\r\n      const startDateOnly = form.startDate ? String(form.startDate).slice(0,10) : null;\r\n      const endDateOnly = form.endDate ? String(form.endDate).slice(0,10) : null;\r\n      const payload = { ...form, discountValue: Number(form.discountValue), minOrderAmount: form.minOrderAmount? Number(form.minOrderAmount): null, maxDiscount: form.maxDiscount? Number(form.maxDiscount): null, startDate: startDateOnly, endDate: endDateOnly };\r\n      const res = await fetch('/api/admin/promotions', { method:'POST', headers:{ 'Content-Type':'application/json', ...authHeaders() }, body: JSON.stringify(payload) });\r\n      if(!res.ok) throw new Error('Tạo ưu đãi thất bại');\r\n      setCreateOpen(false); setForm(emptyForm); load();\r\n    } catch(e){ alert(e.message || 'Lỗi tạo'); } finally { setCreating(false); }\r\n  };\r\n\r\n  const openEdit = (row) => { setEditing(row); setForm({ ...emptyForm, ...row, startDate: row.startDate?.slice(0,16) || '', endDate: row.endDate?.slice(0,16) || '' }); setCreateOpen(true); };\r\n  \r\n  // Normalize edit values to date-only (YYYY-MM-DD)\r\n  const openEditNormalized = (row) => { setEditing(row); setForm({ ...emptyForm, ...row, startDate: row.startDate ? String(row.startDate).slice(0,10) : '', endDate: row.endDate ? String(row.endDate).slice(0,10) : '' }); setCreateOpen(true); };\r\n\r\n  const submitEdit = async () => {\r\n    if(!editing) return; const err = validateForm(form); if(err){ alert(err); return; }\r\n    setSaving(true);\r\n    try {\r\n      // Send date-only values (YYYY-MM-DD) to avoid time components being stored\r\n      const startDateOnly = form.startDate ? String(form.startDate).slice(0,10) : null;\r\n      const endDateOnly = form.endDate ? String(form.endDate).slice(0,10) : null;\r\n      const payload = { description: form.description, discountType: form.discountType, discountValue: Number(form.discountValue), startDate: startDateOnly, endDate: endDateOnly, minOrderAmount: form.minOrderAmount? Number(form.minOrderAmount): null, maxDiscount: form.maxDiscount? Number(form.maxDiscount): null, isActive: form.isActive };\r\n      const res = await fetch(`/api/admin/promotions/${editing.id}`, { method:'PUT', headers:{ 'Content-Type':'application/json', ...authHeaders() }, body: JSON.stringify(payload) });\r\n      if(!res.ok) throw new Error('Cập nhật thất bại');\r\n      setCreateOpen(false); setEditing(null); load();\r\n    } catch(e){ alert(e.message || 'Lỗi cập nhật'); } finally { setSaving(false); }\r\n  };\r\n\r\n  const toggleActive = async (row) => {\r\n    // Optimistic\r\n    setItems(prev => prev.map(p => p.id===row.id? { ...p, isActive: !p.isActive }: p));\r\n    try {\r\n      const res = await fetch(`/api/admin/promotions/${row.id}/activate`, { method:'PATCH', headers:{ 'Content-Type':'application/json', ...authHeaders() }, body: JSON.stringify({ isActive: !row.isActive }) });\r\n      if(!res.ok) throw new Error('Cập nhật trạng thái thất bại');\r\n    } catch(e){\r\n      setItems(prev => prev.map(p => p.id===row.id? { ...p, isActive: row.isActive }: p));\r\n      alert(e.message || 'Lỗi');\r\n    }\r\n  };\r\n\r\n  const del = async (row) => {\r\n    if(!window.confirm('Xóa ưu đãi này?')) return;\r\n    try {\r\n      const res = await fetch(`/api/admin/promotions/${row.id}`, { method:'DELETE', headers: authHeaders() });\r\n      if(!res.ok) throw new Error('Xóa thất bại');\r\n      load();\r\n    } catch(e){ alert(e.message || 'Lỗi xóa'); }\r\n  };\r\n\r\n  if(!isAdminOrStaff) return <div style={{ padding:16 }}>Chức năng dành cho quản trị / nhân viên.</div>;\r\n\r\n  return (\r\n    <div className=\"af-container amenities-anim-root\" style={{ padding:12 }}>\r\n      <h2 className=\"home-rooms-title\" style={{ textAlign:'left', marginTop:0 }}>Quản lý ưu đãi / mã khuyến mãi</h2>\r\n      <div className=\"reports-toolbar af-toolbar\" style={{ marginBottom:10, flexWrap:'wrap', gap:8 }}>\r\n        <div className=\"reports-field af-field-grow\" style={{ minWidth:240 }}>\r\n          <input className=\"reports-input\" placeholder=\"Tìm theo mã hoặc mô tả...\" value={q} onChange={e=>setQ(e.target.value)} />\r\n        </div>\r\n        <div className=\"reports-field\" style={{ minWidth:180 }}>\r\n          <select className=\"reports-select\" value={statusFilter} onChange={e=>setStatusFilter(e.target.value)} style={{ height:38 }}>\r\n            <option value=\"all\">Tất cả trạng thái</option>\r\n            <option value=\"active\">Active</option>\r\n            <option value=\"scheduled\">Scheduled</option>\r\n            <option value=\"expired\">Expired</option>\r\n            <option value=\"disabled\">Disabled</option>\r\n          </select>\r\n        </div>\r\n        <div className=\"reports-field\" style={{ display:'flex', gap:8 }}>\r\n          {isAdmin && <button className=\"ph-btn\" onClick={openCreate}>+ Thêm ưu đãi</button>}\r\n        </div>\r\n      </div>\r\n      {loading ? <div style={{ color:'#666' }}>Đang tải...</div> : error ? <div style={{ color:'#b42318' }}>{error}</div> : (\r\n        <div style={{ overflowX:'auto' }}>\r\n          <table className=\"ph-table-el af-table\" style={{ width:'100%', minWidth:1080 }}>\r\n            <thead>\r\n              <tr>\r\n                <th>Mã</th>\r\n                <th>Mô tả</th>\r\n                <th>Loại</th>\r\n                <th>Giá trị</th>\r\n                <th>Hiệu lực</th>\r\n                <th>Điều kiện</th>\r\n                <th>Trạng thái</th>\r\n                <th>Hành động</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {paged.length===0 ? <tr><td colSpan={8} style={{ textAlign:'center', color:'#666' }}>Không có ưu đãi.</td></tr> : paged.map(p => {\r\n                const st = statusOf(p);\r\n                const amt = Number(previewAmount||0);\r\n                const { discount, final } = computeDiscount(p, (amt && (!p.minOrderAmount || amt >= Number(p.minOrderAmount)))? amt: 0);\r\n                return (\r\n                  <tr key={p.id} className=\"amenity-row\">\r\n                    <td className=\"ph-td\" style={{ fontWeight:600 }} title={`ID: ${p.id}`}>{p.code}</td>\r\n                    <td className=\"ph-td\" style={{ maxWidth:220 }} title={p.description}>{p.description || '—'}</td>\r\n                    <td className=\"ph-td\">{p.discountType === 'PERCENT'? 'Phần trăm':'Cố định'}</td>\r\n                    <td className=\"ph-td\">{p.discountType === 'PERCENT'? `${p.discountValue}%${p.maxDiscount? ` (tối đa ${Number(p.maxDiscount).toLocaleString('vi-VN')}đ)` : ''}` : `${Number(p.discountValue).toLocaleString('vi-VN')} đ`}</td>\r\n                    <td className=\"ph-td\" style={{ fontSize:12 }}>\r\n                      <div>{p.startDate ? new Date(p.startDate).toLocaleDateString('vi-VN') : '—'}</div>\r\n                      <div style={{ opacity:.8 }}>{p.endDate ? new Date(p.endDate).toLocaleDateString('vi-VN') : '—'}</div>\r\n                    </td>\r\n                    <td className=\"ph-td\" style={{ fontSize:12 }}>\r\n                      {p.minOrderAmount ? <div>Tối thiểu: {Number(p.minOrderAmount).toLocaleString('vi-VN')}đ</div> : <div>—</div>}\r\n                      {p.discountType==='PERCENT' && p.maxDiscount && <div>Giảm tối đa: {Number(p.maxDiscount).toLocaleString('vi-VN')}đ</div>}\r\n                      {previewAmount && discount>0 && <div style={{ marginTop:4, color:'#047857' }}>Giảm: {Math.round(discount).toLocaleString('vi-VN')}đ<br/>Còn: {Math.round(final).toLocaleString('vi-VN')}đ</div>}\r\n                    </td>\r\n                    <td className=\"ph-td\" style={{ fontWeight:600 }}>\r\n                      <span className={`promo-badge promo-${st.toLowerCase()}`}>{st}</span>\r\n                    </td>\r\n                    <td className=\"ph-td\" style={{ whiteSpace:'nowrap' }}>\r\n                      <button className=\"ph-btn ph-btn--success\" onClick={()=> openEditNormalized(p)}>Sửa</button>\r\n                      <button className=\"ph-btn ph-btn--warning\" onClick={()=> toggleActive(p)}>{p.isActive? 'Tắt':'Bật'}</button>\r\n                      {isAdmin && <button className=\"ph-btn ph-btn--danger\" onClick={()=> del(p)}>Xóa</button>}\r\n                    </td>\r\n                  </tr>\r\n                );\r\n              })}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n\r\n      <div style={{ marginTop:10, display:'flex', gap:12, alignItems:'center', flexWrap:'wrap' }}>\r\n        <div style={{ display:'flex', gap:6, alignItems:'center' }}>\r\n          <label style={{ fontSize:13 }}>Xem thử đơn hàng (VND):</label>\r\n          <input type=\"number\" style={{ width:140 }} value={previewAmount} onChange={e=> setPreviewAmount(e.target.value)} placeholder=\"Nhập số tiền\" />\r\n        </div>\r\n        <div style={{ marginLeft:'auto', display:'flex', gap:6, alignItems:'center' }}>\r\n          <button className=\"ph-btn\" disabled={page<=1} onClick={()=> setPage(p=> Math.max(1,p-1))}>◀</button>\r\n          <span style={{ fontSize:13 }}>Trang {page}/{pageCount}</span>\r\n          <button className=\"ph-btn\" disabled={page>=pageCount} onClick={()=> setPage(p=> Math.min(pageCount,p+1))}>▶</button>\r\n        </div>\r\n      </div>\r\n\r\n      {createOpen && (\r\n        <div className=\"profile-overlay\" onMouseDown={e=>{ if(e.target===e.currentTarget){ setCreateOpen(false); setEditing(null);} }}>\r\n          <div className=\"profile-modal\" onMouseDown={e=> e.stopPropagation()} style={{ width:720, maxWidth:'96%', background:'#fff', borderRadius:14, padding:18 }}>\r\n            <h3 style={{ marginTop:0, textAlign:'center' }}>{editing? 'Chỉnh sửa ưu đãi' : 'Tạo ưu đãi mới'}</h3>\r\n            <div style={{ display:'grid', gridTemplateColumns:'repeat(auto-fit, minmax(240px,1fr))', gap:16 }}>\r\n              <label style={{ display:'flex', flexDirection:'column', gap:4 }}>Mã ưu đãi\r\n                <input value={form.code} disabled={!!editing} onChange={e=> setForm(f=> ({ ...f, code:e.target.value.toUpperCase() }))} placeholder=\"WELCOME10\" />\r\n              </label>\r\n              <label style={{ display:'flex', flexDirection:'column', gap:4 }}>Loại giảm\r\n                <select value={form.discountType} onChange={e=> setForm(f=> ({ ...f, discountType:e.target.value }))}>\r\n                  <option value=\"PERCENT\">Phần trăm</option>\r\n                  <option value=\"FIXED\">Cố định</option>\r\n                </select>\r\n              </label>\r\n              <label style={{ display:'flex', flexDirection:'column', gap:4 }}>Giá trị giảm\r\n                <input type=\"number\" value={form.discountValue} onChange={e=> setForm(f=> ({ ...f, discountValue:e.target.value }))} placeholder=\"10 hoặc 100000\" />\r\n              </label>\r\n              <label style={{ display:'flex', flexDirection:'column', gap:4 }}>Giảm tối đa (nếu %)\r\n                <input type=\"number\" value={form.maxDiscount} disabled={form.discountType!=='PERCENT'} onChange={e=> setForm(f=> ({ ...f, maxDiscount:e.target.value }))} placeholder=\"200000\" />\r\n              </label>\r\n              <label style={{ display:'flex', flexDirection:'column', gap:4 }}>Đơn tối thiểu\r\n                <input type=\"number\" value={form.minOrderAmount} onChange={e=> setForm(f=> ({ ...f, minOrderAmount:e.target.value }))} placeholder=\"500000\" />\r\n              </label>\r\n              <label style={{ display:'flex', flexDirection:'column', gap:4 }}>Ngày bắt đầu\r\n                <input type=\"date\" value={form.startDate} onChange={e=> setForm(f=> ({ ...f, startDate:e.target.value }))} />\r\n              </label>\r\n              <label style={{ display:'flex', flexDirection:'column', gap:4 }}>Ngày kết thúc\r\n                <input type=\"date\" value={form.endDate} onChange={e=> setForm(f=> ({ ...f, endDate:e.target.value }))} />\r\n              </label>\r\n              <label style={{ display:'flex', flexDirection:'row', gap:8, alignItems:'center', marginTop:6 }}>Kích hoạt\r\n                <input type=\"checkbox\" checked={!!form.isActive} onChange={e=> setForm(f=> ({ ...f, isActive:e.target.checked }))} />\r\n              </label>\r\n              <label style={{ gridColumn:'1 / -1', display:'flex', flexDirection:'column', gap:4 }}>Mô tả\r\n                <textarea rows={3} value={form.description} onChange={e=> setForm(f=> ({ ...f, description:e.target.value }))} placeholder=\"Mô tả ngắn...\" />\r\n              </label>\r\n            </div>\r\n            {/* Live preview */}\r\n            <div style={{ marginTop:12, background:'#f8fafc', padding:'10px 12px', borderRadius:10, fontSize:13 }}>\r\n              <strong>Xem nhanh:</strong>{' '}\r\n              {(() => {\r\n                const testAmt = Number(previewAmount||0);\r\n                if(!(testAmt>0)) return <span>Nhập số tiền đơn hàng ở dưới danh sách để xem mức giảm.</span>;\r\n                const mockPromo = { ...form, discountValue: Number(form.discountValue||0), maxDiscount: form.maxDiscount? Number(form.maxDiscount): null };\r\n                const { discount, final } = computeDiscount(mockPromo, testAmt);\r\n                if(!discount) return <span>Không áp dụng (chưa đủ điều kiện hoặc dữ liệu thiếu).</span>;\r\n                return <span>Giảm {Math.round(discount).toLocaleString('vi-VN')}đ còn {Math.round(final).toLocaleString('vi-VN')}đ.</span>;\r\n              })()}\r\n            </div>\r\n            <div style={{ marginTop:18, display:'flex', gap:12, justifyContent:'center' }}>\r\n              {editing ? (\r\n                <>\r\n                  <button className=\"ph-btn\" onClick={submitEdit} disabled={saving}>{saving? 'Đang lưu...':'Lưu thay đổi'}</button>\r\n                  <button className=\"ph-btn ph-btn--secondary\" onClick={()=> { setCreateOpen(false); setEditing(null); }}>Hủy</button>\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <button className=\"ph-btn\" onClick={submitCreate} disabled={creating}>{creating? 'Đang tạo...':'Tạo mới'}</button>\r\n                  <button className=\"ph-btn ph-btn--secondary\" onClick={()=> { setCreateOpen(false); setEditing(null); }}>Hủy</button>\r\n                </>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <style>{`\r\n        .promo-badge { display:inline-block; padding:4px 8px; font-size:11px; line-height:1; border-radius:20px; letter-spacing:.3px; }\r\n        .promo-active { background:#e6f7ec; color:#087443; border:1px solid #b2e7c9; }\r\n        .promo-scheduled { background:#f0f4ff; color:#1d4ed8; border:1px solid #c7d8ff; }\r\n        .promo-expired { background:#ffe8e6; color:#b42318; border:1px solid #f5b5ae; }\r\n        .promo-disabled { background:#f1f5f9; color:#475569; border:1px solid #d3dce4; }\r\n\r\n        .af-table th, .af-table td { padding:6px 8px; vertical-align:middle; }\r\n        .af-table input, .af-table select, .af-table textarea { font-size:14px; border:1px solid #d7dbe0; border-radius:6px; background:#fff; }\r\n        .af-table input, .af-table select { height:32px; line-height:32px; padding:4px 8px; }\r\n        .af-table textarea { padding:6px 8px; }\r\n\r\n        .ph-btn { cursor:pointer; }\r\n        .profile-overlay { backdrop-filter: blur(2px); }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}