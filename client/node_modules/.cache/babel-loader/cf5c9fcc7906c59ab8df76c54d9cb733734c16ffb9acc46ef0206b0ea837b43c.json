{"ast":null,"code":"var _jsxFileName = \"D:\\\\Git\\\\HMSAI-Hotel\\\\client\\\\src\\\\PaymentHistory.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport './HomePage.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst STATUS_META = {\n  paid: {\n    text: 'Đã thanh toán',\n    cls: 'ok'\n  },\n  pending: {\n    text: 'Chờ thanh toán',\n    cls: 'pending'\n  },\n  canceled: {\n    text: 'Hủy',\n    cls: 'cancel'\n  }\n};\nexport default function PaymentHistory({\n  inline = false,\n  onReview\n}) {\n  _s();\n  const navigate = useNavigate();\n  const [user, setUser] = useState(null);\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [q, setQ] = useState('');\n  const [fromDate, setFromDate] = useState(() => {\n    const now = new Date();\n    const start = new Date(now.getFullYear(), now.getMonth(), 1);\n    return toISODate(start);\n  });\n  const [toDate, setToDate] = useState(() => {\n    const now = new Date();\n    const end = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n    return toISODate(end);\n  });\n  const [status, setStatus] = useState('all');\n  const [page, setPage] = useState(1);\n  const pageSize = 10;\n  // Invoice state\n  const [invoiceItem, setInvoiceItem] = useState(null);\n  const [invoiceHotel, setInvoiceHotel] = useState(null);\n  const [invoiceLoading, setInvoiceLoading] = useState(false);\n  const [invoiceOpenedAt, setInvoiceOpenedAt] = useState(null); // thời điểm mở hóa đơn\n\n  useEffect(() => {\n    try {\n      const u = localStorage.getItem('hmsUser');\n      setUser(u ? JSON.parse(u) : null);\n    } catch {\n      setUser(null);\n    }\n  }, []);\n  const fetchList = async () => {\n    if (!(user !== null && user !== void 0 && user.email)) return;\n    setLoading(true);\n    setError('');\n    try {\n      const url = new URL('/api/transactions', window.location.origin);\n      url.searchParams.set('email', user.email);\n      if (q) url.searchParams.set('q', q);\n      if (status && status !== 'all') url.searchParams.set('status', status);\n      if (fromDate) url.searchParams.set('from', fromDate);\n      if (toDate) url.searchParams.set('to', toDate);\n      const res = await fetch(url.toString());\n      if (!res.ok) throw new Error('Không tải được dữ liệu');\n      const j = await res.json();\n      const rawItems = j && Array.isArray(j.items) ? j.items : [];\n      let raw = rawItems.map(it => ({\n        ...it\n      }));\n      raw = raw.map(it => {\n        const roomTotal = Number(it.roomTotal != null ? it.roomTotal : it.total);\n        const serviceTotal = Number(it.serviceTotal || 0);\n        const grandTotal = Number(it.grandTotal != null ? it.grandTotal : roomTotal + serviceTotal);\n        return {\n          ...it,\n          total: roomTotal,\n          roomTotal,\n          serviceTotal,\n          grandTotal\n        };\n      });\n      // Rehydrate refund info for canceled bookings (prefer server data)\n      raw = raw.map(it => {\n        const paymentStatus = String(it.paymentStatus || '').toLowerCase();\n        const refundStatus = String(it.refundStatus || '');\n        const depositFromServer = Math.round(Number(it.depositAmount || 0));\n        const refundFromServer = Math.round(Number(it.refundAmount || 0));\n        const base = {\n          ...it,\n          depositAmount: depositFromServer,\n          refundAmount: refundFromServer > 0 ? refundFromServer : null,\n          refundStatus\n        };\n        if (paymentStatus === 'canceled') {\n          let depositBase = depositFromServer;\n          if (!(depositBase > 0)) {\n            const totalFallback = Math.round(Number(it.total || 0) * 0.2);\n            if (totalFallback > 0) depositBase = totalFallback;\n          }\n          if (refundFromServer > 0) {\n            const cancellationFee = depositBase > 0 ? Math.max(0, depositBase - refundFromServer) : 0;\n            const cancellationSource = refundStatus.toLowerCase().includes('admin') ? 'admin' : 'user';\n            return {\n              ...base,\n              depositAmount: depositBase,\n              refundAmount: refundFromServer,\n              cancellationFee,\n              cancellationSource\n            };\n          }\n\n          // Server lacks refund info — try cached client data\n          try {\n            const cache = localStorage.getItem('refund:' + it.bookingId);\n            if (cache) {\n              const parsed = JSON.parse(cache);\n              if (parsed && typeof parsed.refundAmount !== 'undefined') {\n                const refundAmount = Math.round(Number(parsed.refundAmount || 0));\n                const cancellationFee = depositBase > 0 ? Math.max(0, depositBase - refundAmount) : Number(parsed.cancellationFee || 0);\n                const depositVal = parsed.depositAmount != null ? Math.round(Number(parsed.depositAmount || 0)) : depositBase;\n                return {\n                  ...base,\n                  refundAmount,\n                  cancellationFee,\n                  depositAmount: depositVal,\n                  cancellationSource: parsed.cancellationSource || 'user'\n                };\n              }\n            }\n          } catch {}\n          if (depositBase > 0) {\n            // Default user-cancel assumption: refund 85%, keep 15%\n            const refundAmount = Math.round(depositBase * 0.85);\n            const cancellationFee = depositBase - refundAmount;\n            return {\n              ...base,\n              depositAmount: depositBase,\n              refundAmount,\n              cancellationFee,\n              cancellationSource: 'user'\n            };\n          }\n          const total = Number(it.total) || 0;\n          if (total > 0) {\n            const fallbackDeposit = Math.round(total * 0.2);\n            const refundAmount = Math.round(fallbackDeposit * 0.85);\n            const cancellationFee = fallbackDeposit - refundAmount;\n            return {\n              ...base,\n              refundAmount,\n              cancellationFee,\n              depositAmount: fallbackDeposit,\n              cancellationSource: 'user'\n            };\n          }\n        }\n        return base;\n      });\n      setItems(raw);\n    } catch (e) {\n      setError(e.message || 'Lỗi tải dữ liệu');\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    fetchList();\n  }, [user]);\n  const filtered = useMemo(() => items, [items]);\n  const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));\n  const pageItems = filtered.slice((page - 1) * pageSize, page * pageSize);\n  const topScrollRef = useRef(null);\n  const tableRef = useRef(null);\n  const bottomScrollRef = useRef(null);\n  const [hasOverflow, setHasOverflow] = useState(false);\n\n  // Detect horizontal overflow (table wider than visible container)\n  useEffect(() => {\n    const check = () => {\n      const tableEl = tableRef.current;\n      const topEl = topScrollRef.current;\n      if (!tableEl || !topEl) {\n        setHasOverflow(false);\n        return;\n      }\n      const overflow = tableEl.scrollWidth > topEl.clientWidth + 5; // small tolerance\n      setHasOverflow(overflow);\n    };\n    check();\n    window.addEventListener('resize', check);\n    return () => window.removeEventListener('resize', check);\n  }, [filtered.length, pageItems.length]);\n\n  // Sync horizontal scroll between top (table container) and bottom (pinned bar)\n  useEffect(() => {\n    const topEl = topScrollRef.current;\n    const botEl = bottomScrollRef.current;\n    if (!topEl || !botEl) return;\n    let syncing = false;\n    const sync = (src, target) => {\n      if (syncing) return;\n      syncing = true;\n      if (target.scrollLeft !== src.scrollLeft) target.scrollLeft = src.scrollLeft;\n      syncing = false;\n    };\n    const onTop = () => sync(topEl, botEl);\n    const onBot = () => sync(botEl, topEl);\n    topEl.addEventListener('scroll', onTop);\n    botEl.addEventListener('scroll', onBot);\n    return () => {\n      topEl.removeEventListener('scroll', onTop);\n      botEl.removeEventListener('scroll', onBot);\n    };\n  }, [filtered.length, hasOverflow]);\n  const openInvoice = async row => {\n    setInvoiceItem(null);\n    setInvoiceHotel(null);\n    setInvoiceLoading(true);\n    try {\n      // Enrich row with userName fallback if missing so tên khách hàng luôn hiện\n      const enriched = {\n        ...row\n      };\n      if (!enriched.userName && user) {\n        // user may have fullName or name fields (guess); fallback to email before '@'\n        const uName = user.fullName || user.name || user.userName || (user.email ? user.email.split('@')[0] : '');\n        if (uName) enriched.userName = uName;\n      }\n      setInvoiceItem(enriched);\n      setInvoiceOpenedAt(new Date());\n    } catch {/* ignore */} finally {\n      setInvoiceLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: (inline ? '' : 'home-root') + ' ph-root',\n    style: {\n      paddingTop: inline ? 0 : 80\n    },\n    children: [!inline && /*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"home-header\",\n      style: {\n        position: 'sticky',\n        top: 0\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"home-header-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/logo.png\",\n          alt: \"logo\",\n          className: \"home-header-logo\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/\",\n          className: \"home-header-title home-header-home-btn\",\n          children: \"TRANG CH\\u1EE6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"home-header-icons\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/login\",\n          className: \"home-header-icon\",\n          title: \"\\u0110\\u0103ng nh\\u1EADp\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"/icon-user.png\",\n            alt: \"user\",\n            className: \"home-header-icon-img\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: inline ? '6px' : '16px 12px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"home-rooms-title\",\n        style: {\n          textAlign: 'left',\n          marginTop: 12\n        },\n        children: \"L\\u1ECBch s\\u1EED giao d\\u1ECBch\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rt-toolbar\",\n        style: {\n          alignItems: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-field rt-field--wide\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"T\\u1EEB kh\\xF3a\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"VD: HMS20250904 ho\\u1EB7c HMS-AI \\u0110\\xE0 N\\u1EB5ng\",\n            value: q,\n            onChange: e => setQ(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-field\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"T\\u1EEB ng\\xE0y\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            value: fromDate,\n            onChange: e => setFromDate(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-field\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"\\u0110\\u1EBFn ng\\xE0y\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            value: toDate,\n            min: fromDate || undefined,\n            onChange: e => setToDate(e.target.value)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-field\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            children: \"Tr\\u1EA1ng th\\xE1i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n            value: status,\n            onChange: e => setStatus(e.target.value),\n            children: [/*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"all\",\n              children: \"T\\u1EA5t c\\u1EA3\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"paid\",\n              children: \"\\u0110\\xE3 thanh to\\xE1n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"pending\",\n              children: \"Ch\\u1EDD thanh to\\xE1n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n              value: \"canceled\",\n              children: \"H\\u1EE7y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ph-btn\",\n          onClick: () => {\n            setPage(1);\n            fetchList();\n          },\n          children: \"T\\xECm ki\\u1EBFm\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"ph-btn ph-btn--secondary\",\n          onClick: () => exportCsv(filtered),\n          children: \"Xu\\u1EA5t CSV\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          overflowX: 'auto',\n          maxWidth: '100%'\n        },\n        ref: topScrollRef,\n        className: \"ph-scroll-top\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: tableRef,\n          className: \"ph-table\",\n          role: \"table\",\n          \"aria-label\": \"L\\u1ECBch s\\u1EED giao d\\u1ECBch\",\n          style: {\n            minWidth: 1700\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ph-tr ph-head ph-hist\",\n            role: \"row\",\n            children: ['MÃ ĐẶT PHÒNG', 'KHÁCH SẠN', 'PHÒNG', 'LOẠI PHÒNG', 'NHẬN PHÒNG', 'TRẢ PHÒNG', 'SỐ ĐÊM', 'KHÁCH', 'GIÁ/ĐÊM', 'TIỀN PHÒNG', 'TIỀN DỊCH VỤ', 'TỔNG THANH TOÁN', 'TRẠNG THÁI', 'THỜI GIAN TT', 'PTTT', 'HÀNH ĐỘNG'].map(h => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              role: \"columnheader\",\n              children: h\n            }, h, false, {\n              fileName: _jsxFileName,\n              lineNumber: 235,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 233,\n            columnNumber: 13\n          }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ph-empty\",\n            children: \"\\u0110ang t\\u1EA3i...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 15\n          }, this) : error ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ph-empty\",\n            style: {\n              color: '#c1121f'\n            },\n            children: error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 15\n          }, this) : pageItems.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ph-empty\",\n            children: \"Ch\\u01B0a c\\xF3 giao d\\u1ECBch\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 15\n          }, this) : pageItems.map(it => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ph-tr ph-hist\",\n            role: \"row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td code\",\n              children: it.code\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 247,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: it.hotelName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 248,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: it.roomName || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 249,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: it.roomType || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: fmtDateTime(it.checkIn)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: fmtDateTime(it.checkOut)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td center\",\n              children: it.nights\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: it.guests\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td right\",\n              children: [fmtMoney(it.pricePerNight), \" VND\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td right\",\n              children: [fmtMoney(it.roomTotal), \" VND\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 256,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td right\",\n              children: it.serviceTotal > 0 ? `${fmtMoney(it.serviceTotal)} VND` : '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 257,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td right\",\n              children: [fmtMoney(it.grandTotal), \" VND\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: /*#__PURE__*/_jsxDEV(StatusBadge, {\n                status: it.paymentStatus\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 259,\n                columnNumber: 42\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 259,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: it.paidAt ? fmtDateTime(it.paidAt) : '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 260,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td\",\n              children: it.method || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ph-td action ph-action-stack\",\n              children: [(() => {\n                const reviewedKey = 'reviewedBooking:' + it.bookingId;\n                let reviewed = false;\n                try {\n                  reviewed = !!localStorage.getItem(reviewedKey);\n                } catch {}\n                const reviewLabel = reviewed ? 'ĐÃ ĐÁNH GIÁ' : 'ĐÁNH GIÁ';\n                const commonCls = 'ph-action-btn ph-action-outline' + (reviewed ? ' disabled' : '');\n                if (typeof onReview === 'function') {\n                  return /*#__PURE__*/_jsxDEV(\"button\", {\n                    type: \"button\",\n                    className: commonCls,\n                    disabled: reviewed,\n                    onClick: e => {\n                      if (reviewed) return;\n                      onReview(it);\n                      try {\n                        localStorage.setItem(reviewedKey, '1');\n                      } catch {}\n                      ;\n                      setItems(list => list.map(x => x.bookingId === it.bookingId ? {\n                        ...x\n                      } : x));\n                    },\n                    children: reviewLabel\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 270,\n                    columnNumber: 27\n                  }, this);\n                } else {\n                  return /*#__PURE__*/_jsxDEV(\"a\", {\n                    href: buildReviewHref(it),\n                    className: commonCls + ' link-as-btn',\n                    onClick: e => {\n                      if (reviewed) {\n                        e.preventDefault();\n                        return;\n                      }\n                      try {\n                        localStorage.setItem(reviewedKey, '1');\n                      } catch {}\n                      ;\n                    },\n                    children: reviewLabel\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 274,\n                    columnNumber: 27\n                  }, this);\n                }\n              })(), it.paymentStatus === 'paid' && /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"ph-action-btn ph-action-primary\",\n                onClick: () => openInvoice(it),\n                children: \"H\\xD3A \\u0110\\u01A0N\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 23\n              }, this), it.paymentStatus === 'pending' && /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"ph-action-btn ph-action-danger\",\n                onClick: async () => {\n                  if (!window.confirm('Hủy giao dịch này? Hoàn 85% tiền cọc, giữ 15% phí.')) return;\n                  try {\n                    const uRaw = localStorage.getItem('hmsUser');\n                    const email = uRaw ? JSON.parse(uRaw).email : null;\n                    if (!email) {\n                      alert('Chưa đăng nhập');\n                      return;\n                    }\n                    const r = await fetch(`/api/payments/${it.bookingId}/cancel`, {\n                      method: 'PUT',\n                      headers: {\n                        'Content-Type': 'application/json'\n                      },\n                      body: JSON.stringify({\n                        email\n                      })\n                    });\n                    if (!r.ok) {\n                      const t = await r.text();\n                      throw new Error(t);\n                    }\n                    const j = await r.json();\n                    setItems(list => list.map(x => x.bookingId === it.bookingId ? {\n                      ...x,\n                      paymentStatus: 'canceled',\n                      refundAmount: j.refundAmount,\n                      cancellationFee: j.cancellationFee,\n                      depositAmount: j.depositAmount != null ? j.depositAmount : x.depositAmount\n                    } : x));\n                    try {\n                      localStorage.setItem('refund:' + it.bookingId, JSON.stringify({\n                        refundAmount: j.refundAmount,\n                        cancellationFee: j.cancellationFee,\n                        depositAmount: j.depositAmount,\n                        cancellationSource: 'user'\n                      }));\n                    } catch {}\n                  } catch (e) {\n                    alert(e.message || 'Hủy thất bại');\n                  }\n                },\n                children: \"H\\u1EE6Y\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 282,\n                columnNumber: 23\n              }, this), it.paymentStatus === 'canceled' && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ph-action-refund\",\n                children: [\"Ho\\xE0n: \", Number(it.refundAmount || 0).toLocaleString('vi-VN'), \" VND\", it.cancellationFee != null && /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [\" \\xB7 Ph\\xED gi\\u1EEF l\\u1EA1i: \", Number(it.cancellationFee).toLocaleString('vi-VN'), \" VND\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 300,\n                  columnNumber: 27\n                }, this), it.depositAmount != null && /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [\" \\xB7 C\\u1ECDc: \", Number(it.depositAmount).toLocaleString('vi-VN'), \" VND\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 303,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 297,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 262,\n              columnNumber: 19\n            }, this)]\n          }, it.bookingId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 17\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 9\n      }, this), hasOverflow && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ph-scroll-bottom-wrapper\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: bottomScrollRef,\n          className: \"ph-scroll-bottom\",\n          style: {\n            overflowX: 'auto',\n            overflowY: 'hidden',\n            maxWidth: '100%'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              width: tableRef.current ? tableRef.current.scrollWidth : 1700,\n              height: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ph-pager\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          disabled: page <= 1,\n          onClick: () => setPage(p => Math.max(1, p - 1)),\n          children: \"\\xAB\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 11\n        }, this), Array.from({\n          length: totalPages\n        }, (_, i) => i + 1).slice(0, 5).map(n => /*#__PURE__*/_jsxDEV(\"button\", {\n          className: n === page ? 'active' : '',\n          onClick: () => setPage(n),\n          children: n\n        }, n, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 13\n        }, this)), /*#__PURE__*/_jsxDEV(\"button\", {\n          disabled: page >= totalPages,\n          onClick: () => setPage(p => Math.min(totalPages, p + 1)),\n          children: \"\\xBB\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }, this), invoiceItem && /*#__PURE__*/_jsxDEV(InvoiceModal, {\n      item: invoiceItem,\n      hotel: invoiceHotel,\n      openedAt: invoiceOpenedAt,\n      onClose: () => {\n        setInvoiceItem(null);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 189,\n    columnNumber: 3\n  }, this);\n}\n\n// ================= INVOICE HELPERS & MODAL =================\n_s(PaymentHistory, \"jHVoxl08cBTxYm/te/W221hw2AU=\", false, function () {\n  return [useNavigate];\n});\n_c = PaymentHistory;\nfunction buildInvoiceNumber(item) {\n  if (!item) return '';\n  const id = String(item.bookingId || '').padStart(6, '0');\n  // Use paid date or today for sequence prefix\n  const d = item.paidAt ? new Date(item.paidAt) : new Date();\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `HD${y}${m}${day}-${id}`;\n}\nfunction generateNightRows(item) {\n  if (!item) return [];\n  try {\n    const ci = new Date(item.checkIn);\n    const co = new Date(item.checkOut);\n    const rows = [];\n    let cursor = new Date(ci.getFullYear(), ci.getMonth(), ci.getDate());\n    let idx = 0;\n    while (cursor < co) {\n      if (idx > 60) {\n        // safety stop for abnormal data\n        rows.push({\n          date: fmtDate(cursor),\n          desc: 'Tiền phòng (gộp)',\n          qty: (item.nights || 0) - idx,\n          unit: item.pricePerNight,\n          amount: item.pricePerNight * ((item.nights || 0) - idx)\n        });\n        break;\n      }\n      rows.push({\n        date: fmtDate(cursor),\n        desc: 'Tiền phòng',\n        qty: 1,\n        unit: item.pricePerNight,\n        amount: item.pricePerNight\n      });\n      cursor = new Date(cursor.getFullYear(), cursor.getMonth(), cursor.getDate() + 1);\n      idx++;\n      if (idx >= (item.nights || 0)) break;\n    }\n    return rows;\n  } catch {\n    return [];\n  }\n}\nfunction calcInvoiceTotals(item, extra) {\n  if (!item) return {\n    roomTotal: 0,\n    serviceTotal: 0,\n    tax: 0,\n    grand: 0\n  };\n  const nightRows = generateNightRows(item);\n  const roomTotal = nightRows.reduce((s, r) => s + Number(r.amount || 0), 0);\n  const serviceTotal = extra && Array.isArray(extra.services) ? extra.services.reduce((s, r) => s + Number(r.amount || 0), 0) : 0;\n  const tax = Math.round(roomTotal * 0.03); // 3% VAT giả định\n  const grand = roomTotal + serviceTotal + tax;\n  return {\n    roomTotal,\n    serviceTotal,\n    tax,\n    grand,\n    nightRows\n  };\n}\nfunction InvoiceModal({\n  item,\n  hotel,\n  openedAt,\n  onClose\n}) {\n  var _nightRows$;\n  if (!item) return null;\n  const {\n    nightRows\n  } = calcInvoiceTotals(item, {});\n  const invoiceNo = buildInvoiceNumber(item);\n  // Họ tên tài khoản đặt phòng: ưu tiên userName -> customerName\n  const custName = item.userName && item.userName.trim() ? item.userName : item.customerName || 'Khách hàng';\n  const checkInTime = '14:00:00';\n  const checkOutTime = '12:00:00';\n  // Nén hiển thị: chỉ ngày bắt đầu & kết thúc chia số ngày thành 2 dòng\n  const totalNights = item.nights || nightRows.length || 0;\n  let startQty = Math.floor(totalNights / 2);\n  let endQty = totalNights - startQty;\n  if (startQty === 0 && endQty > 0) {\n    startQty = 1;\n    endQty = totalNights - 1;\n  }\n  const startDateStr = fmtDate(item.checkIn);\n  const endDateStr = fmtDate(item.checkOut);\n  const price = item.pricePerNight || ((_nightRows$ = nightRows[0]) === null || _nightRows$ === void 0 ? void 0 : _nightRows$.unit) || 0;\n  const startAmount = price * startQty;\n  const endAmount = price * endQty;\n  // Dịch vụ minibar nếu tồn tại trong item.services (giả định mảng) hoặc flags khác\n  let minibarRow = null;\n  if (Array.isArray(item.services)) {\n    const svc = item.services.find(s => /minibar|nước/i.test(s.name || ''));\n    if (svc) {\n      minibarRow = {\n        date: endDateStr,\n        desc: svc.name,\n        qty: svc.qty || 1,\n        unit: svc.price || svc.amount || 0,\n        amount: (svc.price || svc.amount || 0) * (svc.qty || 1)\n      };\n    }\n  }\n  // Nếu không có services, bỏ qua (không tự thêm giả) theo yêu cầu mới\n  const tableRows = [...(totalNights > 0 ? [{\n    date: startDateStr,\n    desc: 'Tiền phòng',\n    qty: startQty,\n    unit: price,\n    amount: startAmount\n  }] : []), ...(totalNights > 1 ? [{\n    date: endDateStr,\n    desc: 'Tiền phòng',\n    qty: endQty,\n    unit: price,\n    amount: endAmount\n  }] : []), ...(minibarRow ? [minibarRow] : [])];\n  const roomTotalDisplay = tableRows.filter(r => r.desc === 'Tiền phòng').reduce((s, r) => s + r.amount, 0);\n  const serviceTotalDisplay = tableRows.filter(r => r.desc !== 'Tiền phòng').reduce((s, r) => s + r.amount, 0);\n  const taxDisplay = Math.round(roomTotalDisplay * 0.03);\n  const grandDisplay = roomTotalDisplay + serviceTotalDisplay + taxDisplay;\n  const openedStamp = openedAt ? fmtDateTime(openedAt) : fmtDateTime(Date.now());\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"invoice-overlay\",\n    onMouseDown: e => {\n      if (e.target === e.currentTarget) onClose();\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"invoice-modal\",\n      onMouseDown: e => e.stopPropagation(),\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"inv-back-btn\",\n        onClick: onClose,\n        title: \"Quay l\\u1EA1i\",\n        children: \"\\u2190 Quay l\\u1EA1i\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"invoice-paper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inv-header-band\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inv-head-left\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: \"/logo.png\",\n              alt: \"Logo\",\n              className: \"inv-logo-img\",\n              onError: e => {\n                e.currentTarget.style.display = 'none';\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 417,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"inv-hotel-meta\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                children: (hotel === null || hotel === void 0 ? void 0 : hotel.name) || 'HMS - AI'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 419,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: (hotel === null || hotel === void 0 ? void 0 : hotel.address) || '03 Quang Trung - Đà Nẵng'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 420,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: (hotel === null || hotel === void 0 ? void 0 : hotel.phone) || '0388618687 · E: hms@gmail.com'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 421,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                children: (hotel === null || hotel === void 0 ? void 0 : hotel.website) || 'www.hmshotel.com'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 422,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inv-head-right\",\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              children: \"H\\xD3A \\u0110\\u01A0N\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 426,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"inv-meta-line\",\n              children: [\"S\\u1ED1 h\\xF3a \\u0111\\u01A1n: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: invoiceNo\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 427,\n                columnNumber: 58\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 427,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"inv-meta-line inv-meta-date\",\n              children: [\"Ng\\xE0y: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: openedStamp\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 428,\n                columnNumber: 66\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 428,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 425,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inv-top-cards\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inv-top-card\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"k-label\",\n              children: \"M\\xE3 \\u0111\\u1EB7t ph\\xF2ng\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 434,\n              columnNumber: 43\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"k-value code-link\",\n              children: item.code\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 434,\n              columnNumber: 86\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 434,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inv-top-card\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"k-label\",\n              children: \"Ngu\\u1ED3n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 435,\n              columnNumber: 43\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"k-value\",\n              children: \"123 - HMS-AI\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 435,\n              columnNumber: 79\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 435,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inv-top-card\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"k-label\",\n              children: \"Ph\\xF2ng\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 43\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"k-value\",\n              children: item.roomName || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 436,\n              columnNumber: 79\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 436,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inv-info-grid\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inv-info-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"T\\xEAn kh\\xE1ch h\\xE0ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 441,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value i-upper\",\n                children: custName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 441,\n                columnNumber: 88\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 441,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"Ng\\xE0y nh\\u1EADn ph\\xF2ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 442,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value i-link\",\n                children: fmtDate(item.checkIn)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 442,\n                columnNumber: 89\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 442,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"Ng\\xE0y tr\\u1EA3 ph\\xF2ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 443,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value i-link\",\n                children: fmtDate(item.checkOut)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 443,\n                columnNumber: 88\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 443,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"Lo\\u1EA1i ph\\xF2ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 444,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value i-link\",\n                children: item.roomType || '—'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 444,\n                columnNumber: 84\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 444,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 440,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"inv-info-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"Th\\u1EDDi gian \\u0111\\u1EBFn\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 447,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value i-time\",\n                children: checkInTime\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 447,\n                columnNumber: 87\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 447,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"Th\\u1EDDi gian tr\\u1EA3\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 448,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value i-time\",\n                children: checkOutTime\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 448,\n                columnNumber: 87\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 448,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"S\\u1ED1 \\u0111\\xEAm l\\u01B0u tr\\xFA\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value\",\n                children: totalNights\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 449,\n                columnNumber: 88\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 449,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-row\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-label\",\n                children: \"CMND/Passport\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 450,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"i-value i-link\",\n                children: item.identityNumber || '—'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 450,\n                columnNumber: 87\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 450,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 446,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"inv-table\",\n          children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n            children: /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"#\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Ng\\xE0y\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 458,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Ph\\xF2ng / N\\u1ED9i dung\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 459,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"S\\u1ED1 l\\u01B0\\u1EE3ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 460,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"\\u0110\\u01A1n gi\\xE1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 461,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                children: \"Th\\xE0nh ti\\u1EC1n\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 456,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 455,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: tableRows.map((r, i) => /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: i + 1\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 468,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: r.date\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 469,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: r.desc\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 470,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: r.qty\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 471,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: [fmtMoney(r.unit), \" VND\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 472,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                children: [fmtMoney(r.amount), \" VND\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 473,\n                columnNumber: 19\n              }, this)]\n            }, i, true, {\n              fileName: _jsxFileName,\n              lineNumber: 467,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 465,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n          className: \"inv-summary-table\",\n          children: /*#__PURE__*/_jsxDEV(\"tbody\", {\n            children: [/*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"Ti\\u1EC1n ph\\xF2ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 481,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"right\",\n                children: [fmtMoney(roomTotalDisplay), \" VND\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 481,\n                columnNumber: 38\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 481,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"Thu\\u1EBF\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 482,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"right\",\n                children: [fmtMoney(taxDisplay), \" VND\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 482,\n                columnNumber: 32\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 482,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"Ph\\xED d\\u1ECBch v\\u1EE5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 483,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"right\",\n                children: [fmtMoney(serviceTotalDisplay), \" VND\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 483,\n                columnNumber: 39\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 483,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"tr\", {\n              className: \"total\",\n              children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                children: \"T\\u1ED5ng ti\\u1EC1n\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 484,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                className: \"right\",\n                children: [fmtMoney(grandDisplay), \" VND\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 484,\n                columnNumber: 55\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 484,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 480,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 479,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inv-thanks\",\n          children: [\"Xin c\\u1EA3m \\u01A1n Qu\\xFD kh\\xE1ch \\u0111\\xE3 tin t\\u01B0\\u1EDFng v\\xE0 s\\u1EED d\\u1EE5ng d\\u1ECBch v\\u1EE5 c\\u1EE7a ch\\xFAng t\\xF4i.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 106\n          }, this), \"Ch\\xFAc Qu\\xFD kh\\xE1ch c\\xF3 m\\u1ED9t k\\u1EF3 ngh\\u0129 vui v\\u1EBB!\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 487,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"inv-sign-line\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"sign-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"L\\u1EC5 t\\xE2n\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 490,\n                columnNumber: 20\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 490,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sign-space\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"sign-watermark\",\n                children: \"HSMAI-Hotel\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 491,\n                columnNumber: 43\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"sign-line\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 491,\n                columnNumber: 94\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sign-name\",\n              children: \"Nh\\xF3m 1 HMSAI-Hotel\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 492,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 489,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"sign-col\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Kh\\xE1ch h\\xE0ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 495,\n                columnNumber: 20\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 495,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sign-space\",\n              style: {\n                height: 70\n              },\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"sign-line\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 496,\n                columnNumber: 63\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 496,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"sign-name\",\n              children: custName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 497,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 494,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 488,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n        children: `\n          .invoice-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:flex-start;justify-content:center;overflow:auto;z-index:4000;padding:30px 18px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}\n          .invoice-modal{background:#fff;border-radius:10px;max-width:960px;width:100%;box-shadow:0 14px 42px -6px rgba(0,0,0,.35);padding:4px 18px 20px;animation:invIn .4s ease;}\n          @keyframes invIn{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}\n          .invoice-actions{display:none;}\n          .inv-back-btn{position:absolute;top:8px;left:10px;background:#f1f5f9;border:1px solid #cbd5e1;color:#0f172a;font-weight:600;padding:6px 14px;border-radius:24px;cursor:pointer;font-size:13px;line-height:1;box-shadow:0 1px 2px rgba(0,0,0,.08);transition:.18s ease;background-image:linear-gradient(to bottom,#fff,#f1f5f9);} \n          .inv-back-btn:hover{background:#e2e8f0;}\n          .inv-back-btn:active{transform:translateY(1px);}\n          .inv-header-band{display:flex;gap:28px;align-items:center;justify-content:space-between;border:1px solid #d7dbe0;border-radius:8px;padding:14px 22px;margin-bottom:14px;position:relative;background:#fff;min-height:140px;}\n          .inv-header-band:after{content:\"\";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:#0f172a;opacity:.65;border-radius:2px;}\n          .inv-head-left,.inv-head-right{flex:1;}\n          .inv-head-left{display:flex;flex-direction:column;gap:6px;align-items:flex-start;}\n          .inv-logo{display:none;}\n          .inv-logo-img{display:block;max-height:90px;width:auto;margin:0 0 2px;}\n          .inv-hotel-meta{font-size:12px;line-height:1.5;color:#0f172a;font-weight:500;display:flex;flex-direction:column;justify-content:center;min-width:200px;}\n          .inv-head-right{display:flex;flex-direction:column;justify-content:center;align-items:flex-end;text-align:right;font-size:12px;line-height:1.5;}\n          .inv-head-right h1{margin:0 0 4px;font-size:18px;color:#0f172a;letter-spacing:.5px;}\n          .inv-meta-line{margin:2px 0;color:#0f172a;}\n          /* Removed .inv-sep & .inv-title-center after framing header */\n          .inv-top-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:20px;}\n          .inv-top-card{background:#fff;border:1px solid #d7dbe0;border-radius:6px;min-height:66px;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:8px 14px;}\n          .inv-top-card .k-label,.inv-top-card .k-value{width:100%;}\n          .k-label{font-size:11px;font-weight:600;color:#475569;text-transform:uppercase;letter-spacing:.4px;margin-bottom:4px;}\n          .k-value{font-size:14px;font-weight:700;color:#0f5fa8;}\n          .code-link{color:#0070c9;cursor:pointer;}\n          .inv-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;background:#fff;border:1px solid #d7dbe0;border-radius:6px;padding:14px 18px;margin-bottom:18px;}\n          .inv-info-col{display:flex;flex-direction:column;gap:10px;font-size:13px;}\n          .info-row{display:flex;justify-content:space-between;gap:12px;}\n          .i-label{color:#0f172a;font-weight:600;}\n          .i-value{font-weight:600;color:#0f5fa8;}\n          .i-link{color:#0070c9;}\n          .i-upper{text-transform:uppercase;}\n          .i-time{color:#0f5fa8;font-weight:700;}\n          .inv-table{width:100%;border-collapse:collapse;font-size:13px;margin-top:8px;}\n          .inv-table th{background:#0f5fa8;color:#fff;padding:8px 10px;font-size:12px;border:1px solid #0f5fa8;}\n          .inv-table td{padding:8px 10px;border:1px solid #e2e8f0;}\n          .inv-table tbody tr:nth-child(even){background:#f8fafc;}\n          .inv-summary-table{width:100%;border-collapse:collapse;margin:18px 0 22px;font-size:13px;}\n          .inv-summary-table td{padding:10px 14px;border:1px solid #e2e8f0;}\n          .inv-summary-table tr td:first-child{width:50%;font-weight:600;color:#0f172a;}\n          .inv-summary-table tr.total td{font-weight:700;color:#0f172a;background:#e8f2fa;}\n          .inv-summary-table td.right{text-align:right;font-weight:700;color:#0f5fa8;}\n          .inv-thanks{text-align:center;font-size:12px;color:#475569;margin:10px 0 30px;line-height:1.55;font-weight:600;}\n          .inv-sign-line{display:flex;justify-content:space-between;margin:30px 0 10px;font-size:13px;text-align:center;}\n          .sign-col{flex:1;display:flex;flex-direction:column;align-items:center;}\n          .sign-space{height:70px;position:relative;display:flex;align-items:flex-end;justify-content:center;width:100%;}\n          .sign-watermark{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:14px;color:#0f5fa8;opacity:.4;font-weight:700;pointer-events:none;user-select:none;white-space:nowrap;}\n          .inv-summary-table tr.total td.right{color:#0f5fa8;}\n          .sign-line{display:block;width:70%;height:1px;background:#0f172a;margin-bottom:2px;}\n          .sign-name{font-size:12px;color:#0f5fa8;font-weight:600;margin-top:4px;}\n          .inv-footer-names{display:none;}\n          @media (max-width:760px){\n            .inv-top-cards{grid-template-columns:1fr;}\n            .inv-info-grid{grid-template-columns:1fr;}\n            .inv-header-band{gap:18px;padding:14px 16px;min-height:120px;}\n            .inv-logo-img{max-height:70px;}\n            .inv-hotel-meta{min-width:0;}\n          }\n          @media (max-width:520px){ .inv-logo-img{max-height:60px;} }\n          @media print{ .inv-logo-img{max-height:70px;} }\n          @media print{body{background:#fff;} .invoice-overlay{position:static;background:#fff;box-shadow:none;padding:0;} .invoice-modal{box-shadow:none;padding:0;} .invoice-actions,.inv-back-btn{display:none !important;} .inv-table th{background:#0f5fa8 !important;-webkit-print-color-adjust:exact;print-color-adjust:exact;} }\n        `\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 501,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 411,\n    columnNumber: 5\n  }, this);\n}\n_c2 = InvoiceModal;\nfunction StatusBadge({\n  status\n}) {\n  const s = STATUS_META[status] || STATUS_META.pending;\n  return /*#__PURE__*/_jsxDEV(\"span\", {\n    className: `ph-badge ${s.cls}`,\n    children: s.text\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 571,\n    columnNumber: 10\n  }, this);\n}\n_c3 = StatusBadge;\nfunction toISODate(d) {\n  const dt = new Date(d);\n  const y = dt.getFullYear();\n  const m = String(dt.getMonth() + 1).padStart(2, '0');\n  const day = String(dt.getDate()).padStart(2, '0');\n  return `${y}-${m}-${day}`;\n}\nfunction fmtDate(d) {\n  const dt = new Date(d);\n  const dd = String(dt.getDate()).padStart(2, '0');\n  const mm = String(dt.getMonth() + 1).padStart(2, '0');\n  const yy = dt.getFullYear();\n  return `${dd}/${mm}/${yy}`;\n}\nfunction fmtDateTime(d) {\n  if (!d) return '';\n  const dt = new Date(d);\n  const hh = String(dt.getHours()).padStart(2, '0');\n  const mi = String(dt.getMinutes()).padStart(2, '0');\n  return `${fmtDate(dt)} ${hh}:${mi}`;\n}\nfunction toISO(s) {\n  const [d, m, y] = s.split('/');\n  return `${y}-${m}-${d}`;\n}\nfunction fmtMoney(n) {\n  return Number(n || 0).toLocaleString('vi-VN');\n}\nfunction exportCsv(list) {\n  const header = ['Mã đặt', 'Khách sạn', 'Phòng', 'Loại phòng', 'Nhận', 'Trả', 'Số đêm', 'Khách', 'Giá/đêm', 'Tiền phòng', 'Tiền dịch vụ', 'Tổng thanh toán', 'Trạng thái', 'Thanh toán', 'PTTT'];\n  const rows = list.map(it => {\n    var _STATUS_META$it$payme;\n    return [it.code, it.hotelName, it.roomName || '', it.roomType || '', fmtDateTime(it.checkIn), fmtDateTime(it.checkOut), it.nights, it.guests, fmtMoney(it.pricePerNight), fmtMoney(it.roomTotal), fmtMoney(it.serviceTotal), fmtMoney(it.grandTotal), ((_STATUS_META$it$payme = STATUS_META[it.paymentStatus]) === null || _STATUS_META$it$payme === void 0 ? void 0 : _STATUS_META$it$payme.text) || STATUS_META.pending.text, it.paidAt ? fmtDateTime(it.paidAt) : '', it.method];\n  });\n  const csv = [header, ...rows].map(r => r.map(v => `\"${String(v).replace(/\"/g, '\"\"')}\"`).join(',')).join('\\n');\n  const blob = new Blob([\"\\uFEFF\" + csv], {\n    type: 'text/csv;charset=utf-8;'\n  });\n  const a = document.createElement('a');\n  a.href = URL.createObjectURL(blob);\n  a.download = 'lich-su-giao-dich.csv';\n  a.click();\n}\nfunction buildReviewHref(it) {\n  const q = new URLSearchParams({\n    bookingId: String(it.bookingId || ''),\n    hotel: String(it.hotelName || ''),\n    roomType: String(it.roomType || ''),\n    ci: it.checkIn ? toISODate(it.checkIn) : '',\n    co: it.checkOut ? toISODate(it.checkOut) : ''\n  });\n  return `/review?${q.toString()}`;\n}\n\n// Additional styles for pinned horizontal scrollbar\n// (Injected once via a style tag at bottom if not present)\nif (typeof document !== 'undefined' && !document.getElementById('ph-scroll-bottom-style')) {\n  const style = document.createElement('style');\n  style.id = 'ph-scroll-bottom-style';\n  style.textContent = `\n    .ph-scroll-bottom-wrapper{position:sticky;bottom:0;left:0;background:linear-gradient(to top, rgba(255,255,255,0.95), rgba(255,255,255,0.75));padding-top:4px;padding-bottom:2px;z-index:50;}\n    .ph-scroll-bottom::-webkit-scrollbar{height:10px;}\n    .ph-scroll-bottom::-webkit-scrollbar-track{background:#f1f5f9;border-radius:6px;}\n    .ph-scroll-bottom::-webkit-scrollbar-thumb{background:#94a3b8;border-radius:6px;}\n    .ph-scroll-bottom::-webkit-scrollbar-thumb:hover{background:#64748b;}\n    /* Hide original top scrollbar when custom pinned bar is present */\n    .ph-scroll-top{scrollbar-width:none;-ms-overflow-style:none;}\n    .ph-scroll-top::-webkit-scrollbar{display:none;height:0;}\n    /* Action column new styles */\n  .ph-action-stack{display:flex;flex-direction:column;gap:6px;min-width:128px;}\n  .ph-action-btn{all:unset;box-sizing:border-box;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;letter-spacing:.5px;padding:11px 14px;border-radius:8px;text-align:center;cursor:pointer;user-select:none;min-height:42px;font-family:inherit;position:relative;transition:background .25s, box-shadow .25s, transform .15s,border-color .25s,color .25s;}\n  .ph-action-btn:focus-visible{outline:2px solid #2563eb;outline-offset:2px;}\n  .ph-action-btn:active{transform:translateY(1px);} \n  /* Primary gradient */\n  .ph-action-primary{color:#fff !important;background:linear-gradient(145deg,#1d64f0,#1251c7) !important;box-shadow:0 2px 4px rgba(29,100,240,.4) !important;border:1px solid #1552c5 !important;}\n  .ph-action-primary:hover{background:linear-gradient(145deg,#256ef5,#1d55d8) !important;box-shadow:0 4px 10px -2px rgba(29,100,240,.55) !important;border-color:#1d55d8 !important;} \n  /* Outline (elevated white) */\n  .ph-action-outline{background:linear-gradient(#ffffff,#f1f5f9) !important;border:1px solid #d0d7df !important;color:#0f172a !important;box-shadow:0 1px 2px rgba(15,23,42,.12) !important;}\n  .ph-action-outline:hover{background:linear-gradient(#f8fafc,#e2e8f0) !important;border-color:#c2cad2 !important;} \n  /* Danger */\n  .ph-action-danger{background:linear-gradient(145deg,#dc2626,#b91c1c) !important;color:#fff !important;box-shadow:0 2px 4px rgba(220,38,38,.4) !important;border:1px solid #b91c1c !important;} \n  .ph-action-danger:hover{background:linear-gradient(145deg,#ef2f2f,#c52020) !important;box-shadow:0 4px 10px -2px rgba(220,38,38,.55) !important;border-color:#c52020 !important;} \n  /* Disabled */\n  .ph-action-btn.disabled,.ph-action-btn:disabled{background:linear-gradient(#f1f5f9,#e2e8f0) !important;color:#94a3b8 !important;border:1px solid #dbe0e6 !important;cursor:default;box-shadow:none !important;}\n  /* Refund badge pill */\n  .ph-action-refund{font-size:11px;font-weight:600;color:#047857;background:linear-gradient(145deg,#ecfdf5,#d1fae5);border:1px solid #34d399;border-radius:10px;padding:10px 8px;line-height:1.25;text-align:center;box-shadow:0 1px 3px rgba(16,185,129,.35);} \n  .ph-action-refund b{display:block;font-size:12px;margin-bottom:2px;color:#065f46;}\n  .ph-action-refund:before{content:\"\";}\n    @media (max-width:900px){ .ph-action-stack{min-width:104px;} .ph-action-btn{font-size:11px;padding:8px 8px;min-height:36px;} }\n  `;\n  document.head.appendChild(style);\n}\n\n// Styles for .ph-action-inline, .ph-link, .ph-cancel-btn, .ph-refund-note moved to HomePage.css\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"PaymentHistory\");\n$RefreshReg$(_c2, \"InvoiceModal\");\n$RefreshReg$(_c3, \"StatusBadge\");","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","Link","useNavigate","jsxDEV","_jsxDEV","STATUS_META","paid","text","cls","pending","canceled","PaymentHistory","inline","onReview","_s","navigate","user","setUser","items","setItems","loading","setLoading","error","setError","q","setQ","fromDate","setFromDate","now","Date","start","getFullYear","getMonth","toISODate","toDate","setToDate","end","status","setStatus","page","setPage","pageSize","invoiceItem","setInvoiceItem","invoiceHotel","setInvoiceHotel","invoiceLoading","setInvoiceLoading","invoiceOpenedAt","setInvoiceOpenedAt","u","localStorage","getItem","JSON","parse","fetchList","email","url","URL","window","location","origin","searchParams","set","res","fetch","toString","ok","Error","j","json","rawItems","Array","isArray","raw","map","it","roomTotal","Number","total","serviceTotal","grandTotal","paymentStatus","String","toLowerCase","refundStatus","depositFromServer","Math","round","depositAmount","refundFromServer","refundAmount","base","depositBase","totalFallback","cancellationFee","max","cancellationSource","includes","cache","bookingId","parsed","depositVal","fallbackDeposit","e","message","filtered","totalPages","ceil","length","pageItems","slice","topScrollRef","tableRef","bottomScrollRef","hasOverflow","setHasOverflow","check","tableEl","current","topEl","overflow","scrollWidth","clientWidth","addEventListener","removeEventListener","botEl","syncing","sync","src","target","scrollLeft","onTop","onBot","openInvoice","row","enriched","userName","uName","fullName","name","split","className","style","paddingTop","children","position","top","alt","fileName","_jsxFileName","lineNumber","columnNumber","to","title","padding","textAlign","marginTop","alignItems","type","placeholder","value","onChange","min","undefined","onClick","exportCsv","overflowX","maxWidth","ref","role","minWidth","h","color","code","hotelName","roomName","roomType","fmtDateTime","checkIn","checkOut","nights","guests","fmtMoney","pricePerNight","StatusBadge","paidAt","method","reviewedKey","reviewed","reviewLabel","commonCls","disabled","setItem","list","x","href","buildReviewHref","preventDefault","confirm","uRaw","alert","r","headers","body","stringify","t","toLocaleString","overflowY","width","height","p","from","_","i","n","InvoiceModal","item","hotel","openedAt","onClose","_c","buildInvoiceNumber","id","padStart","d","y","m","day","getDate","generateNightRows","ci","co","rows","cursor","idx","push","date","fmtDate","desc","qty","unit","amount","calcInvoiceTotals","extra","tax","grand","nightRows","reduce","s","services","_nightRows$","invoiceNo","custName","trim","customerName","checkInTime","checkOutTime","totalNights","startQty","floor","endQty","startDateStr","endDateStr","price","startAmount","endAmount","minibarRow","svc","find","test","tableRows","roomTotalDisplay","filter","serviceTotalDisplay","taxDisplay","grandDisplay","openedStamp","onMouseDown","currentTarget","stopPropagation","onError","display","address","phone","website","identityNumber","_c2","_c3","dt","dd","mm","yy","hh","getHours","mi","getMinutes","toISO","header","_STATUS_META$it$payme","csv","v","replace","join","blob","Blob","a","document","createElement","createObjectURL","download","click","URLSearchParams","getElementById","textContent","head","appendChild","$RefreshReg$"],"sources":["D:/Git/HMSAI-Hotel/client/src/PaymentHistory.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport './HomePage.css';\r\n\r\nconst STATUS_META = {\r\n  paid: { text: 'Đã thanh toán', cls: 'ok' },\r\n  pending: { text: 'Chờ thanh toán', cls: 'pending' },\r\n  canceled: { text: 'Hủy', cls: 'cancel' },\r\n};\r\n\r\nexport default function PaymentHistory({ inline = false, onReview }) {\r\n  const navigate = useNavigate();\r\n  const [user, setUser] = useState(null);\r\n  const [items, setItems] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [q, setQ] = useState('');\r\n  const [fromDate, setFromDate] = useState(() => {\r\n    const now = new Date();\r\n    const start = new Date(now.getFullYear(), now.getMonth(), 1);\r\n    return toISODate(start);\r\n  });\r\n  const [toDate, setToDate] = useState(() => {\r\n    const now = new Date();\r\n    const end = new Date(now.getFullYear(), now.getMonth()+1, 0);\r\n    return toISODate(end);\r\n  });\r\n  const [status, setStatus] = useState('all');\r\n  const [page, setPage] = useState(1);\r\n  const pageSize = 10;\r\n  // Invoice state\r\n  const [invoiceItem, setInvoiceItem] = useState(null);\r\n  const [invoiceHotel, setInvoiceHotel] = useState(null);\r\n  const [invoiceLoading, setInvoiceLoading] = useState(false);\r\n  const [invoiceOpenedAt, setInvoiceOpenedAt] = useState(null); // thời điểm mở hóa đơn\r\n\r\n  useEffect(() => {\r\n    try { const u = localStorage.getItem('hmsUser'); setUser(u? JSON.parse(u): null);} catch { setUser(null);} \r\n  }, []);\r\n\r\n  const fetchList = async () => {\r\n    if (!user?.email) return;\r\n    setLoading(true); setError('');\r\n    try {\r\n      const url = new URL('/api/transactions', window.location.origin);\r\n      url.searchParams.set('email', user.email);\r\n      if (q) url.searchParams.set('q', q);\r\n      if (status && status !== 'all') url.searchParams.set('status', status);\r\n      if (fromDate) url.searchParams.set('from', fromDate);\r\n      if (toDate) url.searchParams.set('to', toDate);\r\n      const res = await fetch(url.toString());\r\n      if (!res.ok) throw new Error('Không tải được dữ liệu');\r\n      const j = await res.json();\r\n      const rawItems = j && Array.isArray(j.items) ? j.items : [];\r\n      let raw = rawItems.map(it => ({ ...it }));\r\n      raw = raw.map(it => {\r\n        const roomTotal = Number(it.roomTotal != null ? it.roomTotal : it.total);\r\n        const serviceTotal = Number(it.serviceTotal || 0);\r\n        const grandTotal = Number(it.grandTotal != null ? it.grandTotal : roomTotal + serviceTotal);\r\n        return {\r\n          ...it,\r\n          total: roomTotal,\r\n          roomTotal,\r\n          serviceTotal,\r\n          grandTotal,\r\n        };\r\n      });\r\n      // Rehydrate refund info for canceled bookings (prefer server data)\r\n      raw = raw.map(it => {\r\n        const paymentStatus = String(it.paymentStatus || '').toLowerCase();\r\n        const refundStatus = String(it.refundStatus || '');\r\n        const depositFromServer = Math.round(Number(it.depositAmount || 0));\r\n        const refundFromServer = Math.round(Number(it.refundAmount || 0));\r\n        const base = {\r\n          ...it,\r\n          depositAmount: depositFromServer,\r\n          refundAmount: refundFromServer > 0 ? refundFromServer : null,\r\n          refundStatus\r\n        };\r\n\r\n        if (paymentStatus === 'canceled') {\r\n          let depositBase = depositFromServer;\r\n          if (!(depositBase > 0)) {\r\n            const totalFallback = Math.round(Number(it.total || 0) * 0.2);\r\n            if (totalFallback > 0) depositBase = totalFallback;\r\n          }\r\n\r\n          if (refundFromServer > 0) {\r\n            const cancellationFee = depositBase > 0 ? Math.max(0, depositBase - refundFromServer) : 0;\r\n            const cancellationSource = refundStatus.toLowerCase().includes('admin') ? 'admin' : 'user';\r\n            return { ...base, depositAmount: depositBase, refundAmount: refundFromServer, cancellationFee, cancellationSource };\r\n          }\r\n\r\n          // Server lacks refund info — try cached client data\r\n          try {\r\n            const cache = localStorage.getItem('refund:' + it.bookingId);\r\n            if (cache) {\r\n              const parsed = JSON.parse(cache);\r\n              if (parsed && typeof parsed.refundAmount !== 'undefined') {\r\n                const refundAmount = Math.round(Number(parsed.refundAmount || 0));\r\n                const cancellationFee = depositBase > 0 ? Math.max(0, depositBase - refundAmount) : Number(parsed.cancellationFee || 0);\r\n                const depositVal = parsed.depositAmount != null ? Math.round(Number(parsed.depositAmount || 0)) : depositBase;\r\n                return { ...base, refundAmount, cancellationFee, depositAmount: depositVal, cancellationSource: parsed.cancellationSource || 'user' };\r\n              }\r\n            }\r\n          } catch {}\r\n\r\n          if (depositBase > 0) {\r\n            // Default user-cancel assumption: refund 85%, keep 15%\r\n            const refundAmount = Math.round(depositBase * 0.85);\r\n            const cancellationFee = depositBase - refundAmount;\r\n            return { ...base, depositAmount: depositBase, refundAmount, cancellationFee, cancellationSource: 'user' };\r\n          }\r\n\r\n          const total = Number(it.total) || 0;\r\n          if (total > 0) {\r\n            const fallbackDeposit = Math.round(total * 0.2);\r\n            const refundAmount = Math.round(fallbackDeposit * 0.85);\r\n            const cancellationFee = fallbackDeposit - refundAmount;\r\n            return { ...base, refundAmount, cancellationFee, depositAmount: fallbackDeposit, cancellationSource: 'user' };\r\n          }\r\n        }\r\n\r\n        return base;\r\n      });\r\n      setItems(raw);\r\n    } catch (e) { setError(e.message || 'Lỗi tải dữ liệu'); }\r\n    finally { setLoading(false); }\r\n  };\r\n\r\n  useEffect(() => { fetchList(); }, [user]);\r\n\r\n  const filtered = useMemo(() => items, [items]);\r\n  const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));\r\n  const pageItems = filtered.slice((page-1)*pageSize, page*pageSize);\r\n\r\n  const topScrollRef = useRef(null);\r\n  const tableRef = useRef(null);\r\n  const bottomScrollRef = useRef(null);\r\n  const [hasOverflow, setHasOverflow] = useState(false);\r\n\r\n  // Detect horizontal overflow (table wider than visible container)\r\n  useEffect(()=>{\r\n    const check = () => {\r\n      const tableEl = tableRef.current; const topEl = topScrollRef.current;\r\n      if(!tableEl || !topEl) { setHasOverflow(false); return; }\r\n      const overflow = tableEl.scrollWidth > (topEl.clientWidth + 5); // small tolerance\r\n      setHasOverflow(overflow);\r\n    };\r\n    check();\r\n    window.addEventListener('resize', check);\r\n    return ()=> window.removeEventListener('resize', check);\r\n  }, [filtered.length, pageItems.length]);\r\n\r\n  // Sync horizontal scroll between top (table container) and bottom (pinned bar)\r\n  useEffect(()=>{\r\n    const topEl = topScrollRef.current;\r\n    const botEl = bottomScrollRef.current;\r\n    if(!topEl || !botEl) return;\r\n    let syncing = false;\r\n    const sync = (src, target)=>{\r\n      if(syncing) return; syncing = true;\r\n      if(target.scrollLeft !== src.scrollLeft) target.scrollLeft = src.scrollLeft;\r\n      syncing = false;\r\n    };\r\n    const onTop = ()=> sync(topEl, botEl);\r\n    const onBot = ()=> sync(botEl, topEl);\r\n    topEl.addEventListener('scroll', onTop);\r\n    botEl.addEventListener('scroll', onBot);\r\n    return ()=> { topEl.removeEventListener('scroll', onTop); botEl.removeEventListener('scroll', onBot); };\r\n  }, [filtered.length, hasOverflow]);\r\n\r\n  const openInvoice = async (row) => {\r\n    setInvoiceItem(null); setInvoiceHotel(null); setInvoiceLoading(true);\r\n    try {\r\n      // Enrich row with userName fallback if missing so tên khách hàng luôn hiện\r\n      const enriched = { ...row };\r\n      if(!enriched.userName && user){\r\n        // user may have fullName or name fields (guess); fallback to email before '@'\r\n        const uName = user.fullName || user.name || user.userName || (user.email? user.email.split('@')[0] : '');\r\n        if(uName) enriched.userName = uName;\r\n      }\r\n      setInvoiceItem(enriched);\r\n      setInvoiceOpenedAt(new Date());\r\n    } catch { /* ignore */ } finally { setInvoiceLoading(false); }\r\n  };\r\n\r\n  return (\r\n  <div className={(inline ? '' : 'home-root') + ' ph-root'} style={{ paddingTop: inline ? 0 : 80 }}>\r\n      {!inline && (\r\n        <header className=\"home-header\" style={{ position: 'sticky', top: 0 }}>\r\n          <div className=\"home-header-left\">\r\n            <img src=\"/logo.png\" alt=\"logo\" className=\"home-header-logo\" />\r\n            <Link to=\"/\" className=\"home-header-title home-header-home-btn\">TRANG CHỦ</Link>\r\n          </div>\r\n          <div className=\"home-header-icons\">\r\n            <Link to=\"/login\" className=\"home-header-icon\" title=\"Đăng nhập\">\r\n              <img src=\"/icon-user.png\" alt=\"user\" className=\"home-header-icon-img\" />\r\n            </Link>\r\n          </div>\r\n        </header>\r\n      )}\r\n      <div style={{ padding: inline ? '6px' : '16px 12px' }}>\r\n        <h2 className=\"home-rooms-title\" style={{ textAlign: 'left', marginTop: 12 }}>Lịch sử giao dịch</h2>\r\n        <div className=\"rt-toolbar\" style={{ alignItems: 'center' }}>\r\n          <div className=\"rt-field rt-field--wide\">\r\n            <label>Từ khóa</label>\r\n            <input type=\"text\" placeholder=\"VD: HMS20250904 hoặc HMS-AI Đà Nẵng\" value={q} onChange={(e)=>setQ(e.target.value)} />\r\n          </div>\r\n          <div className=\"rt-field\">\r\n            <label>Từ ngày</label>\r\n            <input type=\"date\" value={fromDate} onChange={(e)=>setFromDate(e.target.value)} />\r\n          </div>\r\n          <div className=\"rt-field\">\r\n            <label>Đến ngày</label>\r\n            <input type=\"date\" value={toDate} min={fromDate || undefined} onChange={(e)=>setToDate(e.target.value)} />\r\n          </div>\r\n          <div className=\"rt-field\">\r\n            <label>Trạng thái</label>\r\n            <select value={status} onChange={(e)=>setStatus(e.target.value)}>\r\n              <option value=\"all\">Tất cả</option>\r\n              <option value=\"paid\">Đã thanh toán</option>\r\n              <option value=\"pending\">Chờ thanh toán</option>\r\n              <option value=\"canceled\">Hủy</option>\r\n            </select>\r\n          </div>\r\n          <button className=\"ph-btn\" onClick={()=>{setPage(1); fetchList();}}>Tìm kiếm</button>\r\n          <button className=\"ph-btn ph-btn--secondary\" onClick={()=>exportCsv(filtered)}>Xuất CSV</button>\r\n        </div>\r\n\r\n        <div style={{ overflowX:'auto', maxWidth:'100%' }} ref={topScrollRef} className=\"ph-scroll-top\">\r\n          <div ref={tableRef} className=\"ph-table\" role=\"table\" aria-label=\"Lịch sử giao dịch\" style={{ minWidth:1700 }}>\r\n            <div className=\"ph-tr ph-head ph-hist\" role=\"row\">\r\n              {['MÃ ĐẶT PHÒNG','KHÁCH SẠN','PHÒNG','LOẠI PHÒNG','NHẬN PHÒNG','TRẢ PHÒNG','SỐ ĐÊM','KHÁCH','GIÁ/ĐÊM','TIỀN PHÒNG','TIỀN DỊCH VỤ','TỔNG THANH TOÁN','TRẠNG THÁI','THỜI GIAN TT','PTTT','HÀNH ĐỘNG'].map(h=> (\r\n                <div key={h} className=\"ph-td\" role=\"columnheader\">{h}</div>\r\n              ))}\r\n            </div>\r\n            {loading ? (\r\n              <div className=\"ph-empty\">Đang tải...</div>\r\n            ) : error ? (\r\n              <div className=\"ph-empty\" style={{ color: '#c1121f' }}>{error}</div>\r\n            ) : pageItems.length === 0 ? (\r\n              <div className=\"ph-empty\">Chưa có giao dịch</div>\r\n            ) : (\r\n              pageItems.map((it) => (\r\n                <div className=\"ph-tr ph-hist\" role=\"row\" key={it.bookingId}>\r\n                  <div className=\"ph-td code\">{it.code}</div>\r\n                  <div className=\"ph-td\">{it.hotelName}</div>\r\n                  <div className=\"ph-td\">{it.roomName || '—'}</div>\r\n                  <div className=\"ph-td\">{it.roomType || '—'}</div>\r\n                  <div className=\"ph-td\">{fmtDateTime(it.checkIn)}</div>\r\n                  <div className=\"ph-td\">{fmtDateTime(it.checkOut)}</div>\r\n                  <div className=\"ph-td center\">{it.nights}</div>\r\n                  <div className=\"ph-td\">{it.guests}</div>\r\n                  <div className=\"ph-td right\">{fmtMoney(it.pricePerNight)} VND</div>\r\n                  <div className=\"ph-td right\">{fmtMoney(it.roomTotal)} VND</div>\r\n                  <div className=\"ph-td right\">{it.serviceTotal > 0 ? `${fmtMoney(it.serviceTotal)} VND` : '—'}</div>\r\n                  <div className=\"ph-td right\">{fmtMoney(it.grandTotal)} VND</div>\r\n                  <div className=\"ph-td\"><StatusBadge status={it.paymentStatus} /></div>\r\n                  <div className=\"ph-td\">{it.paidAt ? fmtDateTime(it.paidAt) : '—'}</div>\r\n                  <div className=\"ph-td\">{it.method || '—'}</div>\r\n                  <div className=\"ph-td action ph-action-stack\">\r\n                    {(() => {\r\n                      const reviewedKey = 'reviewedBooking:' + it.bookingId;\r\n                      let reviewed = false; try { reviewed = !!localStorage.getItem(reviewedKey); } catch {}\r\n                      const reviewLabel = reviewed ? 'ĐÃ ĐÁNH GIÁ' : 'ĐÁNH GIÁ';\r\n                      const commonCls = 'ph-action-btn ph-action-outline' + (reviewed? ' disabled':'');\r\n                      if(typeof onReview === 'function'){\r\n                        return (\r\n                          <button type=\"button\" className={commonCls} disabled={reviewed} onClick={(e)=>{ if(reviewed) return; onReview(it); try { localStorage.setItem(reviewedKey,'1'); } catch {}; setItems(list=> list.map(x=> x.bookingId===it.bookingId ? { ...x } : x)); }}>{reviewLabel}</button>\r\n                        );\r\n                      } else {\r\n                        return (\r\n                          <a href={buildReviewHref(it)} className={commonCls + ' link-as-btn'} onClick={(e)=>{ if(reviewed){ e.preventDefault(); return;} try { localStorage.setItem(reviewedKey,'1'); } catch {}; }}>{reviewLabel}</a>\r\n                        );\r\n                      }\r\n                    })()}\r\n                    {it.paymentStatus==='paid' && (\r\n                      <button type=\"button\" className=\"ph-action-btn ph-action-primary\" onClick={()=> openInvoice(it)}>HÓA ĐƠN</button>\r\n                    )}\r\n                    {it.paymentStatus==='pending' && (\r\n                      <button type=\"button\" className=\"ph-action-btn ph-action-danger\" onClick={async()=>{\r\n                        if(!window.confirm('Hủy giao dịch này? Hoàn 85% tiền cọc, giữ 15% phí.')) return;\r\n                        try {\r\n                          const uRaw = localStorage.getItem('hmsUser');\r\n                          const email = uRaw? JSON.parse(uRaw).email: null;\r\n                          if(!email) { alert('Chưa đăng nhập'); return; }\r\n                          const r = await fetch(`/api/payments/${it.bookingId}/cancel`, { method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ email }) });\r\n                          if(!r.ok){ const t=await r.text(); throw new Error(t); }\r\n                          const j = await r.json();\r\n                          setItems(list => list.map(x => x.bookingId===it.bookingId ? { ...x, paymentStatus:'canceled', refundAmount:j.refundAmount, cancellationFee:j.cancellationFee, depositAmount:j.depositAmount != null ? j.depositAmount : x.depositAmount } : x));\r\n                          try { localStorage.setItem('refund:'+it.bookingId, JSON.stringify({ refundAmount:j.refundAmount, cancellationFee:j.cancellationFee, depositAmount:j.depositAmount, cancellationSource: 'user' })); } catch {}\r\n                        } catch(e){ alert(e.message||'Hủy thất bại'); }\r\n                      }}>HỦY</button>\r\n                    )}\r\n                    {it.paymentStatus==='canceled' && (\r\n                      <div className=\"ph-action-refund\">\r\n                        Hoàn: {Number(it.refundAmount || 0).toLocaleString('vi-VN')} VND\r\n                        {it.cancellationFee != null && (\r\n                          <span> · Phí giữ lại: {Number(it.cancellationFee).toLocaleString('vi-VN')} VND</span>\r\n                        )}\r\n                        {it.depositAmount != null && (\r\n                          <span> · Cọc: {Number(it.depositAmount).toLocaleString('vi-VN')} VND</span>\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n        {/* Pinned bottom horizontal scrollbar (only when needed) */}\r\n        {hasOverflow && (\r\n          <div className=\"ph-scroll-bottom-wrapper\">\r\n            <div ref={bottomScrollRef} className=\"ph-scroll-bottom\" style={{ overflowX:'auto', overflowY:'hidden', maxWidth:'100%' }}>\r\n              <div style={{ width: (tableRef.current? tableRef.current.scrollWidth: 1700), height:1 }} />\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"ph-pager\">\r\n          <button disabled={page<=1} onClick={()=>setPage((p)=>Math.max(1,p-1))}>«</button>\r\n          {Array.from({length: totalPages}, (_,i)=>i+1).slice(0,5).map(n => (\r\n            <button key={n} className={n===page? 'active': ''} onClick={()=>setPage(n)}>{n}</button>\r\n          ))}\r\n          <button disabled={page>=totalPages} onClick={()=>setPage((p)=>Math.min(totalPages,p+1))}>»</button>\r\n        </div>\r\n      </div>\r\n      {invoiceItem && (\r\n        <InvoiceModal item={invoiceItem} hotel={invoiceHotel} openedAt={invoiceOpenedAt} onClose={()=>{setInvoiceItem(null);}} />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n// ================= INVOICE HELPERS & MODAL =================\r\nfunction buildInvoiceNumber(item){\r\n  if(!item) return '';\r\n  const id = String(item.bookingId||'').padStart(6,'0');\r\n  // Use paid date or today for sequence prefix\r\n  const d = item.paidAt? new Date(item.paidAt): new Date();\r\n  const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const day = String(d.getDate()).padStart(2,'0');\r\n  return `HD${y}${m}${day}-${id}`;\r\n}\r\n\r\nfunction generateNightRows(item){\r\n  if(!item) return [];\r\n  try {\r\n    const ci = new Date(item.checkIn); const co = new Date(item.checkOut);\r\n    const rows=[]; let cursor = new Date(ci.getFullYear(), ci.getMonth(), ci.getDate());\r\n    let idx=0; while(cursor < co){\r\n      if(idx>60){ // safety stop for abnormal data\r\n        rows.push({ date: fmtDate(cursor), desc:'Tiền phòng (gộp)', qty: (item.nights||0)-idx, unit: item.pricePerNight, amount: item.pricePerNight*((item.nights||0)-idx)});\r\n        break;\r\n      }\r\n      rows.push({ date: fmtDate(cursor), desc:'Tiền phòng', qty:1, unit:item.pricePerNight, amount:item.pricePerNight });\r\n      cursor = new Date(cursor.getFullYear(), cursor.getMonth(), cursor.getDate()+1); idx++;\r\n      if(idx >= (item.nights||0)) break;\r\n    }\r\n    return rows;\r\n  } catch { return []; }\r\n}\r\n\r\nfunction calcInvoiceTotals(item, extra){\r\n  if(!item) return { roomTotal:0, serviceTotal:0, tax:0, grand:0};\r\n  const nightRows = generateNightRows(item);\r\n  const roomTotal = nightRows.reduce((s,r)=> s + Number(r.amount||0), 0);\r\n  const serviceTotal = (extra&&Array.isArray(extra.services)) ? extra.services.reduce((s,r)=> s+Number(r.amount||0),0):0;\r\n  const tax = Math.round(roomTotal * 0.03); // 3% VAT giả định\r\n  const grand = roomTotal + serviceTotal + tax;\r\n  return { roomTotal, serviceTotal, tax, grand, nightRows };\r\n}\r\n\r\nfunction InvoiceModal({ item, hotel, openedAt, onClose }){\r\n  if(!item) return null;\r\n  const { nightRows } = calcInvoiceTotals(item, {});\r\n  const invoiceNo = buildInvoiceNumber(item);\r\n  // Họ tên tài khoản đặt phòng: ưu tiên userName -> customerName\r\n  const custName = (item.userName && item.userName.trim()) ? item.userName : (item.customerName || 'Khách hàng');\r\n  const checkInTime = '14:00:00';\r\n  const checkOutTime = '12:00:00';\r\n  // Nén hiển thị: chỉ ngày bắt đầu & kết thúc chia số ngày thành 2 dòng\r\n  const totalNights = item.nights || nightRows.length || 0;\r\n  let startQty = Math.floor(totalNights/2);\r\n  let endQty = totalNights - startQty;\r\n  if(startQty === 0 && endQty>0){ startQty = 1; endQty = totalNights - 1; }\r\n  const startDateStr = fmtDate(item.checkIn);\r\n  const endDateStr = fmtDate(item.checkOut);\r\n  const price = item.pricePerNight || (nightRows[0]?.unit) || 0;\r\n  const startAmount = price * startQty;\r\n  const endAmount = price * endQty;\r\n  // Dịch vụ minibar nếu tồn tại trong item.services (giả định mảng) hoặc flags khác\r\n  let minibarRow = null;\r\n  if(Array.isArray(item.services)){\r\n    const svc = item.services.find(s=> /minibar|nước/i.test(s.name||''));\r\n    if(svc){ minibarRow = { date: endDateStr, desc: svc.name, qty: svc.qty||1, unit: svc.price||svc.amount||0, amount: (svc.price||svc.amount||0)*(svc.qty||1) }; }\r\n  }\r\n  // Nếu không có services, bỏ qua (không tự thêm giả) theo yêu cầu mới\r\n  const tableRows = [\r\n    ...(totalNights>0 ? [{ date: startDateStr, desc:'Tiền phòng', qty:startQty, unit:price, amount:startAmount }] : []),\r\n    ...(totalNights>1 ? [{ date: endDateStr, desc:'Tiền phòng', qty:endQty, unit:price, amount:endAmount }] : []),\r\n    ...(minibarRow? [minibarRow]: [])\r\n  ];\r\n  const roomTotalDisplay = tableRows.filter(r=> r.desc==='Tiền phòng').reduce((s,r)=>s+r.amount,0);\r\n  const serviceTotalDisplay = tableRows.filter(r=> r.desc!=='Tiền phòng').reduce((s,r)=>s+r.amount,0);\r\n  const taxDisplay = Math.round(roomTotalDisplay * 0.03);\r\n  const grandDisplay = roomTotalDisplay + serviceTotalDisplay + taxDisplay;\r\n  const openedStamp = openedAt ? fmtDateTime(openedAt) : fmtDateTime(Date.now());\r\n  return (\r\n    <div className=\"invoice-overlay\" onMouseDown={(e)=>{ if(e.target===e.currentTarget) onClose(); }}>\r\n        <div className=\"invoice-modal\" onMouseDown={(e)=>e.stopPropagation()}> \r\n        <button className=\"inv-back-btn\" onClick={onClose} title=\"Quay lại\">← Quay lại</button>\r\n        <div className=\"invoice-paper\">\r\n          <div className=\"inv-header-band\">\r\n            <div className=\"inv-head-left\">\r\n              <img src=\"/logo.png\" alt=\"Logo\" className=\"inv-logo-img\" onError={(e)=>{ e.currentTarget.style.display='none'; }} />\r\n              <div className=\"inv-hotel-meta\">\r\n                <div>{hotel?.name || 'HMS - AI'}</div>\r\n                <div>{hotel?.address || '03 Quang Trung - Đà Nẵng'}</div>\r\n                <div>{hotel?.phone || '0388618687 · E: hms@gmail.com'}</div>\r\n                <div>{hotel?.website || 'www.hmshotel.com'}</div>\r\n              </div>\r\n            </div>\r\n            <div className=\"inv-head-right\">\r\n              <h1>HÓA ĐƠN</h1>\r\n              <div className=\"inv-meta-line\">Số hóa đơn: <strong>{invoiceNo}</strong></div>\r\n              <div className=\"inv-meta-line inv-meta-date\">Ngày: <strong>{openedStamp}</strong></div>\r\n            </div>\r\n          </div>\r\n          {/* Removed duplicate centered title for cleaner framed header */}\r\n          {/* Top 3 cards row */}\r\n          <div className=\"inv-top-cards\">\r\n            <div className=\"inv-top-card\"><div className=\"k-label\">Mã đặt phòng</div><div className=\"k-value code-link\">{item.code}</div></div>\r\n            <div className=\"inv-top-card\"><div className=\"k-label\">Nguồn</div><div className=\"k-value\">123 - HMS-AI</div></div>\r\n            <div className=\"inv-top-card\"><div className=\"k-label\">Phòng</div><div className=\"k-value\">{item.roomName || '—'}</div></div>\r\n          </div>\r\n          {/* Info grid split 2 columns */}\r\n          <div className=\"inv-info-grid\">\r\n            <div className=\"inv-info-col\">\r\n              <div className=\"info-row\"><span className=\"i-label\">Tên khách hàng</span><span className=\"i-value i-upper\">{custName}</span></div>\r\n              <div className=\"info-row\"><span className=\"i-label\">Ngày nhận phòng</span><span className=\"i-value i-link\">{fmtDate(item.checkIn)}</span></div>\r\n              <div className=\"info-row\"><span className=\"i-label\">Ngày trả phòng</span><span className=\"i-value i-link\">{fmtDate(item.checkOut)}</span></div>\r\n              <div className=\"info-row\"><span className=\"i-label\">Loại phòng</span><span className=\"i-value i-link\">{item.roomType || '—'}</span></div>\r\n            </div>\r\n            <div className=\"inv-info-col\">\r\n              <div className=\"info-row\"><span className=\"i-label\">Thời gian đến</span><span className=\"i-value i-time\">{checkInTime}</span></div>\r\n              <div className=\"info-row\"><span className=\"i-label\">Thời gian trả</span><span className=\"i-value i-time\">{checkOutTime}</span></div>\r\n              <div className=\"info-row\"><span className=\"i-label\">Số đêm lưu trú</span><span className=\"i-value\">{totalNights}</span></div>\r\n              <div className=\"info-row\"><span className=\"i-label\">CMND/Passport</span><span className=\"i-value i-link\">{item.identityNumber || '—'}</span></div>\r\n            </div>\r\n          </div>\r\n          {/* Table */}\r\n          <table className=\"inv-table\">\r\n            <thead>\r\n              <tr>\r\n                <th>#</th>\r\n                <th>Ngày</th>\r\n                <th>Phòng / Nội dung</th>\r\n                <th>Số lượng</th>\r\n                <th>Đơn giá</th>\r\n                <th>Thành tiền</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {tableRows.map((r,i)=> (\r\n                <tr key={i}>\r\n                  <td>{i+1}</td>\r\n                  <td>{r.date}</td>\r\n                  <td>{r.desc}</td>\r\n                  <td>{r.qty}</td>\r\n                  <td>{fmtMoney(r.unit)} VND</td>\r\n                  <td>{fmtMoney(r.amount)} VND</td>\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n          {/* Summary mini table */}\r\n          <table className=\"inv-summary-table\">\r\n            <tbody>\r\n              <tr><td>Tiền phòng</td><td className=\"right\">{fmtMoney(roomTotalDisplay)} VND</td></tr>\r\n              <tr><td>Thuế</td><td className=\"right\">{fmtMoney(taxDisplay)} VND</td></tr>\r\n              <tr><td>Phí dịch vụ</td><td className=\"right\">{fmtMoney(serviceTotalDisplay)} VND</td></tr>\r\n              <tr className=\"total\"><td>Tổng tiền</td><td className=\"right\">{fmtMoney(grandDisplay)} VND</td></tr>\r\n            </tbody>\r\n          </table>\r\n          <div className=\"inv-thanks\">Xin cảm ơn Quý khách đã tin tưởng và sử dụng dịch vụ của chúng tôi.<br/>Chúc Quý khách có một kỳ nghĩ vui vẻ!</div>\r\n          <div className=\"inv-sign-line\">\r\n            <div className=\"sign-col\">\r\n              <div><strong>Lễ tân</strong></div>\r\n              <div className=\"sign-space\"><span className=\"sign-watermark\">HSMAI-Hotel</span><span className=\"sign-line\" /></div>\r\n              <div className=\"sign-name\">Nhóm 1 HMSAI-Hotel</div>\r\n            </div>\r\n            <div className=\"sign-col\">\r\n              <div><strong>Khách hàng</strong></div>\r\n              <div className=\"sign-space\" style={{height:70}}><span className=\"sign-line\" /></div>\r\n              <div className=\"sign-name\">{custName}</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <style>{`\r\n          .invoice-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:flex-start;justify-content:center;overflow:auto;z-index:4000;padding:30px 18px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}\r\n          .invoice-modal{background:#fff;border-radius:10px;max-width:960px;width:100%;box-shadow:0 14px 42px -6px rgba(0,0,0,.35);padding:4px 18px 20px;animation:invIn .4s ease;}\r\n          @keyframes invIn{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}\r\n          .invoice-actions{display:none;}\r\n          .inv-back-btn{position:absolute;top:8px;left:10px;background:#f1f5f9;border:1px solid #cbd5e1;color:#0f172a;font-weight:600;padding:6px 14px;border-radius:24px;cursor:pointer;font-size:13px;line-height:1;box-shadow:0 1px 2px rgba(0,0,0,.08);transition:.18s ease;background-image:linear-gradient(to bottom,#fff,#f1f5f9);} \r\n          .inv-back-btn:hover{background:#e2e8f0;}\r\n          .inv-back-btn:active{transform:translateY(1px);}\r\n          .inv-header-band{display:flex;gap:28px;align-items:center;justify-content:space-between;border:1px solid #d7dbe0;border-radius:8px;padding:14px 22px;margin-bottom:14px;position:relative;background:#fff;min-height:140px;}\r\n          .inv-header-band:after{content:\"\";position:absolute;left:0;right:0;bottom:-6px;height:2px;background:#0f172a;opacity:.65;border-radius:2px;}\r\n          .inv-head-left,.inv-head-right{flex:1;}\r\n          .inv-head-left{display:flex;flex-direction:column;gap:6px;align-items:flex-start;}\r\n          .inv-logo{display:none;}\r\n          .inv-logo-img{display:block;max-height:90px;width:auto;margin:0 0 2px;}\r\n          .inv-hotel-meta{font-size:12px;line-height:1.5;color:#0f172a;font-weight:500;display:flex;flex-direction:column;justify-content:center;min-width:200px;}\r\n          .inv-head-right{display:flex;flex-direction:column;justify-content:center;align-items:flex-end;text-align:right;font-size:12px;line-height:1.5;}\r\n          .inv-head-right h1{margin:0 0 4px;font-size:18px;color:#0f172a;letter-spacing:.5px;}\r\n          .inv-meta-line{margin:2px 0;color:#0f172a;}\r\n          /* Removed .inv-sep & .inv-title-center after framing header */\r\n          .inv-top-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:20px;}\r\n          .inv-top-card{background:#fff;border:1px solid #d7dbe0;border-radius:6px;min-height:66px;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:8px 14px;}\r\n          .inv-top-card .k-label,.inv-top-card .k-value{width:100%;}\r\n          .k-label{font-size:11px;font-weight:600;color:#475569;text-transform:uppercase;letter-spacing:.4px;margin-bottom:4px;}\r\n          .k-value{font-size:14px;font-weight:700;color:#0f5fa8;}\r\n          .code-link{color:#0070c9;cursor:pointer;}\r\n          .inv-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;background:#fff;border:1px solid #d7dbe0;border-radius:6px;padding:14px 18px;margin-bottom:18px;}\r\n          .inv-info-col{display:flex;flex-direction:column;gap:10px;font-size:13px;}\r\n          .info-row{display:flex;justify-content:space-between;gap:12px;}\r\n          .i-label{color:#0f172a;font-weight:600;}\r\n          .i-value{font-weight:600;color:#0f5fa8;}\r\n          .i-link{color:#0070c9;}\r\n          .i-upper{text-transform:uppercase;}\r\n          .i-time{color:#0f5fa8;font-weight:700;}\r\n          .inv-table{width:100%;border-collapse:collapse;font-size:13px;margin-top:8px;}\r\n          .inv-table th{background:#0f5fa8;color:#fff;padding:8px 10px;font-size:12px;border:1px solid #0f5fa8;}\r\n          .inv-table td{padding:8px 10px;border:1px solid #e2e8f0;}\r\n          .inv-table tbody tr:nth-child(even){background:#f8fafc;}\r\n          .inv-summary-table{width:100%;border-collapse:collapse;margin:18px 0 22px;font-size:13px;}\r\n          .inv-summary-table td{padding:10px 14px;border:1px solid #e2e8f0;}\r\n          .inv-summary-table tr td:first-child{width:50%;font-weight:600;color:#0f172a;}\r\n          .inv-summary-table tr.total td{font-weight:700;color:#0f172a;background:#e8f2fa;}\r\n          .inv-summary-table td.right{text-align:right;font-weight:700;color:#0f5fa8;}\r\n          .inv-thanks{text-align:center;font-size:12px;color:#475569;margin:10px 0 30px;line-height:1.55;font-weight:600;}\r\n          .inv-sign-line{display:flex;justify-content:space-between;margin:30px 0 10px;font-size:13px;text-align:center;}\r\n          .sign-col{flex:1;display:flex;flex-direction:column;align-items:center;}\r\n          .sign-space{height:70px;position:relative;display:flex;align-items:flex-end;justify-content:center;width:100%;}\r\n          .sign-watermark{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:14px;color:#0f5fa8;opacity:.4;font-weight:700;pointer-events:none;user-select:none;white-space:nowrap;}\r\n          .inv-summary-table tr.total td.right{color:#0f5fa8;}\r\n          .sign-line{display:block;width:70%;height:1px;background:#0f172a;margin-bottom:2px;}\r\n          .sign-name{font-size:12px;color:#0f5fa8;font-weight:600;margin-top:4px;}\r\n          .inv-footer-names{display:none;}\r\n          @media (max-width:760px){\r\n            .inv-top-cards{grid-template-columns:1fr;}\r\n            .inv-info-grid{grid-template-columns:1fr;}\r\n            .inv-header-band{gap:18px;padding:14px 16px;min-height:120px;}\r\n            .inv-logo-img{max-height:70px;}\r\n            .inv-hotel-meta{min-width:0;}\r\n          }\r\n          @media (max-width:520px){ .inv-logo-img{max-height:60px;} }\r\n          @media print{ .inv-logo-img{max-height:70px;} }\r\n          @media print{body{background:#fff;} .invoice-overlay{position:static;background:#fff;box-shadow:none;padding:0;} .invoice-modal{box-shadow:none;padding:0;} .invoice-actions,.inv-back-btn{display:none !important;} .inv-table th{background:#0f5fa8 !important;-webkit-print-color-adjust:exact;print-color-adjust:exact;} }\r\n        `}</style>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\nfunction StatusBadge({ status }) {\r\n  const s = STATUS_META[status] || STATUS_META.pending;\r\n  return <span className={`ph-badge ${s.cls}`}>{s.text}</span>;\r\n}\r\n\r\nfunction toISODate(d){ const dt = new Date(d); const y=dt.getFullYear(); const m=String(dt.getMonth()+1).padStart(2,'0'); const day=String(dt.getDate()).padStart(2,'0'); return `${y}-${m}-${day}`; }\r\nfunction fmtDate(d){ const dt = new Date(d); const dd=String(dt.getDate()).padStart(2,'0'); const mm = String(dt.getMonth()+1).padStart(2,'0'); const yy = dt.getFullYear(); return `${dd}/${mm}/${yy}`; }\r\nfunction fmtDateTime(d){ if(!d) return ''; const dt=new Date(d); const hh=String(dt.getHours()).padStart(2,'0'); const mi=String(dt.getMinutes()).padStart(2,'0'); return `${fmtDate(dt)} ${hh}:${mi}`; }\r\nfunction toISO(s){ const [d,m,y] = s.split('/'); return `${y}-${m}-${d}`; }\r\nfunction fmtMoney(n){ return Number(n||0).toLocaleString('vi-VN'); }\r\nfunction exportCsv(list){\r\n  const header = ['Mã đặt','Khách sạn','Phòng','Loại phòng','Nhận','Trả','Số đêm','Khách','Giá/đêm','Tiền phòng','Tiền dịch vụ','Tổng thanh toán','Trạng thái','Thanh toán','PTTT'];\r\n  const rows = list.map(it => [\r\n    it.code,\r\n    it.hotelName,\r\n    (it.roomName||''),\r\n    (it.roomType||''),\r\n    fmtDateTime(it.checkIn),\r\n    fmtDateTime(it.checkOut),\r\n    it.nights,\r\n    it.guests,\r\n    fmtMoney(it.pricePerNight),\r\n    fmtMoney(it.roomTotal),\r\n    fmtMoney(it.serviceTotal),\r\n    fmtMoney(it.grandTotal),\r\n    (STATUS_META[it.paymentStatus]?.text || STATUS_META.pending.text),\r\n    (it.paidAt?fmtDateTime(it.paidAt):''),\r\n    it.method\r\n  ]);\r\n  const csv = [header, ...rows].map(r=>r.map(v=>`\"${String(v).replace(/\"/g,'\"\"')}\"`).join(',')).join('\\n');\r\n  const blob = new Blob([\"\\uFEFF\"+csv], { type: 'text/csv;charset=utf-8;' });\r\n  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'lich-su-giao-dich.csv'; a.click();\r\n}\r\n\r\nfunction buildReviewHref(it){\r\n  const q = new URLSearchParams({\r\n    bookingId: String(it.bookingId || ''),\r\n    hotel: String(it.hotelName || ''),\r\n    roomType: String(it.roomType || ''),\r\n    ci: it.checkIn ? toISODate(it.checkIn) : '',\r\n    co: it.checkOut ? toISODate(it.checkOut) : '',\r\n  });\r\n  return `/review?${q.toString()}`;\r\n}\r\n\r\n// Additional styles for pinned horizontal scrollbar\r\n// (Injected once via a style tag at bottom if not present)\r\nif(typeof document !== 'undefined' && !document.getElementById('ph-scroll-bottom-style')){\r\n  const style = document.createElement('style');\r\n  style.id = 'ph-scroll-bottom-style';\r\n  style.textContent = `\r\n    .ph-scroll-bottom-wrapper{position:sticky;bottom:0;left:0;background:linear-gradient(to top, rgba(255,255,255,0.95), rgba(255,255,255,0.75));padding-top:4px;padding-bottom:2px;z-index:50;}\r\n    .ph-scroll-bottom::-webkit-scrollbar{height:10px;}\r\n    .ph-scroll-bottom::-webkit-scrollbar-track{background:#f1f5f9;border-radius:6px;}\r\n    .ph-scroll-bottom::-webkit-scrollbar-thumb{background:#94a3b8;border-radius:6px;}\r\n    .ph-scroll-bottom::-webkit-scrollbar-thumb:hover{background:#64748b;}\r\n    /* Hide original top scrollbar when custom pinned bar is present */\r\n    .ph-scroll-top{scrollbar-width:none;-ms-overflow-style:none;}\r\n    .ph-scroll-top::-webkit-scrollbar{display:none;height:0;}\r\n    /* Action column new styles */\r\n  .ph-action-stack{display:flex;flex-direction:column;gap:6px;min-width:128px;}\r\n  .ph-action-btn{all:unset;box-sizing:border-box;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;letter-spacing:.5px;padding:11px 14px;border-radius:8px;text-align:center;cursor:pointer;user-select:none;min-height:42px;font-family:inherit;position:relative;transition:background .25s, box-shadow .25s, transform .15s,border-color .25s,color .25s;}\r\n  .ph-action-btn:focus-visible{outline:2px solid #2563eb;outline-offset:2px;}\r\n  .ph-action-btn:active{transform:translateY(1px);} \r\n  /* Primary gradient */\r\n  .ph-action-primary{color:#fff !important;background:linear-gradient(145deg,#1d64f0,#1251c7) !important;box-shadow:0 2px 4px rgba(29,100,240,.4) !important;border:1px solid #1552c5 !important;}\r\n  .ph-action-primary:hover{background:linear-gradient(145deg,#256ef5,#1d55d8) !important;box-shadow:0 4px 10px -2px rgba(29,100,240,.55) !important;border-color:#1d55d8 !important;} \r\n  /* Outline (elevated white) */\r\n  .ph-action-outline{background:linear-gradient(#ffffff,#f1f5f9) !important;border:1px solid #d0d7df !important;color:#0f172a !important;box-shadow:0 1px 2px rgba(15,23,42,.12) !important;}\r\n  .ph-action-outline:hover{background:linear-gradient(#f8fafc,#e2e8f0) !important;border-color:#c2cad2 !important;} \r\n  /* Danger */\r\n  .ph-action-danger{background:linear-gradient(145deg,#dc2626,#b91c1c) !important;color:#fff !important;box-shadow:0 2px 4px rgba(220,38,38,.4) !important;border:1px solid #b91c1c !important;} \r\n  .ph-action-danger:hover{background:linear-gradient(145deg,#ef2f2f,#c52020) !important;box-shadow:0 4px 10px -2px rgba(220,38,38,.55) !important;border-color:#c52020 !important;} \r\n  /* Disabled */\r\n  .ph-action-btn.disabled,.ph-action-btn:disabled{background:linear-gradient(#f1f5f9,#e2e8f0) !important;color:#94a3b8 !important;border:1px solid #dbe0e6 !important;cursor:default;box-shadow:none !important;}\r\n  /* Refund badge pill */\r\n  .ph-action-refund{font-size:11px;font-weight:600;color:#047857;background:linear-gradient(145deg,#ecfdf5,#d1fae5);border:1px solid #34d399;border-radius:10px;padding:10px 8px;line-height:1.25;text-align:center;box-shadow:0 1px 3px rgba(16,185,129,.35);} \r\n  .ph-action-refund b{display:block;font-size:12px;margin-bottom:2px;color:#065f46;}\r\n  .ph-action-refund:before{content:\"\";}\r\n    @media (max-width:900px){ .ph-action-stack{min-width:104px;} .ph-action-btn{font-size:11px;padding:8px 8px;min-height:36px;} }\r\n  `;\r\n  document.head.appendChild(style);\r\n}\r\n\r\n// Styles for .ph-action-inline, .ph-link, .ph-cancel-btn, .ph-refund-note moved to HomePage.css\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}