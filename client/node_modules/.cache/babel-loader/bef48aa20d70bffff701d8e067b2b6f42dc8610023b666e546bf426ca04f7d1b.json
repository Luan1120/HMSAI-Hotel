{"ast":null,"code":"import _objectSpread from\"D:/DA_TichHop/HMS_AI Hotel/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useRef,useState}from'react';import{Link}from'react-router-dom';import'./RoomsBrowse.css';/* Public rooms browsing page\r\n   Features:\r\n   - Filters: keyword (room number / type), hotel, room type\r\n   - Uses /api/admin/rooms for richer data if user is Admin/Staff (auth header) else falls back to room types + derived rooms not available => we attempt public-like fetch.\r\n   NOTE: Currently there is no public rooms endpoint returning individual rooms; we will call /api/admin/rooms without auth -> backend will 401.\r\n   Fallback strategy: fetch room types (/api/room-types) + display them as pseudo-room rows with aggregate info.\r\n*/import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function RoomsBrowse(_ref){var _detailFull$price,_detailFull$images,_reviewsData$reviews,_reviewsData$reviews2;let{inline=false,onClose}=_ref;// Helper to normalize status strings into canonical tokens\nconst canonicalStatus=s=>{const v=String(s||'').trim().toLowerCase();if(!v)return'available';if(v.includes('book'))return'booked';if(v.includes('occup'))return'occupied';if(v.includes('clean'))return'cleaning';if(v.includes('maint'))return'maintenance';if(v.includes('unavail')||v.includes('unavailable'))return'unavailable';if(v==='available'||v==='trống'||v==='trong')return'available';return v;};const isDisabledStatus=s=>{const st=canonicalStatus(s);return['booked','maintenance','unavailable','occupied','cleaning'].includes(st);};// Helper to normalize image paths returned from API (may be stored without leading slash or uploads prefix)\nconst normalizeImage=p=>{if(!p)return null;try{// Already absolute (http/https/data) or starts with /uploads or /static\nif(/^https?:\\/\\//i.test(p)||/^data:/i.test(p))return p;if(p.startsWith('/'))return p;// assume valid root-relative\n// If filename only, prepend uploads path\nreturn'/uploads/'+p.replace(/^\\/+/,'');}catch(_unused){return p;}};const[q,setQ]=useState('');const[hotelId,setHotelId]=useState('');const[typeId,setTypeId]=useState('');const[hotels,setHotels]=useState([]);const[types,setTypes]=useState([]);const[rooms,setRooms]=useState([]);// unified view\nconst[detail,setDetail]=useState(null);// basic selected row (list data)\nconst[detailFull,setDetailFull]=useState(null);// full fetched room detail\nconst[detailLoading,setDetailLoading]=useState(false);const[reviewsModal,setReviewsModal]=useState(null);// { roomId, loading, data }\nconst[reviewsLoading,setReviewsLoading]=useState(false);const[reviewsData,setReviewsData]=useState(null);// { reviews, avgRating }\nconst[reviewsError,setReviewsError]=useState('');const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[bookingOpen,setBookingOpen]=useState(false);const[bookingRoom,setBookingRoom]=useState(null);const[bkCheckIn,setBkCheckIn]=useState('');const[bkCheckOut,setBkCheckOut]=useState('');const[bkAdults,setBkAdults]=useState(1);const[bkChildren,setBkChildren]=useState(0);const[bkPayMethod,setBkPayMethod]=useState('MOMO');const[bkAgree,setBkAgree]=useState(false);const[bkLoading,setBkLoading]=useState(false);const[bkMsg,setBkMsg]=useState('');const[bkAvailable,setBkAvailable]=useState(true);// Prevent duplicate rapid submissions / re-init after success redirect\nconst[bkSubmitted,setBkSubmitted]=useState(false);// Promotions removed\nconst bkFirstFieldRef=useRef(null);const authEmail=(()=>{try{const u=JSON.parse(localStorage.getItem('hmsUser')||'null');return(u===null||u===void 0?void 0:u.email)||'';}catch(_unused2){return'';}})();const nights=useMemo(()=>{if(!bkCheckIn||!bkCheckOut)return 0;const inD=new Date(bkCheckIn);const outD=new Date(bkCheckOut);const ms=outD-inD;return ms>0?Math.round(ms/86400000):0;},[bkCheckIn,bkCheckOut]);const totalPrice=useMemo(()=>nights*Number((bookingRoom===null||bookingRoom===void 0?void 0:bookingRoom.price)||0),[nights,bookingRoom]);const finalPrice=totalPrice;// no promotions\nconst dateError=useMemo(()=>{if(!bkCheckIn||!bkCheckOut)return'';const inD=new Date(bkCheckIn);const outD=new Date(bkCheckOut);if(!(outD>inD))return'Ngày trả phải sau ngày nhận';return'';},[bkCheckIn,bkCheckOut]);const submitEnabled=!!authEmail&&!bkLoading&&!bkSubmitted&&bookingRoom&&bkCheckIn&&bkCheckOut&&!dateError&&bkAdults>=1&&nights>0&&bkAgree&&!isDisabledStatus(bookingRoom===null||bookingRoom===void 0?void 0:bookingRoom.status)&&bkAvailable;const isPrivileged=useMemo(()=>{try{const u=JSON.parse(localStorage.getItem('hmsUser')||'null');return['admin','staff'].includes(String((u===null||u===void 0?void 0:u.role)||'').toLowerCase());}catch(_unused3){return false;}},[]);const isAdmin=useMemo(()=>{try{const u=JSON.parse(localStorage.getItem('hmsUser')||'null');return String((u===null||u===void 0?void 0:u.role)||'').toLowerCase().includes('admin');}catch(_unused4){return false;}},[]);const loadHotels=async()=>{try{const res=await fetch('/api/hotels');if(!res.ok)throw new Error();const list=await res.json();setHotels(Array.isArray(list)?list:[]);}catch(_unused5){setHotels([]);}};const loadTypes=async hid=>{try{const url=new URL('/api/room-types',window.location.origin);if(hid)url.searchParams.set('hotelId',hid);const res=await fetch(url);if(!res.ok)throw new Error();const list=await res.json();setTypes(Array.isArray(list)?list:[]);}catch(_unused6){setTypes([]);}};const loadRooms=async()=>{setLoading(true);setError('');try{const origin=window.location.origin;const url=new URL('/api/rooms',origin);if(q)url.searchParams.set('q',q);if(hotelId)url.searchParams.set('hotelId',hotelId);if(typeId)url.searchParams.set('typeId',typeId);console.log('[RoomsBrowse] Fetch rooms:',url.toString());const res=await fetch(url,{headers:{'Accept':'application/json'}});if(!res.ok){const text=await res.text().catch(()=>'');throw new Error('Không tải được phòng'+(text?' - '+text.substring(0,120):''));}const j=await res.json();if(!j||typeof j!=='object')throw new Error('Phản hồi không hợp lệ');const list=Array.isArray(j.items)?j.items:Array.isArray(j.rooms)?j.rooms:[];console.log('[RoomsBrowse] Received rooms count:',list.length);setRooms(list.map(r=>{const imgsRaw=Array.isArray(r.images)?r.images:[];const imgs=imgsRaw.map(im=>normalizeImage(im)).filter(Boolean);const first=imgs.length?imgs[0]:null;return{id:r.id,roomNumber:r.roomNumber||'-',floor:r.floor||null,hotelName:r.hotelName,roomType:r.roomType,price:r.price,status:r.status||'Available',description:r.description||'',image:first,images:imgs};}));// After loading rooms, fetch availability for the near-term (today->tomorrow) so UI disables booked rooms on initial render\ntry{const today=new Date().toISOString().slice(0,10);const tomorrow=(()=>{const d=new Date();d.setDate(d.getDate()+1);return d.toISOString().slice(0,10);})();const url=new URL('/api/rooms/availability',window.location.origin);url.searchParams.set('checkIn',today);url.searchParams.set('checkOut',tomorrow);if(hotelId)url.searchParams.set('hotelId',hotelId);const ares=await fetch(url.toString());if(ares.ok){const aj=await ares.json();const map=new Map((aj.items||[]).map(x=>[Number(x.roomId),!!x.available]));setRooms(prev=>prev.map(r=>_objectSpread(_objectSpread({},r),{},{available:map.has(Number(r.id))?map.get(Number(r.id)):true})));}}catch(e){/* ignore availability fetch errors */}}catch(e){console.error('[RoomsBrowse] loadRooms error',e);setError(e.message||'Lỗi tải dữ liệu');setRooms([]);}finally{setLoading(false);}};useEffect(()=>{loadHotels();loadTypes();},[]);useEffect(()=>{loadTypes(hotelId);},[hotelId]);useEffect(()=>{loadRooms();},[q,hotelId,typeId]);const statusLabel=s=>{const v=String(s||'').toLowerCase();if(v==='available')return/*#__PURE__*/_jsx(\"span\",{className:\"rb-badge available\",children:\"Tr\\u1ED1ng\"});if(v==='occupied')return/*#__PURE__*/_jsx(\"span\",{className:\"rb-badge booked\",children:\"\\u0110ang \\u1EDF\"});if(v==='cleaning')return/*#__PURE__*/_jsx(\"span\",{className:\"rb-badge maintenance\",children:\"D\\u1ECDn d\\u1EB9p\"});if(v==='maintenance')return/*#__PURE__*/_jsx(\"span\",{className:\"rb-badge maintenance\",children:\"B\\u1EA3o tr\\xEC\"});return/*#__PURE__*/_jsx(\"span\",{className:\"rb-badge available\",children:\"Tr\\u1ED1ng\"});};const openDetail=async r=>{setDetail(r);setDetailFull(null);if(!(r!==null&&r!==void 0&&r.id))return;setDetailLoading(true);try{const res=await fetch(\"/api/rooms/\".concat(r.id));if(!res.ok)throw new Error('Không tải được chi tiết');const j=await res.json();setDetailFull(j.room||null);}catch(e){console.error('detail fetch error',e);}finally{setDetailLoading(false);}};const closeDetail=()=>{setDetail(null);setDetailFull(null);};// Open booking modal for a room but refresh latest room detail first to avoid duplicate bookings\nconst openBookingForRoom=async r=>{try{const uRole=(()=>{try{const u=JSON.parse(localStorage.getItem('hmsUser')||'null');return(u===null||u===void 0?void 0:u.role)||'Customer';}catch(_unused7){return'Customer';}})();if(String(uRole).toLowerCase().includes('admin')){setBkMsg('Tài khoản Admin không được phép đặt phòng');setBookingOpen(true);setBookingRoom(null);return;}}catch(_unused8){}if(!(r!==null&&r!==void 0&&r.id))return;setBkMsg('');try{// Try to fetch the latest room detail from server\nconst res=await fetch(\"/api/rooms/\".concat(r.id));if(!res.ok)throw new Error('Không tải được trạng thái phòng');const j=await res.json();const rf=j.room||null;const imgsRaw=Array.isArray((rf===null||rf===void 0?void 0:rf.images)||r.images)?(rf===null||rf===void 0?void 0:rf.images)||r.images:[];const imgs=imgsRaw.map(im=>normalizeImage(im)).filter(Boolean);const merged=_objectSpread(_objectSpread(_objectSpread({},r),rf),{},{images:imgs,image:imgs[0]||r.image,// ensure status field exists and use server-provided status if present\nstatus:rf&&(rf.status||rf.Status)||r.status||'Available'});// If user selected dates already, call availability endpoint to verify\nlet available=true;if(bkCheckIn&&bkCheckOut){try{const avRes=await fetch(\"/api/rooms/\".concat(r.id,\"/availability?checkIn=\").concat(encodeURIComponent(bkCheckIn),\"&checkOut=\").concat(encodeURIComponent(bkCheckOut)));if(avRes.ok){const av=await avRes.json();available=!!av.available;}}catch(e){/* ignore availability check failure */}}setBkAvailable(available);setBookingRoom(merged);// If the room is already in disabled status, show a message but still open modal so user can see details\nif(isDisabledStatus(merged.status)||available===false){setBkMsg('Phòng hiện không khả dụng (đã được đặt hoặc đang bảo trì). Không thể đặt.');}setBookingOpen(true);setBkCheckIn('');setBkCheckOut('');setBkAdults(1);setBkChildren(0);setBkSubmitted(false);}catch(e){console.error('openBookingForRoom error',e);// fallback to original object if fetch failed\nsetBookingRoom(r);setBookingOpen(true);setBkMsg('Không thể kiểm tra trạng thái phòng, vui lòng thử lại.');}};const openReviews=async r=>{if(!(r!==null&&r!==void 0&&r.id))return;setReviewsModal(r);setReviewsLoading(true);setReviewsError('');setReviewsData(null);try{const res=await fetch(\"/api/rooms/\".concat(r.id,\"/reviews\"));if(!res.ok)throw new Error('Không tải được đánh giá');const j=await res.json();setReviewsData({reviews:j.reviews||[],avgRating:j.avgRating||0});}catch(e){setReviewsError(e.message||'Lỗi tải đánh giá');}finally{setReviewsLoading(false);}};const closeReviews=()=>{setReviewsModal(null);setReviewsData(null);};// ESC key to close detail modal\nuseEffect(()=>{const handler=e=>{if(e.key==='Escape'){if(bookingOpen){setBookingOpen(false);setBookingRoom(null);}else if(detail)closeDetail();else if(onClose&&inline)onClose();}};window.addEventListener('keydown',handler);return()=>window.removeEventListener('keydown',handler);},[detail,inline,onClose,bookingOpen]);useEffect(()=>{if(bookingOpen&&bkFirstFieldRef.current){try{bkFirstFieldRef.current.focus();}catch(_unused9){}}},[bookingOpen]);// Single horizontal scrollbar (top) refs\nconst topScrollRef=useRef(null);const bodyScrollRef=useRef(null);const syncScrolling=(source,target)=>{if(!source||!target)return;if(target.scrollLeft!==source.scrollLeft)target.scrollLeft=source.scrollLeft;};useEffect(()=>{const topEl=topScrollRef.current;const botEl=bodyScrollRef.current;if(!topEl||!botEl)return;const onTop=()=>syncScrolling(topEl,botEl);const onBot=()=>syncScrolling(botEl,topEl);topEl.addEventListener('scroll',onTop);botEl.addEventListener('scroll',onBot);const resizeHandler=()=>{// keep width track by forcing reflow\nif(topEl&&botEl){// match scrollLeft after resize\nsyncScrolling(botEl,topEl);}};window.addEventListener('resize',resizeHandler);return()=>{topEl.removeEventListener('scroll',onTop);botEl.removeEventListener('scroll',onBot);window.removeEventListener('resize',resizeHandler);};},[rooms.length]);return/*#__PURE__*/_jsxs(\"div\",{className:inline?'':'home-root',style:{paddingTop:inline?0:80},children:[!inline&&/*#__PURE__*/_jsxs(\"header\",{className:\"home-header\",style:{position:'sticky',top:0},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"home-header-left\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/logo.png\",alt:\"logo\",className:\"home-header-logo\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"home-header-title home-header-home-btn\",children:\"TRANG CH\\u1EE6\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"home-header-icons\",children:/*#__PURE__*/_jsx(Link,{to:\"/login\",className:\"home-header-icon\",title:\"\\u0110\\u0103ng nh\\u1EADp\",children:/*#__PURE__*/_jsx(\"img\",{src:\"/icon-user.png\",alt:\"user\",className:\"home-header-icon-img\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:inline?'8px 14px 24px':'24px 24px 40px'},children:[inline&&/*#__PURE__*/_jsx(\"button\",{className:\"rb-btn gradient\",style:{marginBottom:14,borderRadius:28},onClick:()=>onClose&&onClose(),children:\"\\u2190 Quay l\\u1EA1i\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-overlay-animate rb-panel\",onMouseDown:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rb-heading-wrap\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"rb-heading\",children:\"Danh s\\xE1ch ph\\xF2ng\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-total-count\",\"aria-live\":\"polite\",children:[\"T\\u1ED5ng: \",rooms.length,\" \",loading&&/*#__PURE__*/_jsx(\"span\",{className:\"rb-muted\",style:{fontWeight:400},children:\"(\\u0110ang t\\u1EA3i...)\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-filters\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rb-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"T\\u1EEB kh\\xF3a\"}),/*#__PURE__*/_jsx(\"input\",{className:\"rb-input\",value:q,onChange:e=>setQ(e.target.value),placeholder:\"S\\u1ED1 ph\\xF2ng / lo\\u1EA1i / kh\\xE1ch s\\u1EA1n\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Kh\\xE1ch s\\u1EA1n\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-select-wrap\",children:/*#__PURE__*/_jsxs(\"select\",{className:\"rb-select\",value:hotelId,onChange:e=>setHotelId(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),hotels.map(h=>/*#__PURE__*/_jsx(\"option\",{value:h.id,children:h.name},h.id))]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"H\\u1EA1ng ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-select-wrap\",children:/*#__PURE__*/_jsxs(\"select\",{className:\"rb-select\",value:typeId,onChange:e=>setTypeId(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),types.map(t=>/*#__PURE__*/_jsx(\"option\",{value:t.id,children:t.name},t.id))]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-table-shell\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rb-table-head\",style:{gridTemplateColumns:'150px 130px 1.1fr 1.1fr 120px 120px 2fr 200px'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"\\u1EA2nh\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"Ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"Kh\\xE1ch s\\u1EA1n\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"Lo\\u1EA1i ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"Gi\\xE1/\\u0111\\xEAm\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"M\\xF4 t\\u1EA3\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]}),/*#__PURE__*/_jsx(\"div\",{ref:bodyScrollRef,className:\"rb-table-body\",children:loading?/*#__PURE__*/_jsx(\"div\",{className:\"rb-row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"\\u0110ang t\\u1EA3i...\"})}):error?/*#__PURE__*/_jsx(\"div\",{className:\"rb-row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",style:{color:'#b42318'},children:error})}):rooms.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"rb-row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:\"Kh\\xF4ng c\\xF3 ph\\xF2ng ph\\xF9 h\\u1EE3p.\"})}):rooms.map((r,idx)=>{const roomLabel=r.roomNumber==='-'?'-':\"\".concat(r.roomNumber).concat(r.floor?' - T'+r.floor:'');return/*#__PURE__*/_jsxs(\"div\",{className:\"rb-row\",style:{gridTemplateColumns:'150px 130px 1.1fr 1.1fr 120px 120px 2fr 200px',animationDelay:\"\".concat(Math.min(idx,12)*30,\"ms\")},children:[/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell image-cell\",children:/*#__PURE__*/_jsx(\"div\",{className:\"rb-img-wrap\",children:r.image?/*#__PURE__*/_jsx(\"img\",{src:r.image,alt:\"img\"}):/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'100%',display:'flex',alignItems:'center',justifyContent:'center',fontSize:10,color:'#777'},children:\"No image\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",title:roomLabel,children:roomLabel}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:r.hotelName}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:r.roomType}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-cell\",style:{fontSize:13},children:[Number(r.price||0).toLocaleString('vi-VN'),\" VND\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell\",children:statusLabel(r.status)}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-cell rb-desc\",title:r.description,children:r.description||'—'}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-cell rb-actions\",style:{gap:8},children:[/*#__PURE__*/_jsx(\"button\",{className:\"rb-btn primary\",type:\"button\",disabled:isDisabledStatus(r.status)||r.available===false||isAdmin,onClick:()=>{if(isAdmin){alert('Tài khoản Admin không được phép đặt phòng');return;}if(isDisabledStatus(r.status)||r.available===false)return;openBookingForRoom(r);},children:isDisabledStatus(r.status)||r.available===false?'ĐÃ ĐƯỢC ĐẶT':'Đặt phòng'}),/*#__PURE__*/_jsx(\"button\",{className:\"rb-btn outline\",type:\"button\",onClick:()=>openReviews(r),children:\"\\u0110\\xE1nh gi\\xE1\"}),/*#__PURE__*/_jsx(\"button\",{className:\"rb-btn outline\",type:\"button\",onClick:()=>openDetail(r),children:\"Chi ti\\u1EBFt\"})]})]},r.id);})})]})]}),detail&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-modal-backdrop\",onMouseDown:e=>{if(e.target===e.currentTarget)closeDetail();},children:/*#__PURE__*/_jsxs(\"div\",{className:\"rb-modal\",onMouseDown:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"button\",{className:\"rb-modal-close\",onClick:closeDetail,\"aria-label\":\"\\u0110\\xF3ng\",children:\"\\xD7\"}),/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0,marginBottom:14,fontSize:'1.15rem'},children:detailFull!==null&&detailFull!==void 0&&detailFull.roomNumber?\"\".concat(detailFull.roomNumber).concat(detailFull.floor?' - T'+detailFull.floor:''):detail.roomType}),detailLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-muted\",style:{fontSize:'.75rem'},children:\"\\u0110ang t\\u1EA3i chi ti\\u1EBFt...\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:24,flexWrap:'wrap',opacity:detailLoading?.6:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{flex:'0 0 260px'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"rb-img-wrap\",style:{width:'100%',height:180},children:detailFull!==null&&detailFull!==void 0&&detailFull.images&&detailFull.images[0]?/*#__PURE__*/_jsx(\"img\",{src:normalizeImage(detailFull.images[0]),alt:\"\"}):detail.image?/*#__PURE__*/_jsx(\"img\",{src:detail.image,alt:\"\"}):/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'100%',display:'flex',alignItems:'center',justifyContent:'center',fontSize:12,color:'#666'},children:\"No image\"})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:10,fontSize:'.75rem',lineHeight:1.3},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Lo\\u1EA1i:\"}),\" \",(detailFull===null||detailFull===void 0?void 0:detailFull.roomType)||detail.roomType]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Gi\\xE1:\"}),\" \",Number(((_detailFull$price=detailFull===null||detailFull===void 0?void 0:detailFull.price)!==null&&_detailFull$price!==void 0?_detailFull$price:detail.price)||0).toLocaleString('vi-VN'),\" VND/\\u0111\\xEAm\"]}),(detailFull===null||detailFull===void 0?void 0:detailFull.maxAdults)!=null&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Ng\\u01B0\\u1EDDi l\\u1EDBn t\\u1ED1i \\u0111a:\"}),\" \",detailFull.maxAdults]}),(detailFull===null||detailFull===void 0?void 0:detailFull.maxChildren)!=null&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Tr\\u1EBB em t\\u1ED1i \\u0111a:\"}),\" \",detailFull.maxChildren]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Tr\\u1EA1ng th\\xE1i:\"}),\" \",statusLabel((detailFull===null||detailFull===void 0?void 0:detailFull.status)||detail.status)]})]}),(detailFull===null||detailFull===void 0?void 0:(_detailFull$images=detailFull.images)===null||_detailFull$images===void 0?void 0:_detailFull$images.length)>1&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:6,flexWrap:'wrap',marginTop:10},children:detailFull.images.slice(1,6).map((im,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"rb-img-wrap\",style:{width:54,height:40},children:/*#__PURE__*/_jsx(\"img\",{src:normalizeImage(im),alt:\"thumb\"})},i))})]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:'1 1 300px',minWidth:240},children:/*#__PURE__*/_jsx(\"p\",{style:{whiteSpace:'pre-wrap',lineHeight:1.45,fontSize:'.78rem'},children:(detailFull===null||detailFull===void 0?void 0:detailFull.description)||detail.description||'Không có mô tả.'})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:22,display:'flex',gap:10,justifyContent:'flex-end'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"rb-btn primary\",disabled:isDisabledStatus((detailFull===null||detailFull===void 0?void 0:detailFull.status)||detail.status||'')||(detailFull===null||detailFull===void 0?void 0:detailFull.available)===false||(detail===null||detail===void 0?void 0:detail.available)===false,onClick:()=>{if(isDisabledStatus((detailFull===null||detailFull===void 0?void 0:detailFull.status)||detail.status||'')||(detailFull===null||detailFull===void 0?void 0:detailFull.available)===false||(detail===null||detail===void 0?void 0:detail.available)===false)return;openBookingForRoom(detailFull||detail);},children:isDisabledStatus((detailFull===null||detailFull===void 0?void 0:detailFull.status)||detail.status||'')||(detailFull===null||detailFull===void 0?void 0:detailFull.available)===false||(detail===null||detail===void 0?void 0:detail.available)===false?'ĐÃ ĐƯỢC ĐẶT':'Đặt phòng'}),/*#__PURE__*/_jsx(\"button\",{className:\"rb-btn outline\",onClick:closeDetail,children:\"\\u0110\\xF3ng\"})]})]})}),bookingOpen&&bookingRoom&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-modal-backdrop\",onMouseDown:e=>{if(e.target===e.currentTarget){setBookingOpen(false);setBookingRoom(null);}},children:/*#__PURE__*/_jsxs(\"div\",{className:\"rb-modal rb-booking-fast-animate\",role:\"dialog\",\"aria-modal\":\"true\",\"aria-label\":\"\\u0110\\u1EB7t ph\\xF2ng nhanh\",onMouseDown:e=>e.stopPropagation(),style:{maxWidth:600},children:[/*#__PURE__*/_jsx(\"button\",{className:\"rb-modal-close\",onClick:()=>{setBookingOpen(false);setBookingRoom(null);},\"aria-label\":\"\\u0110\\xF3ng\",children:\"\\xD7\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-fast\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0110\\u1EB7t ph\\xF2ng nhanh\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-room-image\",style:{marginBottom:14},children:[/*#__PURE__*/_jsx(\"div\",{className:\"rb-img-wrap\",style:{width:'100%',height:160,borderRadius:14,overflow:'hidden',boxShadow:'0 2px 6px rgba(0,0,0,0.15)'},children:bookingRoom.images&&bookingRoom.images[0]?/*#__PURE__*/_jsx(\"img\",{src:bookingRoom.images[0],alt:\"Ph\\xF2ng\"}):bookingRoom.image?/*#__PURE__*/_jsx(\"img\",{src:bookingRoom.image,alt:\"Ph\\xF2ng\"}):/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'100%',display:'flex',alignItems:'center',justifyContent:'center',fontSize:12,color:'#666'},children:\"Kh\\xF4ng c\\xF3 \\u1EA3nh\"})}),bookingRoom.images&&bookingRoom.images.length>1&&/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:6,marginTop:8,flexWrap:'wrap'},children:bookingRoom.images.slice(1,6).map((im,i)=>/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{const copy=[...bookingRoom.images];const main=copy[0];copy[0]=copy[i+1];copy[i+1]=main;setBookingRoom(_objectSpread(_objectSpread({},bookingRoom),{},{images:copy,image:copy[0]}));},className:\"rb-img-wrap\",style:{width:54,height:40,cursor:'pointer',opacity:.9},title:\"Xem \\u1EA3nh\",children:/*#__PURE__*/_jsx(\"img\",{src:im,alt:\"thumb\"})},i))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-meta\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Ph\\xF2ng:\"}),\" \",bookingRoom.roomNumber==='-'?bookingRoom.roomType:bookingRoom.roomNumber,bookingRoom.floor?\" \\u2022 T\\u1EA7ng \".concat(bookingRoom.floor):'',/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"Lo\\u1EA1i:\"}),\" \",bookingRoom.roomType,/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"strong\",{children:\"Gi\\xE1:\"}),\" \",Number(bookingRoom.price||0).toLocaleString('vi-VN'),\" VND/\\u0111\\xEAm\"]}),/*#__PURE__*/_jsx(\"form\",{onSubmit:async e=>{e.preventDefault();setBkMsg('');if(!authEmail){setBkMsg('Vui lòng đăng nhập để đặt phòng.');return;}// final server-side availability check to avoid race conditions\nif(!submitEnabled){return;}try{if(bookingRoom&&bookingRoom.id){const avUrl=\"/api/rooms/\".concat(bookingRoom.id,\"/availability?checkIn=\").concat(encodeURIComponent(bkCheckIn),\"&checkOut=\").concat(encodeURIComponent(bkCheckOut));const chkRes=await fetch(avUrl);if(chkRes.ok){const chk=await chkRes.json();if(chk&&chk.available===false){setBkMsg('Phòng không còn khả dụng cho khoảng ngày chọn. Vui lòng chọn phòng khác.');return;}}}}catch(err){/* ignore check failure, proceed with caution */}try{setBkLoading(true);setBkSubmitted(true);// Tạo token và summary tương tự RoomTypeInline flow để chuyển sang trang thanh toán\nconst token=Math.random().toString(36).slice(2)+Date.now().toString(36);const pad2=n=>String(n).padStart(2,'0');const nowD=new Date();const bookingCode=\"HMS\".concat(nowD.getFullYear()).concat(pad2(nowD.getMonth()+1)).concat(pad2(nowD.getDate()));const roomNames=\"Ph\\xF2ng \".concat(bookingRoom.roomNumber).concat(bookingRoom.floor?\" \\u2022 T\\u1EA7ng \".concat(bookingRoom.floor):'');const summary={token,code:bookingCode,hotelId:bookingRoom.hotelId||null,hotel:bookingRoom.hotelName||'',roomType:bookingRoom.roomType||'',roomNames,checkIn:bkCheckIn,checkOut:bkCheckOut,checkInTime:'14:00',checkOutTime:'12:00',payMethod:bkPayMethod||'MOMO',userEmail:authEmail,adults:bkAdults,children:bkChildren,rooms:[{id:bookingRoom.id,number:bookingRoom.roomNumber,floor:bookingRoom.floor,price:bookingRoom.price,name:bookingRoom.roomNumber,adults:bkAdults,children:bkChildren}],amount:Number(bookingRoom.price||0)*nights||0};// promotions removed\ntry{localStorage.setItem('hmsBooking:'+token,JSON.stringify(summary));}catch(_unused0){}const q=[\"token=\".concat(encodeURIComponent(token)),\"code=\".concat(encodeURIComponent(summary.code)),// pass gross amount; discount is read from summary on PaymentConfirm\n\"amount=\".concat(encodeURIComponent(summary.amount)),\"hid=\".concat(encodeURIComponent(summary.hotelId||'')),\"rn=\".concat(encodeURIComponent(roomNames)),\"rt=\".concat(encodeURIComponent(summary.roomType||'')),\"ci=\".concat(encodeURIComponent(summary.checkIn||'')),\"co=\".concat(encodeURIComponent(summary.checkOut||'')),\"ad=\".concat(encodeURIComponent(summary.adults)),\"ch=\".concat(encodeURIComponent(summary.children))].join('&');window.location.href='/payment/confirm?'+q;}catch(err){setBkMsg(err.message||'Lỗi khởi tạo thanh toán');setBkSubmitted(false);}finally{setBkLoading(false);}},children:/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ng\\xE0y nh\\u1EADn\"}),/*#__PURE__*/_jsx(\"input\",{ref:bkFirstFieldRef,type:\"date\",min:new Date().toISOString().slice(0,10),value:bkCheckIn,onChange:e=>{const v=e.target.value;setBkCheckIn(v);// If check-out is before/equals new check-in, reset check-out\nif(bkCheckOut&&bkCheckOut<=v){setBkCheckOut('');}},required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ng\\xE0y tr\\u1EA3\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",min:bkCheckIn?(()=>{const d=new Date(bkCheckIn);d.setDate(d.getDate()+1);return d.toISOString().slice(0,10);})():new Date().toISOString().slice(0,10),value:bkCheckOut,onChange:e=>setBkCheckOut(e.target.value),disabled:!bkCheckIn,required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ng\\u01B0\\u1EDDi l\\u1EDBn\"}),/*#__PURE__*/_jsx(\"select\",{value:bkAdults,onChange:e=>setBkAdults(Number(e.target.value)),children:Array.from({length:bookingRoom.maxAdults||2},(_,i)=>i+1).map(v=>/*#__PURE__*/_jsx(\"option\",{value:v,children:v},v))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Tr\\u1EBB em\"}),/*#__PURE__*/_jsx(\"select\",{value:bkChildren,onChange:e=>setBkChildren(Number(e.target.value)),children:Array.from({length:(bookingRoom.maxChildren||0)+1},(_,i)=>i).map(v=>/*#__PURE__*/_jsx(\"option\",{value:v,children:v},v))})]})]}),dateError&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-msg error\",role:\"alert\",children:dateError}),!dateError&&bkCheckIn&&bkCheckOut&&bkAvailable===false&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-msg error\",role:\"alert\",children:\"Ph\\xF2ng kh\\xF4ng kh\\u1EA3 d\\u1EE5ng cho kho\\u1EA3ng ng\\xE0y \\u0111\\xE3 ch\\u1ECDn.\"}),nights>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-summary\",\"aria-live\":\"polite\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:nights}),\" \\u0111\\xEAm x \",Number(bookingRoom.price||0).toLocaleString('vi-VN'),\" VND\"]}),/*#__PURE__*/_jsxs(\"span\",{style:{fontWeight:800},children:[Number(totalPrice).toLocaleString('vi-VN'),\" VND\"]})]}),!authEmail&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-msg error\",children:\"Vui l\\xF2ng \\u0111\\u0103ng nh\\u1EADp \\u0111\\u1EC3 \\u0111\\u1EB7t ph\\xF2ng.\"}),bkMsg&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-msg \".concat(bkMsg.includes('thành công')?'success':'error'),children:bkMsg}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-booking-row\",style:{marginTop:4},children:/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-field\",style:{flex:'1 1 100%'},children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\"}),/*#__PURE__*/_jsxs(\"select\",{value:bkPayMethod,onChange:e=>setBkPayMethod(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"MOMO\",children:\"V\\xED \\u0111i\\u1EC7n t\\u1EED MOMO\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ZALOPAY\",children:\"ZaloPay\"}),/*#__PURE__*/_jsx(\"option\",{value:\"VNPAY\",children:\"VNPay\"}),/*#__PURE__*/_jsx(\"option\",{value:\"CARD\",children:\"Th\\u1EBB t\\xEDn d\\u1EE5ng/ghi n\\u1EE3\"})]})]})}),/*#__PURE__*/_jsxs(\"label\",{className:\"rb-terms\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",style:{marginTop:2},checked:bkAgree,onChange:e=>setBkAgree(e.target.checked)}),/*#__PURE__*/_jsx(\"span\",{children:\"Vui l\\xF2ng \\u0111\\u1ECDc k\\u0129 v\\xE0 \\u0111\\u1ED3ng \\xFD v\\u1EDBi \\u0111i\\u1EC1u kho\\u1EA3n b\\u1EB1ng c\\xE1ch \\u0111\\xE1nh d\\u1EA5u v\\xE0o \\xF4 b\\xEAn c\\u1EA1nh\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rb-booking-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"rb-btn outline\",onClick:()=>{setBookingOpen(false);setBookingRoom(null);},children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"rb-btn primary\",disabled:!submitEnabled||isDisabledStatus(bookingRoom===null||bookingRoom===void 0?void 0:bookingRoom.status)||(bookingRoom===null||bookingRoom===void 0?void 0:bookingRoom.available)===false,children:isDisabledStatus(bookingRoom===null||bookingRoom===void 0?void 0:bookingRoom.status)||(bookingRoom===null||bookingRoom===void 0?void 0:bookingRoom.available)===false?'ĐÃ ĐƯỢC ĐẶT':bkLoading?'Đang xử lý...':'Thanh toán'})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"rb-booking-note\",children:\"C\\u1EA7n nhi\\u1EC1u ph\\xF2ng ho\\u1EB7c t\\xF9y ch\\u1ECDn n\\xE2ng cao? V\\xE0o giao di\\u1EC7n h\\u1EA1ng ph\\xF2ng \\u0111\\u1EC3 ch\\u1ECDn nhi\\u1EC1u ph\\xF2ng v\\xE0 ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n.\"})]})]})}),reviewsModal&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-modal-backdrop\",onMouseDown:e=>{if(e.target===e.currentTarget)closeReviews();},children:/*#__PURE__*/_jsxs(\"div\",{className:\"rb-modal\",onMouseDown:e=>e.stopPropagation(),style:{maxWidth:860},children:[/*#__PURE__*/_jsx(\"button\",{className:\"rb-modal-close\",onClick:closeReviews,\"aria-label\":\"\\u0110\\xF3ng\",children:\"\\xD7\"}),/*#__PURE__*/_jsxs(\"h3\",{style:{marginTop:0,marginBottom:10,fontSize:'1.05rem'},children:[\"\\u0110\\xE1nh gi\\xE1 ph\\xF2ng \",reviewsModal.roomNumber||reviewsModal.roomType]}),reviewsLoading&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-muted\",style:{fontSize:'.75rem'},children:\"\\u0110ang t\\u1EA3i \\u0111\\xE1nh gi\\xE1...\"}),reviewsError&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#b42318',fontSize:'.75rem'},children:reviewsError}),!reviewsLoading&&!reviewsError&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:6},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'.8rem',marginBottom:10},children:[\"Trung b\\xECnh: \",/*#__PURE__*/_jsx(\"strong\",{children:((reviewsData===null||reviewsData===void 0?void 0:reviewsData.avgRating)||0).toFixed(1)}),\"/5 \\u2B50\"]}),/*#__PURE__*/_jsxs(\"div\",{style:{maxHeight:380,overflow:'auto',paddingRight:4,border:'1px solid #e5e7eb',borderRadius:8},children:[(!reviewsData||!((_reviewsData$reviews=reviewsData.reviews)!==null&&_reviewsData$reviews!==void 0&&_reviewsData$reviews.length))&&/*#__PURE__*/_jsx(\"div\",{className:\"rb-muted\",style:{padding:12,fontSize:'.75rem'},children:\"Ch\\u01B0a c\\xF3 \\u0111\\xE1nh gi\\xE1.\"}),reviewsData===null||reviewsData===void 0?void 0:(_reviewsData$reviews2=reviewsData.reviews)===null||_reviewsData$reviews2===void 0?void 0:_reviewsData$reviews2.map(rv=>/*#__PURE__*/_jsxs(\"div\",{style:{padding:'10px 12px',borderBottom:'1px solid #eef2f6',fontSize:'.75rem',lineHeight:1.35},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',gap:12},children:[/*#__PURE__*/_jsx(\"strong\",{children:rv.customer}),/*#__PURE__*/_jsxs(\"span\",{style:{color:'#f59e0b',fontWeight:600},children:[rv.rating.toFixed(1),\"\\u2B50\"]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:4},children:rv.comment||/*#__PURE__*/_jsx(\"span\",{className:\"rb-muted\",children:\"(Kh\\xF4ng c\\xF3 n\\u1ED9i dung)\"})}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:4,fontSize:'.65rem',color:'#64748b'},children:new Date(rv.createdAt).toLocaleString('vi-VN')})]},rv.id))]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:18,textAlign:'right'},children:/*#__PURE__*/_jsx(\"button\",{className:\"rb-btn outline\",onClick:closeReviews,children:\"\\u0110\\xF3ng\"})})]})})]})]});}","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","Link","jsx","_jsx","jsxs","_jsxs","RoomsBrowse","_ref","_detailFull$price","_detailFull$images","_reviewsData$reviews","_reviewsData$reviews2","inline","onClose","canonicalStatus","s","v","String","trim","toLowerCase","includes","isDisabledStatus","st","normalizeImage","p","test","startsWith","replace","_unused","q","setQ","hotelId","setHotelId","typeId","setTypeId","hotels","setHotels","types","setTypes","rooms","setRooms","detail","setDetail","detailFull","setDetailFull","detailLoading","setDetailLoading","reviewsModal","setReviewsModal","reviewsLoading","setReviewsLoading","reviewsData","setReviewsData","reviewsError","setReviewsError","loading","setLoading","error","setError","bookingOpen","setBookingOpen","bookingRoom","setBookingRoom","bkCheckIn","setBkCheckIn","bkCheckOut","setBkCheckOut","bkAdults","setBkAdults","bkChildren","setBkChildren","bkPayMethod","setBkPayMethod","bkAgree","setBkAgree","bkLoading","setBkLoading","bkMsg","setBkMsg","bkAvailable","setBkAvailable","bkSubmitted","setBkSubmitted","bkFirstFieldRef","authEmail","u","JSON","parse","localStorage","getItem","email","_unused2","nights","inD","Date","outD","ms","Math","round","totalPrice","Number","price","finalPrice","dateError","submitEnabled","status","isPrivileged","role","_unused3","isAdmin","_unused4","loadHotels","res","fetch","ok","Error","list","json","Array","isArray","_unused5","loadTypes","hid","url","URL","window","location","origin","searchParams","set","_unused6","loadRooms","console","log","toString","headers","text","catch","substring","j","items","length","map","r","imgsRaw","images","imgs","im","filter","Boolean","first","id","roomNumber","floor","hotelName","roomType","description","image","today","toISOString","slice","tomorrow","d","setDate","getDate","ares","aj","Map","x","roomId","available","prev","_objectSpread","has","get","e","message","statusLabel","className","children","openDetail","concat","room","closeDetail","openBookingForRoom","uRole","_unused7","_unused8","rf","merged","Status","avRes","encodeURIComponent","av","openReviews","reviews","avgRating","closeReviews","handler","key","addEventListener","removeEventListener","current","focus","_unused9","topScrollRef","bodyScrollRef","syncScrolling","source","target","scrollLeft","topEl","botEl","onTop","onBot","resizeHandler","style","paddingTop","position","top","src","alt","to","title","padding","marginBottom","borderRadius","onClick","onMouseDown","stopPropagation","fontWeight","value","onChange","placeholder","h","name","t","gridTemplateColumns","ref","color","idx","roomLabel","animationDelay","min","width","height","display","alignItems","justifyContent","fontSize","toLocaleString","gap","type","disabled","alert","currentTarget","marginTop","flexWrap","opacity","flex","lineHeight","maxAdults","maxChildren","i","minWidth","whiteSpace","maxWidth","overflow","boxShadow","copy","main","cursor","onSubmit","preventDefault","avUrl","chkRes","chk","err","token","random","now","pad2","n","padStart","nowD","bookingCode","getFullYear","getMonth","roomNames","summary","code","hotel","checkIn","checkOut","checkInTime","checkOutTime","payMethod","userEmail","adults","number","amount","setItem","stringify","_unused0","join","href","required","from","_","checked","toFixed","maxHeight","paddingRight","border","rv","borderBottom","customer","rating","comment","createdAt","textAlign"],"sources":["D:/DA_TichHop/HMS_AI Hotel/client/src/RoomsBrowse.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './RoomsBrowse.css';\r\n\r\n/* Public rooms browsing page\r\n   Features:\r\n   - Filters: keyword (room number / type), hotel, room type\r\n   - Uses /api/admin/rooms for richer data if user is Admin/Staff (auth header) else falls back to room types + derived rooms not available => we attempt public-like fetch.\r\n   NOTE: Currently there is no public rooms endpoint returning individual rooms; we will call /api/admin/rooms without auth -> backend will 401.\r\n   Fallback strategy: fetch room types (/api/room-types) + display them as pseudo-room rows with aggregate info.\r\n*/\r\nexport default function RoomsBrowse({ inline=false, onClose }){\r\n  // Helper to normalize status strings into canonical tokens\r\n  const canonicalStatus = (s) => {\r\n    const v = String(s||'').trim().toLowerCase();\r\n    if(!v) return 'available';\r\n    if(v.includes('book')) return 'booked';\r\n    if(v.includes('occup')) return 'occupied';\r\n    if(v.includes('clean')) return 'cleaning';\r\n    if(v.includes('maint')) return 'maintenance';\r\n    if(v.includes('unavail') || v.includes('unavailable')) return 'unavailable';\r\n    if(v==='available' || v==='trống' || v==='trong') return 'available';\r\n    return v;\r\n  };\r\n\r\n  const isDisabledStatus = (s) => {\r\n    const st = canonicalStatus(s);\r\n    return ['booked','maintenance','unavailable','occupied','cleaning'].includes(st);\r\n  };\r\n  // Helper to normalize image paths returned from API (may be stored without leading slash or uploads prefix)\r\n  const normalizeImage = (p) => {\r\n    if(!p) return null;\r\n    try {\r\n      // Already absolute (http/https/data) or starts with /uploads or /static\r\n      if(/^https?:\\/\\//i.test(p) || /^data:/i.test(p)) return p;\r\n      if(p.startsWith('/')) return p; // assume valid root-relative\r\n      // If filename only, prepend uploads path\r\n      return '/uploads/' + p.replace(/^\\/+/, '');\r\n    } catch { return p; }\r\n  };\r\n  const [q, setQ] = useState('');\r\n  const [hotelId, setHotelId] = useState('');\r\n  const [typeId, setTypeId] = useState('');\r\n  const [hotels, setHotels] = useState([]);\r\n  const [types, setTypes] = useState([]);\r\n  const [rooms, setRooms] = useState([]); // unified view\r\n  const [detail, setDetail] = useState(null); // basic selected row (list data)\r\n  const [detailFull, setDetailFull] = useState(null); // full fetched room detail\r\n  const [detailLoading, setDetailLoading] = useState(false);\r\n  const [reviewsModal, setReviewsModal] = useState(null); // { roomId, loading, data }\r\n  const [reviewsLoading, setReviewsLoading] = useState(false);\r\n  const [reviewsData, setReviewsData] = useState(null); // { reviews, avgRating }\r\n  const [reviewsError, setReviewsError] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [bookingOpen, setBookingOpen] = useState(false);\r\n  const [bookingRoom, setBookingRoom] = useState(null);\r\n  const [bkCheckIn, setBkCheckIn] = useState('');\r\n  const [bkCheckOut, setBkCheckOut] = useState('');\r\n  const [bkAdults, setBkAdults] = useState(1);\r\n  const [bkChildren, setBkChildren] = useState(0);\r\n  const [bkPayMethod, setBkPayMethod] = useState('MOMO');\r\n  const [bkAgree, setBkAgree] = useState(false);\r\n  const [bkLoading, setBkLoading] = useState(false);\r\n  const [bkMsg, setBkMsg] = useState('');\r\n  const [bkAvailable, setBkAvailable] = useState(true);\r\n  // Prevent duplicate rapid submissions / re-init after success redirect\r\n  const [bkSubmitted, setBkSubmitted] = useState(false);\r\n  // Promotions removed\r\n  const bkFirstFieldRef = useRef(null);\r\n  const authEmail = (()=>{ try { const u = JSON.parse(localStorage.getItem('hmsUser')||'null'); return u?.email || ''; } catch { return ''; } })();\r\n  const nights = useMemo(()=>{ if(!bkCheckIn || !bkCheckOut) return 0; const inD=new Date(bkCheckIn); const outD=new Date(bkCheckOut); const ms= outD - inD; return ms>0? Math.round(ms/86400000):0; }, [bkCheckIn, bkCheckOut]);\r\n  const totalPrice = useMemo(()=> nights * Number(bookingRoom?.price||0), [nights, bookingRoom]);\r\n  const finalPrice = totalPrice; // no promotions\r\n  const dateError = useMemo(()=>{ if(!bkCheckIn || !bkCheckOut) return ''; const inD=new Date(bkCheckIn); const outD=new Date(bkCheckOut); if(!(outD>inD)) return 'Ngày trả phải sau ngày nhận'; return ''; }, [bkCheckIn, bkCheckOut]);\r\n  const submitEnabled = !!authEmail && !bkLoading && !bkSubmitted && bookingRoom && bkCheckIn && bkCheckOut && !dateError && bkAdults>=1 && nights>0 && bkAgree && !isDisabledStatus(bookingRoom?.status) && bkAvailable;\r\n\r\n  const isPrivileged = useMemo(()=>{ try { const u = JSON.parse(localStorage.getItem('hmsUser')||'null'); return ['admin','staff'].includes(String(u?.role||'').toLowerCase()); } catch { return false; } }, []);\r\n  const isAdmin = useMemo(()=>{ try { const u = JSON.parse(localStorage.getItem('hmsUser')||'null'); return String(u?.role||'').toLowerCase().includes('admin'); } catch { return false; } }, []);\r\n\r\n  const loadHotels = async () => {\r\n    try {\r\n      const res = await fetch('/api/hotels');\r\n      if(!res.ok) throw new Error();\r\n      const list = await res.json();\r\n      setHotels(Array.isArray(list)? list: []);\r\n    } catch { setHotels([]); }\r\n  };\r\n  const loadTypes = async (hid) => {\r\n    try {\r\n      const url = new URL('/api/room-types', window.location.origin);\r\n      if(hid) url.searchParams.set('hotelId', hid);\r\n      const res = await fetch(url);\r\n      if(!res.ok) throw new Error();\r\n      const list = await res.json();\r\n      setTypes(Array.isArray(list)? list: []);\r\n    } catch { setTypes([]); }\r\n  };\r\n\r\n  const loadRooms = async () => {\r\n    setLoading(true); setError('');\r\n    try {\r\n      const origin = window.location.origin;\r\n      const url = new URL('/api/rooms', origin);\r\n      if(q) url.searchParams.set('q', q);\r\n      if(hotelId) url.searchParams.set('hotelId', hotelId);\r\n      if(typeId) url.searchParams.set('typeId', typeId);\r\n      console.log('[RoomsBrowse] Fetch rooms:', url.toString());\r\n      const res = await fetch(url, { headers:{ 'Accept':'application/json' } });\r\n      if(!res.ok){\r\n        const text = await res.text().catch(()=> '');\r\n        throw new Error('Không tải được phòng' + (text? ' - ' + text.substring(0,120): '')); }\r\n      const j = await res.json();\r\n      if(!j || typeof j !== 'object') throw new Error('Phản hồi không hợp lệ');\r\n      const list = Array.isArray(j.items)? j.items: (Array.isArray(j.rooms)? j.rooms: []);\r\n      console.log('[RoomsBrowse] Received rooms count:', list.length);\r\n      setRooms(list.map(r => {\r\n        const imgsRaw = Array.isArray(r.images)? r.images : [];\r\n        const imgs = imgsRaw.map(im=> normalizeImage(im)).filter(Boolean);\r\n        const first = imgs.length? imgs[0] : null;\r\n        return {\r\n          id: r.id,\r\n          roomNumber: r.roomNumber || '-',\r\n            floor: r.floor || null,\r\n            hotelName: r.hotelName,\r\n            roomType: r.roomType,\r\n            price: r.price,\r\n            status: r.status || 'Available',\r\n            description: r.description || '',\r\n            image: first,\r\n            images: imgs\r\n        };\r\n      }));\r\n      // After loading rooms, fetch availability for the near-term (today->tomorrow) so UI disables booked rooms on initial render\r\n      try {\r\n        const today = new Date().toISOString().slice(0,10);\r\n        const tomorrow = (()=>{ const d=new Date(); d.setDate(d.getDate()+1); return d.toISOString().slice(0,10); })();\r\n        const url = new URL('/api/rooms/availability', window.location.origin);\r\n        url.searchParams.set('checkIn', today);\r\n        url.searchParams.set('checkOut', tomorrow);\r\n        if(hotelId) url.searchParams.set('hotelId', hotelId);\r\n        const ares = await fetch(url.toString());\r\n        if(ares.ok){ const aj = await ares.json(); const map = new Map((aj.items||[]).map(x=> [Number(x.roomId), !!x.available]));\r\n          setRooms(prev => prev.map(r => ({ ...r, available: map.has(Number(r.id)) ? map.get(Number(r.id)) : true })));\r\n        }\r\n      } catch(e){ /* ignore availability fetch errors */ }\r\n    } catch(e){ console.error('[RoomsBrowse] loadRooms error', e); setError(e.message||'Lỗi tải dữ liệu'); setRooms([]);} finally { setLoading(false); }\r\n  };\r\n\r\n  useEffect(()=>{ loadHotels(); loadTypes(); }, []);\r\n  useEffect(()=>{ loadTypes(hotelId); }, [hotelId]);\r\n  useEffect(()=>{ loadRooms(); }, [q, hotelId, typeId]);\r\n\r\n  const statusLabel = (s) => {\r\n    const v = String(s||'').toLowerCase();\r\n    if(v==='available') return <span className=\"rb-badge available\">Trống</span>;\r\n    if(v==='occupied') return <span className=\"rb-badge booked\">Đang ở</span>;\r\n    if(v==='cleaning') return <span className=\"rb-badge maintenance\">Dọn dẹp</span>;\r\n    if(v==='maintenance') return <span className=\"rb-badge maintenance\">Bảo trì</span>;\r\n    return <span className=\"rb-badge available\">Trống</span>;\r\n  };\r\n\r\n  const openDetail = async (r) => {\r\n    setDetail(r);\r\n    setDetailFull(null);\r\n    if(!r?.id) return;\r\n    setDetailLoading(true);\r\n    try {\r\n      const res = await fetch(`/api/rooms/${r.id}`);\r\n      if(!res.ok) throw new Error('Không tải được chi tiết');\r\n      const j = await res.json();\r\n      setDetailFull(j.room || null);\r\n    } catch(e){ console.error('detail fetch error', e); } finally { setDetailLoading(false); }\r\n  };\r\n  const closeDetail = () => { setDetail(null); setDetailFull(null); };\r\n\r\n  // Open booking modal for a room but refresh latest room detail first to avoid duplicate bookings\r\n  const openBookingForRoom = async (r) => {\r\n    try { const uRole = (()=>{ try { const u = JSON.parse(localStorage.getItem('hmsUser')||'null'); return u?.role || 'Customer'; } catch { return 'Customer'; } })(); if(String(uRole).toLowerCase().includes('admin')) { setBkMsg('Tài khoản Admin không được phép đặt phòng'); setBookingOpen(true); setBookingRoom(null); return; } } catch {}\r\n    if(!r?.id) return;\r\n    setBkMsg('');\r\n    try {\r\n      // Try to fetch the latest room detail from server\r\n      const res = await fetch(`/api/rooms/${r.id}`);\r\n      if(!res.ok) throw new Error('Không tải được trạng thái phòng');\r\n      const j = await res.json();\r\n      const rf = j.room || null;\r\n      const imgsRaw = Array.isArray(rf?.images || r.images)? (rf?.images || r.images) : [];\r\n      const imgs = imgsRaw.map(im=> normalizeImage(im)).filter(Boolean);\r\n      const merged = {\r\n        ...r,\r\n        ...rf,\r\n        images: imgs,\r\n        image: imgs[0] || r.image,\r\n        // ensure status field exists and use server-provided status if present\r\n        status: (rf && (rf.status || rf.Status)) || r.status || 'Available'\r\n      };\r\n      // If user selected dates already, call availability endpoint to verify\r\n      let available = true;\r\n      if(bkCheckIn && bkCheckOut){\r\n        try {\r\n          const avRes = await fetch(`/api/rooms/${r.id}/availability?checkIn=${encodeURIComponent(bkCheckIn)}&checkOut=${encodeURIComponent(bkCheckOut)}`);\r\n          if(avRes.ok){ const av = await avRes.json(); available = !!av.available; }\r\n        } catch(e){ /* ignore availability check failure */ }\r\n      }\r\n      setBkAvailable(available);\r\n      setBookingRoom(merged);\r\n      // If the room is already in disabled status, show a message but still open modal so user can see details\r\n      if(isDisabledStatus(merged.status) || available === false){\r\n        setBkMsg('Phòng hiện không khả dụng (đã được đặt hoặc đang bảo trì). Không thể đặt.');\r\n      }\r\n      setBookingOpen(true);\r\n      setBkCheckIn(''); setBkCheckOut(''); setBkAdults(1); setBkChildren(0); setBkSubmitted(false);\r\n    } catch(e){\r\n      console.error('openBookingForRoom error', e);\r\n      // fallback to original object if fetch failed\r\n      setBookingRoom(r);\r\n      setBookingOpen(true);\r\n      setBkMsg('Không thể kiểm tra trạng thái phòng, vui lòng thử lại.');\r\n    }\r\n  };\r\n\r\n  const openReviews = async (r) => {\r\n    if(!r?.id) return;\r\n    setReviewsModal(r);\r\n    setReviewsLoading(true); setReviewsError(''); setReviewsData(null);\r\n    try {\r\n      const res = await fetch(`/api/rooms/${r.id}/reviews`);\r\n      if(!res.ok) throw new Error('Không tải được đánh giá');\r\n      const j = await res.json();\r\n      setReviewsData({ reviews: j.reviews||[], avgRating: j.avgRating||0 });\r\n    } catch(e){ setReviewsError(e.message||'Lỗi tải đánh giá'); } finally { setReviewsLoading(false); }\r\n  };\r\n  const closeReviews = () => { setReviewsModal(null); setReviewsData(null); };\r\n\r\n  // ESC key to close detail modal\r\n  useEffect(()=>{\r\n    const handler = (e) => {\r\n      if(e.key === 'Escape') {\r\n        if(bookingOpen){ setBookingOpen(false); setBookingRoom(null); }\r\n        else if(detail) closeDetail();\r\n        else if(onClose && inline) onClose();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handler);\r\n    return ()=> window.removeEventListener('keydown', handler);\r\n  }, [detail, inline, onClose, bookingOpen]);\r\n\r\n  useEffect(()=>{ if(bookingOpen && bkFirstFieldRef.current){ try { bkFirstFieldRef.current.focus(); } catch {} } }, [bookingOpen]);\r\n\r\n  // Single horizontal scrollbar (top) refs\r\n  const topScrollRef = useRef(null);\r\n  const bodyScrollRef = useRef(null);\r\n  const syncScrolling = (source, target) => {\r\n    if(!source || !target) return;\r\n    if(target.scrollLeft !== source.scrollLeft) target.scrollLeft = source.scrollLeft;\r\n  };\r\n  useEffect(()=>{\r\n  const topEl = topScrollRef.current;\r\n  const botEl = bodyScrollRef.current;\r\n  if(!topEl || !botEl) return;\r\n  const onTop = () => syncScrolling(topEl, botEl);\r\n  const onBot = () => syncScrolling(botEl, topEl);\r\n  topEl.addEventListener('scroll', onTop);\r\n  botEl.addEventListener('scroll', onBot);\r\n    const resizeHandler = () => { // keep width track by forcing reflow\r\n      if(topEl && botEl) {\r\n        // match scrollLeft after resize\r\n        syncScrolling(botEl, topEl);\r\n      }\r\n    };\r\n    window.addEventListener('resize', resizeHandler);\r\n    return ()=>{ topEl.removeEventListener('scroll', onTop); botEl.removeEventListener('scroll', onBot); window.removeEventListener('resize', resizeHandler); };\r\n  }, [rooms.length]);\r\n\r\n  return (\r\n    <div className={inline? '' : 'home-root'} style={{ paddingTop: inline? 0 : 80 }}>\r\n      {!inline && (\r\n        <header className=\"home-header\" style={{ position:'sticky', top:0 }}>\r\n          <div className=\"home-header-left\">\r\n            <img src=\"/logo.png\" alt=\"logo\" className=\"home-header-logo\" />\r\n            <Link to=\"/\" className=\"home-header-title home-header-home-btn\">TRANG CHỦ</Link>\r\n          </div>\r\n          <div className=\"home-header-icons\">\r\n            <Link to=\"/login\" className=\"home-header-icon\" title=\"Đăng nhập\">\r\n              <img src=\"/icon-user.png\" alt=\"user\" className=\"home-header-icon-img\" />\r\n            </Link>\r\n          </div>\r\n        </header>\r\n      )}\r\n      <div style={{ padding: inline? '8px 14px 24px' : '24px 24px 40px' }}>\r\n        {inline && (\r\n          <button className=\"rb-btn gradient\" style={{ marginBottom:14, borderRadius:28 }} onClick={()=>onClose && onClose()}>&larr; Quay lại</button>\r\n        )}\r\n  <div className=\"rb-overlay-animate rb-panel\" onMouseDown={e=>e.stopPropagation()}>\r\n          <div className=\"rb-heading-wrap\">\r\n            <h2 className=\"rb-heading\">Danh sách phòng</h2>\r\n            <div className=\"rb-total-count\" aria-live=\"polite\">Tổng: {rooms.length} {loading && <span className=\"rb-muted\" style={{ fontWeight:400 }}>(Đang tải...)</span>}</div>\r\n          </div>\r\n          <div className=\"rb-filters\">\r\n            <div className=\"rb-field\">\r\n              <label>Từ khóa</label>\r\n              <input className=\"rb-input\" value={q} onChange={e=>setQ(e.target.value)} placeholder=\"Số phòng / loại / khách sạn\" />\r\n            </div>\r\n            <div className=\"rb-field\">\r\n              <label>Khách sạn</label>\r\n              <div className=\"rb-select-wrap\">\r\n                <select className=\"rb-select\" value={hotelId} onChange={e=>setHotelId(e.target.value)}>\r\n                  <option value=\"\">Tất cả</option>\r\n                  {hotels.map(h=> <option key={h.id} value={h.id}>{h.name}</option>)}\r\n                </select>\r\n              </div>\r\n            </div>\r\n            <div className=\"rb-field\">\r\n              <label>Hạng phòng</label>\r\n              <div className=\"rb-select-wrap\">\r\n                <select className=\"rb-select\" value={typeId} onChange={e=>setTypeId(e.target.value)}>\r\n                  <option value=\"\">Tất cả</option>\r\n                  {types.map(t=> <option key={t.id} value={t.id}>{t.name}</option>)}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"rb-table-shell\">\r\n            <div className=\"rb-table-head\" style={{ gridTemplateColumns:'150px 130px 1.1fr 1.1fr 120px 120px 2fr 200px' }}>\r\n              <div className=\"rb-cell\">Ảnh</div>\r\n              <div className=\"rb-cell\">Phòng</div>\r\n              <div className=\"rb-cell\">Khách sạn</div>\r\n              <div className=\"rb-cell\">Loại phòng</div>\r\n              <div className=\"rb-cell\">Giá/đêm</div>\r\n              <div className=\"rb-cell\">Trạng thái</div>\r\n              <div className=\"rb-cell\">Mô tả</div>\r\n              <div className=\"rb-cell\">Hành động</div>\r\n            </div>\r\n            <div ref={bodyScrollRef} className=\"rb-table-body\">\r\n              {loading ? <div className=\"rb-row\"><div className=\"rb-cell\">Đang tải...</div></div> : error ? <div className=\"rb-row\"><div className=\"rb-cell\" style={{ color:'#b42318' }}>{error}</div></div> : rooms.length===0 ? <div className=\"rb-row\"><div className=\"rb-cell\">Không có phòng phù hợp.</div></div> : rooms.map((r, idx) => {\r\n                const roomLabel = r.roomNumber === '-' ? '-' : `${r.roomNumber}${r.floor ? ' - T' + r.floor : ''}`;\r\n                return (\r\n                  <div key={r.id} className=\"rb-row\" style={{ gridTemplateColumns:'150px 130px 1.1fr 1.1fr 120px 120px 2fr 200px', animationDelay: `${Math.min(idx, 12)*30}ms` }}>\r\n                    <div className=\"rb-cell image-cell\">\r\n                      <div className=\"rb-img-wrap\">\r\n                        {r.image ? <img src={r.image} alt=\"img\" /> : <div style={{ width:'100%', height:'100%', display:'flex', alignItems:'center', justifyContent:'center', fontSize:10, color:'#777' }}>No image</div>}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"rb-cell\" title={roomLabel}>{roomLabel}</div>\r\n                    <div className=\"rb-cell\">{r.hotelName}</div>\r\n                    <div className=\"rb-cell\">{r.roomType}</div>\r\n                    <div className=\"rb-cell\" style={{ fontSize:13 }}>{Number(r.price||0).toLocaleString('vi-VN')} VND</div>\r\n                    <div className=\"rb-cell\">{statusLabel(r.status)}</div>\r\n                    <div className=\"rb-cell rb-desc\" title={r.description}>{r.description || '—'}</div>\r\n                    <div className=\"rb-cell rb-actions\" style={{ gap:8 }}>\r\n                      <button\r\n                        className=\"rb-btn primary\"\r\n                        type=\"button\"\r\n                        disabled={isDisabledStatus(r.status) || (r.available === false) || isAdmin}\r\n                        onClick={() => {\r\n                          if (isAdmin) { alert('Tài khoản Admin không được phép đặt phòng'); return; }\r\n                          if (isDisabledStatus(r.status) || (r.available === false)) return;\r\n                          openBookingForRoom(r);\r\n                        }}\r\n                      >\r\n                        {(isDisabledStatus(r.status) || (r.available === false)) ? 'ĐÃ ĐƯỢC ĐẶT' : 'Đặt phòng'}\r\n                      </button>\r\n                      <button className=\"rb-btn outline\" type=\"button\" onClick={() => openReviews(r)}>Đánh giá</button>\r\n                      <button className=\"rb-btn outline\" type=\"button\" onClick={() => openDetail(r)}>Chi tiết</button>\r\n                    </div>\r\n                  </div>\r\n                  );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        {detail && (\r\n          <div className=\"rb-modal-backdrop\" onMouseDown={(e)=>{ if(e.target===e.currentTarget) closeDetail(); }}>\r\n            <div className=\"rb-modal\" onMouseDown={e=>e.stopPropagation()}>\r\n              <button className=\"rb-modal-close\" onClick={closeDetail} aria-label=\"Đóng\">×</button>\r\n              <h3 style={{ marginTop:0, marginBottom:14, fontSize:'1.15rem' }}>\r\n                {detailFull?.roomNumber ? `${detailFull.roomNumber}${detailFull.floor? ' - T'+detailFull.floor:''}` : (detail.roomType)}\r\n              </h3>\r\n              {detailLoading && <div className=\"rb-muted\" style={{ fontSize:'.75rem' }}>Đang tải chi tiết...</div>}\r\n              <div style={{ display:'flex', gap:24, flexWrap:'wrap', opacity: detailLoading? .6: 1 }}>\r\n                <div style={{ flex:'0 0 260px' }}>\r\n                  <div className=\"rb-img-wrap\" style={{ width:'100%', height:180 }}>\r\n                    { (detailFull?.images && detailFull.images[0]) ? <img src={normalizeImage(detailFull.images[0])} alt=\"\" /> : (detail.image ? <img src={detail.image} alt=\"\" /> : <div style={{ width:'100%', height:'100%', display:'flex', alignItems:'center', justifyContent:'center', fontSize:12, color:'#666' }}>No image</div>) }\r\n                  </div>\r\n                  <div style={{ marginTop:10, fontSize:'.75rem', lineHeight:1.3 }}>\r\n                    <div><strong>Loại:</strong> {detailFull?.roomType || detail.roomType}</div>\r\n                    <div><strong>Giá:</strong> {Number((detailFull?.price ?? detail.price)||0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                    {detailFull?.maxAdults != null && <div><strong>Người lớn tối đa:</strong> {detailFull.maxAdults}</div>}\r\n                    {detailFull?.maxChildren != null && <div><strong>Trẻ em tối đa:</strong> {detailFull.maxChildren}</div>}\r\n                    <div><strong>Trạng thái:</strong> {statusLabel(detailFull?.status || detail.status)}</div>\r\n                  </div>\r\n                  {detailFull?.images?.length > 1 && (\r\n                    <div style={{ display:'flex', gap:6, flexWrap:'wrap', marginTop:10 }}>\r\n                      {detailFull.images.slice(1,6).map((im,i)=>(\r\n                        <div key={i} className=\"rb-img-wrap\" style={{ width:54, height:40 }}>\r\n                          <img src={normalizeImage(im)} alt=\"thumb\" />\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div style={{ flex:'1 1 300px', minWidth:240 }}>\r\n                  <p style={{ whiteSpace:'pre-wrap', lineHeight:1.45, fontSize:'.78rem' }}>{detailFull?.description || detail.description || 'Không có mô tả.'}</p>\r\n                </div>\r\n              </div>\r\n              <div style={{ marginTop:22, display:'flex', gap:10, justifyContent:'flex-end' }}>\r\n                <button className=\"rb-btn primary\" disabled={isDisabledStatus(((detailFull?.status)||(detail.status)||'')) || (detailFull?.available === false) || (detail?.available === false)} onClick={()=>{ if(isDisabledStatus(((detailFull?.status)||(detail.status)||'')) || (detailFull?.available === false) || (detail?.available === false)) return; openBookingForRoom(detailFull || detail); }}>\r\n                  {(isDisabledStatus(((detailFull?.status)||(detail.status)||'')) || (detailFull?.available === false) || (detail?.available === false)) ? 'ĐÃ ĐƯỢC ĐẶT' : 'Đặt phòng'}\r\n                </button>\r\n                <button className=\"rb-btn outline\" onClick={closeDetail}>Đóng</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {bookingOpen && bookingRoom && (\r\n          <div className=\"rb-modal-backdrop\" onMouseDown={(e)=>{ if(e.target===e.currentTarget) { setBookingOpen(false); setBookingRoom(null); } }}>\r\n            <div className=\"rb-modal rb-booking-fast-animate\" role=\"dialog\" aria-modal=\"true\" aria-label=\"Đặt phòng nhanh\" onMouseDown={e=>e.stopPropagation()} style={{ maxWidth:600 }}>\r\n              <button className=\"rb-modal-close\" onClick={()=>{ setBookingOpen(false); setBookingRoom(null); }} aria-label=\"Đóng\">×</button>\r\n              <div className=\"rb-booking-fast\">\r\n                <h3>Đặt phòng nhanh</h3>\r\n                <div className=\"rb-booking-room-image\" style={{ marginBottom:14 }}>\r\n                  <div className=\"rb-img-wrap\" style={{ width:'100%', height:160, borderRadius:14, overflow:'hidden', boxShadow:'0 2px 6px rgba(0,0,0,0.15)' }}>\r\n                    { (bookingRoom.images && bookingRoom.images[0]) ? <img src={bookingRoom.images[0]} alt=\"Phòng\" /> : (bookingRoom.image ? <img src={bookingRoom.image} alt=\"Phòng\" /> : <div style={{ width:'100%', height:'100%', display:'flex', alignItems:'center', justifyContent:'center', fontSize:12, color:'#666' }}>Không có ảnh</div>) }\r\n                  </div>\r\n                  {bookingRoom.images && bookingRoom.images.length > 1 && (\r\n                    <div style={{ display:'flex', gap:6, marginTop:8, flexWrap:'wrap' }}>\r\n                      {bookingRoom.images.slice(1,6).map((im,i)=>(\r\n                        <button key={i} type=\"button\" onClick={()=>{ const copy=[...bookingRoom.images]; const main=copy[0]; copy[0]=copy[i+1]; copy[i+1]=main; setBookingRoom({ ...bookingRoom, images: copy, image: copy[0] }); }} className=\"rb-img-wrap\" style={{ width:54, height:40, cursor:'pointer', opacity:.9 }} title=\"Xem ảnh\">\r\n                          <img src={im} alt=\"thumb\" />\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                <div className=\"rb-booking-meta\">\r\n                  <strong>Phòng:</strong> {bookingRoom.roomNumber === '-' ? bookingRoom.roomType : bookingRoom.roomNumber}{bookingRoom.floor? ` • Tầng ${bookingRoom.floor}`:''}<br />\r\n                  <strong>Loại:</strong> {bookingRoom.roomType}<br />\r\n                  <strong>Giá:</strong> {Number(bookingRoom.price||0).toLocaleString('vi-VN')} VND/đêm\r\n                </div>\r\n                <form onSubmit={async (e)=>{ \r\n                  e.preventDefault(); \r\n                  setBkMsg(''); \r\n                  if(!authEmail){ setBkMsg('Vui lòng đăng nhập để đặt phòng.'); return; }\r\n                  // final server-side availability check to avoid race conditions\r\n                  if(!submitEnabled){ return; }\r\n                  try {\r\n                    if(bookingRoom && bookingRoom.id){\r\n                      const avUrl = `/api/rooms/${bookingRoom.id}/availability?checkIn=${encodeURIComponent(bkCheckIn)}&checkOut=${encodeURIComponent(bkCheckOut)}`;\r\n                      const chkRes = await fetch(avUrl);\r\n                      if(chkRes.ok){ const chk = await chkRes.json(); if(chk && chk.available === false){ setBkMsg('Phòng không còn khả dụng cho khoảng ngày chọn. Vui lòng chọn phòng khác.'); return; } }\r\n                    }\r\n                  } catch(err){ /* ignore check failure, proceed with caution */ }\r\n                  try { \r\n                    setBkLoading(true);\r\n                    setBkSubmitted(true);\r\n                    // Tạo token và summary tương tự RoomTypeInline flow để chuyển sang trang thanh toán\r\n                    const token = Math.random().toString(36).slice(2) + Date.now().toString(36);\r\n                    const pad2 = (n)=> String(n).padStart(2,'0');\r\n                    const nowD = new Date();\r\n                    const bookingCode = `HMS${nowD.getFullYear()}${pad2(nowD.getMonth()+1)}${pad2(nowD.getDate())}`;\r\n                    const roomNames = `Phòng ${bookingRoom.roomNumber}${bookingRoom.floor?` • Tầng ${bookingRoom.floor}`:''}`;\r\n                    const summary = {\r\n                      token,\r\n                      code: bookingCode,\r\n                      hotelId: bookingRoom.hotelId || null,\r\n                      hotel: bookingRoom.hotelName || '',\r\n                      roomType: bookingRoom.roomType || '',\r\n                      roomNames,\r\n                      checkIn: bkCheckIn,\r\n                      checkOut: bkCheckOut,\r\n                      checkInTime: '14:00',\r\n                      checkOutTime: '12:00',\r\n                      payMethod: bkPayMethod || 'MOMO',\r\n                      userEmail: authEmail,\r\n                      adults: bkAdults,\r\n                      children: bkChildren,\r\n                      rooms: [{ id: bookingRoom.id, number: bookingRoom.roomNumber, floor: bookingRoom.floor, price: bookingRoom.price, name: bookingRoom.roomNumber, adults: bkAdults, children: bkChildren }],\r\n                      amount: (Number(bookingRoom.price||0) * nights) || 0,\r\n                    };\r\n                    // promotions removed\r\n                    try { localStorage.setItem('hmsBooking:'+token, JSON.stringify(summary)); } catch {}\r\n                    const q = [\r\n                      `token=${encodeURIComponent(token)}`,\r\n                      `code=${encodeURIComponent(summary.code)}`,\r\n                      // pass gross amount; discount is read from summary on PaymentConfirm\r\n                      `amount=${encodeURIComponent(summary.amount)}`,\r\n                      `hid=${encodeURIComponent(summary.hotelId||'')}`,\r\n                      `rn=${encodeURIComponent(roomNames)}`,\r\n                      `rt=${encodeURIComponent(summary.roomType||'')}`,\r\n                      `ci=${encodeURIComponent(summary.checkIn||'')}`,\r\n                      `co=${encodeURIComponent(summary.checkOut||'')}`,\r\n                      `ad=${encodeURIComponent(summary.adults)}`,\r\n                      `ch=${encodeURIComponent(summary.children)}`\r\n                    ].join('&');\r\n                    window.location.href = '/payment/confirm?'+q;\r\n                  } catch(err){\r\n                    setBkMsg(err.message||'Lỗi khởi tạo thanh toán');\r\n                    setBkSubmitted(false);\r\n                  } finally { setBkLoading(false); }\r\n                }}>\r\n                  <div className=\"rb-booking-grid\">\r\n                    <div className=\"rb-booking-row\">\r\n                      <div className=\"rb-booking-field\">\r\n                        <label>Ngày nhận</label>\r\n                        <input\r\n                          ref={bkFirstFieldRef}\r\n                          type=\"date\"\r\n                          min={new Date().toISOString().slice(0,10)}\r\n                          value={bkCheckIn}\r\n                          onChange={e=>{\r\n                            const v = e.target.value;\r\n                            setBkCheckIn(v);\r\n                            // If check-out is before/equals new check-in, reset check-out\r\n                            if(bkCheckOut && bkCheckOut <= v){\r\n                              setBkCheckOut('');\r\n                            }\r\n                          }}\r\n                          required\r\n                        />\r\n                      </div>\r\n                      <div className=\"rb-booking-field\">\r\n                        <label>Ngày trả</label>\r\n                        <input\r\n                          type=\"date\"\r\n                          min={bkCheckIn ? (()=>{ const d=new Date(bkCheckIn); d.setDate(d.getDate()+1); return d.toISOString().slice(0,10); })() : new Date().toISOString().slice(0,10)}\r\n                          value={bkCheckOut}\r\n                          onChange={e=>setBkCheckOut(e.target.value)}\r\n                          disabled={!bkCheckIn}\r\n                          required\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"rb-booking-row\">\r\n                      <div className=\"rb-booking-field\">\r\n                        <label>Người lớn</label>\r\n                        <select\r\n                          value={bkAdults}\r\n                          onChange={e=>setBkAdults(Number(e.target.value))}\r\n                        >\r\n                          {Array.from({ length: (bookingRoom.maxAdults || 2) }, (_,i)=> i+1).map(v=> (\r\n                            <option key={v} value={v}>{v}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                      <div className=\"rb-booking-field\">\r\n                        <label>Trẻ em</label>\r\n                        <select\r\n                          value={bkChildren}\r\n                          onChange={e=>setBkChildren(Number(e.target.value))}\r\n                        >\r\n                          {Array.from({ length: (bookingRoom.maxChildren || 0) + 1 }, (_,i)=> i).map(v=> (\r\n                            <option key={v} value={v}>{v}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                    {dateError && <div className=\"rb-msg error\" role=\"alert\">{dateError}</div>}\r\n                    {(!dateError && bkCheckIn && bkCheckOut && bkAvailable===false) && <div className=\"rb-msg error\" role=\"alert\">Phòng không khả dụng cho khoảng ngày đã chọn.</div>}\r\n                    {nights > 0 && (\r\n                      <div className=\"rb-booking-summary\" aria-live=\"polite\">\r\n                        <span><strong>{nights}</strong> đêm x {Number(bookingRoom.price||0).toLocaleString('vi-VN')} VND</span>\r\n                        <span style={{ fontWeight:800 }}>{Number(totalPrice).toLocaleString('vi-VN')} VND</span>\r\n                      </div>\r\n                    )}\r\n                    {/* Promotion UI removed */}\r\n                    {(!authEmail) && <div className=\"rb-msg error\">Vui lòng đăng nhập để đặt phòng.</div>}\r\n                    {bkMsg && <div className={`rb-msg ${bkMsg.includes('thành công')? 'success':'error'}`}>{bkMsg}</div>}\r\n                    <div className=\"rb-booking-row\" style={{ marginTop:4 }}>\r\n                      <div className=\"rb-booking-field\" style={{ flex: '1 1 100%' }}>\r\n                        <label>Phương thức thanh toán</label>\r\n                        <select value={bkPayMethod} onChange={e=>setBkPayMethod(e.target.value)}>\r\n                          <option value=\"MOMO\">Ví điện tử MOMO</option>\r\n                          <option value=\"ZALOPAY\">ZaloPay</option>\r\n                          <option value=\"VNPAY\">VNPay</option>\r\n                          <option value=\"CARD\">Thẻ tín dụng/ghi nợ</option>\r\n                        </select>\r\n                      </div>\r\n                    </div>\r\n                    <label className=\"rb-terms\">\r\n                      <input type=\"checkbox\" style={{ marginTop:2 }} checked={bkAgree} onChange={e=>setBkAgree(e.target.checked)} />\r\n                      <span>Vui lòng đọc kĩ và đồng ý với điều khoản bằng cách đánh dấu vào ô bên cạnh</span>\r\n                    </label>\r\n                    <div className=\"rb-booking-actions\">\r\n                      <button type=\"button\" className=\"rb-btn outline\" onClick={()=>{ setBookingOpen(false); setBookingRoom(null); }}>Hủy</button>\r\n                      <button type=\"submit\" className=\"rb-btn primary\" disabled={!submitEnabled || isDisabledStatus(bookingRoom?.status) || (bookingRoom?.available === false)}>\r\n                        {(isDisabledStatus(bookingRoom?.status) || (bookingRoom?.available === false)) ? 'ĐÃ ĐƯỢC ĐẶT' : (bkLoading? 'Đang xử lý...' : 'Thanh toán') }\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </form>\r\n                <div className=\"rb-booking-note\">Cần nhiều phòng hoặc tùy chọn nâng cao? Vào giao diện hạng phòng để chọn nhiều phòng và phương thức thanh toán.</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {reviewsModal && (\r\n          <div className=\"rb-modal-backdrop\" onMouseDown={(e)=>{ if(e.target===e.currentTarget) closeReviews(); }}>\r\n            <div className=\"rb-modal\" onMouseDown={e=>e.stopPropagation()} style={{ maxWidth:860 }}>\r\n              <button className=\"rb-modal-close\" onClick={closeReviews} aria-label=\"Đóng\">×</button>\r\n              <h3 style={{ marginTop:0, marginBottom:10, fontSize:'1.05rem' }}>Đánh giá phòng {reviewsModal.roomNumber || reviewsModal.roomType}</h3>\r\n              {reviewsLoading && <div className=\"rb-muted\" style={{ fontSize:'.75rem' }}>Đang tải đánh giá...</div>}\r\n              {reviewsError && <div style={{ color:'#b42318', fontSize:'.75rem' }}>{reviewsError}</div>}\r\n              {(!reviewsLoading && !reviewsError) && (\r\n                <div style={{ marginTop:6 }}>\r\n                  <div style={{ fontSize:'.8rem', marginBottom:10 }}>\r\n                    Trung bình: <strong>{(reviewsData?.avgRating||0).toFixed(1)}</strong>/5 ⭐\r\n                  </div>\r\n                  <div style={{ maxHeight:380, overflow:'auto', paddingRight:4, border:'1px solid #e5e7eb', borderRadius:8 }}>\r\n                    {(!reviewsData || !reviewsData.reviews?.length) && <div className=\"rb-muted\" style={{ padding:12, fontSize:'.75rem' }}>Chưa có đánh giá.</div>}\r\n                    {reviewsData?.reviews?.map(rv => (\r\n                      <div key={rv.id} style={{ padding:'10px 12px', borderBottom:'1px solid #eef2f6', fontSize:'.75rem', lineHeight:1.35 }}>\r\n                        <div style={{ display:'flex', justifyContent:'space-between', gap:12 }}>\r\n                          <strong>{rv.customer}</strong>\r\n                          <span style={{ color:'#f59e0b', fontWeight:600 }}>{rv.rating.toFixed(1)}⭐</span>\r\n                        </div>\r\n                        <div style={{ marginTop:4 }}>{rv.comment || <span className=\"rb-muted\">(Không có nội dung)</span>}</div>\r\n                        <div style={{ marginTop:4, fontSize:'.65rem', color:'#64748b' }}>{new Date(rv.createdAt).toLocaleString('vi-VN')}</div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              )}\r\n              <div style={{ marginTop:18, textAlign:'right' }}>\r\n                <button className=\"rb-btn outline\" onClick={closeReviews}>Đóng</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}