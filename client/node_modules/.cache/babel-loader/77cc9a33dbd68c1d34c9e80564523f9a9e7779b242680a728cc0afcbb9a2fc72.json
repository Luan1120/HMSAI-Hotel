{"ast":null,"code":"var _jsxFileName = \"D:\\\\Git\\\\HMSAI-Hotel\\\\client\\\\src\\\\PaymentSuccess.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { Link, useSearchParams, useNavigate } from 'react-router-dom';\nimport './HomePage.css';\nimport { jsPDF } from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { isLoggedIn } from './auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PaymentSuccess() {\n  _s();\n  const [params] = useSearchParams();\n  const navigate = useNavigate();\n  const token = params.get('token') || '';\n  const amount = Number(params.get('amount') || 0);\n  const code = params.get('code') || '';\n  const rt = params.get('rt') || '';\n  const rn = params.get('rn') || '';\n  const ci = params.get('ci') || '';\n  const co = params.get('co') || '';\n  const ad = Number(params.get('ad') || 0);\n  const ch = Number(params.get('ch') || 0);\n  const [hotelName, setHotelName] = useState('');\n  const summary = useMemo(() => {\n    try {\n      const raw = token ? localStorage.getItem('hmsBooking:' + token) : null;\n      if (raw) return JSON.parse(raw);\n    } catch {}\n    return {\n      token,\n      code,\n      amount,\n      roomType: rt,\n      roomNames: rn,\n      checkIn: ci,\n      checkOut: co,\n      adults: ad,\n      children: ch,\n      hotelId: Number(params.get('hid') || 0) || null,\n      hotel: '',\n      checkInTime: '14:00',\n      checkOutTime: '12:00'\n    };\n  }, [token, code, amount, rt, rn, ci, co, ad, ch, params]);\n  useEffect(() => {\n    let cancelled = false;\n    const setName = name => {\n      if (!cancelled) setHotelName(name);\n    };\n    const fetchHotel = hid => {\n      if (!hid) return;\n      fetch(`/api/hotels/${hid}`).then(r => r.ok ? r.json() : null).then(j => {\n        if (j && j.name) setName(j.name);\n      }).catch(() => {});\n    };\n    if (!hotelName) {\n      const hidParam = Number(params.get('hid') || 0) || null;\n      if (summary.hotelId) {\n        fetchHotel(summary.hotelId);\n      } else if (hidParam) {\n        fetchHotel(hidParam);\n      } else if (summary.roomType) {\n        fetch(`/api/room-types/${encodeURIComponent(summary.roomType)}/rooms`).then(r => r.ok ? r.json() : null).then(j => {\n          if (j && j.roomType) {\n            if (j.roomType.hotelName && !hotelName) setName(j.roomType.hotelName);\n            if (j.roomType.hotelId) fetchHotel(j.roomType.hotelId);\n          }\n        }).catch(() => {});\n      }\n    }\n    return () => {\n      cancelled = true;\n    };\n  }, [summary.hotelId, summary.roomType, hotelName, params]);\n  const detailsHref = useMemo(() => {\n    const q = new URLSearchParams({\n      amount: String(summary.amount || amount || 0),\n      code: String(summary.code || code || ''),\n      rn: String(summary.roomNames || rn || ''),\n      rt: String(summary.roomType || rt || ''),\n      ci: String(summary.checkIn || ci || ''),\n      co: String(summary.checkOut || co || ''),\n      ad: String(summary.adults || ad || 0),\n      ch: String(summary.children || ch || 0),\n      hid: String(summary.hotelId || params.get('hid') || '')\n    });\n    return `/booking/${token || summary.token || ''}?${q.toString()}`;\n  }, [summary, token, amount, code, rn, ci, co, ad, ch, params]);\n  const toBase64 = buf => {\n    let binary = '';\n    const bytes = new Uint8Array(buf);\n    const len = bytes.byteLength;\n    for (let i = 0; i < len; i++) binary += String.fromCharCode(bytes[i]);\n    return btoa(binary);\n  };\n  const ensurePdfFonts = async () => {\n    const REG_KEY = 'hmsPdfFont:DejaVu-Regular';\n    const BOLD_KEY = 'hmsPdfFont:DejaVu-Bold';\n    let regular = '';\n    let bold = '';\n    try {\n      regular = localStorage.getItem(REG_KEY) || '';\n    } catch {}\n    try {\n      bold = localStorage.getItem(BOLD_KEY) || '';\n    } catch {}\n    const fetchFont = async url => {\n      const res = await fetch(url, {\n        mode: 'cors'\n      });\n      if (!res.ok) throw new Error('Font fetch failed');\n      const buf = await res.arrayBuffer();\n      return toBase64(buf);\n    };\n    if (!regular) {\n      regular = await fetchFont('https://raw.githubusercontent.com/dejavu-fonts/dejavu-fonts/master/ttf/DejaVuSans.ttf');\n      try {\n        localStorage.setItem(REG_KEY, regular);\n      } catch {}\n    }\n    if (!bold) {\n      bold = await fetchFont('https://raw.githubusercontent.com/dejavu-fonts/dejavu-fonts/master/ttf/DejaVuSans-Bold.ttf');\n      try {\n        localStorage.setItem(BOLD_KEY, bold);\n      } catch {}\n    }\n    return {\n      regular,\n      bold\n    };\n  };\n  const printReceipt = async () => {\n    const hotel = hotelName || summary.hotel || '';\n    const file = `${summary.code || token || 'receipt'}.pdf`;\n    const container = document.createElement('div');\n    container.style.position = 'fixed';\n    container.style.left = '-99999px';\n    container.style.top = '0';\n    container.style.width = '560px';\n    container.style.background = '#fff';\n    container.style.padding = '24px 16px';\n    container.style.fontFamily = \"'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'DejaVu Sans', 'Liberation Sans', sans-serif\";\n    container.innerHTML = `\n      <div>\n        <div style=\"font-weight:800;font-size:22px;margin:0 0 10px 0;\">Phiếu xác nhận đặt phòng</div>\n        <div style=\"height:1px;background:#e6e6e6;margin:8px 0 14px 0;\"></div>\n        <div style=\"display:grid;grid-template-columns:180px 1fr;gap:10px 16px;font-size:13px;\">\n          <div style=\"color:#666;font-weight:700;\">Mã đặt phòng</div>\n          <div style=\"font-weight:800;\">${String(summary.code || token)}</div>\n          <div style=\"color:#666;font-weight:700;\">Khách sạn</div>\n          <div style=\"font-weight:800;\">${hotel || '—'}</div>\n          <div style=\"color:#666;font-weight:700;\">Ngày nhận</div>\n          <div style=\"font-weight:800;\">${summary.checkIn} - ${summary.checkInTime}</div>\n          <div style=\"color:#666;font-weight:700;\">Ngày trả</div>\n          <div style=\"font-weight:800;\">${summary.checkOut} - ${summary.checkOutTime}</div>\n          <div style=\"color:#666;font-weight:700;\">Phòng</div>\n          <div style=\"font-weight:800;\">${String(summary.roomNames || summary.roomType || '—')}</div>\n          <div style=\"color:#666;font-weight:700;\">Khách</div>\n          <div style=\"font-weight:800;\">${summary.adults || 0} người lớn${summary.children ? ` • ${summary.children} trẻ em` : ''}</div>\n          <div style=\"color:#666;font-weight:700;\">Tổng cộng</div>\n          <div style=\"font-weight:800;\">${Number(summary.amount || 0).toLocaleString('vi-VN')} VND</div>\n        </div>\n        <div style=\"margin-top:10px;font-weight:800;\">(ĐÃ THANH TOÁN)</div>\n      </div>`;\n    document.body.appendChild(container);\n    try {\n      const canvas = await html2canvas(container, {\n        scale: 2,\n        useCORS: true,\n        backgroundColor: '#ffffff'\n      });\n      const imgData = canvas.toDataURL('image/png');\n      const pdf = new jsPDF({\n        unit: 'pt',\n        format: 'a4'\n      });\n      const pageWidth = pdf.internal.pageSize.getWidth();\n      const pageHeight = pdf.internal.pageSize.getHeight();\n      const imgWidth = Math.min(540, pageWidth - 56 * 2);\n      const imgHeight = canvas.height * imgWidth / canvas.width;\n      const x = (pageWidth - imgWidth) / 2;\n      let y = 56;\n      if (imgHeight > pageHeight - 112) {\n        // Multi-page if content longer than one page\n        let remaining = imgHeight;\n        let offset = 0;\n        while (remaining > 0) {\n          pdf.addImage(imgData, 'PNG', x, y - offset, imgWidth, imgHeight);\n          remaining -= pageHeight - 112;\n          offset += pageHeight - 112;\n          if (remaining > 0) {\n            pdf.addPage();\n          }\n        }\n      } else {\n        pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);\n      }\n      pdf.save(file);\n    } finally {\n      document.body.removeChild(container);\n    }\n  };\n\n  // Save to DB on mount (once)\n  useEffect(() => {\n    if (!isLoggedIn()) {\n      try {\n        sessionStorage.setItem('hmsRedirectAfterLogin', window.location.pathname + window.location.search);\n      } catch {}\n      navigate('/login');\n      return; // skip saving\n    }\n    const save = async () => {\n      try {\n        const raw = token ? localStorage.getItem('hmsBooking:' + token) : null;\n        if (!raw) return;\n        const s = JSON.parse(raw);\n        let email = s.userEmail || '';\n        if (!email) {\n          try {\n            const rawUser = localStorage.getItem('hmsUser');\n            if (rawUser) email = JSON.parse(rawUser).email || '';\n          } catch {}\n        }\n        if (!email) return;\n        const body = {\n          token: token || s.token,\n          email,\n          checkIn: s.checkIn,\n          checkOut: s.checkOut,\n          method: s.payMethod || 'MOMO',\n          rooms: (s.rooms || []).map(r => ({\n            id: r.id,\n            adults: r.adults || 1,\n            children: r.children || 0,\n            price: r.price\n          }))\n        };\n        await fetch('/api/payments/complete', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(body)\n        });\n      } catch {}\n    };\n    save();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home-root success-root\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"success-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-top\",\n        children: [/*#__PURE__*/_jsxDEV(Link, {\n          to: \"/\",\n          className: \"success-home\",\n          children: \"\\u2190 Quay l\\u1EA1i Trang Ch\\u1EE7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-icon\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/success.png\",\n          alt: \"success\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"success-title\",\n        children: \"Thanh To\\xE1n Th\\xE0nh C\\xF4ng!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-sub\",\n        children: \"C\\u1EA3m \\u01A1n b\\u1EA1n \\u0111\\xE3 \\u0111\\u1EB7t ph\\xF2ng t\\u1EA1i HMS Hotel.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-code-line\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"label\",\n          children: \"M\\xE3 \\u0110\\u1EB7t Ph\\xF2ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 38\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"value\",\n          children: summary.code || token\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 218,\n          columnNumber: 81\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 3\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-sep\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-grid\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"Kh\\xE1ch S\\u1EA1n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"value\",\n          children: hotelName || summary.hotel || '—'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 49\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"Ng\\xE0y Nh\\u1EADn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"value\",\n          children: [summary.checkIn, \" - \", summary.checkInTime]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 222,\n          columnNumber: 49\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"Ng\\xE0y Tr\\u1EA3\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"value\",\n          children: [summary.checkOut, \" - \", summary.checkOutTime]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 48\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"H\\u1EA1ng Ph\\xF2ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"value\",\n          children: summary.roomType || '—'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 50\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"Ph\\xF2ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"value wrap\",\n          children: summary.roomNames || summary.roomType\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 45\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"Kh\\xE1ch\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"value\",\n          children: [summary.adults || 0, \" ng\\u01B0\\u1EDDi l\\u1EDBn\", summary.children ? ` • ${summary.children} trẻ em` : '']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 226,\n          columnNumber: 45\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"label\",\n          children: \"T\\u1ED5ng C\\u1ED9ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"value bold nowrap\",\n          children: [Number(summary.amount || 0).toLocaleString('vi-VN'), \" VND\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 49\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-paid\",\n        children: \"(\\u0110\\xC3 THANH TO\\xC1N)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"success-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"checkout-btn success-btn\",\n          onClick: printReceipt,\n          children: \"T\\u1EA3i phi\\u1EBFu x\\xE1c nh\\u1EADn (PDF)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 207,\n    columnNumber: 5\n  }, this);\n}\n_s(PaymentSuccess, \"EHM60iV9aPdgjSPkyVT7N4EhpT8=\", false, function () {\n  return [useSearchParams, useNavigate];\n});\n_c = PaymentSuccess;\nvar _c;\n$RefreshReg$(_c, \"PaymentSuccess\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","Link","useSearchParams","useNavigate","jsPDF","html2canvas","isLoggedIn","jsxDEV","_jsxDEV","PaymentSuccess","_s","params","navigate","token","get","amount","Number","code","rt","rn","ci","co","ad","ch","hotelName","setHotelName","summary","raw","localStorage","getItem","JSON","parse","roomType","roomNames","checkIn","checkOut","adults","children","hotelId","hotel","checkInTime","checkOutTime","cancelled","setName","name","fetchHotel","hid","fetch","then","r","ok","json","j","catch","hidParam","encodeURIComponent","detailsHref","q","URLSearchParams","String","toString","toBase64","buf","binary","bytes","Uint8Array","len","byteLength","i","fromCharCode","btoa","ensurePdfFonts","REG_KEY","BOLD_KEY","regular","bold","fetchFont","url","res","mode","Error","arrayBuffer","setItem","printReceipt","file","container","document","createElement","style","position","left","top","width","background","padding","fontFamily","innerHTML","toLocaleString","body","appendChild","canvas","scale","useCORS","backgroundColor","imgData","toDataURL","pdf","unit","format","pageWidth","internal","pageSize","getWidth","pageHeight","getHeight","imgWidth","Math","min","imgHeight","height","x","y","remaining","offset","addImage","addPage","save","removeChild","sessionStorage","window","location","pathname","search","s","email","userEmail","rawUser","method","payMethod","rooms","map","id","price","headers","stringify","className","to","fileName","_jsxFileName","lineNumber","columnNumber","src","alt","onClick","_c","$RefreshReg$"],"sources":["D:/Git/HMSAI-Hotel/client/src/PaymentSuccess.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { Link, useSearchParams, useNavigate } from 'react-router-dom';\r\nimport './HomePage.css';\r\nimport { jsPDF } from 'jspdf';\r\nimport html2canvas from 'html2canvas';\r\nimport { isLoggedIn } from './auth';\r\n\r\nexport default function PaymentSuccess() {\r\n  const [params] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const token = params.get('token') || '';\r\n  const amount = Number(params.get('amount') || 0);\r\n  const code = params.get('code') || '';\r\n  const rt = params.get('rt') || '';\r\n  const rn = params.get('rn') || '';\r\n  const ci = params.get('ci') || '';\r\n  const co = params.get('co') || '';\r\n  const ad = Number(params.get('ad') || 0);\r\n  const ch = Number(params.get('ch') || 0);\r\n\r\n  const [hotelName, setHotelName] = useState('');\r\n  const summary = useMemo(() => {\r\n    try {\r\n      const raw = token ? localStorage.getItem('hmsBooking:' + token) : null;\r\n      if (raw) return JSON.parse(raw);\r\n    } catch {}\r\n    return {\r\n      token, code, amount, roomType: rt, roomNames: rn, checkIn: ci, checkOut: co, adults: ad, children: ch, hotelId: (Number(params.get('hid')||0)||null),\r\n      hotel: '', checkInTime: '14:00', checkOutTime: '12:00'\r\n    };\r\n  }, [token, code, amount, rt, rn, ci, co, ad, ch, params]);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    const setName = (name) => { if (!cancelled) setHotelName(name); };\r\n    const fetchHotel = (hid) => {\r\n      if (!hid) return;\r\n      fetch(`/api/hotels/${hid}`).then(r => r.ok ? r.json() : null).then(j => {\r\n        if (j && j.name) setName(j.name);\r\n      }).catch(() => {});\r\n    };\r\n    if (!hotelName) {\r\n      const hidParam = Number(params.get('hid') || 0) || null;\r\n      if (summary.hotelId) {\r\n        fetchHotel(summary.hotelId);\r\n      } else if (hidParam) {\r\n        fetchHotel(hidParam);\r\n      } else if (summary.roomType) {\r\n        fetch(`/api/room-types/${encodeURIComponent(summary.roomType)}/rooms`)\r\n          .then(r => r.ok ? r.json() : null)\r\n          .then(j => {\r\n            if (j && j.roomType) {\r\n              if (j.roomType.hotelName && !hotelName) setName(j.roomType.hotelName);\r\n              if (j.roomType.hotelId) fetchHotel(j.roomType.hotelId);\r\n            }\r\n          })\r\n          .catch(() => {});\r\n      }\r\n    }\r\n    return () => { cancelled = true; };\r\n  }, [summary.hotelId, summary.roomType, hotelName, params]);\r\n\r\n  const detailsHref = useMemo(() => {\r\n    const q = new URLSearchParams({\r\n      amount: String(summary.amount || amount || 0),\r\n      code: String(summary.code || code || ''),\r\n      rn: String(summary.roomNames || rn || ''),\r\n      rt: String(summary.roomType || rt || ''),\r\n      ci: String(summary.checkIn || ci || ''),\r\n      co: String(summary.checkOut || co || ''),\r\n      ad: String(summary.adults || ad || 0),\r\n      ch: String(summary.children || ch || 0),\r\n      hid: String(summary.hotelId || params.get('hid') || ''),\r\n    });\r\n    return `/booking/${token || summary.token || ''}?${q.toString()}`;\r\n  }, [summary, token, amount, code, rn, ci, co, ad, ch, params]);\r\n\r\n  const toBase64 = (buf) => {\r\n    let binary = '';\r\n    const bytes = new Uint8Array(buf);\r\n    const len = bytes.byteLength;\r\n    for (let i = 0; i < len; i++) binary += String.fromCharCode(bytes[i]);\r\n    return btoa(binary);\r\n  };\r\n\r\n  const ensurePdfFonts = async () => {\r\n    const REG_KEY = 'hmsPdfFont:DejaVu-Regular';\r\n    const BOLD_KEY = 'hmsPdfFont:DejaVu-Bold';\r\n    let regular = '';\r\n    let bold = '';\r\n    try { regular = localStorage.getItem(REG_KEY) || ''; } catch {}\r\n    try { bold = localStorage.getItem(BOLD_KEY) || ''; } catch {}\r\n    const fetchFont = async (url) => {\r\n      const res = await fetch(url, { mode: 'cors' });\r\n      if (!res.ok) throw new Error('Font fetch failed');\r\n      const buf = await res.arrayBuffer();\r\n      return toBase64(buf);\r\n    };\r\n    if (!regular) {\r\n      regular = await fetchFont('https://raw.githubusercontent.com/dejavu-fonts/dejavu-fonts/master/ttf/DejaVuSans.ttf');\r\n      try { localStorage.setItem(REG_KEY, regular); } catch {}\r\n    }\r\n    if (!bold) {\r\n      bold = await fetchFont('https://raw.githubusercontent.com/dejavu-fonts/dejavu-fonts/master/ttf/DejaVuSans-Bold.ttf');\r\n      try { localStorage.setItem(BOLD_KEY, bold); } catch {}\r\n    }\r\n    return { regular, bold };\r\n  };\r\n\r\n  const printReceipt = async () => {\r\n    const hotel = hotelName || summary.hotel || '';\r\n    const file = `${summary.code || token || 'receipt'}.pdf`;\r\n    const container = document.createElement('div');\r\n    container.style.position = 'fixed';\r\n    container.style.left = '-99999px';\r\n    container.style.top = '0';\r\n    container.style.width = '560px';\r\n    container.style.background = '#fff';\r\n    container.style.padding = '24px 16px';\r\n    container.style.fontFamily = \"'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'DejaVu Sans', 'Liberation Sans', sans-serif\";\r\n    container.innerHTML = `\r\n      <div>\r\n        <div style=\"font-weight:800;font-size:22px;margin:0 0 10px 0;\">Phiếu xác nhận đặt phòng</div>\r\n        <div style=\"height:1px;background:#e6e6e6;margin:8px 0 14px 0;\"></div>\r\n        <div style=\"display:grid;grid-template-columns:180px 1fr;gap:10px 16px;font-size:13px;\">\r\n          <div style=\"color:#666;font-weight:700;\">Mã đặt phòng</div>\r\n          <div style=\"font-weight:800;\">${String(summary.code || token)}</div>\r\n          <div style=\"color:#666;font-weight:700;\">Khách sạn</div>\r\n          <div style=\"font-weight:800;\">${hotel || '—'}</div>\r\n          <div style=\"color:#666;font-weight:700;\">Ngày nhận</div>\r\n          <div style=\"font-weight:800;\">${summary.checkIn} - ${summary.checkInTime}</div>\r\n          <div style=\"color:#666;font-weight:700;\">Ngày trả</div>\r\n          <div style=\"font-weight:800;\">${summary.checkOut} - ${summary.checkOutTime}</div>\r\n          <div style=\"color:#666;font-weight:700;\">Phòng</div>\r\n          <div style=\"font-weight:800;\">${String(summary.roomNames || summary.roomType || '—')}</div>\r\n          <div style=\"color:#666;font-weight:700;\">Khách</div>\r\n          <div style=\"font-weight:800;\">${summary.adults || 0} người lớn${summary.children ? ` • ${summary.children} trẻ em` : ''}</div>\r\n          <div style=\"color:#666;font-weight:700;\">Tổng cộng</div>\r\n          <div style=\"font-weight:800;\">${Number(summary.amount || 0).toLocaleString('vi-VN')} VND</div>\r\n        </div>\r\n        <div style=\"margin-top:10px;font-weight:800;\">(ĐÃ THANH TOÁN)</div>\r\n      </div>`;\r\n    document.body.appendChild(container);\r\n    try {\r\n      const canvas = await html2canvas(container, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });\r\n      const imgData = canvas.toDataURL('image/png');\r\n      const pdf = new jsPDF({ unit: 'pt', format: 'a4' });\r\n      const pageWidth = pdf.internal.pageSize.getWidth();\r\n      const pageHeight = pdf.internal.pageSize.getHeight();\r\n      const imgWidth = Math.min(540, pageWidth - 56 * 2);\r\n      const imgHeight = (canvas.height * imgWidth) / canvas.width;\r\n      const x = (pageWidth - imgWidth) / 2;\r\n      let y = 56;\r\n      if (imgHeight > pageHeight - 112) {\r\n        // Multi-page if content longer than one page\r\n        let remaining = imgHeight;\r\n        let offset = 0;\r\n        while (remaining > 0) {\r\n          pdf.addImage(imgData, 'PNG', x, y - offset, imgWidth, imgHeight);\r\n          remaining -= (pageHeight - 112);\r\n          offset += (pageHeight - 112);\r\n          if (remaining > 0) {\r\n            pdf.addPage();\r\n          }\r\n        }\r\n      } else {\r\n        pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);\r\n      }\r\n      pdf.save(file);\r\n    } finally {\r\n      document.body.removeChild(container);\r\n    }\r\n  };\r\n\r\n  // Save to DB on mount (once)\r\n  useEffect(() => {\r\n    if (!isLoggedIn()) {\r\n      try { sessionStorage.setItem('hmsRedirectAfterLogin', window.location.pathname + window.location.search); } catch {}\r\n      navigate('/login');\r\n      return; // skip saving\r\n    }\r\n    const save = async () => {\r\n      try {\r\n        const raw = token ? localStorage.getItem('hmsBooking:' + token) : null;\r\n        if (!raw) return;\r\n        const s = JSON.parse(raw);\r\n        let email = s.userEmail || '';\r\n        if (!email) {\r\n          try { const rawUser = localStorage.getItem('hmsUser'); if (rawUser) email = JSON.parse(rawUser).email || ''; } catch {}\r\n        }\r\n        if (!email) return;\r\n        const body = {\r\n          token: token || s.token,\r\n          email,\r\n          checkIn: s.checkIn,\r\n          checkOut: s.checkOut,\r\n          method: s.payMethod || 'MOMO',\r\n          rooms: (s.rooms || []).map(r => ({ id: r.id, adults: r.adults || 1, children: r.children || 0, price: r.price })),\r\n        };\r\n        await fetch('/api/payments/complete', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });\r\n      } catch {}\r\n    };\r\n    save();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"home-root success-root\">\r\n      <div className=\"success-card\">\r\n        <div className=\"success-top\">\r\n          <Link to=\"/\" className=\"success-home\">← Quay lại Trang Chủ</Link>\r\n          <span />\r\n        </div>\r\n        <div className=\"success-icon\">\r\n          <img src=\"/success.png\" alt=\"success\" />\r\n        </div>\r\n        <h2 className=\"success-title\">Thanh Toán Thành Công!</h2>\r\n        <div className=\"success-sub\">Cảm ơn bạn đã đặt phòng tại HMS Hotel.</div>\r\n  <div className=\"success-code-line\"><span className=\"label\">Mã Đặt Phòng</span><span className=\"value\">{summary.code || token}</span></div>\r\n        <div className=\"success-sep\" />\r\n        <div className=\"success-grid\">\r\n          <div className=\"label\">Khách Sạn</div><div className=\"value\">{hotelName || summary.hotel || '—'}</div>\r\n          <div className=\"label\">Ngày Nhận</div><div className=\"value\">{summary.checkIn} - {summary.checkInTime}</div>\r\n          <div className=\"label\">Ngày Trả</div><div className=\"value\">{summary.checkOut} - {summary.checkOutTime}</div>\r\n          <div className=\"label\">Hạng Phòng</div><div className=\"value\">{summary.roomType || '—'}</div>\r\n          <div className=\"label\">Phòng</div><div className=\"value wrap\">{summary.roomNames || summary.roomType}</div>\r\n          <div className=\"label\">Khách</div><div className=\"value\">{summary.adults || 0} người lớn{summary.children ? ` • ${summary.children} trẻ em` : ''}</div>\r\n          <div className=\"label\">Tổng Cộng</div><div className=\"value bold nowrap\">{Number(summary.amount || 0).toLocaleString('vi-VN')} VND</div>\r\n        </div>\r\n        <div className=\"success-paid\">(ĐÃ THANH TOÁN)</div>\r\n        <div className=\"success-actions\">\r\n          <button className=\"checkout-btn success-btn\" onClick={printReceipt}>Tải phiếu xác nhận (PDF)</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}