{"ast":null,"code":"var _jsxFileName = \"D:\\\\DA_TichHop\\\\HMS_AI Hotel\\\\client\\\\src\\\\RoomTypeInline.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useMemo, useState, useRef } from 'react';\nimport { getUserRole, getUserEmail, isLoggedIn } from './auth';\nimport './HomePage.css';\nimport showToast from './toast';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function RoomTypeInline({\n  name,\n  onClose\n}) {\n  _s();\n  var _data$roomType2, _data$roomType4, _data$roomType5, _data$roomType6;\n  const [data, setData] = useState({\n    roomType: null,\n    rooms: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const [dateRange, setDateRange] = useState({\n    checkIn: '',\n    checkOut: ''\n  });\n  const [roomCount, setRoomCount] = useState(1);\n  // Promotions feature removed\n  const [selectedIndex, setSelectedIndex] = useState(-1);\n  const [selectedMap, setSelectedMap] = useState({});\n  const [zoomUrl, setZoomUrl] = useState('');\n  const [galleryIndex, setGalleryIndex] = useState(0);\n  const [showDetails, setShowDetails] = useState(false);\n  const [showCheckout, setShowCheckout] = useState(false);\n  const [promoCode, setPromoCode] = useState('');\n  const [availablePromos, setAvailablePromos] = useState([]);\n  const [showPromosList, setShowPromosList] = useState(false);\n  const [appliedPromo, setAppliedPromo] = useState(null);\n  const [showCheckoutDetails, setShowCheckoutDetails] = useState(false);\n  const [payMethod, setPayMethod] = useState('MOMO');\n  const [promoLoading, setPromoLoading] = useState(false);\n  const [promoLoadError, setPromoLoadError] = useState('');\n  const flashTotalRef = useRef(null);\n  const role = getUserRole();\n  const isAdmin = useMemo(() => {\n    try {\n      return String(role || '').toLowerCase().includes('admin');\n    } catch {\n      return false;\n    }\n  }, [role]);\n  const [agree, setAgree] = useState(false);\n  // QR flow removed – only direct redirect payment flow retained\n  const [showReviews, setShowReviews] = useState(false);\n  const [reviews, setReviews] = useState({\n    list: [],\n    avg: 0,\n    loading: false,\n    error: ''\n  });\n\n  // Removed QR base URL detection effect\n\n  useEffect(() => {\n    if (!name) return;\n    let active = true;\n    setLoading(true);\n    setError('');\n    setSelectedIndex(-1);\n    setSelectedMap({});\n    const params = new URLSearchParams();\n    if (dateRange.checkIn) params.set('checkIn', dateRange.checkIn);\n    if (dateRange.checkOut) params.set('checkOut', dateRange.checkOut);\n    // Cache bust: ensure fresh status for red/yellow/green dots\n    params.set('_', String(Date.now()));\n    fetch(`/api/room-types/${encodeURIComponent(name)}/rooms${params.toString() ? '?' + params.toString() : ''}`, {\n      cache: 'no-store'\n    }).then(async res => {\n      if (!res.ok) {\n        const j = await res.json().catch(() => ({}));\n        throw new Error(j.message || `HTTP ${res.status}`);\n      }\n      return res.json();\n    }).then(j => {\n      if (active) setData(j);\n    }).catch(err => {\n      if (active) setError(err.message || 'Lỗi tải dữ liệu');\n    }).finally(() => {\n      if (active) setLoading(false);\n    });\n    return () => {\n      active = false;\n    };\n  }, [name, dateRange.checkIn, dateRange.checkOut]);\n  const selectedRoom = useMemo(() => data.rooms[selectedIndex] || null, [data.rooms, selectedIndex]);\n  const galleryImages = useMemo(() => {\n    if (!selectedRoom) return [];\n    const arr = [];\n    if (selectedRoom.image) arr.push(selectedRoom.image);\n    return arr;\n  }, [selectedRoom]);\n  const selectedIds = useMemo(() => Object.keys(selectedMap).map(id => Number(id)), [selectedMap]);\n  const selectedRooms = useMemo(() => data.rooms.filter(r => selectedIds.includes(r.id)), [data.rooms, selectedIds]);\n  const nights = useMemo(() => {\n    if (!dateRange.checkIn || !dateRange.checkOut) return 0;\n    const inD = new Date(dateRange.checkIn);\n    const outD = new Date(dateRange.checkOut);\n    const ms = outD.setHours(0, 0, 0, 0) - inD.setHours(0, 0, 0, 0);\n    return ms > 0 ? Math.ceil(ms / (1000 * 60 * 60 * 24)) : 0;\n  }, [dateRange]);\n  const baseSum = useMemo(() => selectedRooms.reduce((s, r) => s + Number(r.basePrice || 0), 0), [selectedRooms]);\n  const totalPrice = useMemo(() => baseSum * (nights || 0), [baseSum, nights]);\n  // Helper to detect multiple hotel IDs chosen (defensive)\n  const selectedHotelIds = useMemo(() => {\n    try {\n      return Array.from(new Set(selectedRooms.map(r => r.hotelId || r.HotelId).filter(Boolean)));\n    } catch {\n      return [];\n    }\n  }, [selectedRooms]);\n  const totalGuests = useMemo(() => selectedRooms.reduce((sum, r) => {\n    const sel = selectedMap[String(r.id)] || {\n      adults: 0,\n      children: 0\n    };\n    return sum + Number(sel.adults || 0) + Number(sel.children || 0);\n  }, 0), [selectedRooms, selectedMap]);\n  const now = new Date();\n  const isValidDates = useMemo(() => {\n    if (!dateRange.checkIn || !dateRange.checkOut) return false;\n    const inD = new Date(dateRange.checkIn);\n    const outD = new Date(dateRange.checkOut);\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    // allow check-in equal to today, checkout must be after check-in\n    return inD >= today && outD > inD;\n  }, [dateRange, now]);\n\n  // Helpers for date inputs and warnings\n  const pad2 = n => String(n).padStart(2, '0');\n  const fmtDate = d => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;\n  const todayLocal = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  // allow selecting today as check-in (min = today)\n  const minCheckInDate = new Date(todayLocal.getFullYear(), todayLocal.getMonth(), todayLocal.getDate());\n  const minCheckInStr = fmtDate(minCheckInDate);\n  const minCheckOutStr = useMemo(() => {\n    if (dateRange.checkIn) {\n      const inD = new Date(dateRange.checkIn);\n      const d = new Date(inD.getFullYear(), inD.getMonth(), inD.getDate() + 1);\n      return fmtDate(d);\n    }\n    const d = new Date(minCheckInDate.getFullYear(), minCheckInDate.getMonth(), minCheckInDate.getDate() + 1);\n    return fmtDate(d);\n  }, [dateRange.checkIn, now]);\n  const dateError = useMemo(() => {\n    if (!dateRange.checkIn || !dateRange.checkOut) return '';\n    const inD = new Date(dateRange.checkIn);\n    const outD = new Date(dateRange.checkOut);\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n    if (!(inD >= today)) return 'Ngày nhận phải là hôm nay hoặc ngày sau';\n    if (!(outD > inD)) return 'Ngày trả phải sau ngày nhận';\n    return '';\n  }, [dateRange, now]);\n  const loggedIn = isLoggedIn();\n  // Điều kiện dữ liệu đã đủ (không xét đăng nhập)\n  const baseReady = useMemo(() => selectedRooms.length > 0 && totalGuests > 1 && isValidDates && nights > 0, [selectedRooms.length, totalGuests, isValidDates, nights]);\n  // Điều kiện thực sự có thể mở checkout\n  const canBook = loggedIn && baseReady;\n  const canPay = useMemo(() => canBook && agree && !!payMethod, [canBook, agree, payMethod]);\n  useEffect(() => {\n    // If reduced roomCount below current selected, trim selection deterministically\n    const max = Math.max(1, Number(roomCount || 1));\n    const ids = Object.keys(selectedMap);\n    if (ids.length > max) {\n      const keep = new Set(ids.slice(0, max));\n      const next = {};\n      ids.slice(0, max).forEach(id => {\n        next[id] = selectedMap[id];\n      });\n      setSelectedMap(next);\n    }\n  }, [roomCount]);\n\n  // Helper: validate promo code with server and return normalized promo object\n  const validatePromoServer = async code => {\n    if (!code) throw new Error('Thiếu mã');\n    try {\n      var _data$roomType, _ref, _promo$discountValue;\n      const q = new URL('/api/promotions/validate', window.location.origin);\n      q.searchParams.set('code', String(code).trim());\n      q.searchParams.set('amount', String(totalPrice || 0));\n      if (data !== null && data !== void 0 && (_data$roomType = data.roomType) !== null && _data$roomType !== void 0 && _data$roomType.hotelId) q.searchParams.set('hotelId', String(data.roomType.hotelId));\n      if (Array.isArray(selectedRooms) && selectedRooms.length) {\n        q.searchParams.set('roomIds', selectedRooms.map(r => r.id).join(','));\n      }\n      const r = await fetch(q.toString());\n      if (!r.ok) {\n        const t = await r.json().catch(() => ({}));\n        throw new Error(t.message || 'Mã không hợp lệ');\n      }\n      const j = await r.json();\n      console.log('[promo validate] server response:', j, 'gross:', totalPrice);\n      // Normalize and compute discount client-side according to rules when promo object is present\n      // Prefer server-provided numbers (authoritative). Fall back to minimal local normalization.\n      const promo = j.promo || {};\n      const serverDiscount = typeof j.discount !== 'undefined' ? Number(j.discount) : null;\n      const serverFinal = typeof j.final !== 'undefined' ? Number(j.final) : null;\n      const dType = promo.discountType || j.discountType || null;\n      const dVal = Number((_ref = (_promo$discountValue = promo.discountValue) !== null && _promo$discountValue !== void 0 ? _promo$discountValue : j.discount) !== null && _ref !== void 0 ? _ref : 0);\n      // Enforce hotel mismatch (defensive — server should reject already)\n      if (promo && promo.hotelId && selectedHotelIds.length && !selectedHotelIds.every(h => Number(h) === Number(promo.hotelId))) {\n        throw new Error('Mã ưu đãi không áp dụng cho các phòng đã chọn');\n      }\n      return {\n        code: (j.code || promo.code || String(code)).toString().toUpperCase(),\n        discount: serverDiscount !== null ? serverDiscount : Number(0),\n        discountType: dType,\n        discountValue: Number(dVal || 0),\n        final: serverFinal !== null ? serverFinal : Number(0),\n        raw: promo || null,\n        serverRaw: j\n      };\n    } catch (e) {\n      throw e;\n    }\n  };\n\n  // Auto-drop appliedPromo if user changes selection sang hotel khác hoặc promo hotel mismatch\n  useEffect(() => {\n    try {\n      if (!appliedPromo || !appliedPromo.raw) return;\n      const promoHotel = appliedPromo.raw.hotelId || appliedPromo.raw.HotelId || null;\n      if (promoHotel && selectedHotelIds.length && !selectedHotelIds.every(h => Number(h) === Number(promoHotel))) {\n        setAppliedPromo(null);\n        showToast('Đã gỡ mã ưu đãi không còn phù hợp (khách sạn khác)', {\n          type: 'warning',\n          duration: 2500\n        });\n      }\n    } catch {/* ignore */}\n  }, [selectedHotelIds]);\n  function flashTotal() {\n    try {\n      // target possible total elements in summary/checkout\n      const els = [];\n      const a = document.querySelectorAll('.rt-summary-total span:last-child, .checkout-total span:last-child');\n      a.forEach(x => els.push(x));\n      if (!els.length) return;\n      els.forEach(el => {\n        el.classList.add('total-highlight');\n        el.classList.add('apply');\n      });\n      clearTimeout(flashTotalRef.current);\n      flashTotalRef.current = setTimeout(() => {\n        els.forEach(el => el.classList.remove('apply'));\n      }, 600);\n    } catch (e) {/* ignore */}\n  }\n  const toggleSelectRoom = room => {\n    const id = String(room.id);\n    const isSelected = !!selectedMap[id];\n    if (isSelected) {\n      const next = {\n        ...selectedMap\n      };\n      delete next[id];\n      setSelectedMap(next);\n      return;\n    }\n    const max = Math.max(1, Number(roomCount || 1));\n    const ids = Object.keys(selectedMap);\n    if (ids.length >= max) {\n      if (max === 1) {\n        // replace existing selection with the new room\n        setSelectedMap({\n          [id]: {\n            adults: 0,\n            children: 0\n          }\n        });\n      } else {\n        return; // reach limit for multi-selection\n      }\n    } else {\n      setSelectedMap({\n        ...selectedMap,\n        [id]: {\n          adults: 0,\n          children: 0\n        }\n      });\n    }\n  };\n  const updateCounts = (room, kind, value) => {\n    const id = String(room.id);\n    if (!selectedMap[id]) return;\n    setSelectedMap({\n      ...selectedMap,\n      [id]: {\n        ...selectedMap[id],\n        [kind]: Number(value)\n      }\n    });\n  };\n  if (!name) return null;\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"rt-inline\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rt-toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rt-field rt-field--wide\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"Ng\\xE0y nh\\u1EADn - tr\\u1EA3 ph\\xF2ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-date-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            min: minCheckInStr,\n            \"aria-invalid\": dateRange.checkIn ? new Date(dateRange.checkIn) <= todayLocal : false,\n            value: dateRange.checkIn,\n            onChange: e => {\n              const newIn = e.target.value;\n              setDateRange(v => {\n                let newOut = v.checkOut;\n                if (newOut && !(new Date(newOut) > new Date(newIn))) {\n                  newOut = '';\n                }\n                return {\n                  ...v,\n                  checkIn: newIn,\n                  checkOut: newOut\n                };\n              });\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            min: minCheckOutStr,\n            \"aria-invalid\": dateRange.checkOut && dateRange.checkIn ? new Date(dateRange.checkOut) <= new Date(dateRange.checkIn) : false,\n            value: dateRange.checkOut,\n            onChange: e => setDateRange(v => ({\n              ...v,\n              checkOut: e.target.value\n            }))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 11\n        }, this), dateError && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-date-error\",\n          style: {\n            color: '#d93025',\n            fontSize: 12,\n            marginTop: 6\n          },\n          children: dateError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"rt-field\",\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"S\\u1ED1 ph\\xF2ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"number\",\n          min: 1,\n          value: roomCount,\n          onChange: e => setRoomCount(Math.max(1, Number(e.target.value)))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 279,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"rt-search-btn\",\n        disabled: !dateRange.checkIn || !dateRange.checkOut || !isValidDates,\n        children: \"T\\xCCM KI\\u1EBEM\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 3\n      }, this), onClose && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"rt-close-btn\",\n        onClick: onClose,\n        children: \"\\u0110\\xD3NG\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 7\n    }, this), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"\\u0110ang t\\u1EA3i...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 19\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: 'red'\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 17\n    }, this), !loading && !error && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rt-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"rt-list\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-legend\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"rt-legend-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"rt-status-dot red\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 48\n            }, this), \" \\u0110\\xE3 \\u0111\\u01B0\\u1EE3c \\u0111\\u1EB7t\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 293,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"rt-legend-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"rt-status-dot yellow\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 48\n            }, this), \" \\u0110ang \\u0111\\u01B0\\u1EE3c \\u0111\\u1EB7t\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"rt-legend-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"rt-status-dot green\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 295,\n              columnNumber: 48\n            }, this), \" Tr\\u1ED1ng\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 13\n        }, this), data.rooms.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: \"Ch\\u01B0a c\\xF3 ph\\xF2ng n\\xE0o thu\\u1ED9c h\\u1EA1ng ph\\xF2ng n\\xE0y.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 15\n        }, this) : data.rooms.map((r, idx) => {\n          const isSelected = !!selectedMap[String(r.id)];\n          const hasDates = !!(dateRange.checkIn && dateRange.checkOut);\n          const isBooked = hasDates ? !!r.isBooked : r.status === 'Occupied';\n          const adultsMax = Number(r.maxAdults || 0);\n          const childrenMax = Number(r.maxChildren || 0);\n          const adultsVal = isSelected ? selectedMap[String(r.id)].adults : 0;\n          const childrenVal = isSelected ? selectedMap[String(r.id)].children : 0;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `rt-card ${isSelected ? 'selected' : ''}`,\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-main\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-thumb\",\n                children: r.image && /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: r.image,\n                  alt: r.roomNumber,\n                  onClick: () => setZoomUrl(r.image)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 312,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 311,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-info\",\n                children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                  className: \"rt-name\",\n                  onClick: () => {\n                    setSelectedIndex(idx);\n                    setGalleryIndex(0);\n                    setShowDetails(true);\n                  },\n                  style: {\n                    cursor: 'pointer',\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    children: `Phòng ${r.roomNumber}${r.floor != null ? ` * Tầng ${r.floor}` : ''}`\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 316,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: `rt-status-dot ${isBooked ? 'red' : isSelected ? 'yellow' : 'green'}`,\n                    title: isBooked ? 'Đã đặt' : isSelected ? 'Đang đặt' : 'Trống'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 317,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 315,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"rt-cap\",\n                  children: [\"T\\u1ED1i \\u0111a \", adultsMax, \" ng\\u01B0\\u1EDDi l\\u1EDBn | \", childrenMax, \" tr\\u1EBB em\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 319,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"rt-price\",\n                  children: [\"Gi\\xE1 t\\u1EEB \", Number(r.basePrice || 0).toLocaleString('vi-VN'), \" VND/\\u0111\\xEAm\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 320,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 314,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-actions\",\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"rt-choose\",\n                  onClick: () => {\n                    if (isAdmin) {\n                      showToast('Tài khoản Admin không được chọn phòng', {\n                        duration: 2000,\n                        type: 'warn'\n                      });\n                      return;\n                    }\n                    if (isBooked) return;\n                    toggleSelectRoom(r);\n                  },\n                  disabled: isBooked || isAdmin,\n                  title: isAdmin ? 'Tài khoản Admin không được chọn phòng' : isBooked ? 'Phòng đã được đặt trong khoảng thời gian này' : '',\n                  children: isBooked ? 'ĐÃ ĐẶT' : isSelected ? 'BỎ CHỌN' : 'CHỌN'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 323,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 322,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 21\n            }, this), isSelected && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-extra\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-note-row\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"rt-note\",\n                  children: \"\\u0110\\xE3 bao g\\u1ED3m \\u0103n s\\xE1ng \\u2022 Kh\\xF4ng ho\\xE0n tr\\u1EA3 ph\\xED khi h\\u1EE7y ph\\xF2ng\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 337,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"rt-selects\",\n                  children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                    children: [\"Ch\\u1ECDn s\\u1ED1 ng\\u01B0\\u1EDDi l\\u1EDBn\", /*#__PURE__*/_jsxDEV(\"select\", {\n                      value: adultsVal,\n                      onChange: e => updateCounts(r, 'adults', e.target.value),\n                      children: Array.from({\n                        length: adultsMax + 1\n                      }, (_, i) => /*#__PURE__*/_jsxDEV(\"option\", {\n                        value: i,\n                        children: i\n                      }, i, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 342,\n                        columnNumber: 82\n                      }, this))\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 341,\n                      columnNumber: 31\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 339,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                    children: [\". Tr\\u1EBB em\", /*#__PURE__*/_jsxDEV(\"select\", {\n                      value: childrenVal,\n                      onChange: e => updateCounts(r, 'children', e.target.value),\n                      children: Array.from({\n                        length: childrenMax + 1\n                      }, (_, i) => /*#__PURE__*/_jsxDEV(\"option\", {\n                        value: i,\n                        children: i\n                      }, i, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 348,\n                        columnNumber: 84\n                      }, this))\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 347,\n                      columnNumber: 31\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 345,\n                    columnNumber: 29\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 338,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 336,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-price-2\",\n                children: [\"Gi\\xE1 t\\u1EEB \", Number(r.basePrice || 0).toLocaleString('vi-VN'), \" VND/\\u0111\\xEAm\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 353,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 335,\n              columnNumber: 23\n            }, this)]\n          }, r.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 309,\n            columnNumber: 19\n          }, this);\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n        className: \"rt-detail\",\n        children: [(!showDetails || !(selectedIndex >= 0 && selectedRoom)) && !showCheckout && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-detail-inner\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"rt-summary\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-title\",\n              style: {\n                cursor: selectedRoom ? 'pointer' : 'default'\n              },\n              onClick: () => {\n                if (selectedRoom) setShowDetails(true);\n              },\n              children: \"Th\\xF4ng tin \\u0111\\u1EB7t ph\\xF2ng\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 367,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-hotel\",\n              children: ((_data$roomType2 = data.roomType) === null || _data$roomType2 === void 0 ? void 0 : _data$roomType2.name) || name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-dates\",\n              children: [dateRange.checkIn || 'dd/mm/yyyy', \" - \", dateRange.checkOut || 'dd/mm/yyyy']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 372,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-sep\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 373,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-title\",\n              children: \"Th\\xF4ng tin ph\\xF2ng\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-list\",\n              children: selectedRooms.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: \"Ch\\u01B0a ch\\u1ECDn ph\\xF2ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 377,\n                columnNumber: 23\n              }, this) : selectedRooms.map(r => {\n                var _sel$adults, _sel$children;\n                const sel = selectedMap[String(r.id)];\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"rt-summary-room\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"rt-summary-line\",\n                    children: [\"Ph\\xF2ng: \", r.roomNumber, r.floor != null ? ` • Tầng ${r.floor}` : '']\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 383,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"rt-summary-line\",\n                    children: [\"Ng\\u01B0\\u1EDDi l\\u1EDBn: \", (_sel$adults = sel === null || sel === void 0 ? void 0 : sel.adults) !== null && _sel$adults !== void 0 ? _sel$adults : 0]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 384,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"rt-summary-line\",\n                    children: [\"Tr\\u1EBB em: \", (_sel$children = sel === null || sel === void 0 ? void 0 : sel.children) !== null && _sel$children !== void 0 ? _sel$children : 0]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 385,\n                    columnNumber: 29\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"rt-summary-line\",\n                    children: [\"Gi\\xE1: \", Number(r.basePrice || 0).toLocaleString('vi-VN'), \" VND/\\u0111\\xEAm\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 386,\n                    columnNumber: 29\n                  }, this)]\n                }, r.id, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 382,\n                  columnNumber: 27\n                }, this);\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 375,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-sep\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 392,\n              columnNumber: 19\n            }, this), !baseReady && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-warning\",\n              children: \"L\\u01B0u \\xFD: H\\xE3y ch\\u1ECDn ph\\xF2ng, Ng\\xE0y nh\\u1EADn - ng\\xE0y tr\\u1EA3, v\\xE0 s\\u1ED1 l\\u01B0\\u1EE3ng kh\\xE1ch (t\\u1ED5ng > 1) \\u0111\\u1EC3 chu\\u1EA9n b\\u1ECB \\u0111\\u1EB7t ph\\xF2ng.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 394,\n              columnNumber: 21\n            }, this), baseReady && !loggedIn && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-warning\",\n              children: \"B\\u1EA1n \\u0111\\xE3 ch\\u1ECDn \\u0111\\u1EE7 th\\xF4ng tin. Vui l\\xF2ng \\u0111\\u0103ng nh\\u1EADp \\u0111\\u1EC3 ti\\u1EBFp t\\u1EE5c \\u0111\\u1EB7t ph\\xF2ng.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 397,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-total\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: [\"T\\u1ED5ng c\\u1ED9ng (\", nights, \" \\u0111\\xEAm)\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 400,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                children: [Number(totalPrice).toLocaleString('vi-VN'), \" VND\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 401,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 399,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-actions-vertical\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"rt-review-btn\",\n                onClick: async () => {\n                  setShowReviews(true);\n                  setReviews(r => ({\n                    ...r,\n                    loading: true,\n                    error: ''\n                  }));\n                  try {\n                    var _data$roomType3;\n                    const params = new URLSearchParams();\n                    if (selectedRoom) params.set('roomId', String(selectedRoom.id));else params.set('roomType', ((_data$roomType3 = data.roomType) === null || _data$roomType3 === void 0 ? void 0 : _data$roomType3.name) || name);\n                    params.set('_', String(Date.now()));\n                    const res = await fetch(`/api/public-reviews?${params.toString()}`, {\n                      cache: 'no-store'\n                    });\n                    if (!res.ok) throw new Error('Không tải được đánh giá');\n                    const j = await res.json();\n                    setReviews({\n                      list: Array.isArray(j.reviews) ? j.reviews : [],\n                      avg: Number(j.avgRating || 0),\n                      loading: false,\n                      error: ''\n                    });\n                  } catch (e) {\n                    setReviews({\n                      list: [],\n                      avg: 0,\n                      loading: false,\n                      error: e.message || 'Lỗi tải đánh giá'\n                    });\n                  }\n                },\n                style: {\n                  whiteSpace: 'nowrap'\n                },\n                children: \"xem \\u0111\\xE1nh gi\\xE1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 404,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `rt-book-btn ${baseReady ? 'enabled' : ''} ${canBook ? 'can-book' : ''}`,\n                disabled: !baseReady || isAdmin,\n                onClick: () => {\n                  if (isAdmin) {\n                    showToast('Tài khoản Admin không được phép đặt phòng', {\n                      duration: 2200,\n                      type: 'warn'\n                    });\n                    return;\n                  }\n                  if (!loggedIn) return; // chỉ không mở checkout\n                  setShowCheckoutDetails(false);\n                  setShowCheckout(true);\n                },\n                onMouseEnter: e => {\n                  if (baseReady && !loggedIn) {\n                    e.currentTarget.setAttribute('data-tip', 'Vui lòng Đăng nhập để đặt phòng!');\n                  }\n                },\n                onMouseLeave: e => {\n                  e.currentTarget.removeAttribute('data-tip');\n                },\n                children: [canBook ? 'ĐẶT PHÒNG' : baseReady ? 'ĐẶT PHÒNG' : 'ĐẶT PHÒNG', !loggedIn && baseReady && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"rt-btn-hint\",\n                  children: \" (\\u0110\\u0103ng nh\\u1EADp \\u0111\\u1EC3 ti\\u1EBFp t\\u1EE5c)\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 442,\n                  columnNumber: 50\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 426,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 403,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 15\n        }, this), showDetails && !showCheckout && selectedIndex >= 0 && selectedRoom && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-detail-inner\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"rt-summary\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-title\",\n              style: {\n                cursor: 'pointer'\n              },\n              onClick: () => setShowDetails(false),\n              children: \"Chi ti\\u1EBFt ph\\xF2ng (nh\\u1EA5n \\u0111\\u1EC3 quay l\\u1EA1i \\u0111\\u1EB7t ph\\xF2ng)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 453,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-gallery\",\n              style: {\n                marginBottom: 10\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  position: 'relative',\n                  borderRadius: 8,\n                  overflow: 'hidden',\n                  height: 180,\n                  background: '#f5f5f5'\n                },\n                children: galleryImages.length > 0 && /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: galleryImages[galleryIndex % galleryImages.length],\n                  alt: \"\\u1EA2nh ph\\xF2ng\",\n                  style: {\n                    width: '100%',\n                    height: '100%',\n                    objectFit: 'cover',\n                    display: 'block'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 459,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-gallery-controls\",\n                style: {\n                  display: 'flex',\n                  justifyContent: 'center',\n                  gap: 10,\n                  marginTop: 8\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"btn\",\n                  disabled: galleryImages.length <= 1,\n                  onClick: () => setGalleryIndex(i => (i - 1 + galleryImages.length) % galleryImages.length),\n                  children: '<'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 463,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"btn\",\n                  disabled: galleryImages.length <= 1,\n                  onClick: () => setGalleryIndex(i => (i + 1) % galleryImages.length),\n                  children: '>'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 464,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 456,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-list\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: [\"S\\u1ED1 ph\\xF2ng: \", selectedRoom.roomNumber]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 468,\n                columnNumber: 21\n              }, this), selectedRoom.floor != null && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: [\"T\\u1EA7ng: \", selectedRoom.floor]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 470,\n                columnNumber: 23\n              }, this), typeof selectedRoom.status !== 'undefined' && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: [\"Tr\\u1EA1ng th\\xE1i: \", String(selectedRoom.status)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 473,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: [\"Lo\\u1EA1i ph\\xF2ng: \", ((_data$roomType4 = data.roomType) === null || _data$roomType4 === void 0 ? void 0 : _data$roomType4.name) || name]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 475,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: [\"S\\u1EE9c ch\\u1EE9a: \", Number(selectedRoom.maxAdults || 0), \" ng\\u01B0\\u1EDDi l\\u1EDBn, \", Number(selectedRoom.maxChildren || 0), \" tr\\u1EBB em\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 476,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: [\"Gi\\xE1 c\\u01A1 b\\u1EA3n: \", Number(selectedRoom.basePrice || 0).toLocaleString('vi-VN'), \" VND/\\u0111\\xEAm\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 477,\n                columnNumber: 21\n              }, this), ((_data$roomType5 = data.roomType) === null || _data$roomType5 === void 0 ? void 0 : _data$roomType5.description) && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"rt-summary-line\",\n                children: [\"M\\xF4 t\\u1EA3: \", data.roomType.description]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 479,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 467,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-summary-sep\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 482,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"rt-actions-vertical\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"rt-review-btn\",\n                onClick: async () => {\n                  setShowReviews(true);\n                  setReviews(r => ({\n                    ...r,\n                    loading: true,\n                    error: ''\n                  }));\n                  try {\n                    const params = new URLSearchParams();\n                    params.set('roomId', String(selectedRoom.id));\n                    params.set('_', String(Date.now()));\n                    const res = await fetch(`/api/public-reviews?${params.toString()}`, {\n                      cache: 'no-store'\n                    });\n                    if (!res.ok) throw new Error('Không tải được đánh giá');\n                    const j = await res.json();\n                    setReviews({\n                      list: Array.isArray(j.reviews) ? j.reviews : [],\n                      avg: Number(j.avgRating || 0),\n                      loading: false,\n                      error: ''\n                    });\n                  } catch (e) {\n                    setReviews({\n                      list: [],\n                      avg: 0,\n                      loading: false,\n                      error: e.message || 'Lỗi tải đánh giá'\n                    });\n                  }\n                },\n                style: {\n                  whiteSpace: 'nowrap'\n                },\n                children: \"xem \\u0111\\xE1nh gi\\xE1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 484,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `rt-book-btn ${baseReady ? 'enabled' : ''}`,\n                onClick: () => {\n                  if (isAdmin) {\n                    alert('Tài khoản Admin không được phép đặt phòng');\n                    return;\n                  }\n                  if (!loggedIn) return;\n                  setShowDetails(false);\n                  setShowCheckoutDetails(false);\n                  setShowCheckout(true);\n                },\n                disabled: !baseReady || isAdmin,\n                onMouseEnter: e => {\n                  if (baseReady && !loggedIn) e.currentTarget.setAttribute('data-tip', 'Vui lòng Đăng nhập để đặt phòng!');\n                },\n                onMouseLeave: e => e.currentTarget.removeAttribute('data-tip'),\n                children: canBook ? 'ĐẶT PHÒNG' : 'ĐẶT PHÒNG'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 506,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 483,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 451,\n          columnNumber: 15\n        }, this), showCheckout && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rt-detail-inner\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checkout-panel\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"checkout-main-title\",\n              children: \"Thanh To\\xE1n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 524,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"checkout-header\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-title\",\n                children: \"Th\\xF4ng Tin \\u0110\\u1EB7t Ph\\xF2ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 526,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 525,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"checkout-body\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontWeight: 800,\n                  marginBottom: 4\n                },\n                children: ((_data$roomType6 = data.roomType) === null || _data$roomType6 === void 0 ? void 0 : _data$roomType6.name) || name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 529,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  color: '#555',\n                  marginBottom: 8\n                },\n                children: [dateRange.checkIn || 'dd/mm/yyyy', \" - \", dateRange.checkOut || 'dd/mm/yyyy']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 530,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-info-row\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"checkout-section-title\",\n                  style: {\n                    margin: 0\n                  },\n                  children: \"Th\\xF4ng Tin Ph\\xF2ng\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 532,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  className: \"checkout-inline-toggle\",\n                  onClick: () => setShowCheckoutDetails(v => !v),\n                  children: showCheckoutDetails ? 'Ẩn Thông Tin' : 'Xem Thông Tin'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 533,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 531,\n                columnNumber: 21\n              }, this), showCheckoutDetails && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-room-list\",\n                children: selectedRooms.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                  children: \"Ch\\u01B0a ch\\u1ECDn ph\\xF2ng\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 540,\n                  columnNumber: 27\n                }, this) : selectedRooms.map(r => {\n                  var _sel$adults2, _sel$children2;\n                  const sel = selectedMap[String(r.id)];\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"rt-summary-room\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"rt-summary-line\",\n                      children: [\"Ph\\xF2ng: \", r.roomNumber, r.floor != null ? ` • Tầng ${r.floor}` : '']\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 546,\n                      columnNumber: 33\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"rt-summary-line\",\n                      children: [\"Ng\\u01B0\\u1EDDi l\\u1EDBn: \", (_sel$adults2 = sel === null || sel === void 0 ? void 0 : sel.adults) !== null && _sel$adults2 !== void 0 ? _sel$adults2 : 0, \" \\u2022 Tr\\u1EBB em: \", (_sel$children2 = sel === null || sel === void 0 ? void 0 : sel.children) !== null && _sel$children2 !== void 0 ? _sel$children2 : 0]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 547,\n                      columnNumber: 33\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"rt-summary-line\",\n                      children: [\"Gi\\xE1: \", Number(r.basePrice || 0).toLocaleString('vi-VN'), \" VND/\\u0111\\xEAm\"]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 548,\n                      columnNumber: 33\n                    }, this)]\n                  }, r.id, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 545,\n                    columnNumber: 31\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 538,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-line\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"S\\u1ED1 \\u0111\\xEAm\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 556,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [nights, \" \\u0111\\xEAm\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 557,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 555,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-line\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Gi\\xE1 ph\\xF2ng\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 560,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [Number(totalPrice).toLocaleString('vi-VN'), \" VND\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 561,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 559,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-line\",\n                style: {\n                  alignItems: 'center',\n                  gap: 8,\n                  marginTop: 8\n                },\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    display: 'flex',\n                    gap: 8,\n                    alignItems: 'center',\n                    flexWrap: 'wrap'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                    placeholder: \"Nh\\u1EADp m\\xE3 \\u01B0u \\u0111\\xE3i\",\n                    value: promoCode,\n                    onChange: e => setPromoCode(e.target.value.toUpperCase()),\n                    style: {\n                      padding: '8px 10px',\n                      borderRadius: 8,\n                      border: '1px solid #ddd'\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 565,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    type: \"button\",\n                    className: \"ph-btn\",\n                    disabled: !(totalPrice > 0),\n                    onClick: async () => {\n                      if (!(totalPrice > 0)) {\n                        showToast('Vui lòng chọn phòng và ngày để áp dụng mã ưu đãi', {\n                          duration: 2000,\n                          type: 'warn'\n                        });\n                        return;\n                      }\n                      try {\n                        const normalized = await validatePromoServer(promoCode.trim());\n                        setAppliedPromo(normalized);\n                        setPromoCode(normalized.code);\n                        // visual flash of total\n                        flashTotal();\n                        showToast('Áp dụng mã: ' + normalized.code + ' • Giảm ' + normalized.discount.toLocaleString('vi-VN') + 'đ', {\n                          duration: 2000,\n                          type: 'success'\n                        });\n                      } catch (e) {\n                        showToast(e.message || 'Lỗi kiểm tra mã', {\n                          duration: 2400,\n                          type: 'error'\n                        });\n                      }\n                    },\n                    children: \"\\xC1p d\\u1EE5ng\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 566,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    type: \"button\",\n                    className: \"ph-btn ph-btn--secondary\",\n                    disabled: !(totalPrice > 0),\n                    onClick: async () => {\n                      if (!(totalPrice > 0)) {\n                        showToast('Vui lòng chọn phòng và ngày để xem ưu đãi', {\n                          duration: 2000,\n                          type: 'warn'\n                        });\n                        return;\n                      }\n                      // fetch available promos list\n                      try {\n                        var _data$roomType7;\n                        setPromoLoading(true);\n                        setPromoLoadError('');\n                        const promoUrl = new URL('/api/promotions', window.location.origin);\n                        if (data !== null && data !== void 0 && (_data$roomType7 = data.roomType) !== null && _data$roomType7 !== void 0 && _data$roomType7.hotelId) promoUrl.searchParams.set('hotelId', String(data.roomType.hotelId));\n                        if (Array.isArray(selectedRooms) && selectedRooms.length) {\n                          promoUrl.searchParams.set('roomIds', selectedRooms.map(r => r.id).join(','));\n                        }\n                        const r = await fetch(promoUrl.toString());\n                        if (!r.ok) {\n                          const txt = await r.text().catch(() => null);\n                          throw new Error(txt || 'Không lấy được danh sách');\n                        }\n                        const j = await r.json();\n                        setAvailablePromos(Array.isArray(j.items) ? j.items : []);\n                        setShowPromosList(true);\n                      } catch (e) {\n                        setPromoLoadError(e.message || 'Lỗi tải ưu đãi');\n                        showToast(e.message || 'Lỗi tải ưu đãi', {\n                          duration: 2400,\n                          type: 'error'\n                        });\n                      } finally {\n                        setPromoLoading(false);\n                      }\n                    },\n                    children: \"Ch\\u1ECDn\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 577,\n                    columnNumber: 25\n                  }, this), appliedPromo && /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      fontWeight: 800\n                    },\n                    children: [appliedPromo.code, \" \\u2022 Gi\\u1EA3m \", appliedPromo.discountType === 'PERCENT' ? appliedPromo.discountValue + '%' : Number(appliedPromo.discount || 0).toLocaleString('vi-VN') + 'đ']\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 593,\n                    columnNumber: 42\n                  }, this), promoLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      color: '#2563eb',\n                      fontSize: 13\n                    },\n                    children: \"\\u0110ang t\\u1EA3i \\u01B0u \\u0111\\xE3i...\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 594,\n                    columnNumber: 42\n                  }, this), promoLoadError && /*#__PURE__*/_jsxDEV(\"div\", {\n                    style: {\n                      color: '#b42318',\n                      fontSize: 13\n                    },\n                    children: promoLoadError\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 595,\n                    columnNumber: 44\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 564,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 563,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-line\",\n                style: {\n                  alignItems: 'stretch',\n                  flexDirection: 'column',\n                  gap: 6\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    fontWeight: 700\n                  },\n                  children: \"Ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 601,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n                  className: \"checkout-pay-method\",\n                  value: payMethod,\n                  onChange: e => setPayMethod(e.target.value),\n                  children: [/*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"MOMO\",\n                    children: \"V\\xED \\u0111i\\u1EC7n t\\u1EED MOMO\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 603,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"ZALOPAY\",\n                    children: \"ZaloPay\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 604,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"VNPAY\",\n                    children: \"VNPay\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 605,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"option\", {\n                    value: \"CARD\",\n                    children: \"Th\\u1EBB t\\xEDn d\\u1EE5ng/ghi n\\u1EE3\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 606,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 602,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 600,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"checkout-terms\",\n                children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"checkbox\",\n                  checked: agree,\n                  onChange: e => setAgree(e.target.checked)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 611,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Vui l\\xF2ng \\u0111\\u1ECDc k\\u0129 v\\xE0 \\u0111\\u1ED3ng \\xFD v\\u1EDBi \\u0111i\\u1EC1u kho\\u1EA3n b\\u1EB1ng c\\xE1ch \\u0111\\xE1nh d\\u1EA5u v\\xE0o \\xF4 b\\xEAn c\\u1EA1nh\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 612,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 610,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-total\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"T\\u1ED5ng c\\u1ED9ng\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 615,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [Number(totalPrice).toLocaleString('vi-VN'), \" VND\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 616,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 614,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"checkout-actions\",\n                style: {\n                  display: 'flex',\n                  gap: 8,\n                  flexWrap: 'wrap'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"checkout-btn\",\n                  disabled: !canPay || isAdmin,\n                  onClick: () => {\n                    var _data$roomType8, _data$roomType9, _data$roomType0;\n                    if (isAdmin) {\n                      alert('Tài khoản Admin không được phép đặt phòng');\n                      return;\n                    }\n                    // Flow mới: chuyển hướng trực tiếp sang trang /payment/confirm\n                    const t = Math.random().toString(36).slice(2) + Date.now().toString(36);\n                    const totals = selectedRooms.reduce((acc, r) => {\n                      const sel = selectedMap[String(r.id)] || {\n                        adults: 0,\n                        children: 0\n                      };\n                      acc.ad += Number(sel.adults || 0);\n                      acc.ch += Number(sel.children || 0);\n                      return acc;\n                    }, {\n                      ad: 0,\n                      ch: 0\n                    });\n                    const pad2 = n => String(n).padStart(2, '0');\n                    const nowD = new Date();\n                    const bookingCode = `HMS${nowD.getFullYear()}${pad2(nowD.getMonth() + 1)}${pad2(nowD.getDate())}`;\n                    const roomNames = selectedRooms.map(r => `Phòng ${r.roomNumber}${r.floor != null ? ` • Tầng ${r.floor}` : ''}`).join(', ');\n                    let userEmail = '';\n                    try {\n                      const u = localStorage.getItem('hmsUser');\n                      if (u) userEmail = (JSON.parse(u).email || '').trim();\n                    } catch {}\n                    const grossAmount = Number(totalPrice) || 0;\n                    // compute discount locally if appliedPromo exists; but final validation will be on server on promotions/validate\n                    let promoData = null;\n                    if (appliedPromo && appliedPromo.code) {\n                      // include server-provided discount & final where available\n                      promoData = {\n                        code: appliedPromo.code,\n                        discount: Number(appliedPromo.discount || 0),\n                        discountType: appliedPromo.discountType || appliedPromo.raw && appliedPromo.raw.discountType || null,\n                        discountValue: Number(appliedPromo.discountValue || 0),\n                        final: appliedPromo.final || null,\n                        raw: appliedPromo.raw || null\n                      };\n                    }\n                    const summary = {\n                      token: t,\n                      code: bookingCode,\n                      hotelId: ((_data$roomType8 = data.roomType) === null || _data$roomType8 === void 0 ? void 0 : _data$roomType8.hotelId) || null,\n                      hotel: ((_data$roomType9 = data.roomType) === null || _data$roomType9 === void 0 ? void 0 : _data$roomType9.hotelName) || '',\n                      roomType: ((_data$roomType0 = data.roomType) === null || _data$roomType0 === void 0 ? void 0 : _data$roomType0.name) || name,\n                      roomNames,\n                      checkIn: dateRange.checkIn,\n                      checkOut: dateRange.checkOut,\n                      checkInTime: '14:00',\n                      checkOutTime: '12:00',\n                      payMethod,\n                      userEmail,\n                      adults: totals.ad,\n                      children: totals.ch,\n                      rooms: selectedRooms.map(r => {\n                        const sel = selectedMap[String(r.id)] || {\n                          adults: 0,\n                          children: 0\n                        };\n                        return {\n                          id: r.id,\n                          number: r.roomNumber,\n                          floor: r.floor,\n                          price: r.basePrice,\n                          name: r.roomNumber,\n                          adults: sel.adults,\n                          children: sel.children\n                        };\n                      }),\n                      amount: grossAmount,\n                      promo: promoData\n                    };\n                    // promotion fields removed from summary\n                    try {\n                      localStorage.setItem('hmsBooking:' + t, JSON.stringify(summary));\n                    } catch {}\n                    // Pass gross amount in query (PaymentConfirm will apply discount from summary)\n                    const q = [`token=${encodeURIComponent(t)}`, `code=${encodeURIComponent(summary.code)}`, `amount=${encodeURIComponent(grossAmount)}`, `hid=${encodeURIComponent(summary.hotelId || '')}`, `rn=${encodeURIComponent(roomNames)}`, `rt=${encodeURIComponent(summary.roomType || '')}`, `ci=${encodeURIComponent(summary.checkIn || '')}`, `co=${encodeURIComponent(summary.checkOut || '')}`, `ad=${encodeURIComponent(summary.adults)}`, `ch=${encodeURIComponent(summary.children)}`].join('&');\n                    window.location.href = '/payment/confirm?' + q;\n                  },\n                  children: \"THANH TO\\xC1N\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 620,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 618,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 528,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 523,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 522,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 9\n    }, this), showReviews && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"qr-overlay\",\n      onClick: () => setShowReviews(false),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"qr-box\",\n        onClick: e => e.stopPropagation(),\n        style: {\n          width: 680,\n          maxWidth: '96%'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"qr-title\",\n          style: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"\\u0110\\xE1nh gi\\xE1 ph\\xF2ng\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 667,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"qr-close\",\n            onClick: () => setShowReviews(false),\n            children: \"\\u0110\\xF3ng\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 668,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 666,\n          columnNumber: 13\n        }, this), reviews.loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: 10,\n            color: '#666'\n          },\n          children: \"\\u0110ang t\\u1EA3i \\u0111\\xE1nh gi\\xE1...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 671,\n          columnNumber: 15\n        }, this) : reviews.error ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: 10,\n            color: '#b42318'\n          },\n          children: reviews.error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 673,\n          columnNumber: 15\n        }, this) : reviews.list.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: 10,\n            color: '#666'\n          },\n          children: \"Ch\\u01B0a c\\xF3 \\u0111\\xE1nh gi\\xE1 n\\xE0o cho ph\\xF2ng n\\xE0y.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 675,\n          columnNumber: 15\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'left'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 800,\n              margin: '4px 0 10px'\n            },\n            children: [\"Trung b\\xECnh: \", reviews.avg.toFixed(1), \" / 5.0 \\u2605\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 678,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              maxHeight: 360,\n              overflowY: 'auto'\n            },\n            children: reviews.list.map(rv => /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                borderTop: '1px solid #eee',\n                padding: '8px 0'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'space-between'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    fontWeight: 700\n                  },\n                  children: rv.user || 'Khách'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 683,\n                  columnNumber: 25\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  style: {\n                    fontWeight: 700,\n                    color: '#444'\n                  },\n                  children: [Number(rv.rating || 0).toFixed(1), \" / 5.0 \\u2605\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 684,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 682,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  color: '#555',\n                  marginTop: 4\n                },\n                children: rv.comment || '(Không có nhận xét)'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 686,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  color: '#888',\n                  fontSize: 12,\n                  marginTop: 4\n                },\n                children: [rv.hotelName, rv.roomName ? ` • Phòng ${rv.roomName}` : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 687,\n                columnNumber: 23\n              }, this)]\n            }, rv.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 681,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 679,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 677,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 665,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 664,\n      columnNumber: 9\n    }, this), zoomUrl && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rt-zoom\",\n      onClick: () => setZoomUrl(''),\n      children: /*#__PURE__*/_jsxDEV(\"img\", {\n        src: zoomUrl,\n        alt: \"Xem \\u1EA3nh ph\\xF2ng\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 698,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 697,\n      columnNumber: 9\n    }, this), showPromosList && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"qr-overlay\",\n      onClick: () => setShowPromosList(false),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"qr-box\",\n        onClick: e => e.stopPropagation(),\n        style: {\n          width: 620,\n          maxWidth: '96%'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"qr-title\",\n          style: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Danh s\\xE1ch \\u01AFu \\u0111\\xE3i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 706,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"qr-close\",\n            onClick: () => setShowPromosList(false),\n            children: \"\\u0110\\xF3ng\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 707,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 705,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            maxHeight: 420,\n            overflowY: 'auto',\n            padding: 8\n          },\n          children: availablePromos.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              padding: 12,\n              color: '#666'\n            },\n            children: \"Kh\\xF4ng c\\xF3 \\u01B0u \\u0111\\xE3i n\\xE0o.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 711,\n            columnNumber: 17\n          }, this) : availablePromos.map(p => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              borderBottom: '1px solid #eee',\n              padding: 10,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontWeight: 700\n                },\n                children: [p.code, \" \", p.description ? `— ${p.description}` : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 716,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  color: '#555',\n                  fontSize: 13\n                },\n                children: [p.discountType === 'PERCENT' ? `Giảm ${p.discountValue}%${p.maxDiscount ? ` (tối đa ${Number(p.maxDiscount).toLocaleString('vi-VN')}đ)` : ''}` : `Giảm ${Number(p.discountValue || 0).toLocaleString('vi-VN')}đ`, p.minOrderAmount ? ` • Điều kiện: tối thiểu ${Number(p.minOrderAmount).toLocaleString('vi-VN')}đ` : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 717,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 715,\n              columnNumber: 21\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                gap: 8\n              },\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"ph-btn\",\n                onClick: async () => {\n                  // Validate selected promo against current totalPrice so we can show discount immediately\n                  try {\n                    const normalized = await validatePromoServer(p.code);\n                    setAppliedPromo(normalized);\n                    setPromoCode(normalized.code);\n                    setShowPromosList(false);\n                    flashTotal();\n                    alert('Đã chọn ưu đãi: ' + normalized.code + ' • Giảm ' + normalized.discount.toLocaleString('vi-VN') + 'đ');\n                  } catch (e) {\n                    alert(e.message || 'Không áp dụng được ưu đãi này');\n                  }\n                },\n                children: \"Ch\\u1ECDn\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 723,\n                columnNumber: 23\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 722,\n              columnNumber: 21\n            }, this)]\n          }, p.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 714,\n            columnNumber: 19\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 709,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 704,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 703,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 244,\n    columnNumber: 5\n  }, this);\n}\n_s(RoomTypeInline, \"2lnZ5XWEaRq/cjnlWjOfBzdcyUs=\");\n_c = RoomTypeInline;\nvar _c;\n$RefreshReg$(_c, \"RoomTypeInline\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","useRef","getUserRole","getUserEmail","isLoggedIn","showToast","jsxDEV","_jsxDEV","RoomTypeInline","name","onClose","_s","_data$roomType2","_data$roomType4","_data$roomType5","_data$roomType6","data","setData","roomType","rooms","loading","setLoading","error","setError","dateRange","setDateRange","checkIn","checkOut","roomCount","setRoomCount","selectedIndex","setSelectedIndex","selectedMap","setSelectedMap","zoomUrl","setZoomUrl","galleryIndex","setGalleryIndex","showDetails","setShowDetails","showCheckout","setShowCheckout","promoCode","setPromoCode","availablePromos","setAvailablePromos","showPromosList","setShowPromosList","appliedPromo","setAppliedPromo","showCheckoutDetails","setShowCheckoutDetails","payMethod","setPayMethod","promoLoading","setPromoLoading","promoLoadError","setPromoLoadError","flashTotalRef","role","isAdmin","String","toLowerCase","includes","agree","setAgree","showReviews","setShowReviews","reviews","setReviews","list","avg","active","params","URLSearchParams","set","Date","now","fetch","encodeURIComponent","toString","cache","then","res","ok","j","json","catch","Error","message","status","err","finally","selectedRoom","galleryImages","arr","image","push","selectedIds","Object","keys","map","id","Number","selectedRooms","filter","r","nights","inD","outD","ms","setHours","Math","ceil","baseSum","reduce","s","basePrice","totalPrice","selectedHotelIds","Array","from","Set","hotelId","HotelId","Boolean","totalGuests","sum","sel","adults","children","isValidDates","today","getFullYear","getMonth","getDate","pad2","n","padStart","fmtDate","d","todayLocal","minCheckInDate","minCheckInStr","minCheckOutStr","dateError","loggedIn","baseReady","length","canBook","canPay","max","ids","keep","slice","next","forEach","validatePromoServer","code","_data$roomType","_ref","_promo$discountValue","q","URL","window","location","origin","searchParams","trim","isArray","join","t","console","log","promo","serverDiscount","discount","serverFinal","final","dType","discountType","dVal","discountValue","every","h","toUpperCase","raw","serverRaw","e","promoHotel","type","duration","flashTotal","els","a","document","querySelectorAll","x","el","classList","add","clearTimeout","current","setTimeout","remove","toggleSelectRoom","room","isSelected","updateCounts","kind","value","className","fileName","_jsxFileName","lineNumber","columnNumber","min","onChange","newIn","target","v","newOut","style","color","fontSize","marginTop","disabled","onClick","idx","hasDates","isBooked","adultsMax","maxAdults","childrenMax","maxChildren","adultsVal","childrenVal","src","alt","roomNumber","cursor","display","alignItems","gap","floor","title","toLocaleString","_","i","_sel$adults","_sel$children","_data$roomType3","avgRating","whiteSpace","onMouseEnter","currentTarget","setAttribute","onMouseLeave","removeAttribute","marginBottom","position","borderRadius","overflow","height","background","width","objectFit","justifyContent","description","alert","fontWeight","margin","_sel$adults2","_sel$children2","flexWrap","placeholder","padding","border","normalized","_data$roomType7","promoUrl","txt","text","items","flexDirection","checked","_data$roomType8","_data$roomType9","_data$roomType0","random","totals","acc","ad","ch","nowD","bookingCode","roomNames","userEmail","u","localStorage","getItem","JSON","parse","email","grossAmount","promoData","summary","token","hotel","hotelName","checkInTime","checkOutTime","number","price","amount","setItem","stringify","href","stopPropagation","maxWidth","textAlign","toFixed","maxHeight","overflowY","rv","borderTop","user","rating","comment","roomName","p","borderBottom","maxDiscount","minOrderAmount","_c","$RefreshReg$"],"sources":["D:/DA_TichHop/HMS_AI Hotel/client/src/RoomTypeInline.js"],"sourcesContent":["import React, { useEffect, useMemo, useState, useRef } from 'react';\r\nimport { getUserRole, getUserEmail, isLoggedIn } from './auth';\r\nimport './HomePage.css';\r\nimport showToast from './toast';\r\n\r\nexport default function RoomTypeInline({ name, onClose }) {\r\n  const [data, setData] = useState({ roomType: null, rooms: [] });\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [dateRange, setDateRange] = useState({ checkIn: '', checkOut: '' });\r\n  const [roomCount, setRoomCount] = useState(1);\r\n  // Promotions feature removed\r\n  const [selectedIndex, setSelectedIndex] = useState(-1);\r\n  const [selectedMap, setSelectedMap] = useState({});\r\n  const [zoomUrl, setZoomUrl] = useState('');\r\n  const [galleryIndex, setGalleryIndex] = useState(0);\r\n  const [showDetails, setShowDetails] = useState(false);\r\n  const [showCheckout, setShowCheckout] = useState(false);\r\n  const [promoCode, setPromoCode] = useState('');\r\n  const [availablePromos, setAvailablePromos] = useState([]);\r\n  const [showPromosList, setShowPromosList] = useState(false);\r\n  const [appliedPromo, setAppliedPromo] = useState(null);\r\n  const [showCheckoutDetails, setShowCheckoutDetails] = useState(false);\r\n  const [payMethod, setPayMethod] = useState('MOMO');\r\n  const [promoLoading, setPromoLoading] = useState(false);\r\n  const [promoLoadError, setPromoLoadError] = useState('');\r\n  const flashTotalRef = useRef(null);\r\n  const role = getUserRole();\r\n  const isAdmin = useMemo(() => { try { return String(role||'').toLowerCase().includes('admin'); } catch { return false; } }, [role]);\r\n  const [agree, setAgree] = useState(false);\r\n  // QR flow removed – only direct redirect payment flow retained\r\n  const [showReviews, setShowReviews] = useState(false);\r\n  const [reviews, setReviews] = useState({ list: [], avg: 0, loading: false, error: '' });\r\n\r\n  // Removed QR base URL detection effect\r\n\r\n  useEffect(() => {\r\n    if (!name) return;\r\n    let active = true;\r\n    setLoading(true);\r\n    setError('');\r\n    setSelectedIndex(-1);\r\n    setSelectedMap({});\r\n    const params = new URLSearchParams();\r\n    if (dateRange.checkIn) params.set('checkIn', dateRange.checkIn);\r\n    if (dateRange.checkOut) params.set('checkOut', dateRange.checkOut);\r\n  // Cache bust: ensure fresh status for red/yellow/green dots\r\n  params.set('_', String(Date.now()));\r\n  fetch(`/api/room-types/${encodeURIComponent(name)}/rooms${params.toString() ? ('?' + params.toString()) : ''}`, { cache: 'no-store' })\r\n      .then(async (res) => {\r\n        if (!res.ok) {\r\n          const j = await res.json().catch(() => ({}));\r\n          throw new Error(j.message || `HTTP ${res.status}`);\r\n        }\r\n        return res.json();\r\n      })\r\n      .then((j) => { if (active) setData(j); })\r\n      .catch((err) => { if (active) setError(err.message || 'Lỗi tải dữ liệu'); })\r\n      .finally(() => { if (active) setLoading(false); });\r\n    return () => { active = false; };\r\n  }, [name, dateRange.checkIn, dateRange.checkOut]);\r\n\r\n  const selectedRoom = useMemo(() => data.rooms[selectedIndex] || null, [data.rooms, selectedIndex]);\r\n  const galleryImages = useMemo(() => {\r\n    if (!selectedRoom) return [];\r\n    const arr = [];\r\n    if (selectedRoom.image) arr.push(selectedRoom.image);\r\n    return arr;\r\n  }, [selectedRoom]);\r\n  const selectedIds = useMemo(() => Object.keys(selectedMap).map(id => Number(id)), [selectedMap]);\r\n  const selectedRooms = useMemo(() => data.rooms.filter(r => selectedIds.includes(r.id)), [data.rooms, selectedIds]);\r\n  const nights = useMemo(() => {\r\n    if (!dateRange.checkIn || !dateRange.checkOut) return 0;\r\n    const inD = new Date(dateRange.checkIn);\r\n    const outD = new Date(dateRange.checkOut);\r\n    const ms = outD.setHours(0, 0, 0, 0) - inD.setHours(0, 0, 0, 0);\r\n    return ms > 0 ? Math.ceil(ms / (1000 * 60 * 60 * 24)) : 0;\r\n  }, [dateRange]);\r\n  const baseSum = useMemo(() => selectedRooms.reduce((s, r) => s + Number(r.basePrice || 0), 0), [selectedRooms]);\r\n  const totalPrice = useMemo(() => baseSum * (nights || 0), [baseSum, nights]);\r\n  // Helper to detect multiple hotel IDs chosen (defensive)\r\n  const selectedHotelIds = useMemo(() => {\r\n    try { return Array.from(new Set(selectedRooms.map(r=> r.hotelId || r.HotelId).filter(Boolean))); } catch { return []; }\r\n  }, [selectedRooms]);\r\n  const totalGuests = useMemo(() => selectedRooms.reduce((sum, r) => {\r\n    const sel = selectedMap[String(r.id)] || { adults: 0, children: 0 };\r\n    return sum + Number(sel.adults || 0) + Number(sel.children || 0);\r\n  }, 0), [selectedRooms, selectedMap]);\r\n  const now = new Date();\r\n  const isValidDates = useMemo(() => {\r\n    if (!dateRange.checkIn || !dateRange.checkOut) return false;\r\n    const inD = new Date(dateRange.checkIn);\r\n    const outD = new Date(dateRange.checkOut);\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    // allow check-in equal to today, checkout must be after check-in\r\n    return inD >= today && outD > inD;\r\n  }, [dateRange, now]);\r\n\r\n  // Helpers for date inputs and warnings\r\n  const pad2 = (n) => String(n).padStart(2, '0');\r\n  const fmtDate = (d) => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;\r\n  const todayLocal = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n  // allow selecting today as check-in (min = today)\r\n  const minCheckInDate = new Date(todayLocal.getFullYear(), todayLocal.getMonth(), todayLocal.getDate());\r\n  const minCheckInStr = fmtDate(minCheckInDate);\r\n  const minCheckOutStr = useMemo(() => {\r\n    if (dateRange.checkIn) {\r\n      const inD = new Date(dateRange.checkIn);\r\n      const d = new Date(inD.getFullYear(), inD.getMonth(), inD.getDate() + 1);\r\n      return fmtDate(d);\r\n    }\r\n    const d = new Date(minCheckInDate.getFullYear(), minCheckInDate.getMonth(), minCheckInDate.getDate() + 1);\r\n    return fmtDate(d);\r\n  }, [dateRange.checkIn, now]);\r\n\r\n  const dateError = useMemo(() => {\r\n    if (!dateRange.checkIn || !dateRange.checkOut) return '';\r\n    const inD = new Date(dateRange.checkIn);\r\n    const outD = new Date(dateRange.checkOut);\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    if (!(inD >= today)) return 'Ngày nhận phải là hôm nay hoặc ngày sau';\r\n    if (!(outD > inD)) return 'Ngày trả phải sau ngày nhận';\r\n    return '';\r\n  }, [dateRange, now]);\r\n  const loggedIn = isLoggedIn();\r\n  // Điều kiện dữ liệu đã đủ (không xét đăng nhập)\r\n  const baseReady = useMemo(() => selectedRooms.length > 0 && totalGuests > 1 && isValidDates && nights > 0, [selectedRooms.length, totalGuests, isValidDates, nights]);\r\n  // Điều kiện thực sự có thể mở checkout\r\n  const canBook = loggedIn && baseReady;\r\n  const canPay = useMemo(() => canBook && agree && !!payMethod, [canBook, agree, payMethod]);\r\n\r\n  useEffect(() => {\r\n    // If reduced roomCount below current selected, trim selection deterministically\r\n    const max = Math.max(1, Number(roomCount || 1));\r\n    const ids = Object.keys(selectedMap);\r\n    if (ids.length > max) {\r\n      const keep = new Set(ids.slice(0, max));\r\n      const next = {};\r\n      ids.slice(0, max).forEach(id => { next[id] = selectedMap[id]; });\r\n      setSelectedMap(next);\r\n    }\r\n  }, [roomCount]);\r\n\r\n  // Helper: validate promo code with server and return normalized promo object\r\n  const validatePromoServer = async (code) => {\r\n    if (!code) throw new Error('Thiếu mã');\r\n    try {\r\n  const q = new URL('/api/promotions/validate', window.location.origin);\r\n  q.searchParams.set('code', String(code).trim());\r\n  q.searchParams.set('amount', String(totalPrice || 0));\r\n  if (data?.roomType?.hotelId) q.searchParams.set('hotelId', String(data.roomType.hotelId));\r\n      if (Array.isArray(selectedRooms) && selectedRooms.length) {\r\n        q.searchParams.set('roomIds', selectedRooms.map(r=>r.id).join(','));\r\n      }\r\n      const r = await fetch(q.toString());\r\n      if (!r.ok) { const t = await r.json().catch(()=>({})); throw new Error(t.message || 'Mã không hợp lệ'); }\r\n      const j = await r.json();\r\n      console.log('[promo validate] server response:', j, 'gross:', totalPrice);\r\n      // Normalize and compute discount client-side according to rules when promo object is present\r\n      // Prefer server-provided numbers (authoritative). Fall back to minimal local normalization.\r\n      const promo = j.promo || {};\r\n      const serverDiscount = typeof j.discount !== 'undefined' ? Number(j.discount) : null;\r\n      const serverFinal = typeof j.final !== 'undefined' ? Number(j.final) : null;\r\n      const dType = promo.discountType || j.discountType || null;\r\n      const dVal = Number(promo.discountValue ?? j.discount ?? 0);\r\n      // Enforce hotel mismatch (defensive — server should reject already)\r\n      if (promo && promo.hotelId && selectedHotelIds.length && !selectedHotelIds.every(h => Number(h) === Number(promo.hotelId))) {\r\n        throw new Error('Mã ưu đãi không áp dụng cho các phòng đã chọn');\r\n      }\r\n      return {\r\n        code: (j.code || promo.code || String(code)).toString().toUpperCase(),\r\n        discount: serverDiscount !== null ? serverDiscount : Number(0),\r\n        discountType: dType,\r\n        discountValue: Number(dVal || 0),\r\n        final: serverFinal !== null ? serverFinal : Number(0),\r\n        raw: promo || null,\r\n        serverRaw: j\r\n      };\r\n    } catch (e) { throw e; }\r\n  };\r\n\r\n  // Auto-drop appliedPromo if user changes selection sang hotel khác hoặc promo hotel mismatch\r\n  useEffect(() => {\r\n    try {\r\n      if (!appliedPromo || !appliedPromo.raw) return;\r\n      const promoHotel = appliedPromo.raw.hotelId || appliedPromo.raw.HotelId || null;\r\n      if (promoHotel && selectedHotelIds.length && !selectedHotelIds.every(h => Number(h) === Number(promoHotel))) {\r\n        setAppliedPromo(null);\r\n        showToast('Đã gỡ mã ưu đãi không còn phù hợp (khách sạn khác)', { type:'warning', duration:2500 });\r\n      }\r\n    } catch { /* ignore */ }\r\n  }, [selectedHotelIds]);\r\n\r\n  function flashTotal() {\r\n    try {\r\n      // target possible total elements in summary/checkout\r\n      const els = [];\r\n      const a = document.querySelectorAll('.rt-summary-total span:last-child, .checkout-total span:last-child');\r\n      a.forEach(x => els.push(x));\r\n      if (!els.length) return;\r\n      els.forEach(el => {\r\n        el.classList.add('total-highlight');\r\n        el.classList.add('apply');\r\n      });\r\n      clearTimeout(flashTotalRef.current);\r\n      flashTotalRef.current = setTimeout(() => {\r\n        els.forEach(el => el.classList.remove('apply'));\r\n      }, 600);\r\n    } catch (e) { /* ignore */ }\r\n  }\r\n\r\n  const toggleSelectRoom = (room) => {\r\n    const id = String(room.id);\r\n    const isSelected = !!selectedMap[id];\r\n    if (isSelected) {\r\n      const next = { ...selectedMap };\r\n      delete next[id];\r\n      setSelectedMap(next);\r\n      return;\r\n    }\r\n    const max = Math.max(1, Number(roomCount || 1));\r\n    const ids = Object.keys(selectedMap);\r\n    if (ids.length >= max) {\r\n      if (max === 1) {\r\n        // replace existing selection with the new room\r\n        setSelectedMap({ [id]: { adults: 0, children: 0 } });\r\n      } else {\r\n        return; // reach limit for multi-selection\r\n      }\r\n    } else {\r\n      setSelectedMap({ ...selectedMap, [id]: { adults: 0, children: 0 } });\r\n    }\r\n  };\r\n\r\n  const updateCounts = (room, kind, value) => {\r\n    const id = String(room.id);\r\n    if (!selectedMap[id]) return;\r\n    setSelectedMap({ ...selectedMap, [id]: { ...selectedMap[id], [kind]: Number(value) } });\r\n  };\r\n\r\n  if (!name) return null;\r\n\r\n  return (\r\n    <section className=\"rt-inline\">\r\n      <div className=\"rt-toolbar\">\r\n        <div className=\"rt-field rt-field--wide\">\r\n          <label>Ngày nhận - trả phòng</label>\r\n          <div className=\"rt-date-group\">\r\n            <input\r\n              type=\"date\"\r\n              min={minCheckInStr}\r\n              aria-invalid={dateRange.checkIn ? (new Date(dateRange.checkIn) <= todayLocal) : false}\r\n              value={dateRange.checkIn}\r\n              onChange={(e) => {\r\n                const newIn = e.target.value;\r\n                setDateRange((v) => {\r\n                  let newOut = v.checkOut;\r\n                  if (newOut && !(new Date(newOut) > new Date(newIn))) {\r\n                    newOut = '';\r\n                  }\r\n                  return { ...v, checkIn: newIn, checkOut: newOut };\r\n                });\r\n              }}\r\n            />\r\n            <input\r\n              type=\"date\"\r\n              min={minCheckOutStr}\r\n              aria-invalid={dateRange.checkOut && dateRange.checkIn ? (new Date(dateRange.checkOut) <= new Date(dateRange.checkIn)) : false}\r\n              value={dateRange.checkOut}\r\n              onChange={(e) => setDateRange(v => ({ ...v, checkOut: e.target.value }))}\r\n            />\r\n          </div>\r\n          {dateError && (\r\n            <div className=\"rt-date-error\" style={{ color: '#d93025', fontSize: 12, marginTop: 6 }}>{dateError}</div>\r\n          )}\r\n        </div>\r\n        <div className=\"rt-field\">\r\n          <label>Số phòng</label>\r\n          <input type=\"number\" min={1} value={roomCount} onChange={(e) => setRoomCount(Math.max(1, Number(e.target.value)))} />\r\n        </div>\r\n        {/* Promotion input removed */}\r\n  <button className=\"rt-search-btn\" disabled={!dateRange.checkIn || !dateRange.checkOut || !isValidDates}>TÌM KIẾM</button>\r\n        {onClose && <button className=\"rt-close-btn\" onClick={onClose}>ĐÓNG</button>}\r\n      </div>\r\n\r\n      {loading && <div>Đang tải...</div>}\r\n      {error && <div style={{ color: 'red' }}>{error}</div>}\r\n\r\n      {!loading && !error && (\r\n        <div className=\"rt-grid\">\r\n          <section className=\"rt-list\">\r\n            <div className=\"rt-legend\">\r\n              <span className=\"rt-legend-item\"><span className=\"rt-status-dot red\"></span> Đã được đặt</span>\r\n              <span className=\"rt-legend-item\"><span className=\"rt-status-dot yellow\"></span> Đang được đặt</span>\r\n              <span className=\"rt-legend-item\"><span className=\"rt-status-dot green\"></span> Trống</span>\r\n            </div>\r\n            {data.rooms.length === 0 ? (\r\n              <div>Chưa có phòng nào thuộc hạng phòng này.</div>\r\n            ) : (\r\n              data.rooms.map((r, idx) => {\r\n                const isSelected = !!selectedMap[String(r.id)];\r\n                const hasDates = !!(dateRange.checkIn && dateRange.checkOut);\r\n                const isBooked = hasDates ? !!r.isBooked : (r.status === 'Occupied');\r\n                const adultsMax = Number(r.maxAdults || 0);\r\n                const childrenMax = Number(r.maxChildren || 0);\r\n                const adultsVal = isSelected ? selectedMap[String(r.id)].adults : 0;\r\n                const childrenVal = isSelected ? selectedMap[String(r.id)].children : 0;\r\n                return (\r\n                  <div className={`rt-card ${isSelected ? 'selected' : ''}`} key={r.id}>\r\n                    <div className=\"rt-main\">\r\n                      <div className=\"rt-thumb\">\r\n                        {r.image && <img src={r.image} alt={r.roomNumber} onClick={() => setZoomUrl(r.image)} />}\r\n                      </div>\r\n                      <div className=\"rt-info\">\r\n                        <h3 className=\"rt-name\" onClick={() => { setSelectedIndex(idx); setGalleryIndex(0); setShowDetails(true); }} style={{ cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                          <span>{`Phòng ${r.roomNumber}${r.floor != null ? ` * Tầng ${r.floor}` : ''}`}</span>\r\n                          <span className={`rt-status-dot ${isBooked ? 'red' : isSelected ? 'yellow' : 'green'}`} title={isBooked ? 'Đã đặt' : isSelected ? 'Đang đặt' : 'Trống'}></span>\r\n                        </h3>\r\n                        <div className=\"rt-cap\">Tối đa {adultsMax} người lớn | {childrenMax} trẻ em</div>\r\n                        <div className=\"rt-price\">Giá từ {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                      </div>\r\n                      <div className=\"rt-actions\">\r\n                        <button\r\n                            type=\"button\"\r\n                            className=\"rt-choose\"\r\n                            onClick={() => { if (isAdmin) { showToast('Tài khoản Admin không được chọn phòng', { duration: 2000, type: 'warn' }); return; } if (isBooked) return; toggleSelectRoom(r); }}\r\n                            disabled={isBooked || isAdmin}\r\n                            title={isAdmin ? 'Tài khoản Admin không được chọn phòng' : (isBooked ? 'Phòng đã được đặt trong khoảng thời gian này' : '')}\r\n                          >\r\n                            {isBooked ? 'ĐÃ ĐẶT' : (isSelected ? 'BỎ CHỌN' : 'CHỌN')}\r\n                          </button>\r\n                      </div>\r\n                    </div>\r\n                    {isSelected && (\r\n                      <div className=\"rt-extra\">\r\n                        <div className=\"rt-note-row\">\r\n                          <div className=\"rt-note\">Đã bao gồm ăn sáng • Không hoàn trả phí khi hủy phòng</div>\r\n                          <div className=\"rt-selects\">\r\n                            <label>\r\n                              Chọn số người lớn\r\n                              <select value={adultsVal} onChange={(e) => updateCounts(r, 'adults', e.target.value)}>\r\n                                {Array.from({ length: adultsMax + 1 }, (_, i) => <option key={i} value={i}>{i}</option>)}\r\n                              </select>\r\n                            </label>\r\n                            <label>\r\n                              . Trẻ em\r\n                              <select value={childrenVal} onChange={(e) => updateCounts(r, 'children', e.target.value)}>\r\n                                {Array.from({ length: childrenMax + 1 }, (_, i) => <option key={i} value={i}>{i}</option>)}\r\n                              </select>\r\n                            </label>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"rt-price-2\">Giá từ {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })\r\n            )}\r\n          </section>\r\n\r\n          <aside className=\"rt-detail\">\r\n            {/* Booking info view (default) */}\r\n            {(!showDetails || !(selectedIndex >= 0 && selectedRoom)) && !showCheckout && (\r\n              <div className=\"rt-detail-inner\">\r\n                <div className=\"rt-summary\">\r\n                  <div className=\"rt-summary-title\" style={{ cursor: selectedRoom ? 'pointer' : 'default' }}\r\n                    onClick={() => { if (selectedRoom) setShowDetails(true); }}>\r\n                    Thông tin đặt phòng\r\n                  </div>\r\n                  <div className=\"rt-summary-hotel\">{data.roomType?.name || name}</div>\r\n                  <div className=\"rt-summary-dates\">{dateRange.checkIn || 'dd/mm/yyyy'} - {dateRange.checkOut || 'dd/mm/yyyy'}</div>\r\n                  <div className=\"rt-summary-sep\" />\r\n                  <div className=\"rt-summary-title\">Thông tin phòng</div>\r\n                  <div className=\"rt-summary-list\">\r\n                    {selectedRooms.length === 0 ? (\r\n                      <div className=\"rt-summary-line\">Chưa chọn phòng</div>\r\n                    ) : (\r\n                      selectedRooms.map((r) => {\r\n                        const sel = selectedMap[String(r.id)];\r\n                        return (\r\n                          <div key={r.id} className=\"rt-summary-room\">\r\n                            <div className=\"rt-summary-line\">Phòng: {r.roomNumber}{r.floor != null ? ` • Tầng ${r.floor}` : ''}</div>\r\n                            <div className=\"rt-summary-line\">Người lớn: {sel?.adults ?? 0}</div>\r\n                            <div className=\"rt-summary-line\">Trẻ em: {sel?.children ?? 0}</div>\r\n                            <div className=\"rt-summary-line\">Giá: {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                          </div>\r\n                        );\r\n                      })\r\n                    )}\r\n                  </div>\r\n                  <div className=\"rt-summary-sep\" />\r\n                  {!baseReady && (\r\n                    <div className=\"rt-warning\">Lưu ý: Hãy chọn phòng, Ngày nhận - ngày trả, và số lượng khách (tổng &gt; 1) để chuẩn bị đặt phòng.</div>\r\n                  )}\r\n                  {baseReady && !loggedIn && (\r\n                    <div className=\"rt-warning\">Bạn đã chọn đủ thông tin. Vui lòng đăng nhập để tiếp tục đặt phòng.</div>\r\n                  )}\r\n                  <div className=\"rt-summary-total\">\r\n                    <span>Tổng cộng ({nights} đêm)</span>\r\n                    <span>{Number(totalPrice).toLocaleString('vi-VN')} VND</span>\r\n                  </div>\r\n                    <div className=\"rt-actions-vertical\">\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"rt-review-btn\"\r\n                      onClick={async ()=>{\r\n                        setShowReviews(true);\r\n                        setReviews(r=>({ ...r, loading: true, error: '' }));\r\n                        try {\r\n                          const params = new URLSearchParams();\r\n                          if (selectedRoom) params.set('roomId', String(selectedRoom.id)); else params.set('roomType', data.roomType?.name || name);\r\n                          params.set('_', String(Date.now()));\r\n                          const res = await fetch(`/api/public-reviews?${params.toString()}`, { cache: 'no-store' });\r\n                          if (!res.ok) throw new Error('Không tải được đánh giá');\r\n                          const j = await res.json();\r\n                          setReviews({ list: Array.isArray(j.reviews)? j.reviews: [], avg: Number(j.avgRating||0), loading: false, error: '' });\r\n                        } catch (e) {\r\n                          setReviews({ list: [], avg: 0, loading: false, error: e.message || 'Lỗi tải đánh giá' });\r\n                        }\r\n                      }}\r\n                      style={{ whiteSpace: 'nowrap' }}\r\n                    >\r\n                      xem đánh giá\r\n                    </button>\r\n                    <button\r\n                      className={`rt-book-btn ${baseReady ? 'enabled' : ''} ${canBook ? 'can-book' : ''}`}\r\n                      disabled={!baseReady || isAdmin}\r\n                      onClick={() => {\r\n                        if (isAdmin) { showToast('Tài khoản Admin không được phép đặt phòng', { duration: 2200, type: 'warn' }); return; }\r\n                        if (!loggedIn) return; // chỉ không mở checkout\r\n                        setShowCheckoutDetails(false); setShowCheckout(true);\r\n                      }}\r\n                      onMouseEnter={(e) => {\r\n                        if (baseReady && !loggedIn) {\r\n                          e.currentTarget.setAttribute('data-tip', 'Vui lòng Đăng nhập để đặt phòng!');\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => { e.currentTarget.removeAttribute('data-tip'); }}\r\n                    >\r\n                      {canBook ? 'ĐẶT PHÒNG' : (baseReady ? 'ĐẶT PHÒNG' : 'ĐẶT PHÒNG')}\r\n                      {!loggedIn && baseReady && <span className=\"rt-btn-hint\"> (Đăng nhập để tiếp tục)</span>}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Details view (shown when title clicked) */}\r\n            {showDetails && !showCheckout && selectedIndex >= 0 && selectedRoom && (\r\n              <div className=\"rt-detail-inner\">\r\n                <div className=\"rt-summary\">\r\n                  <div className=\"rt-summary-title\" style={{ cursor: 'pointer' }} onClick={() => setShowDetails(false)}>\r\n                    Chi tiết phòng (nhấn để quay lại đặt phòng)\r\n                  </div>\r\n                  <div className=\"rt-gallery\" style={{ marginBottom: 10 }}>\r\n                    <div style={{ position: 'relative', borderRadius: 8, overflow: 'hidden', height: 180, background: '#f5f5f5' }}>\r\n                      {galleryImages.length > 0 && (\r\n                        <img src={galleryImages[galleryIndex % galleryImages.length]} alt=\"Ảnh phòng\" style={{ width: '100%', height: '100%', objectFit: 'cover', display: 'block' }} />\r\n                      )}\r\n                    </div>\r\n                    <div className=\"rt-gallery-controls\" style={{ display: 'flex', justifyContent: 'center', gap: 10, marginTop: 8 }}>\r\n                      <button type=\"button\" className=\"btn\" disabled={galleryImages.length <= 1} onClick={() => setGalleryIndex((i) => (i - 1 + galleryImages.length) % galleryImages.length)}>{'<'}</button>\r\n                      <button type=\"button\" className=\"btn\" disabled={galleryImages.length <= 1} onClick={() => setGalleryIndex((i) => (i + 1) % galleryImages.length)}>{'>'}</button>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"rt-summary-list\">\r\n                    <div className=\"rt-summary-line\">Số phòng: {selectedRoom.roomNumber}</div>\r\n                    {selectedRoom.floor != null && (\r\n                      <div className=\"rt-summary-line\">Tầng: {selectedRoom.floor}</div>\r\n                    )}\r\n                    {typeof selectedRoom.status !== 'undefined' && (\r\n                      <div className=\"rt-summary-line\">Trạng thái: {String(selectedRoom.status)}</div>\r\n                    )}\r\n                    <div className=\"rt-summary-line\">Loại phòng: {data.roomType?.name || name}</div>\r\n                    <div className=\"rt-summary-line\">Sức chứa: {Number(selectedRoom.maxAdults || 0)} người lớn, {Number(selectedRoom.maxChildren || 0)} trẻ em</div>\r\n                    <div className=\"rt-summary-line\">Giá cơ bản: {Number(selectedRoom.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                    {data.roomType?.description && (\r\n                      <div className=\"rt-summary-line\">Mô tả: {data.roomType.description}</div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"rt-summary-sep\" />\r\n                    <div className=\"rt-actions-vertical\">\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"rt-review-btn\"\r\n                      onClick={async ()=>{\r\n                        setShowReviews(true);\r\n                        setReviews(r=>({ ...r, loading: true, error: '' }));\r\n                        try {\r\n                          const params = new URLSearchParams();\r\n                          params.set('roomId', String(selectedRoom.id));\r\n                          params.set('_', String(Date.now()));\r\n                          const res = await fetch(`/api/public-reviews?${params.toString()}`, { cache: 'no-store' });\r\n                          if (!res.ok) throw new Error('Không tải được đánh giá');\r\n                          const j = await res.json();\r\n                          setReviews({ list: Array.isArray(j.reviews)? j.reviews: [], avg: Number(j.avgRating||0), loading: false, error: '' });\r\n                        } catch (e) {\r\n                          setReviews({ list: [], avg: 0, loading: false, error: e.message || 'Lỗi tải đánh giá' });\r\n                        }\r\n                      }}\r\n                      style={{ whiteSpace: 'nowrap' }}\r\n                    >\r\n                      xem đánh giá\r\n                    </button>\r\n                    <button\r\n                      className={`rt-book-btn ${baseReady ? 'enabled' : ''}`}\r\n                      onClick={() => { if (isAdmin) { alert('Tài khoản Admin không được phép đặt phòng'); return; } if (!loggedIn) return; setShowDetails(false); setShowCheckoutDetails(false); setShowCheckout(true); }}\r\n                      disabled={!baseReady || isAdmin}\r\n                      onMouseEnter={(e) => { if (baseReady && !loggedIn) e.currentTarget.setAttribute('data-tip', 'Vui lòng Đăng nhập để đặt phòng!'); }}\r\n                      onMouseLeave={(e) => e.currentTarget.removeAttribute('data-tip')}\r\n                    >\r\n                      {canBook ? 'ĐẶT PHÒNG' : 'ĐẶT PHÒNG'}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Checkout view */}\r\n            {showCheckout && (\r\n              <div className=\"rt-detail-inner\">\r\n                <div className=\"checkout-panel\">\r\n                  <div className=\"checkout-main-title\">Thanh Toán</div>\r\n                  <div className=\"checkout-header\">\r\n                    <div className=\"checkout-title\">Thông Tin Đặt Phòng</div>\r\n                  </div>\r\n                  <div className=\"checkout-body\">\r\n                    <div style={{ fontWeight: 800, marginBottom: 4 }}>{data.roomType?.name || name}</div>\r\n                    <div style={{ color: '#555', marginBottom: 8 }}>{(dateRange.checkIn || 'dd/mm/yyyy')} - {(dateRange.checkOut || 'dd/mm/yyyy')}</div>\r\n                    <div className=\"checkout-info-row\">\r\n                      <div className=\"checkout-section-title\" style={{ margin: 0 }}>Thông Tin Phòng</div>\r\n                      <button type=\"button\" className=\"checkout-inline-toggle\" onClick={() => setShowCheckoutDetails((v) => !v)}>\r\n                        {showCheckoutDetails ? 'Ẩn Thông Tin' : 'Xem Thông Tin'}\r\n                      </button>\r\n                    </div>\r\n                    {showCheckoutDetails && (\r\n                      <div className=\"checkout-room-list\">\r\n                        {selectedRooms.length === 0 ? (\r\n                          <div>Chưa chọn phòng</div>\r\n                        ) : (\r\n                          selectedRooms.map((r) => {\r\n                            const sel = selectedMap[String(r.id)];\r\n                            return (\r\n                              <div key={r.id} className=\"rt-summary-room\">\r\n                                <div className=\"rt-summary-line\">Phòng: {r.roomNumber}{r.floor != null ? ` • Tầng ${r.floor}` : ''}</div>\r\n                                <div className=\"rt-summary-line\">Người lớn: {sel?.adults ?? 0} • Trẻ em: {sel?.children ?? 0}</div>\r\n                                <div className=\"rt-summary-line\">Giá: {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                              </div>\r\n                            );\r\n                          })\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                    <div className=\"checkout-line\">\r\n                      <span>Số đêm</span>\r\n                      <span>{nights} đêm</span>\r\n                    </div>\r\n                    <div className=\"checkout-line\">\r\n                      <span>Giá phòng</span>\r\n                      <span>{Number(totalPrice).toLocaleString('vi-VN')} VND</span>\r\n                    </div>\r\n                    <div className=\"checkout-line\" style={{ alignItems: 'center', gap: 8, marginTop: 8 }}>\r\n                      <div style={{ display: 'flex', gap: 8, alignItems: 'center', flexWrap: 'wrap' }}>\r\n                        <input placeholder=\"Nhập mã ưu đãi\" value={promoCode} onChange={(e)=> setPromoCode(e.target.value.toUpperCase())} style={{ padding: '8px 10px', borderRadius: 8, border: '1px solid #ddd' }} />\r\n                        <button type=\"button\" className=\"ph-btn\" disabled={!(totalPrice>0)} onClick={async ()=>{\r\n                          if (!(totalPrice>0)) { showToast('Vui lòng chọn phòng và ngày để áp dụng mã ưu đãi', { duration: 2000, type: 'warn' }); return; }\r\n                          try {\r\n                            const normalized = await validatePromoServer(promoCode.trim());\r\n                            setAppliedPromo(normalized);\r\n                            setPromoCode(normalized.code);\r\n                            // visual flash of total\r\n                            flashTotal();\r\n                            showToast('Áp dụng mã: ' + normalized.code + ' • Giảm ' + normalized.discount.toLocaleString('vi-VN') + 'đ', { duration: 2000, type: 'success' });\r\n                          } catch (e) { showToast(e.message || 'Lỗi kiểm tra mã', { duration: 2400, type: 'error' }); }\r\n                        }}>Áp dụng</button>\r\n                        <button type=\"button\" className=\"ph-btn ph-btn--secondary\" disabled={!(totalPrice>0)} onClick={async ()=>{\r\n                          if (!(totalPrice>0)) { showToast('Vui lòng chọn phòng và ngày để xem ưu đãi', { duration: 2000, type: 'warn' }); return; }\r\n                          // fetch available promos list\r\n                          try {\r\n                            setPromoLoading(true); setPromoLoadError('');\r\n                            const promoUrl = new URL('/api/promotions', window.location.origin);\r\n                            if (data?.roomType?.hotelId) promoUrl.searchParams.set('hotelId', String(data.roomType.hotelId));\r\n                            if (Array.isArray(selectedRooms) && selectedRooms.length) {\r\n                              promoUrl.searchParams.set('roomIds', selectedRooms.map(r=>r.id).join(','));\r\n                            }\r\n                            const r = await fetch(promoUrl.toString());\r\n                            if(!r.ok) { const txt = await r.text().catch(()=>null); throw new Error(txt || 'Không lấy được danh sách'); }\r\n                            const j = await r.json(); setAvailablePromos(Array.isArray(j.items)? j.items : []); setShowPromosList(true);\r\n                          } catch(e){ setPromoLoadError(e.message || 'Lỗi tải ưu đãi'); showToast(e.message||'Lỗi tải ưu đãi', { duration: 2400, type: 'error' }); }\r\n                          finally { setPromoLoading(false); }\r\n                        }}>Chọn</button>\r\n                        {appliedPromo && <div style={{ fontWeight:800 }}>{appliedPromo.code} • Giảm {appliedPromo.discountType==='PERCENT' ? (appliedPromo.discountValue + '%') : (Number(appliedPromo.discount||0).toLocaleString('vi-VN') + 'đ')}</div>}\r\n                        {promoLoading && <div style={{ color:'#2563eb', fontSize:13 }}>Đang tải ưu đãi...</div>}\r\n                        {promoLoadError && <div style={{ color:'#b42318', fontSize:13 }}>{promoLoadError}</div>}\r\n                      </div>\r\n                    </div>\r\n                    {/* Phương thức thanh toán trực tuyến */}\r\n                    {\r\n                      <div className=\"checkout-line\" style={{ alignItems: 'stretch', flexDirection: 'column', gap: 6 }}>\r\n                        <div style={{ fontWeight: 700 }}>Phương thức thanh toán</div>\r\n                        <select className=\"checkout-pay-method\" value={payMethod} onChange={(e) => setPayMethod(e.target.value)}>\r\n                          <option value=\"MOMO\">Ví điện tử MOMO</option>\r\n                          <option value=\"ZALOPAY\">ZaloPay</option>\r\n                          <option value=\"VNPAY\">VNPay</option>\r\n                          <option value=\"CARD\">Thẻ tín dụng/ghi nợ</option>\r\n                        </select>\r\n                      </div>\r\n                    }\r\n                    <label className=\"checkout-terms\">\r\n                      <input type=\"checkbox\" checked={agree} onChange={(e) => setAgree(e.target.checked)} />\r\n                      <span>Vui lòng đọc kĩ và đồng ý với điều khoản bằng cách đánh dấu vào ô bên cạnh</span>\r\n                    </label>\r\n                    <div className=\"checkout-total\">\r\n                      <span>Tổng cộng</span>\r\n                      <span>{Number(totalPrice).toLocaleString('vi-VN')} VND</span>\r\n                    </div>\r\n                    <div className=\"checkout-actions\" style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\r\n                      {/* Online payment flow */}\r\n                        <button className=\"checkout-btn\" disabled={!canPay || isAdmin} onClick={() => {\r\n                        if (isAdmin) { alert('Tài khoản Admin không được phép đặt phòng'); return; }\r\n                        // Flow mới: chuyển hướng trực tiếp sang trang /payment/confirm\r\n                        const t = Math.random().toString(36).slice(2) + Date.now().toString(36);\r\n                        const totals = selectedRooms.reduce((acc, r) => {\r\n                          const sel = selectedMap[String(r.id)] || { adults: 0, children: 0 }; acc.ad += Number(sel.adults||0); acc.ch += Number(sel.children||0); return acc; }, { ad:0, ch:0 });\r\n                        const pad2 = (n)=> String(n).padStart(2,'0');\r\n                        const nowD = new Date();\r\n                        const bookingCode = `HMS${nowD.getFullYear()}${pad2(nowD.getMonth()+1)}${pad2(nowD.getDate())}`;\r\n                        const roomNames = selectedRooms.map(r=>`Phòng ${r.roomNumber}${r.floor!=null?` • Tầng ${r.floor}`:''}`).join(', ');\r\n                        let userEmail='';\r\n                        try { const u=localStorage.getItem('hmsUser'); if(u) userEmail=(JSON.parse(u).email||'').trim(); } catch {}\r\n                        const grossAmount = Number(totalPrice) || 0;\r\n                        // compute discount locally if appliedPromo exists; but final validation will be on server on promotions/validate\r\n                        let promoData = null;\r\n                        if (appliedPromo && appliedPromo.code) {\r\n                          // include server-provided discount & final where available\r\n                          promoData = {\r\n                            code: appliedPromo.code,\r\n                            discount: Number(appliedPromo.discount || 0),\r\n                            discountType: appliedPromo.discountType || (appliedPromo.raw && appliedPromo.raw.discountType) || null,\r\n                            discountValue: Number(appliedPromo.discountValue || 0),\r\n                            final: appliedPromo.final || null,\r\n                            raw: appliedPromo.raw || null\r\n                          };\r\n                        }\r\n                        const summary = { token:t, code:bookingCode, hotelId:data.roomType?.hotelId||null, hotel:data.roomType?.hotelName||'', roomType:data.roomType?.name||name, roomNames, checkIn:dateRange.checkIn, checkOut:dateRange.checkOut, checkInTime:'14:00', checkOutTime:'12:00', payMethod, userEmail, adults:totals.ad, children:totals.ch, rooms:selectedRooms.map(r=>{ const sel=selectedMap[String(r.id)]||{adults:0,children:0}; return { id:r.id, number:r.roomNumber, floor:r.floor, price:r.basePrice, name:r.roomNumber, adults:sel.adults, children:sel.children }; }), amount:grossAmount, promo: promoData };\r\n                        // promotion fields removed from summary\r\n                        try { localStorage.setItem('hmsBooking:'+t, JSON.stringify(summary)); } catch {}\r\n                        // Pass gross amount in query (PaymentConfirm will apply discount from summary)\r\n                        const q=[`token=${encodeURIComponent(t)}`,`code=${encodeURIComponent(summary.code)}`,`amount=${encodeURIComponent(grossAmount)}`,`hid=${encodeURIComponent(summary.hotelId||'')}`,`rn=${encodeURIComponent(roomNames)}`,`rt=${encodeURIComponent(summary.roomType||'')}`,`ci=${encodeURIComponent(summary.checkIn||'')}`,`co=${encodeURIComponent(summary.checkOut||'')}`,`ad=${encodeURIComponent(summary.adults)}`,`ch=${encodeURIComponent(summary.children)}`].join('&');\r\n                        window.location.href = '/payment/confirm?'+q;\r\n                      }}>THANH TOÁN</button>\r\n                      {/* QR button removed */}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </aside>\r\n        </div>\r\n      )}\r\n      {/* QR overlay removed */}\r\n      {showReviews && (\r\n        <div className=\"qr-overlay\" onClick={()=> setShowReviews(false)}>\r\n          <div className=\"qr-box\" onClick={(e)=> e.stopPropagation()} style={{ width: 680, maxWidth: '96%' }}>\r\n            <div className=\"qr-title\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 8 }}>\r\n              <span>Đánh giá phòng</span>\r\n              <button className=\"qr-close\" onClick={()=> setShowReviews(false)}>Đóng</button>\r\n            </div>\r\n            {reviews.loading ? (\r\n              <div style={{ padding: 10, color: '#666' }}>Đang tải đánh giá...</div>\r\n            ) : reviews.error ? (\r\n              <div style={{ padding: 10, color: '#b42318' }}>{reviews.error}</div>\r\n            ) : reviews.list.length === 0 ? (\r\n              <div style={{ padding: 10, color: '#666' }}>Chưa có đánh giá nào cho phòng này.</div>\r\n            ) : (\r\n              <div style={{ textAlign: 'left' }}>\r\n                <div style={{ fontWeight: 800, margin: '4px 0 10px' }}>Trung bình: {reviews.avg.toFixed(1)} / 5.0 ★</div>\r\n                <div style={{ maxHeight: 360, overflowY: 'auto' }}>\r\n                  {reviews.list.map(rv => (\r\n                    <div key={rv.id} style={{ borderTop: '1px solid #eee', padding: '8px 0' }}>\r\n                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                        <div style={{ fontWeight: 700 }}>{rv.user || 'Khách'}</div>\r\n                        <div style={{ fontWeight: 700, color: '#444' }}>{Number(rv.rating||0).toFixed(1)} / 5.0 ★</div>\r\n                      </div>\r\n                      <div style={{ color: '#555', marginTop: 4 }}>{rv.comment || '(Không có nhận xét)'}</div>\r\n                      <div style={{ color: '#888', fontSize: 12, marginTop: 4 }}>{rv.hotelName}{rv.roomName ? ` • Phòng ${rv.roomName}`: ''}</div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {zoomUrl && (\r\n        <div className=\"rt-zoom\" onClick={() => setZoomUrl('')}>\r\n          <img src={zoomUrl} alt=\"Xem ảnh phòng\" />\r\n        </div>\r\n      )}\r\n      {/* Promos list modal */}\r\n      {showPromosList && (\r\n        <div className=\"qr-overlay\" onClick={() => setShowPromosList(false)}>\r\n          <div className=\"qr-box\" onClick={(e) => e.stopPropagation()} style={{ width: 620, maxWidth: '96%' }}>\r\n            <div className=\"qr-title\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 8 }}>\r\n              <span>Danh sách Ưu đãi</span>\r\n              <button className=\"qr-close\" onClick={() => setShowPromosList(false)}>Đóng</button>\r\n            </div>\r\n            <div style={{ maxHeight: 420, overflowY: 'auto', padding: 8 }}>\r\n              {availablePromos.length === 0 ? (\r\n                <div style={{ padding: 12, color: '#666' }}>Không có ưu đãi nào.</div>\r\n              ) : (\r\n                availablePromos.map(p => (\r\n                  <div key={p.id} style={{ borderBottom: '1px solid #eee', padding: 10, display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                    <div>\r\n                      <div style={{ fontWeight: 700 }}>{p.code} {p.description ? `— ${p.description}` : ''}</div>\r\n                      <div style={{ color: '#555', fontSize: 13 }}>\r\n                        {p.discountType === 'PERCENT' ? (`Giảm ${p.discountValue}%${p.maxDiscount ? ` (tối đa ${Number(p.maxDiscount).toLocaleString('vi-VN')}đ)` : ''}`) : (`Giảm ${Number(p.discountValue||0).toLocaleString('vi-VN')}đ`)}\r\n                        {p.minOrderAmount ? ` • Điều kiện: tối thiểu ${Number(p.minOrderAmount).toLocaleString('vi-VN')}đ` : ''}\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ display: 'flex', gap: 8 }}>\r\n                      <button className=\"ph-btn\" onClick={async () => {\r\n                        // Validate selected promo against current totalPrice so we can show discount immediately\r\n                        try {\r\n                          const normalized = await validatePromoServer(p.code);\r\n                          setAppliedPromo(normalized);\r\n                          setPromoCode(normalized.code);\r\n                          setShowPromosList(false);\r\n                          flashTotal();\r\n                          alert('Đã chọn ưu đãi: ' + normalized.code + ' • Giảm ' + normalized.discount.toLocaleString('vi-VN') + 'đ');\r\n                        } catch (e) {\r\n                          alert(e.message || 'Không áp dụng được ưu đãi này');\r\n                        }\r\n                      }}>Chọn</button>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}