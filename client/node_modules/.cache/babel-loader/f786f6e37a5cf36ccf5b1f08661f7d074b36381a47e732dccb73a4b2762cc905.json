{"ast":null,"code":"var _jsxFileName = \"D:\\\\Git\\\\HMSAI-Hotel\\\\client\\\\src\\\\ChatBotAI.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { authHeaders, getUserEmail } from './auth';\nimport './HomePage.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DEFAULT_BOT_GREETING = 'Xin chÃ o ðŸ‘‹! TÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?';\nconst UI_COMMAND_SUGGESTIONS = ['Má»Ÿ dá»‹ch vá»¥', 'Má»Ÿ Æ°u Ä‘Ã£i', 'Má»Ÿ tiá»‡n nghi', 'Má»Ÿ há»“ sÆ¡', 'Má»Ÿ lá»‹ch sá»­ giao dá»‹ch'];\nconst MAX_HISTORY = 200;\nconst LEGACY_MSG_KEY = 'hmsChatMsgs';\nconst LEGACY_SESSION_KEY = 'hmsChatSessionId';\nconst ROOM_TYPE_LIST_ROLE = 'room-types';\nconst ROOM_LIST_ROLE = 'room-list';\nfunction createWelcomeMessages() {\n  return [{\n    role: 'bot',\n    text: DEFAULT_BOT_GREETING\n  }, {\n    role: 'suggest',\n    suggestions: UI_COMMAND_SUGGESTIONS,\n    meta: 'ui-commands'\n  }];\n}\nfunction normalizeEmailForKey(email) {\n  if (!email) return null;\n  const trimmed = String(email).trim().toLowerCase();\n  if (!trimmed) return null;\n  return encodeURIComponent(trimmed);\n}\nfunction buildMessageKey(email) {\n  const normalized = normalizeEmailForKey(email);\n  return normalized ? `${LEGACY_MSG_KEY}:${normalized}` : null;\n}\nfunction buildSessionKey(email) {\n  const normalized = normalizeEmailForKey(email);\n  return normalized ? `${LEGACY_SESSION_KEY}:${normalized}` : null;\n}\nfunction loadStoredMessages(email) {\n  const key = buildMessageKey(email);\n  if (!key) return createWelcomeMessages();\n  try {\n    const raw = localStorage.getItem(key);\n    if (!raw) return createWelcomeMessages();\n    const parsed = JSON.parse(raw);\n    if (Array.isArray(parsed) && parsed.length) {\n      return parsed.slice(-MAX_HISTORY);\n    }\n  } catch {/* ignore parse errors */}\n  return createWelcomeMessages();\n}\nfunction createSessionId() {\n  return `s_${Math.random().toString(36).slice(2, 10)}${Date.now().toString(36).slice(-4)}`;\n}\nfunction ensurePersistedSessionId(email, existing) {\n  const fallback = existing || createSessionId();\n  if (!email) return fallback;\n  const key = buildSessionKey(email);\n  if (!key) return fallback;\n  try {\n    const stored = localStorage.getItem(key);\n    if (stored) return stored;\n    localStorage.setItem(key, fallback);\n    return fallback;\n  } catch {\n    return fallback;\n  }\n}\nfunction persistSessionId(email, sessionId) {\n  if (!email || !sessionId) return;\n  const key = buildSessionKey(email);\n  if (!key) return;\n  try {\n    localStorage.setItem(key, sessionId);\n  } catch {/* ignore */}\n}\nfunction migrateLegacyStorage(email) {\n  if (!email) return {\n    session: null,\n    migratedMessages: false\n  };\n  let migratedSession = null;\n  let migratedMessages = false;\n  const messageKey = buildMessageKey(email);\n  const sessionKey = buildSessionKey(email);\n  try {\n    const legacyMsgs = localStorage.getItem(LEGACY_MSG_KEY);\n    if (legacyMsgs) {\n      if (messageKey && !localStorage.getItem(messageKey)) {\n        localStorage.setItem(messageKey, legacyMsgs);\n      }\n      localStorage.removeItem(LEGACY_MSG_KEY);\n      migratedMessages = true;\n    }\n    const legacySession = localStorage.getItem(LEGACY_SESSION_KEY);\n    if (legacySession) {\n      if (sessionKey && !localStorage.getItem(sessionKey)) {\n        localStorage.setItem(sessionKey, legacySession);\n      }\n      localStorage.removeItem(LEGACY_SESSION_KEY);\n      migratedSession = legacySession;\n    }\n  } catch {/* ignore storage errors */}\n  return {\n    session: migratedSession,\n    migratedMessages\n  };\n}\nfunction formatCurrencyVND(value) {\n  if (value === null || value === undefined) return 'ChÆ°a cáº­p nháº­t';\n  const num = Number(value);\n  if (!Number.isFinite(num)) return String(value);\n  return `${num.toLocaleString('vi-VN')}Ä‘/Ä‘Ãªm`;\n}\nfunction describeRoomStatus(status, isBooked) {\n  const txt = (status || '').toString().toLowerCase();\n  if (isBooked) return 'Äang Ä‘Æ°á»£c giá»¯ chá»—';\n  if (txt.includes('available') || txt.includes('trong')) return 'CÃ²n trá»‘ng';\n  if (txt.includes('occupied') || txt.includes('booked')) return 'Äang cÃ³ khÃ¡ch';\n  if (txt.includes('maintenance') || txt.includes('bao tri')) return 'Äang báº£o trÃ¬';\n  if (txt.includes('cleaning')) return 'Äang dá»n dáº¹p';\n  return status || 'KhÃ´ng xÃ¡c Ä‘á»‹nh';\n}\nfunction roomTypeLabel(item) {\n  if (!item) return '';\n  return item.hotelName ? `${item.name} Â· ${item.hotelName}` : item.name;\n}\n\n/** Simple AI Chatbox Component */\nexport default function ChatBotAI({\n  open,\n  onClose\n}) {\n  _s();\n  const [userEmail, setUserEmail] = useState(() => getUserEmail() || null);\n  const [messages, setMessages] = useState(() => loadStoredMessages(getUserEmail() || null));\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [sessionId, setSessionId] = useState(() => ensurePersistedSessionId(getUserEmail() || null, null));\n  const [selectingRoomType, setSelectingRoomType] = useState(false);\n  const [roomTypesCache, setRoomTypesCache] = useState(null);\n  const [roomsLoading, setRoomsLoading] = useState(false);\n  const bottomRef = useRef(null);\n  const messagesRef = useRef(messages); // track latest messages for async updates\n\n  const storageKey = buildMessageKey(userEmail);\n  useEffect(() => {\n    messagesRef.current = messages;\n  }, [messages]);\n  useEffect(() => {\n    if (!storageKey) return;\n    try {\n      localStorage.setItem(storageKey, JSON.stringify(messages.slice(-MAX_HISTORY)));\n    } catch {}\n  }, [messages, storageKey]);\n  useEffect(() => {\n    setSessionId(prev => ensurePersistedSessionId(userEmail, prev));\n    const nextMessages = loadStoredMessages(userEmail);\n    setMessages(nextMessages);\n    messagesRef.current = nextMessages;\n  }, [userEmail]);\n  useEffect(() => {\n    if (!userEmail) {\n      try {\n        localStorage.removeItem(LEGACY_MSG_KEY);\n        localStorage.removeItem(LEGACY_SESSION_KEY);\n      } catch {}\n      return;\n    }\n    const {\n      session: migratedSession,\n      migratedMessages\n    } = migrateLegacyStorage(userEmail);\n    if (migratedSession) {\n      setSessionId(prev => prev === migratedSession ? prev : migratedSession);\n    }\n    if (migratedMessages) {\n      const restored = loadStoredMessages(userEmail);\n      setMessages(restored);\n      messagesRef.current = restored;\n    }\n  }, [userEmail]);\n  useEffect(() => {\n    if (userEmail && sessionId) persistSessionId(userEmail, sessionId);\n  }, [sessionId, userEmail]);\n  useEffect(() => {\n    const syncUser = () => {\n      const current = getUserEmail() || null;\n      setUserEmail(prev => prev === current ? prev : current);\n    };\n    syncUser();\n    window.addEventListener('focus', syncUser);\n    window.addEventListener('storage', syncUser);\n    return () => {\n      window.removeEventListener('focus', syncUser);\n      window.removeEventListener('storage', syncUser);\n    };\n  }, []);\n  useEffect(() => {\n    if (!open) return;\n    const current = getUserEmail() || null;\n    setUserEmail(prev => prev === current ? prev : current);\n  }, [open]);\n  useEffect(() => {\n    if (bottomRef.current) bottomRef.current.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, [messages, open]);\n  useEffect(() => {\n    const onEsc = e => {\n      if (e.key === 'Escape' && open) onClose && onClose();\n    };\n    document.addEventListener('keydown', onEsc);\n    return () => document.removeEventListener('keydown', onEsc);\n  }, [open, onClose]);\n  useEffect(() => {\n    if (!open) return;\n    setMessages(prev => {\n      if (prev.some(m => m.role === 'suggest' && m.meta === 'ui-commands')) return prev;\n      return [...prev, {\n        role: 'suggest',\n        suggestions: UI_COMMAND_SUGGESTIONS,\n        meta: 'ui-commands'\n      }];\n    });\n  }, [open]);\n  const loadRoomTypes = async () => {\n    if (roomTypesCache && Array.isArray(roomTypesCache) && roomTypesCache.length) {\n      return roomTypesCache;\n    }\n    const res = await fetch('/api/room-types');\n    if (!res.ok) throw new Error('room-types');\n    const list = await res.json();\n    const normalized = Array.isArray(list) ? list.filter(it => it && it.name).map(it => ({\n      id: it.id,\n      name: it.name,\n      hotelName: it.hotelName || null,\n      basePrice: it.basePrice || it.price || null,\n      maxAdults: it.maxAdults || null,\n      maxChildren: it.maxChildren || null,\n      image: it.image || null,\n      description: it.description || null\n    })) : [];\n    setRoomTypesCache(normalized);\n    return normalized;\n  };\n  const triggerRoomTypeSelection = async preferredName => {\n    if (selectingRoomType) return;\n    setSelectingRoomType(true);\n    setMessages(prev => [...prev, {\n      role: 'bot',\n      text: 'HÃ£y chá»n háº¡ng phÃ²ng vÃ  khu vá»±c cáº§n Ä‘áº·t.'\n    }]);\n    try {\n      const list = await loadRoomTypes();\n      if (!list.length) {\n        setMessages(prev => [...prev, {\n          role: 'bot',\n          text: 'Hiá»‡n chÆ°a cÃ³ háº¡ng phÃ²ng nÃ o kháº£ dá»¥ng.'\n        }]);\n        setSelectingRoomType(false);\n        return;\n      }\n      setMessages(prev => [...prev, {\n        role: ROOM_TYPE_LIST_ROLE,\n        items: list,\n        preferred: preferredName || null\n      }]);\n      setSelectingRoomType(false);\n    } catch {\n      setMessages(prev => [...prev, {\n        role: 'bot',\n        text: 'KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch háº¡ng phÃ²ng. Vui lÃ²ng thá»­ láº¡i sau.'\n      }]);\n      setSelectingRoomType(false);\n    }\n  };\n  const finalizeRoomBooking = room => {\n    const detail = {\n      name: room.roomTypeName || room.roomTypeLabel || room.roomType,\n      roomId: room.id,\n      roomNumber: room.roomNumber,\n      floor: room.floor,\n      price: room.basePrice,\n      adults: room.maxAdults,\n      children: room.maxChildren,\n      hotelName: room.hotelName || null\n    };\n    try {\n      window.dispatchEvent(new CustomEvent('open-room-booking', {\n        detail\n      }));\n      setMessages(prev => [...prev, {\n        role: 'bot',\n        text: `Äang má»Ÿ Ä‘áº·t phÃ²ng cho phÃ²ng ${room.roomNumber}.`\n      }]);\n    } catch {\n      try {\n        window.dispatchEvent(new CustomEvent('open-room-type', {\n          detail: {\n            name: detail.name,\n            roomId: detail.roomId\n          }\n        }));\n        setMessages(prev => [...prev, {\n          role: 'bot',\n          text: 'Äang má»Ÿ giao diá»‡n Ä‘áº·t phÃ²ng, vui lÃ²ng kiá»ƒm tra.'\n        }]);\n      } catch {\n        setMessages(prev => [...prev, {\n          role: 'bot',\n          text: 'KhÃ´ng thá»ƒ má»Ÿ Ä‘áº·t phÃ²ng. Vui lÃ²ng chuyá»ƒn sang tab Ä‘áº·t phÃ²ng thá»§ cÃ´ng.'\n        }]);\n      }\n    }\n  };\n  const handleRoomTypeSelect = async item => {\n    if (!item || roomsLoading) return;\n    const label = roomTypeLabel(item);\n    setSelectingRoomType(false);\n    setRoomsLoading(true);\n    setMessages(prev => [...prev, {\n      role: 'user',\n      text: `Chá»n ${label}`\n    }]);\n    setMessages(prev => [...prev, {\n      role: 'bot',\n      text: 'Äang táº£i danh sÃ¡ch phÃ²ng...'\n    }]);\n    try {\n      const endpoint = `/api/room-types/${encodeURIComponent(item.name)}/rooms`;\n      const res = await fetch(endpoint);\n      if (!res.ok) throw new Error('rooms');\n      const data = await res.json();\n      const info = data && data.roomType ? data.roomType : {\n        name: item.name,\n        hotelName: item.hotelName || null\n      };\n      const rooms = data && Array.isArray(data.rooms) ? data.rooms : [];\n      const headerText = rooms.length ? `CÃ³ ${rooms.length} phÃ²ng thuá»™c háº¡ng ${info.name}${info.hotelName ? ` táº¡i ${info.hotelName}` : ''}.` : `Hiá»‡n chÆ°a cÃ³ phÃ²ng kháº£ dá»¥ng cho háº¡ng ${info.name}.`;\n      const followUps = [{\n        role: 'bot',\n        text: headerText\n      }, rooms.length ? {\n        role: ROOM_LIST_ROLE,\n        items: rooms.map(r => ({\n          id: r.id,\n          roomNumber: r.roomNumber,\n          floor: r.floor,\n          status: r.status,\n          basePrice: r.basePrice,\n          maxAdults: r.maxAdults,\n          maxChildren: r.maxChildren,\n          isBooked: r.isBooked,\n          image: r.image || item.image || null,\n          hotelName: info.hotelName || item.hotelName || null,\n          roomTypeName: info.name\n        }))\n      } : null].filter(Boolean);\n      setMessages(prev => [...prev, ...followUps]);\n    } catch {\n      setMessages(prev => [...prev, {\n        role: 'bot',\n        text: 'KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch phÃ²ng. Vui lÃ²ng thá»­ láº¡i sau.'\n      }]);\n    } finally {\n      setRoomsLoading(false);\n    }\n  };\n  const send = async text => {\n    const msg = (text !== null && text !== void 0 ? text : input).trim();\n    if (!msg || loading) return;\n    setInput('');\n    setMessages(m => [...m, {\n      role: 'user',\n      text: msg\n    }]);\n\n    // Command parsing (client-side UI open triggers)\n    // Vietnamese command patterns: \"má»Ÿ dá»‹ch vá»¥\", \"má»Ÿ phÃ²ng\", \"má»Ÿ tiá»‡n nghi\", \"má»Ÿ Ä‘Ã¡nh giÃ¡\", \"má»Ÿ khuyáº¿n mÃ£i\", \"má»Ÿ Ä‘áº·t phÃ²ng\", etc.\n    try {\n      const lower = msg.toLowerCase();\n      const fire = (name, detail = {}) => {\n        try {\n          window.dispatchEvent(new CustomEvent(name, {\n            detail\n          }));\n        } catch {}\n      };\n      const commandMap = [{\n        keywords: ['má»Ÿ dá»‹ch vá»¥', 'open service', 'open services', 'má»Ÿ service', 'xem dá»‹ch vá»¥', 'danh sÃ¡ch dá»‹ch vá»¥', 'dá»‹ch vá»¥ khÃ¡ch sáº¡n'],\n        event: 'open-services'\n      }, {\n        keywords: ['má»Ÿ phÃ²ng', 'open rooms', 'open room list', 'má»Ÿ danh sÃ¡ch phÃ²ng', 'xem phÃ²ng', 'danh sÃ¡ch phÃ²ng', 'danh sÃ¡ch phÃ²ng trá»‘ng'],\n        event: 'open-rooms'\n      }, {\n        keywords: ['má»Ÿ tiá»‡n nghi', 'open amenities', 'open amenity', 'xem tiá»‡n nghi', 'danh sÃ¡ch tiá»‡n nghi'],\n        event: 'open-amenities'\n      }, {\n        keywords: ['má»Ÿ khuyáº¿n mÃ£i', 'má»Ÿ Æ°u Ä‘Ã£i', 'open promotions', 'open promotion', 'xem Æ°u Ä‘Ã£i', 'open offers', 'view offers', 'danh sÃ¡ch Æ°u Ä‘Ã£i'],\n        event: 'open-promotions'\n      }, {\n        keywords: ['má»Ÿ Ä‘Ã¡nh giÃ¡', 'open reviews', 'xem Ä‘Ã¡nh giÃ¡', 'xem pháº£n há»“i'],\n        event: 'open-reviews'\n      }, {\n        keywords: ['má»Ÿ Ä‘áº·t phÃ²ng', 'Ä‘áº·t phÃ²ng ngay', 'booking now', 'book now', 'xem Ä‘áº·t phÃ²ng', 'mÃ n hÃ¬nh Ä‘áº·t phÃ²ng'],\n        event: 'open-booking'\n      }, {\n        keywords: ['má»Ÿ há»“ sÆ¡', 'má»Ÿ profile', 'open profile', 'thÃ´ng tin cÃ¡ nhÃ¢n', 'xem há»“ sÆ¡', 'xem profile'],\n        event: 'open-profile'\n      }, {\n        keywords: ['má»Ÿ thanh toÃ¡n', 'xem thanh toÃ¡n', 'payment history', 'má»Ÿ lá»‹ch sá»­ giao dá»‹ch', 'xem lá»‹ch sá»­ giao dá»‹ch', 'lá»‹ch sá»­ giao dá»‹ch', 'má»Ÿ lá»‹ch sá»­ thanh toÃ¡n', 'xem lá»‹ch sá»­ thanh toÃ¡n', 'xem giao dá»‹ch'],\n        event: 'open-payments'\n      }, {\n        keywords: ['má»Ÿ thÃ´ng bÃ¡o', 'xem thÃ´ng bÃ¡o', 'open notifications', 'xem thÃ´ng bÃ¡o má»›i'],\n        event: 'open-notifications'\n      }];\n      const found = commandMap.find(c => c.keywords.some(k => lower.includes(k)));\n      if (found) {\n        fire(found.event, {\n          source: 'chatbot',\n          original: msg\n        });\n        // Provide a local immediate bot acknowledgement without calling API\n        setMessages(m => [...m, {\n          role: 'bot',\n          text: 'Äang má»Ÿ giao diá»‡n theo yÃªu cáº§u cá»§a báº¡n...'\n        }]);\n        return; // skip server request for pure UI command\n      }\n    } catch {/* ignore command parse errors */}\n    setLoading(true);\n    try {\n      const res = await fetch('/api/ai/chat', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeaders()\n        },\n        body: JSON.stringify({\n          message: msg,\n          sessionId\n        })\n      });\n      if (!res.ok) throw new Error('Lá»—i pháº£n há»“i');\n      const j = await res.json();\n      const next = [...messagesRef.current, {\n        role: 'bot',\n        text: j.reply || '(khÃ´ng cÃ³ pháº£n há»“i)'\n      }];\n      if (Array.isArray(j.results) && j.results.length) {\n        next.push({\n          role: 'results',\n          items: j.results.slice(0, 8)\n        });\n      }\n      if (Array.isArray(j.suggestions) && j.suggestions.length) {\n        next.push({\n          role: 'suggest',\n          suggestions: j.suggestions.slice(0, 6)\n        });\n      }\n      setMessages(next);\n    } catch (e) {\n      setMessages(m => [...m, {\n        role: 'bot',\n        text: 'Xin lá»—i, hiá»‡n chÆ°a pháº£n há»“i Ä‘Æ°á»£c.'\n      }]);\n    } finally {\n      setLoading(false);\n    }\n  };\n  const openBooking = roomName => {\n    triggerRoomTypeSelection(roomName);\n  };\n  const clickSuggestion = s => {\n    send(s);\n  };\n  if (!open) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ai-chatbox-wrapper\",\n    role: \"dialog\",\n    \"aria-label\": \"Chat h\\u1ED7 tr\\u1EE3 AI\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ai-chatbox-header\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ai-chatbox-title\",\n        children: \"H\\u1ED7 tr\\u1EE3 AI\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ai-chatbox-close\",\n        \"aria-label\": \"\\u0110\\xF3ng\",\n        onClick: onClose,\n        children: \"\\xD7\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ai-chatbox-body\",\n      children: [messages.map((m, idx) => {\n        if (m.role === 'suggest') {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ai-suggest-row\",\n            children: m.suggestions.map(s => /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"ai-suggest-btn\",\n              onClick: () => clickSuggestion(s),\n              children: s\n            }, s, false, {\n              fileName: _jsxFileName,\n              lineNumber: 389,\n              columnNumber: 41\n            }, this))\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 15\n          }, this);\n        }\n        if (m.role === ROOM_TYPE_LIST_ROLE) {\n          const preferred = (m.preferred || '').toString().toLowerCase();\n          const items = Array.isArray(m.items) ? m.items : [];\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ai-roomtype-grid\",\n            children: items.map(it => {\n              const isPreferred = preferred && it.name && it.name.toLowerCase() === preferred;\n              const label = roomTypeLabel(it);\n              return /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: `ai-roomtype-card${isPreferred ? ' preferred' : ''}`,\n                onClick: () => handleRoomTypeSelect(it),\n                disabled: roomsLoading,\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomtype-name\",\n                  children: it.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 409,\n                  columnNumber: 23\n                }, this), it.hotelName && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomtype-hotel\",\n                  children: it.hotelName\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 410,\n                  columnNumber: 40\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomtype-meta\",\n                  children: [it.maxAdults ? `${it.maxAdults} NL` : 'â€”', \" \\u2022 \", it.maxChildren ? `${it.maxChildren} TE` : 'â€”']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 411,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomtype-price\",\n                  children: formatCurrencyVND(it.basePrice)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 414,\n                  columnNumber: 23\n                }, this), isPreferred && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomtype-tag\",\n                  children: \"G\\u1EE3i \\xFD\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 415,\n                  columnNumber: 39\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"sr-only\",\n                  children: [\"Ch\\u1ECDn \", label]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 416,\n                  columnNumber: 23\n                }, this)]\n              }, `${it.id || it.name}`, true, {\n                fileName: _jsxFileName,\n                lineNumber: 402,\n                columnNumber: 21\n              }, this);\n            })\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 15\n          }, this);\n        }\n        if (m.role === ROOM_LIST_ROLE) {\n          const rooms = Array.isArray(m.items) ? m.items : [];\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ai-roomlist-grid\",\n            children: rooms.map(room => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ai-roomlist-card\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ai-roomlist-header\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomlist-title\",\n                  children: [\"Ph\\xF2ng \", room.roomNumber || 'KhÃ´ng xÃ¡c Ä‘á»‹nh']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 430,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: `ai-roomlist-status ${room.isBooked ? 'is-booked' : ''}`,\n                  children: describeRoomStatus(room.status, room.isBooked)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 431,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 429,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ai-roomlist-body\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomlist-info\",\n                  children: [room.hotelName && /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"ai-roomlist-hotel\",\n                    children: room.hotelName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 435,\n                    columnNumber: 44\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"ai-roomlist-meta\",\n                    children: [\"T\\u1EA7ng \", room.floor || 'â€”', \" \\u2022 \", room.maxAdults || 0, \" NL \\u2022 \", room.maxChildren || 0, \" TE\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 436,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"ai-roomlist-price\",\n                    children: formatCurrencyVND(room.basePrice)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 437,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 434,\n                  columnNumber: 23\n                }, this), room.image ? /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ai-roomlist-thumb\",\n                  children: /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: room.image,\n                    alt: room.roomTypeName || 'PhÃ²ng'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 440,\n                    columnNumber: 60\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 440,\n                  columnNumber: 25\n                }, this) : null]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 433,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ai-roomlist-actions\",\n                children: /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  onClick: () => finalizeRoomBooking(room),\n                  children: \"\\u0110\\u1EB7t ph\\xF2ng ngay\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 444,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 443,\n                columnNumber: 21\n              }, this)]\n            }, room.id || room.roomNumber, true, {\n              fileName: _jsxFileName,\n              lineNumber: 428,\n              columnNumber: 19\n            }, this))\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 15\n          }, this);\n        }\n        if (m.role === 'results') {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ai-results-grid\",\n            children: m.items.map(it => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"ai-room-card\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ai-room-thumb\",\n                children: it.image ? /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: it.image,\n                  alt: it.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 456,\n                  columnNumber: 64\n                }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"ph-img-fallback\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 456,\n                  columnNumber: 103\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 456,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ai-room-name\",\n                children: it.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ai-room-meta\",\n                children: [it.maxAdults, \" NL \\u2022 \", it.maxChildren, \" TE\", it.rating ? ` â€¢ ${it.rating}â˜…` : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 458,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"ai-room-price\",\n                children: formatCurrencyVND(it.price)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 459,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"ai-room-book\",\n                onClick: () => openBooking(it.name),\n                children: \"\\u0110\\u1EB7t ph\\xF2ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 460,\n                columnNumber: 21\n              }, this)]\n            }, it.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 455,\n              columnNumber: 19\n            }, this))\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 15\n          }, this);\n        }\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `ai-msg ai-msg-${m.role}`,\n          children: m.text\n        }, idx, false, {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 18\n        }, this);\n      }), loading && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ai-msg ai-msg-bot loading\",\n        children: \"\\u0110ang g\\xF5...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 468,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: bottomRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"ai-chatbox-input\",\n      onSubmit: e => {\n        e.preventDefault();\n        send();\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        placeholder: \"Nh\\u1EADp tin nh\\u1EAFn...\",\n        value: input,\n        onChange: e => setInput(e.target.value),\n        onKeyDown: e => {\n          if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            send();\n          }\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        disabled: !input.trim() || loading,\n        children: \"G\\u1EEDi\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n  .ai-chatbox-wrapper { position:fixed; bottom:108px; right:120px; width:340px; max-width:90vw; background:#fff; border:1px solid #e2e8f0; border-radius:16px; box-shadow:0 8px 28px -4px rgba(0,0,0,.18),0 4px 12px -2px rgba(0,0,0,.12); display:flex; flex-direction:column; font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif; z-index:3000; animation:chatIn .35s cubic-bezier(.4,.2,.2,1); max-height:70vh; min-height:300px; }\n        @keyframes chatIn { from { opacity:0; transform:translateY(12px) scale(.96);} to { opacity:1; transform:translateY(0) scale(1);} }\n        .ai-chatbox-header { background:#f59f00; color:#fff; padding:10px 14px; border-radius:16px 16px 0 0; display:flex; align-items:center; justify-content:space-between; font-weight:600; letter-spacing:.3px; }\n        .ai-chatbox-close { background:transparent; border:none; color:#fff; font-size:20px; line-height:1; cursor:pointer; padding:4px 8px; }\n        .ai-chatbox-body { flex:1; padding:10px 12px 12px; overflow-y:auto; background:#fff; display:flex; flex-direction:column; gap:8px; overscroll-behavior:contain; }\n        /* Scrollbar tuá»³ biáº¿n (WebKit) */\n        .ai-chatbox-body::-webkit-scrollbar { width:8px; }\n        .ai-chatbox-body::-webkit-scrollbar-track { background:transparent; }\n        .ai-chatbox-body::-webkit-scrollbar-thumb { background:#dadfe4; border-radius:4px; }\n        .ai-chatbox-body::-webkit-scrollbar-thumb:hover { background:#c3c9d0; }\n        /* Firefox */\n        .ai-chatbox-body { scrollbar-width:thin; scrollbar-color:#c3c9d0 transparent; }\n        .ai-msg { max-width:80%; padding:8px 12px; border-radius:14px; font-size:14px; line-height:1.4; word-break:break-word; white-space:pre-wrap; }\n        .ai-msg-bot { background:#f1f5f9; color:#111; align-self:flex-start; border:1px solid #e2e8f0; }\n        .ai-msg-user { background:#f59f00; color:#fff; align-self:flex-end; box-shadow:0 2px 4px rgba(0,0,0,0.12); }\n        .ai-msg-bot.loading { opacity:.7; font-style:italic; }\n        .ai-chatbox-input { display:flex; align-items:center; gap:8px; border-top:1px solid #e2e8f0; padding:8px 10px; }\n        .ai-chatbox-input input { flex:1; border:1px solid #d0d7e0; border-radius:10px; padding:8px 10px; font-size:14px; }\n        .ai-chatbox-input input:focus { outline:none; border-color:#f59f00; box-shadow:0 0 0 2px rgba(245,159,0,.35); }\n        .ai-chatbox-input button { background:#f59f00; color:#fff; border:none; padding:8px 14px; border-radius:10px; font-size:14px; cursor:pointer; font-weight:600; }\n        .ai-chatbox-input button:disabled { opacity:.5; cursor:not-allowed; }\n        .ai-suggest-row { display:flex; flex-wrap:wrap; gap:6px; margin-top:2px; }\n        .ai-suggest-btn { background:#fff; border:1px solid #f59f00; color:#b06900; padding:4px 8px; border-radius:20px; font-size:12px; cursor:pointer; transition:.25s; }\n        .ai-suggest-btn:hover { background:#f59f00; color:#fff; }\n        .ai-results-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:10px; }\n        .ai-room-card { background:#fffaf3; border:1px solid #fbe4c2; border-radius:12px; padding:8px; display:flex; flex-direction:column; gap:6px; position:relative; box-shadow:0 2px 4px rgba(0,0,0,.04); }\n        .ai-room-thumb { width:100%; aspect-ratio:4/3; background:#f5f5f5; border-radius:8px; overflow:hidden; display:flex; align-items:center; justify-content:center; }\n        .ai-room-thumb img { width:100%; height:100%; object-fit:cover; display:block; }\n        .ai-room-name { font-weight:700; font-size:13px; letter-spacing:.2px; }\n        .ai-room-meta { font-size:11px; color:#555; }\n        .ai-room-price { font-size:12px; font-weight:800; color:#c2410c; }\n        .ai-room-book { background:#f59f00; color:#fff; border:none; border-radius:18px; padding:6px 10px; font-size:12px; font-weight:700; cursor:pointer; }\n        .ai-room-book:hover { background:#d97706; }\n        .ai-roomtype-grid { display:flex; flex-direction:column; gap:8px; }\n        .ai-roomtype-card { position:relative; background:#fffaf3; border:1px solid #fbe4c2; border-radius:12px; padding:10px 12px; text-align:left; display:flex; flex-direction:column; gap:4px; cursor:pointer; transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease; }\n        .ai-roomtype-card:hover { transform:translateY(-2px); box-shadow:0 6px 16px rgba(245,159,0,0.18); border-color:#f59f00; }\n        .ai-roomtype-card:disabled { opacity:0.6; cursor:not-allowed; transform:none; box-shadow:none; }\n        .ai-roomtype-card.preferred { border-color:#f59f00; box-shadow:0 0 0 2px rgba(245,159,0,.25); }\n        .ai-roomtype-name { font-weight:700; font-size:13px; color:#b45309; }\n        .ai-roomtype-hotel { font-size:12px; color:#475569; }\n        .ai-roomtype-meta { font-size:11px; color:#64748b; }\n        .ai-roomtype-price { font-size:12px; font-weight:700; color:#c2410c; }\n        .ai-roomtype-tag { position:absolute; top:8px; right:10px; background:#f59f00; color:#fff; padding:2px 8px; border-radius:10px; font-size:11px; font-weight:600; }\n        .ai-roomlist-grid { display:flex; flex-direction:column; gap:10px; }\n        .ai-roomlist-card { border:1px solid #e2e8f0; border-radius:14px; padding:10px 12px; background:#fff; box-shadow:0 4px 12px rgba(148,163,184,0.18); display:flex; flex-direction:column; gap:10px; }\n        .ai-roomlist-header { display:flex; align-items:center; justify-content:space-between; gap:8px; }\n        .ai-roomlist-title { font-weight:700; color:#0f172a; }\n        .ai-roomlist-status { font-size:11px; padding:4px 8px; border-radius:999px; background:#f1f5f9; color:#0f172a; font-weight:600; }\n        .ai-roomlist-status.is-booked { background:#fee2e2; color:#b91c1c; }\n        .ai-roomlist-body { display:flex; gap:10px; align-items:flex-start; }\n        .ai-roomlist-info { flex:1; display:flex; flex-direction:column; gap:4px; }\n        .ai-roomlist-hotel { font-size:12px; color:#475569; font-weight:600; }\n        .ai-roomlist-meta { font-size:12px; color:#64748b; }\n        .ai-roomlist-price { font-size:13px; font-weight:700; color:#c2410c; }\n        .ai-roomlist-thumb { width:80px; height:68px; border-radius:10px; overflow:hidden; background:#f5f5f5; flex-shrink:0; }\n        .ai-roomlist-thumb img { width:100%; height:100%; object-fit:cover; display:block; }\n        .ai-roomlist-actions { display:flex; justify-content:flex-end; }\n        .ai-roomlist-actions button { background:#f59f00; color:#fff; border:none; border-radius:14px; padding:6px 12px; font-size:12px; font-weight:600; cursor:pointer; }\n        .ai-roomlist-actions button:hover { background:#d97706; }\n        .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }\n  @media (max-width:600px){ .ai-chatbox-wrapper { right:12px; bottom:84px; width:300px; } }\n      `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 480,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 379,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatBotAI, \"ocuI5E30psswQqxWP/3TzJJ3BF8=\");\n_c = ChatBotAI;\nvar _c;\n$RefreshReg$(_c, \"ChatBotAI\");","map":{"version":3,"names":["React","useEffect","useRef","useState","authHeaders","getUserEmail","jsxDEV","_jsxDEV","DEFAULT_BOT_GREETING","UI_COMMAND_SUGGESTIONS","MAX_HISTORY","LEGACY_MSG_KEY","LEGACY_SESSION_KEY","ROOM_TYPE_LIST_ROLE","ROOM_LIST_ROLE","createWelcomeMessages","role","text","suggestions","meta","normalizeEmailForKey","email","trimmed","String","trim","toLowerCase","encodeURIComponent","buildMessageKey","normalized","buildSessionKey","loadStoredMessages","key","raw","localStorage","getItem","parsed","JSON","parse","Array","isArray","length","slice","createSessionId","Math","random","toString","Date","now","ensurePersistedSessionId","existing","fallback","stored","setItem","persistSessionId","sessionId","migrateLegacyStorage","session","migratedMessages","migratedSession","messageKey","sessionKey","legacyMsgs","removeItem","legacySession","formatCurrencyVND","value","undefined","num","Number","isFinite","toLocaleString","describeRoomStatus","status","isBooked","txt","includes","roomTypeLabel","item","hotelName","name","ChatBotAI","open","onClose","_s","userEmail","setUserEmail","messages","setMessages","input","setInput","loading","setLoading","setSessionId","selectingRoomType","setSelectingRoomType","roomTypesCache","setRoomTypesCache","roomsLoading","setRoomsLoading","bottomRef","messagesRef","storageKey","current","stringify","prev","nextMessages","restored","syncUser","window","addEventListener","removeEventListener","scrollIntoView","behavior","onEsc","e","document","some","m","loadRoomTypes","res","fetch","ok","Error","list","json","filter","it","map","id","basePrice","price","maxAdults","maxChildren","image","description","triggerRoomTypeSelection","preferredName","items","preferred","finalizeRoomBooking","room","detail","roomTypeName","roomType","roomId","roomNumber","floor","adults","children","dispatchEvent","CustomEvent","handleRoomTypeSelect","label","endpoint","data","info","rooms","headerText","followUps","r","Boolean","send","msg","lower","fire","commandMap","keywords","event","found","find","c","k","source","original","method","headers","body","message","j","next","reply","results","push","openBooking","roomName","clickSuggestion","s","className","fileName","_jsxFileName","lineNumber","columnNumber","onClick","idx","type","isPreferred","disabled","src","alt","rating","ref","onSubmit","preventDefault","placeholder","onChange","target","onKeyDown","shiftKey","_c","$RefreshReg$"],"sources":["D:/Git/HMSAI-Hotel/client/src/ChatBotAI.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { authHeaders, getUserEmail } from './auth';\r\nimport './HomePage.css';\r\n\r\nconst DEFAULT_BOT_GREETING = 'Xin chÃ o ðŸ‘‹! TÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?';\r\nconst UI_COMMAND_SUGGESTIONS = [\r\n  'Má»Ÿ dá»‹ch vá»¥',\r\n  'Má»Ÿ Æ°u Ä‘Ã£i',\r\n  'Má»Ÿ tiá»‡n nghi',\r\n  'Má»Ÿ há»“ sÆ¡',\r\n  'Má»Ÿ lá»‹ch sá»­ giao dá»‹ch',\r\n];\r\nconst MAX_HISTORY = 200;\r\nconst LEGACY_MSG_KEY = 'hmsChatMsgs';\r\nconst LEGACY_SESSION_KEY = 'hmsChatSessionId';\r\nconst ROOM_TYPE_LIST_ROLE = 'room-types';\r\nconst ROOM_LIST_ROLE = 'room-list';\r\n\r\nfunction createWelcomeMessages() {\r\n  return [\r\n    { role: 'bot', text: DEFAULT_BOT_GREETING },\r\n    { role: 'suggest', suggestions: UI_COMMAND_SUGGESTIONS, meta: 'ui-commands' },\r\n  ];\r\n}\r\n\r\nfunction normalizeEmailForKey(email) {\r\n  if (!email) return null;\r\n  const trimmed = String(email).trim().toLowerCase();\r\n  if (!trimmed) return null;\r\n  return encodeURIComponent(trimmed);\r\n}\r\n\r\nfunction buildMessageKey(email) {\r\n  const normalized = normalizeEmailForKey(email);\r\n  return normalized ? `${LEGACY_MSG_KEY}:${normalized}` : null;\r\n}\r\n\r\nfunction buildSessionKey(email) {\r\n  const normalized = normalizeEmailForKey(email);\r\n  return normalized ? `${LEGACY_SESSION_KEY}:${normalized}` : null;\r\n}\r\n\r\nfunction loadStoredMessages(email) {\r\n  const key = buildMessageKey(email);\r\n  if (!key) return createWelcomeMessages();\r\n  try {\r\n    const raw = localStorage.getItem(key);\r\n    if (!raw) return createWelcomeMessages();\r\n    const parsed = JSON.parse(raw);\r\n    if (Array.isArray(parsed) && parsed.length) {\r\n      return parsed.slice(-MAX_HISTORY);\r\n    }\r\n  } catch { /* ignore parse errors */ }\r\n  return createWelcomeMessages();\r\n}\r\n\r\nfunction createSessionId() {\r\n  return `s_${Math.random().toString(36).slice(2, 10)}${Date.now().toString(36).slice(-4)}`;\r\n}\r\n\r\nfunction ensurePersistedSessionId(email, existing) {\r\n  const fallback = existing || createSessionId();\r\n  if (!email) return fallback;\r\n  const key = buildSessionKey(email);\r\n  if (!key) return fallback;\r\n  try {\r\n    const stored = localStorage.getItem(key);\r\n    if (stored) return stored;\r\n    localStorage.setItem(key, fallback);\r\n    return fallback;\r\n  } catch {\r\n    return fallback;\r\n  }\r\n}\r\n\r\nfunction persistSessionId(email, sessionId) {\r\n  if (!email || !sessionId) return;\r\n  const key = buildSessionKey(email);\r\n  if (!key) return;\r\n  try { localStorage.setItem(key, sessionId); } catch { /* ignore */ }\r\n}\r\n\r\nfunction migrateLegacyStorage(email) {\r\n  if (!email) return { session: null, migratedMessages: false };\r\n  let migratedSession = null;\r\n  let migratedMessages = false;\r\n  const messageKey = buildMessageKey(email);\r\n  const sessionKey = buildSessionKey(email);\r\n  try {\r\n    const legacyMsgs = localStorage.getItem(LEGACY_MSG_KEY);\r\n    if (legacyMsgs) {\r\n      if (messageKey && !localStorage.getItem(messageKey)) {\r\n        localStorage.setItem(messageKey, legacyMsgs);\r\n      }\r\n      localStorage.removeItem(LEGACY_MSG_KEY);\r\n      migratedMessages = true;\r\n    }\r\n    const legacySession = localStorage.getItem(LEGACY_SESSION_KEY);\r\n    if (legacySession) {\r\n      if (sessionKey && !localStorage.getItem(sessionKey)) {\r\n        localStorage.setItem(sessionKey, legacySession);\r\n      }\r\n      localStorage.removeItem(LEGACY_SESSION_KEY);\r\n      migratedSession = legacySession;\r\n    }\r\n  } catch { /* ignore storage errors */ }\r\n  return { session: migratedSession, migratedMessages };\r\n}\r\n\r\nfunction formatCurrencyVND(value) {\r\n  if (value === null || value === undefined) return 'ChÆ°a cáº­p nháº­t';\r\n  const num = Number(value);\r\n  if (!Number.isFinite(num)) return String(value);\r\n  return `${num.toLocaleString('vi-VN')}Ä‘/Ä‘Ãªm`;\r\n}\r\n\r\nfunction describeRoomStatus(status, isBooked) {\r\n  const txt = (status || '').toString().toLowerCase();\r\n  if (isBooked) return 'Äang Ä‘Æ°á»£c giá»¯ chá»—';\r\n  if (txt.includes('available') || txt.includes('trong')) return 'CÃ²n trá»‘ng';\r\n  if (txt.includes('occupied') || txt.includes('booked')) return 'Äang cÃ³ khÃ¡ch';\r\n  if (txt.includes('maintenance') || txt.includes('bao tri')) return 'Äang báº£o trÃ¬';\r\n  if (txt.includes('cleaning')) return 'Äang dá»n dáº¹p';\r\n  return status || 'KhÃ´ng xÃ¡c Ä‘á»‹nh';\r\n}\r\n\r\nfunction roomTypeLabel(item) {\r\n  if (!item) return '';\r\n  return item.hotelName ? `${item.name} Â· ${item.hotelName}` : item.name;\r\n}\r\n\r\n/** Simple AI Chatbox Component */\r\nexport default function ChatBotAI({ open, onClose }) {\r\n  const [userEmail, setUserEmail] = useState(() => getUserEmail() || null);\r\n  const [messages, setMessages] = useState(() => loadStoredMessages(getUserEmail() || null));\r\n  const [input, setInput] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [sessionId, setSessionId] = useState(() => ensurePersistedSessionId(getUserEmail() || null, null));\r\n  const [selectingRoomType, setSelectingRoomType] = useState(false);\r\n  const [roomTypesCache, setRoomTypesCache] = useState(null);\r\n  const [roomsLoading, setRoomsLoading] = useState(false);\r\n  const bottomRef = useRef(null);\r\n  const messagesRef = useRef(messages); // track latest messages for async updates\r\n\r\n  const storageKey = buildMessageKey(userEmail);\r\n\r\n  useEffect(() => { messagesRef.current = messages; }, [messages]);\r\n\r\n  useEffect(() => {\r\n    if (!storageKey) return;\r\n    try { localStorage.setItem(storageKey, JSON.stringify(messages.slice(-MAX_HISTORY))); } catch {}\r\n  }, [messages, storageKey]);\r\n\r\n  useEffect(() => {\r\n    setSessionId(prev => ensurePersistedSessionId(userEmail, prev));\r\n    const nextMessages = loadStoredMessages(userEmail);\r\n    setMessages(nextMessages);\r\n    messagesRef.current = nextMessages;\r\n  }, [userEmail]);\r\n\r\n  useEffect(() => {\r\n    if (!userEmail) {\r\n      try {\r\n        localStorage.removeItem(LEGACY_MSG_KEY);\r\n        localStorage.removeItem(LEGACY_SESSION_KEY);\r\n      } catch {}\r\n      return;\r\n    }\r\n    const { session: migratedSession, migratedMessages } = migrateLegacyStorage(userEmail);\r\n    if (migratedSession) {\r\n      setSessionId(prev => (prev === migratedSession ? prev : migratedSession));\r\n    }\r\n    if (migratedMessages) {\r\n      const restored = loadStoredMessages(userEmail);\r\n      setMessages(restored);\r\n      messagesRef.current = restored;\r\n    }\r\n  }, [userEmail]);\r\n\r\n  useEffect(() => {\r\n    if (userEmail && sessionId) persistSessionId(userEmail, sessionId);\r\n  }, [sessionId, userEmail]);\r\n\r\n  useEffect(() => {\r\n    const syncUser = () => {\r\n      const current = getUserEmail() || null;\r\n      setUserEmail(prev => (prev === current ? prev : current));\r\n    };\r\n    syncUser();\r\n    window.addEventListener('focus', syncUser);\r\n    window.addEventListener('storage', syncUser);\r\n    return () => {\r\n      window.removeEventListener('focus', syncUser);\r\n      window.removeEventListener('storage', syncUser);\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    const current = getUserEmail() || null;\r\n    setUserEmail(prev => (prev === current ? prev : current));\r\n  }, [open]);\r\n\r\n  useEffect(()=>{ if(bottomRef.current) bottomRef.current.scrollIntoView({ behavior:'smooth' }); }, [messages, open]);\r\n  useEffect(()=>{ const onEsc = (e)=>{ if(e.key==='Escape' && open) onClose && onClose(); }; document.addEventListener('keydown', onEsc); return ()=> document.removeEventListener('keydown', onEsc); }, [open,onClose]);\r\n  useEffect(() => {\r\n    if (!open) return;\r\n    setMessages(prev => {\r\n      if (prev.some(m => m.role === 'suggest' && m.meta === 'ui-commands')) return prev;\r\n      return [...prev, { role: 'suggest', suggestions: UI_COMMAND_SUGGESTIONS, meta: 'ui-commands' }];\r\n    });\r\n  }, [open]);\r\n\r\n  const loadRoomTypes = async () => {\r\n    if (roomTypesCache && Array.isArray(roomTypesCache) && roomTypesCache.length) {\r\n      return roomTypesCache;\r\n    }\r\n    const res = await fetch('/api/room-types');\r\n    if (!res.ok) throw new Error('room-types');\r\n    const list = await res.json();\r\n    const normalized = Array.isArray(list) ? list.filter(it => it && it.name).map(it => ({\r\n      id: it.id,\r\n      name: it.name,\r\n      hotelName: it.hotelName || null,\r\n      basePrice: it.basePrice || it.price || null,\r\n      maxAdults: it.maxAdults || null,\r\n      maxChildren: it.maxChildren || null,\r\n      image: it.image || null,\r\n      description: it.description || null,\r\n    })) : [];\r\n    setRoomTypesCache(normalized);\r\n    return normalized;\r\n  };\r\n\r\n  const triggerRoomTypeSelection = async (preferredName) => {\r\n    if (selectingRoomType) return;\r\n    setSelectingRoomType(true);\r\n    setMessages(prev => [...prev, { role: 'bot', text: 'HÃ£y chá»n háº¡ng phÃ²ng vÃ  khu vá»±c cáº§n Ä‘áº·t.' }]);\r\n    try {\r\n      const list = await loadRoomTypes();\r\n      if (!list.length) {\r\n        setMessages(prev => [...prev, { role: 'bot', text: 'Hiá»‡n chÆ°a cÃ³ háº¡ng phÃ²ng nÃ o kháº£ dá»¥ng.' }]);\r\n        setSelectingRoomType(false);\r\n        return;\r\n      }\r\n      setMessages(prev => [...prev, { role: ROOM_TYPE_LIST_ROLE, items: list, preferred: preferredName || null }]);\r\n      setSelectingRoomType(false);\r\n    } catch {\r\n      setMessages(prev => [...prev, { role: 'bot', text: 'KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch háº¡ng phÃ²ng. Vui lÃ²ng thá»­ láº¡i sau.' }]);\r\n      setSelectingRoomType(false);\r\n    }\r\n  };\r\n\r\n  const finalizeRoomBooking = (room) => {\r\n    const detail = {\r\n      name: room.roomTypeName || room.roomTypeLabel || room.roomType,\r\n      roomId: room.id,\r\n      roomNumber: room.roomNumber,\r\n      floor: room.floor,\r\n      price: room.basePrice,\r\n      adults: room.maxAdults,\r\n      children: room.maxChildren,\r\n      hotelName: room.hotelName || null,\r\n    };\r\n    try {\r\n      window.dispatchEvent(new CustomEvent('open-room-booking', { detail }));\r\n      setMessages(prev => [...prev, { role: 'bot', text: `Äang má»Ÿ Ä‘áº·t phÃ²ng cho phÃ²ng ${room.roomNumber}.` }]);\r\n    } catch {\r\n      try {\r\n        window.dispatchEvent(new CustomEvent('open-room-type', { detail: { name: detail.name, roomId: detail.roomId } }));\r\n        setMessages(prev => [...prev, { role: 'bot', text: 'Äang má»Ÿ giao diá»‡n Ä‘áº·t phÃ²ng, vui lÃ²ng kiá»ƒm tra.' }]);\r\n      } catch {\r\n        setMessages(prev => [...prev, { role: 'bot', text: 'KhÃ´ng thá»ƒ má»Ÿ Ä‘áº·t phÃ²ng. Vui lÃ²ng chuyá»ƒn sang tab Ä‘áº·t phÃ²ng thá»§ cÃ´ng.' }]);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleRoomTypeSelect = async (item) => {\r\n    if (!item || roomsLoading) return;\r\n    const label = roomTypeLabel(item);\r\n    setSelectingRoomType(false);\r\n    setRoomsLoading(true);\r\n    setMessages(prev => [...prev, { role: 'user', text: `Chá»n ${label}` }]);\r\n    setMessages(prev => [...prev, { role: 'bot', text: 'Äang táº£i danh sÃ¡ch phÃ²ng...' }]);\r\n    try {\r\n      const endpoint = `/api/room-types/${encodeURIComponent(item.name)}/rooms`;\r\n      const res = await fetch(endpoint);\r\n      if (!res.ok) throw new Error('rooms');\r\n      const data = await res.json();\r\n      const info = data && data.roomType ? data.roomType : { name: item.name, hotelName: item.hotelName || null };\r\n      const rooms = data && Array.isArray(data.rooms) ? data.rooms : [];\r\n      const headerText = rooms.length\r\n        ? `CÃ³ ${rooms.length} phÃ²ng thuá»™c háº¡ng ${info.name}${info.hotelName ? ` táº¡i ${info.hotelName}` : ''}.`\r\n        : `Hiá»‡n chÆ°a cÃ³ phÃ²ng kháº£ dá»¥ng cho háº¡ng ${info.name}.`;\r\n      const followUps = [\r\n        { role: 'bot', text: headerText },\r\n        rooms.length ? {\r\n          role: ROOM_LIST_ROLE,\r\n          items: rooms.map(r => ({\r\n            id: r.id,\r\n            roomNumber: r.roomNumber,\r\n            floor: r.floor,\r\n            status: r.status,\r\n            basePrice: r.basePrice,\r\n            maxAdults: r.maxAdults,\r\n            maxChildren: r.maxChildren,\r\n            isBooked: r.isBooked,\r\n            image: r.image || item.image || null,\r\n            hotelName: info.hotelName || item.hotelName || null,\r\n            roomTypeName: info.name,\r\n          })),\r\n        } : null,\r\n      ].filter(Boolean);\r\n      setMessages(prev => [...prev, ...followUps]);\r\n    } catch {\r\n      setMessages(prev => [...prev, { role: 'bot', text: 'KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch phÃ²ng. Vui lÃ²ng thá»­ láº¡i sau.' }]);\r\n    } finally {\r\n      setRoomsLoading(false);\r\n    }\r\n  };\r\n\r\n  const send = async (text) => {\r\n    const msg = (text ?? input).trim();\r\n    if(!msg || loading) return;\r\n    setInput('');\r\n    setMessages(m => [...m, { role:'user', text: msg }]);\r\n\r\n    // Command parsing (client-side UI open triggers)\r\n    // Vietnamese command patterns: \"má»Ÿ dá»‹ch vá»¥\", \"má»Ÿ phÃ²ng\", \"má»Ÿ tiá»‡n nghi\", \"má»Ÿ Ä‘Ã¡nh giÃ¡\", \"má»Ÿ khuyáº¿n mÃ£i\", \"má»Ÿ Ä‘áº·t phÃ²ng\", etc.\r\n    try {\r\n      const lower = msg.toLowerCase();\r\n      const fire = (name, detail={}) => { try { window.dispatchEvent(new CustomEvent(name,{ detail })); } catch {} };\r\n      const commandMap = [\r\n        { keywords:['má»Ÿ dá»‹ch vá»¥','open service','open services','má»Ÿ service','xem dá»‹ch vá»¥','danh sÃ¡ch dá»‹ch vá»¥','dá»‹ch vá»¥ khÃ¡ch sáº¡n'], event:'open-services' },\r\n        { keywords:['má»Ÿ phÃ²ng','open rooms','open room list','má»Ÿ danh sÃ¡ch phÃ²ng','xem phÃ²ng','danh sÃ¡ch phÃ²ng','danh sÃ¡ch phÃ²ng trá»‘ng'], event:'open-rooms' },\r\n        { keywords:['má»Ÿ tiá»‡n nghi','open amenities','open amenity','xem tiá»‡n nghi','danh sÃ¡ch tiá»‡n nghi'], event:'open-amenities' },\r\n        { keywords:['má»Ÿ khuyáº¿n mÃ£i','má»Ÿ Æ°u Ä‘Ã£i','open promotions','open promotion','xem Æ°u Ä‘Ã£i','open offers','view offers','danh sÃ¡ch Æ°u Ä‘Ã£i'], event:'open-promotions' },\r\n        { keywords:['má»Ÿ Ä‘Ã¡nh giÃ¡','open reviews','xem Ä‘Ã¡nh giÃ¡','xem pháº£n há»“i'], event:'open-reviews' },\r\n        { keywords:['má»Ÿ Ä‘áº·t phÃ²ng','Ä‘áº·t phÃ²ng ngay','booking now','book now','xem Ä‘áº·t phÃ²ng','mÃ n hÃ¬nh Ä‘áº·t phÃ²ng'], event:'open-booking' },\r\n        { keywords:['má»Ÿ há»“ sÆ¡','má»Ÿ profile','open profile','thÃ´ng tin cÃ¡ nhÃ¢n','xem há»“ sÆ¡','xem profile'], event:'open-profile' },\r\n        { keywords:['má»Ÿ thanh toÃ¡n','xem thanh toÃ¡n','payment history','má»Ÿ lá»‹ch sá»­ giao dá»‹ch','xem lá»‹ch sá»­ giao dá»‹ch','lá»‹ch sá»­ giao dá»‹ch','má»Ÿ lá»‹ch sá»­ thanh toÃ¡n','xem lá»‹ch sá»­ thanh toÃ¡n','xem giao dá»‹ch'], event:'open-payments' },\r\n        { keywords:['má»Ÿ thÃ´ng bÃ¡o','xem thÃ´ng bÃ¡o','open notifications','xem thÃ´ng bÃ¡o má»›i'], event:'open-notifications' },\r\n      ];\r\n      const found = commandMap.find(c => c.keywords.some(k => lower.includes(k)));\r\n      if (found) {\r\n        fire(found.event, { source:'chatbot', original: msg });\r\n        // Provide a local immediate bot acknowledgement without calling API\r\n        setMessages(m => [...m, { role:'bot', text: 'Äang má»Ÿ giao diá»‡n theo yÃªu cáº§u cá»§a báº¡n...' }]);\r\n        return; // skip server request for pure UI command\r\n      }\r\n    } catch {/* ignore command parse errors */}\r\n\r\n    setLoading(true);\r\n    try {\r\n      const res = await fetch('/api/ai/chat', { method:'POST', headers:{ 'Content-Type':'application/json', ...authHeaders() }, body: JSON.stringify({ message: msg, sessionId }) });\r\n      if(!res.ok) throw new Error('Lá»—i pháº£n há»“i');\r\n      const j = await res.json();\r\n      const next = [...messagesRef.current, { role:'bot', text: j.reply || '(khÃ´ng cÃ³ pháº£n há»“i)' }];\r\n      if (Array.isArray(j.results) && j.results.length) {\r\n        next.push({ role:'results', items: j.results.slice(0,8) });\r\n      }\r\n      if (Array.isArray(j.suggestions) && j.suggestions.length) {\r\n        next.push({ role:'suggest', suggestions: j.suggestions.slice(0,6) });\r\n      }\r\n      setMessages(next);\r\n    } catch(e){\r\n      setMessages(m => [...m, { role:'bot', text: 'Xin lá»—i, hiá»‡n chÆ°a pháº£n há»“i Ä‘Æ°á»£c.' }]);\r\n    } finally { setLoading(false); }\r\n  };\r\n\r\n  const openBooking = (roomName) => {\r\n    triggerRoomTypeSelection(roomName);\r\n  };\r\n\r\n  const clickSuggestion = (s) => { send(s); };\r\n\r\n  if(!open) return null;\r\n  return (\r\n    <div className=\"ai-chatbox-wrapper\" role=\"dialog\" aria-label=\"Chat há»— trá»£ AI\">\r\n      <div className=\"ai-chatbox-header\">\r\n        <div className=\"ai-chatbox-title\">Há»— trá»£ AI</div>\r\n        <button className=\"ai-chatbox-close\" aria-label=\"ÄÃ³ng\" onClick={onClose}>Ã—</button>\r\n      </div>\r\n      <div className=\"ai-chatbox-body\">\r\n        {messages.map((m,idx)=> {\r\n          if (m.role==='suggest') {\r\n            return (\r\n              <div key={idx} className=\"ai-suggest-row\">\r\n                {m.suggestions.map(s => <button key={s} type=\"button\" className=\"ai-suggest-btn\" onClick={()=>clickSuggestion(s)}>{s}</button>)}\r\n              </div>\r\n            );\r\n          }\r\n          if (m.role===ROOM_TYPE_LIST_ROLE) {\r\n            const preferred = (m.preferred || '').toString().toLowerCase();\r\n            const items = Array.isArray(m.items) ? m.items : [];\r\n            return (\r\n              <div key={idx} className=\"ai-roomtype-grid\">\r\n                {items.map((it) => {\r\n                  const isPreferred = preferred && it.name && it.name.toLowerCase() === preferred;\r\n                  const label = roomTypeLabel(it);\r\n                  return (\r\n                    <button\r\n                      key={`${it.id || it.name}`}\r\n                      type=\"button\"\r\n                      className={`ai-roomtype-card${isPreferred ? ' preferred' : ''}`}\r\n                      onClick={() => handleRoomTypeSelect(it)}\r\n                      disabled={roomsLoading}\r\n                    >\r\n                      <div className=\"ai-roomtype-name\">{it.name}</div>\r\n                      {it.hotelName && <div className=\"ai-roomtype-hotel\">{it.hotelName}</div>}\r\n                      <div className=\"ai-roomtype-meta\">\r\n                        {it.maxAdults ? `${it.maxAdults} NL` : 'â€”'} â€¢ {it.maxChildren ? `${it.maxChildren} TE` : 'â€”'}\r\n                      </div>\r\n                      <div className=\"ai-roomtype-price\">{formatCurrencyVND(it.basePrice)}</div>\r\n                      {isPreferred && <div className=\"ai-roomtype-tag\">Gá»£i Ã½</div>}\r\n                      <span className=\"sr-only\">Chá»n {label}</span>\r\n                    </button>\r\n                  );\r\n                })}\r\n              </div>\r\n            );\r\n          }\r\n          if (m.role===ROOM_LIST_ROLE) {\r\n            const rooms = Array.isArray(m.items) ? m.items : [];\r\n            return (\r\n              <div key={idx} className=\"ai-roomlist-grid\">\r\n                {rooms.map((room) => (\r\n                  <div key={room.id || room.roomNumber} className=\"ai-roomlist-card\">\r\n                    <div className=\"ai-roomlist-header\">\r\n                      <div className=\"ai-roomlist-title\">PhÃ²ng {room.roomNumber || 'KhÃ´ng xÃ¡c Ä‘á»‹nh'}</div>\r\n                      <div className={`ai-roomlist-status ${room.isBooked ? 'is-booked' : ''}`}>{describeRoomStatus(room.status, room.isBooked)}</div>\r\n                    </div>\r\n                    <div className=\"ai-roomlist-body\">\r\n                      <div className=\"ai-roomlist-info\">\r\n                        {room.hotelName && <div className=\"ai-roomlist-hotel\">{room.hotelName}</div>}\r\n                        <div className=\"ai-roomlist-meta\">Táº§ng {room.floor || 'â€”'} â€¢ {room.maxAdults || 0} NL â€¢ {room.maxChildren || 0} TE</div>\r\n                        <div className=\"ai-roomlist-price\">{formatCurrencyVND(room.basePrice)}</div>\r\n                      </div>\r\n                      {room.image ? (\r\n                        <div className=\"ai-roomlist-thumb\"><img src={room.image} alt={room.roomTypeName || 'PhÃ²ng'} /></div>\r\n                      ) : null}\r\n                    </div>\r\n                    <div className=\"ai-roomlist-actions\">\r\n                      <button type=\"button\" onClick={() => finalizeRoomBooking(room)}>Äáº·t phÃ²ng ngay</button>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            );\r\n          }\r\n          if (m.role==='results') {\r\n            return (\r\n              <div key={idx} className=\"ai-results-grid\">\r\n                {m.items.map(it => (\r\n                  <div key={it.id} className=\"ai-room-card\">\r\n                    <div className=\"ai-room-thumb\">{it.image ? <img src={it.image} alt={it.name} /> : <div className=\"ph-img-fallback\" />}</div>\r\n                    <div className=\"ai-room-name\">{it.name}</div>\r\n                    <div className=\"ai-room-meta\">{it.maxAdults} NL â€¢ {it.maxChildren} TE{it.rating ? ` â€¢ ${it.rating}â˜…` : ''}</div>\r\n                    <div className=\"ai-room-price\">{formatCurrencyVND(it.price)}</div>\r\n                    <button type=\"button\" className=\"ai-room-book\" onClick={()=>openBooking(it.name)}>Äáº·t phÃ²ng</button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            );\r\n          }\r\n          return <div key={idx} className={`ai-msg ai-msg-${m.role}`}>{m.text}</div>;\r\n        })}\r\n        {loading && <div className=\"ai-msg ai-msg-bot loading\">Äang gÃµ...</div>}\r\n        <div ref={bottomRef} />\r\n      </div>\r\n      <form className=\"ai-chatbox-input\" onSubmit={e=>{ e.preventDefault(); send(); }}>\r\n        <input\r\n          placeholder=\"Nháº­p tin nháº¯n...\"\r\n          value={input}\r\n          onChange={e=>setInput(e.target.value)}\r\n          onKeyDown={e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); } }}\r\n        />\r\n        <button type=\"submit\" disabled={!input.trim() || loading}>Gá»­i</button>\r\n      </form>\r\n      <style>{`\r\n  .ai-chatbox-wrapper { position:fixed; bottom:108px; right:120px; width:340px; max-width:90vw; background:#fff; border:1px solid #e2e8f0; border-radius:16px; box-shadow:0 8px 28px -4px rgba(0,0,0,.18),0 4px 12px -2px rgba(0,0,0,.12); display:flex; flex-direction:column; font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif; z-index:3000; animation:chatIn .35s cubic-bezier(.4,.2,.2,1); max-height:70vh; min-height:300px; }\r\n        @keyframes chatIn { from { opacity:0; transform:translateY(12px) scale(.96);} to { opacity:1; transform:translateY(0) scale(1);} }\r\n        .ai-chatbox-header { background:#f59f00; color:#fff; padding:10px 14px; border-radius:16px 16px 0 0; display:flex; align-items:center; justify-content:space-between; font-weight:600; letter-spacing:.3px; }\r\n        .ai-chatbox-close { background:transparent; border:none; color:#fff; font-size:20px; line-height:1; cursor:pointer; padding:4px 8px; }\r\n        .ai-chatbox-body { flex:1; padding:10px 12px 12px; overflow-y:auto; background:#fff; display:flex; flex-direction:column; gap:8px; overscroll-behavior:contain; }\r\n        /* Scrollbar tuá»³ biáº¿n (WebKit) */\r\n        .ai-chatbox-body::-webkit-scrollbar { width:8px; }\r\n        .ai-chatbox-body::-webkit-scrollbar-track { background:transparent; }\r\n        .ai-chatbox-body::-webkit-scrollbar-thumb { background:#dadfe4; border-radius:4px; }\r\n        .ai-chatbox-body::-webkit-scrollbar-thumb:hover { background:#c3c9d0; }\r\n        /* Firefox */\r\n        .ai-chatbox-body { scrollbar-width:thin; scrollbar-color:#c3c9d0 transparent; }\r\n        .ai-msg { max-width:80%; padding:8px 12px; border-radius:14px; font-size:14px; line-height:1.4; word-break:break-word; white-space:pre-wrap; }\r\n        .ai-msg-bot { background:#f1f5f9; color:#111; align-self:flex-start; border:1px solid #e2e8f0; }\r\n        .ai-msg-user { background:#f59f00; color:#fff; align-self:flex-end; box-shadow:0 2px 4px rgba(0,0,0,0.12); }\r\n        .ai-msg-bot.loading { opacity:.7; font-style:italic; }\r\n        .ai-chatbox-input { display:flex; align-items:center; gap:8px; border-top:1px solid #e2e8f0; padding:8px 10px; }\r\n        .ai-chatbox-input input { flex:1; border:1px solid #d0d7e0; border-radius:10px; padding:8px 10px; font-size:14px; }\r\n        .ai-chatbox-input input:focus { outline:none; border-color:#f59f00; box-shadow:0 0 0 2px rgba(245,159,0,.35); }\r\n        .ai-chatbox-input button { background:#f59f00; color:#fff; border:none; padding:8px 14px; border-radius:10px; font-size:14px; cursor:pointer; font-weight:600; }\r\n        .ai-chatbox-input button:disabled { opacity:.5; cursor:not-allowed; }\r\n        .ai-suggest-row { display:flex; flex-wrap:wrap; gap:6px; margin-top:2px; }\r\n        .ai-suggest-btn { background:#fff; border:1px solid #f59f00; color:#b06900; padding:4px 8px; border-radius:20px; font-size:12px; cursor:pointer; transition:.25s; }\r\n        .ai-suggest-btn:hover { background:#f59f00; color:#fff; }\r\n        .ai-results-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:10px; }\r\n        .ai-room-card { background:#fffaf3; border:1px solid #fbe4c2; border-radius:12px; padding:8px; display:flex; flex-direction:column; gap:6px; position:relative; box-shadow:0 2px 4px rgba(0,0,0,.04); }\r\n        .ai-room-thumb { width:100%; aspect-ratio:4/3; background:#f5f5f5; border-radius:8px; overflow:hidden; display:flex; align-items:center; justify-content:center; }\r\n        .ai-room-thumb img { width:100%; height:100%; object-fit:cover; display:block; }\r\n        .ai-room-name { font-weight:700; font-size:13px; letter-spacing:.2px; }\r\n        .ai-room-meta { font-size:11px; color:#555; }\r\n        .ai-room-price { font-size:12px; font-weight:800; color:#c2410c; }\r\n        .ai-room-book { background:#f59f00; color:#fff; border:none; border-radius:18px; padding:6px 10px; font-size:12px; font-weight:700; cursor:pointer; }\r\n        .ai-room-book:hover { background:#d97706; }\r\n        .ai-roomtype-grid { display:flex; flex-direction:column; gap:8px; }\r\n        .ai-roomtype-card { position:relative; background:#fffaf3; border:1px solid #fbe4c2; border-radius:12px; padding:10px 12px; text-align:left; display:flex; flex-direction:column; gap:4px; cursor:pointer; transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease; }\r\n        .ai-roomtype-card:hover { transform:translateY(-2px); box-shadow:0 6px 16px rgba(245,159,0,0.18); border-color:#f59f00; }\r\n        .ai-roomtype-card:disabled { opacity:0.6; cursor:not-allowed; transform:none; box-shadow:none; }\r\n        .ai-roomtype-card.preferred { border-color:#f59f00; box-shadow:0 0 0 2px rgba(245,159,0,.25); }\r\n        .ai-roomtype-name { font-weight:700; font-size:13px; color:#b45309; }\r\n        .ai-roomtype-hotel { font-size:12px; color:#475569; }\r\n        .ai-roomtype-meta { font-size:11px; color:#64748b; }\r\n        .ai-roomtype-price { font-size:12px; font-weight:700; color:#c2410c; }\r\n        .ai-roomtype-tag { position:absolute; top:8px; right:10px; background:#f59f00; color:#fff; padding:2px 8px; border-radius:10px; font-size:11px; font-weight:600; }\r\n        .ai-roomlist-grid { display:flex; flex-direction:column; gap:10px; }\r\n        .ai-roomlist-card { border:1px solid #e2e8f0; border-radius:14px; padding:10px 12px; background:#fff; box-shadow:0 4px 12px rgba(148,163,184,0.18); display:flex; flex-direction:column; gap:10px; }\r\n        .ai-roomlist-header { display:flex; align-items:center; justify-content:space-between; gap:8px; }\r\n        .ai-roomlist-title { font-weight:700; color:#0f172a; }\r\n        .ai-roomlist-status { font-size:11px; padding:4px 8px; border-radius:999px; background:#f1f5f9; color:#0f172a; font-weight:600; }\r\n        .ai-roomlist-status.is-booked { background:#fee2e2; color:#b91c1c; }\r\n        .ai-roomlist-body { display:flex; gap:10px; align-items:flex-start; }\r\n        .ai-roomlist-info { flex:1; display:flex; flex-direction:column; gap:4px; }\r\n        .ai-roomlist-hotel { font-size:12px; color:#475569; font-weight:600; }\r\n        .ai-roomlist-meta { font-size:12px; color:#64748b; }\r\n        .ai-roomlist-price { font-size:13px; font-weight:700; color:#c2410c; }\r\n        .ai-roomlist-thumb { width:80px; height:68px; border-radius:10px; overflow:hidden; background:#f5f5f5; flex-shrink:0; }\r\n        .ai-roomlist-thumb img { width:100%; height:100%; object-fit:cover; display:block; }\r\n        .ai-roomlist-actions { display:flex; justify-content:flex-end; }\r\n        .ai-roomlist-actions button { background:#f59f00; color:#fff; border:none; border-radius:14px; padding:6px 12px; font-size:12px; font-weight:600; cursor:pointer; }\r\n        .ai-roomlist-actions button:hover { background:#d97706; }\r\n        .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }\r\n  @media (max-width:600px){ .ai-chatbox-wrapper { right:12px; bottom:84px; width:300px; } }\r\n      `}</style>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}