{"ast":null,"code":"import _objectSpread from\"D:/DA_TichHop/HMS_AI Hotel/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useState}from'react';import{getUserRole,getUserEmail,isLoggedIn}from'./auth';import'./HomePage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function RoomTypeInline(_ref){var _data$roomType,_data$roomType3,_data$roomType4,_data$roomType5;let{name,onClose}=_ref;const[data,setData]=useState({roomType:null,rooms:[]});const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[dateRange,setDateRange]=useState({checkIn:'',checkOut:''});const[roomCount,setRoomCount]=useState(1);// Promotions feature removed\nconst[selectedIndex,setSelectedIndex]=useState(-1);const[selectedMap,setSelectedMap]=useState({});const[zoomUrl,setZoomUrl]=useState('');const[galleryIndex,setGalleryIndex]=useState(0);const[showDetails,setShowDetails]=useState(false);const[showCheckout,setShowCheckout]=useState(false);const[showCheckoutDetails,setShowCheckoutDetails]=useState(false);const[payMethod,setPayMethod]=useState('MOMO');const role=getUserRole();const isAdmin=useMemo(()=>{try{return String(role||'').toLowerCase().includes('admin');}catch(_unused){return false;}},[role]);const[agree,setAgree]=useState(false);// QR flow removed – only direct redirect payment flow retained\nconst[showReviews,setShowReviews]=useState(false);const[reviews,setReviews]=useState({list:[],avg:0,loading:false,error:''});// Removed QR base URL detection effect\nuseEffect(()=>{if(!name)return;let active=true;setLoading(true);setError('');setSelectedIndex(-1);setSelectedMap({});const params=new URLSearchParams();if(dateRange.checkIn)params.set('checkIn',dateRange.checkIn);if(dateRange.checkOut)params.set('checkOut',dateRange.checkOut);// Cache bust: ensure fresh status for red/yellow/green dots\nparams.set('_',String(Date.now()));fetch(\"/api/room-types/\".concat(encodeURIComponent(name),\"/rooms\").concat(params.toString()?'?'+params.toString():''),{cache:'no-store'}).then(async res=>{if(!res.ok){const j=await res.json().catch(()=>({}));throw new Error(j.message||\"HTTP \".concat(res.status));}return res.json();}).then(j=>{if(active)setData(j);}).catch(err=>{if(active)setError(err.message||'Lỗi tải dữ liệu');}).finally(()=>{if(active)setLoading(false);});return()=>{active=false;};},[name,dateRange.checkIn,dateRange.checkOut]);const selectedRoom=useMemo(()=>data.rooms[selectedIndex]||null,[data.rooms,selectedIndex]);const galleryImages=useMemo(()=>{if(!selectedRoom)return[];const arr=[];if(selectedRoom.image)arr.push(selectedRoom.image);return arr;},[selectedRoom]);const selectedIds=useMemo(()=>Object.keys(selectedMap).map(id=>Number(id)),[selectedMap]);const selectedRooms=useMemo(()=>data.rooms.filter(r=>selectedIds.includes(r.id)),[data.rooms,selectedIds]);const nights=useMemo(()=>{if(!dateRange.checkIn||!dateRange.checkOut)return 0;const inD=new Date(dateRange.checkIn);const outD=new Date(dateRange.checkOut);const ms=outD.setHours(0,0,0,0)-inD.setHours(0,0,0,0);return ms>0?Math.ceil(ms/(1000*60*60*24)):0;},[dateRange]);const baseSum=useMemo(()=>selectedRooms.reduce((s,r)=>s+Number(r.basePrice||0),0),[selectedRooms]);const totalPrice=useMemo(()=>baseSum*(nights||0),[baseSum,nights]);const totalGuests=useMemo(()=>selectedRooms.reduce((sum,r)=>{const sel=selectedMap[String(r.id)]||{adults:0,children:0};return sum+Number(sel.adults||0)+Number(sel.children||0);},0),[selectedRooms,selectedMap]);const now=new Date();const isValidDates=useMemo(()=>{if(!dateRange.checkIn||!dateRange.checkOut)return false;const inD=new Date(dateRange.checkIn);const outD=new Date(dateRange.checkOut);const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());return inD>today&&outD>inD;},[dateRange,now]);// Helpers for date inputs and warnings\nconst pad2=n=>String(n).padStart(2,'0');const fmtDate=d=>\"\".concat(d.getFullYear(),\"-\").concat(pad2(d.getMonth()+1),\"-\").concat(pad2(d.getDate()));const todayLocal=new Date(now.getFullYear(),now.getMonth(),now.getDate());const minCheckInDate=new Date(todayLocal.getFullYear(),todayLocal.getMonth(),todayLocal.getDate()+1);const minCheckInStr=fmtDate(minCheckInDate);const minCheckOutStr=useMemo(()=>{if(dateRange.checkIn){const inD=new Date(dateRange.checkIn);const d=new Date(inD.getFullYear(),inD.getMonth(),inD.getDate()+1);return fmtDate(d);}const d=new Date(minCheckInDate.getFullYear(),minCheckInDate.getMonth(),minCheckInDate.getDate()+1);return fmtDate(d);},[dateRange.checkIn,now]);const dateError=useMemo(()=>{if(!dateRange.checkIn||!dateRange.checkOut)return'';const inD=new Date(dateRange.checkIn);const outD=new Date(dateRange.checkOut);const today=new Date(now.getFullYear(),now.getMonth(),now.getDate());if(!(inD>today))return'Ngày nhận phải sau ngày hiện tại';if(!(outD>inD))return'Ngày trả phải sau ngày nhận';return'';},[dateRange,now]);const loggedIn=isLoggedIn();// Điều kiện dữ liệu đã đủ (không xét đăng nhập)\nconst baseReady=useMemo(()=>selectedRooms.length>0&&totalGuests>1&&isValidDates&&nights>0,[selectedRooms.length,totalGuests,isValidDates,nights]);// Điều kiện thực sự có thể mở checkout\nconst canBook=loggedIn&&baseReady;const canPay=useMemo(()=>canBook&&agree&&!!payMethod,[canBook,agree,payMethod]);useEffect(()=>{// If reduced roomCount below current selected, trim selection deterministically\nconst max=Math.max(1,Number(roomCount||1));const ids=Object.keys(selectedMap);if(ids.length>max){const keep=new Set(ids.slice(0,max));const next={};ids.slice(0,max).forEach(id=>{next[id]=selectedMap[id];});setSelectedMap(next);}},[roomCount]);const toggleSelectRoom=room=>{const id=String(room.id);const isSelected=!!selectedMap[id];if(isSelected){const next=_objectSpread({},selectedMap);delete next[id];setSelectedMap(next);return;}const max=Math.max(1,Number(roomCount||1));const ids=Object.keys(selectedMap);if(ids.length>=max){if(max===1){// replace existing selection with the new room\nsetSelectedMap({[id]:{adults:0,children:0}});}else{return;// reach limit for multi-selection\n}}else{setSelectedMap(_objectSpread(_objectSpread({},selectedMap),{},{[id]:{adults:0,children:0}}));}};const updateCounts=(room,kind,value)=>{const id=String(room.id);if(!selectedMap[id])return;setSelectedMap(_objectSpread(_objectSpread({},selectedMap),{},{[id]:_objectSpread(_objectSpread({},selectedMap[id]),{},{[kind]:Number(value)})}));};if(!name)return null;return/*#__PURE__*/_jsxs(\"section\",{className:\"rt-inline\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-toolbar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-field rt-field--wide\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ng\\xE0y nh\\u1EADn - tr\\u1EA3 ph\\xF2ng\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-date-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",min:minCheckInStr,\"aria-invalid\":dateRange.checkIn?new Date(dateRange.checkIn)<=todayLocal:false,value:dateRange.checkIn,onChange:e=>{const newIn=e.target.value;setDateRange(v=>{let newOut=v.checkOut;if(newOut&&!(new Date(newOut)>new Date(newIn))){newOut='';}return _objectSpread(_objectSpread({},v),{},{checkIn:newIn,checkOut:newOut});});}}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",min:minCheckOutStr,\"aria-invalid\":dateRange.checkOut&&dateRange.checkIn?new Date(dateRange.checkOut)<=new Date(dateRange.checkIn):false,value:dateRange.checkOut,onChange:e=>setDateRange(v=>_objectSpread(_objectSpread({},v),{},{checkOut:e.target.value}))})]}),dateError&&/*#__PURE__*/_jsx(\"div\",{className:\"rt-date-error\",style:{color:'#d93025',fontSize:12,marginTop:6},children:dateError})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-field\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"S\\u1ED1 ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:1,value:roomCount,onChange:e=>setRoomCount(Math.max(1,Number(e.target.value)))})]}),/*#__PURE__*/_jsx(\"button\",{className:\"rt-search-btn\",disabled:!dateRange.checkIn||!dateRange.checkOut||!isValidDates,children:\"T\\xCCM KI\\u1EBEM\"}),onClose&&/*#__PURE__*/_jsx(\"button\",{className:\"rt-close-btn\",onClick:onClose,children:\"\\u0110\\xD3NG\"})]}),loading&&/*#__PURE__*/_jsx(\"div\",{children:\"\\u0110ang t\\u1EA3i...\"}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'red'},children:error}),!loading&&!error&&/*#__PURE__*/_jsxs(\"div\",{className:\"rt-grid\",children:[/*#__PURE__*/_jsxs(\"section\",{className:\"rt-list\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-legend\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"rt-legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"rt-status-dot red\"}),\" \\u0110\\xE3 \\u0111\\u01B0\\u1EE3c \\u0111\\u1EB7t\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"rt-legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"rt-status-dot yellow\"}),\" \\u0110ang \\u0111\\u01B0\\u1EE3c \\u0111\\u1EB7t\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"rt-legend-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"rt-status-dot green\"}),\" Tr\\u1ED1ng\"]})]}),data.rooms.length===0?/*#__PURE__*/_jsx(\"div\",{children:\"Ch\\u01B0a c\\xF3 ph\\xF2ng n\\xE0o thu\\u1ED9c h\\u1EA1ng ph\\xF2ng n\\xE0y.\"}):data.rooms.map((r,idx)=>{const isSelected=!!selectedMap[String(r.id)];const hasDates=!!(dateRange.checkIn&&dateRange.checkOut);const isBooked=hasDates?!!r.isBooked:r.status==='Occupied';const adultsMax=Number(r.maxAdults||0);const childrenMax=Number(r.maxChildren||0);const adultsVal=isSelected?selectedMap[String(r.id)].adults:0;const childrenVal=isSelected?selectedMap[String(r.id)].children:0;return/*#__PURE__*/_jsxs(\"div\",{className:\"rt-card \".concat(isSelected?'selected':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-main\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rt-thumb\",children:r.image&&/*#__PURE__*/_jsx(\"img\",{src:r.image,alt:r.roomNumber,onClick:()=>setZoomUrl(r.image)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-info\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"rt-name\",onClick:()=>{setSelectedIndex(idx);setGalleryIndex(0);setShowDetails(true);},style:{cursor:'pointer',display:'flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsx(\"span\",{children:\"Ph\\xF2ng \".concat(r.roomNumber).concat(r.floor!=null?\" * T\\u1EA7ng \".concat(r.floor):'')}),/*#__PURE__*/_jsx(\"span\",{className:\"rt-status-dot \".concat(isBooked?'red':isSelected?'yellow':'green'),title:isBooked?'Đã đặt':isSelected?'Đang đặt':'Trống'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-cap\",children:[\"T\\u1ED1i \\u0111a \",adultsMax,\" ng\\u01B0\\u1EDDi l\\u1EDBn | \",childrenMax,\" tr\\u1EBB em\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-price\",children:[\"Gi\\xE1 t\\u1EEB \",Number(r.basePrice||0).toLocaleString('vi-VN'),\" VND/\\u0111\\xEAm\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"rt-actions\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"rt-choose\",onClick:()=>{if(isBooked)return;toggleSelectRoom(r);},disabled:isBooked,title:isBooked?'Phòng đã được đặt trong khoảng thời gian này':'',children:isBooked?'ĐÃ ĐẶT':isSelected?'BỎ CHỌN':'CHỌN'})})]}),isSelected&&/*#__PURE__*/_jsxs(\"div\",{className:\"rt-extra\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-note-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rt-note\",children:\"\\u0110\\xE3 bao g\\u1ED3m \\u0103n s\\xE1ng \\u2022 Kh\\xF4ng ho\\xE0n tr\\u1EA3 ph\\xED khi h\\u1EE7y ph\\xF2ng\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-selects\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Ch\\u1ECDn s\\u1ED1 ng\\u01B0\\u1EDDi l\\u1EDBn\",/*#__PURE__*/_jsx(\"select\",{value:adultsVal,onChange:e=>updateCounts(r,'adults',e.target.value),children:Array.from({length:adultsMax+1},(_,i)=>/*#__PURE__*/_jsx(\"option\",{value:i,children:i},i))})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\". Tr\\u1EBB em\",/*#__PURE__*/_jsx(\"select\",{value:childrenVal,onChange:e=>updateCounts(r,'children',e.target.value),children:Array.from({length:childrenMax+1},(_,i)=>/*#__PURE__*/_jsx(\"option\",{value:i,children:i},i))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-price-2\",children:[\"Gi\\xE1 t\\u1EEB \",Number(r.basePrice||0).toLocaleString('vi-VN'),\" VND/\\u0111\\xEAm\"]})]})]},r.id);})]}),/*#__PURE__*/_jsxs(\"aside\",{className:\"rt-detail\",children:[(!showDetails||!(selectedIndex>=0&&selectedRoom))&&!showCheckout&&/*#__PURE__*/_jsx(\"div\",{className:\"rt-detail-inner\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-title\",style:{cursor:selectedRoom?'pointer':'default'},onClick:()=>{if(selectedRoom)setShowDetails(true);},children:\"Th\\xF4ng tin \\u0111\\u1EB7t ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-hotel\",children:((_data$roomType=data.roomType)===null||_data$roomType===void 0?void 0:_data$roomType.name)||name}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-dates\",children:[dateRange.checkIn||'dd/mm/yyyy',\" - \",dateRange.checkOut||'dd/mm/yyyy']}),/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-sep\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-title\",children:\"Th\\xF4ng tin ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-list\",children:selectedRooms.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-line\",children:\"Ch\\u01B0a ch\\u1ECDn ph\\xF2ng\"}):selectedRooms.map(r=>{var _sel$adults,_sel$children;const sel=selectedMap[String(r.id)];return/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-room\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Ph\\xF2ng: \",r.roomNumber,r.floor!=null?\" \\u2022 T\\u1EA7ng \".concat(r.floor):'']}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Ng\\u01B0\\u1EDDi l\\u1EDBn: \",(_sel$adults=sel===null||sel===void 0?void 0:sel.adults)!==null&&_sel$adults!==void 0?_sel$adults:0]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Tr\\u1EBB em: \",(_sel$children=sel===null||sel===void 0?void 0:sel.children)!==null&&_sel$children!==void 0?_sel$children:0]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Gi\\xE1: \",Number(r.basePrice||0).toLocaleString('vi-VN'),\" VND/\\u0111\\xEAm\"]})]},r.id);})}),/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-sep\"}),!baseReady&&/*#__PURE__*/_jsx(\"div\",{className:\"rt-warning\",children:\"L\\u01B0u \\xFD: H\\xE3y ch\\u1ECDn ph\\xF2ng, Ng\\xE0y nh\\u1EADn - ng\\xE0y tr\\u1EA3, v\\xE0 s\\u1ED1 l\\u01B0\\u1EE3ng kh\\xE1ch (t\\u1ED5ng > 1) \\u0111\\u1EC3 chu\\u1EA9n b\\u1ECB \\u0111\\u1EB7t ph\\xF2ng.\"}),baseReady&&!loggedIn&&/*#__PURE__*/_jsx(\"div\",{className:\"rt-warning\",children:\"B\\u1EA1n \\u0111\\xE3 ch\\u1ECDn \\u0111\\u1EE7 th\\xF4ng tin. Vui l\\xF2ng \\u0111\\u0103ng nh\\u1EADp \\u0111\\u1EC3 ti\\u1EBFp t\\u1EE5c \\u0111\\u1EB7t ph\\xF2ng.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-total\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"T\\u1ED5ng c\\u1ED9ng (\",nights,\" \\u0111\\xEAm)\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[Number(totalPrice).toLocaleString('vi-VN'),\" VND\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-actions-vertical\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"rt-review-btn\",onClick:async()=>{setShowReviews(true);setReviews(r=>_objectSpread(_objectSpread({},r),{},{loading:true,error:''}));try{var _data$roomType2;const params=new URLSearchParams();if(selectedRoom)params.set('roomId',String(selectedRoom.id));else params.set('roomType',((_data$roomType2=data.roomType)===null||_data$roomType2===void 0?void 0:_data$roomType2.name)||name);params.set('_',String(Date.now()));const res=await fetch(\"/api/public-reviews?\".concat(params.toString()),{cache:'no-store'});if(!res.ok)throw new Error('Không tải được đánh giá');const j=await res.json();setReviews({list:Array.isArray(j.reviews)?j.reviews:[],avg:Number(j.avgRating||0),loading:false,error:''});}catch(e){setReviews({list:[],avg:0,loading:false,error:e.message||'Lỗi tải đánh giá'});}},style:{whiteSpace:'nowrap'},children:\"xem \\u0111\\xE1nh gi\\xE1\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"rt-book-btn \".concat(baseReady?'enabled':'',\" \").concat(canBook?'can-book':''),disabled:!baseReady||isAdmin,onClick:()=>{if(isAdmin){alert('Tài khoản Admin không được phép đặt phòng');return;}if(!loggedIn)return;// chỉ không mở checkout\nsetShowCheckoutDetails(false);setShowCheckout(true);},onMouseEnter:e=>{if(baseReady&&!loggedIn){e.currentTarget.setAttribute('data-tip','Vui lòng Đăng nhập để đặt phòng!');}},onMouseLeave:e=>{e.currentTarget.removeAttribute('data-tip');},children:[canBook?'ĐẶT PHÒNG':baseReady?'ĐẶT PHÒNG':'ĐẶT PHÒNG',!loggedIn&&baseReady&&/*#__PURE__*/_jsx(\"span\",{className:\"rt-btn-hint\",children:\" (\\u0110\\u0103ng nh\\u1EADp \\u0111\\u1EC3 ti\\u1EBFp t\\u1EE5c)\"})]})]})]})}),showDetails&&!showCheckout&&selectedIndex>=0&&selectedRoom&&/*#__PURE__*/_jsx(\"div\",{className:\"rt-detail-inner\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-title\",style:{cursor:'pointer'},onClick:()=>setShowDetails(false),children:\"Chi ti\\u1EBFt ph\\xF2ng (nh\\u1EA5n \\u0111\\u1EC3 quay l\\u1EA1i \\u0111\\u1EB7t ph\\xF2ng)\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-gallery\",style:{marginBottom:10},children:[/*#__PURE__*/_jsx(\"div\",{style:{position:'relative',borderRadius:8,overflow:'hidden',height:180,background:'#f5f5f5'},children:galleryImages.length>0&&/*#__PURE__*/_jsx(\"img\",{src:galleryImages[galleryIndex%galleryImages.length],alt:\"\\u1EA2nh ph\\xF2ng\",style:{width:'100%',height:'100%',objectFit:'cover',display:'block'}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-gallery-controls\",style:{display:'flex',justifyContent:'center',gap:10,marginTop:8},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn\",disabled:galleryImages.length<=1,onClick:()=>setGalleryIndex(i=>(i-1+galleryImages.length)%galleryImages.length),children:'<'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn\",disabled:galleryImages.length<=1,onClick:()=>setGalleryIndex(i=>(i+1)%galleryImages.length),children:'>'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-list\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"S\\u1ED1 ph\\xF2ng: \",selectedRoom.roomNumber]}),selectedRoom.floor!=null&&/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"T\\u1EA7ng: \",selectedRoom.floor]}),typeof selectedRoom.status!=='undefined'&&/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Tr\\u1EA1ng th\\xE1i: \",String(selectedRoom.status)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Lo\\u1EA1i ph\\xF2ng: \",((_data$roomType3=data.roomType)===null||_data$roomType3===void 0?void 0:_data$roomType3.name)||name]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"S\\u1EE9c ch\\u1EE9a: \",Number(selectedRoom.maxAdults||0),\" ng\\u01B0\\u1EDDi l\\u1EDBn, \",Number(selectedRoom.maxChildren||0),\" tr\\u1EBB em\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Gi\\xE1 c\\u01A1 b\\u1EA3n: \",Number(selectedRoom.basePrice||0).toLocaleString('vi-VN'),\" VND/\\u0111\\xEAm\"]}),((_data$roomType4=data.roomType)===null||_data$roomType4===void 0?void 0:_data$roomType4.description)&&/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"M\\xF4 t\\u1EA3: \",data.roomType.description]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"rt-summary-sep\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-actions-vertical\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"rt-review-btn\",onClick:async()=>{setShowReviews(true);setReviews(r=>_objectSpread(_objectSpread({},r),{},{loading:true,error:''}));try{const params=new URLSearchParams();params.set('roomId',String(selectedRoom.id));params.set('_',String(Date.now()));const res=await fetch(\"/api/public-reviews?\".concat(params.toString()),{cache:'no-store'});if(!res.ok)throw new Error('Không tải được đánh giá');const j=await res.json();setReviews({list:Array.isArray(j.reviews)?j.reviews:[],avg:Number(j.avgRating||0),loading:false,error:''});}catch(e){setReviews({list:[],avg:0,loading:false,error:e.message||'Lỗi tải đánh giá'});}},style:{whiteSpace:'nowrap'},children:\"xem \\u0111\\xE1nh gi\\xE1\"}),/*#__PURE__*/_jsx(\"button\",{className:\"rt-book-btn \".concat(baseReady?'enabled':''),onClick:()=>{if(isAdmin){alert('Tài khoản Admin không được phép đặt phòng');return;}if(!loggedIn)return;setShowDetails(false);setShowCheckoutDetails(false);setShowCheckout(true);},disabled:!baseReady||isAdmin,onMouseEnter:e=>{if(baseReady&&!loggedIn)e.currentTarget.setAttribute('data-tip','Vui lòng Đăng nhập để đặt phòng!');},onMouseLeave:e=>e.currentTarget.removeAttribute('data-tip'),children:canBook?'ĐẶT PHÒNG':'ĐẶT PHÒNG'})]})]})}),showCheckout&&/*#__PURE__*/_jsx(\"div\",{className:\"rt-detail-inner\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-panel\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"checkout-main-title\",children:\"Thanh To\\xE1n\"}),/*#__PURE__*/_jsx(\"div\",{className:\"checkout-header\",children:/*#__PURE__*/_jsx(\"div\",{className:\"checkout-title\",children:\"Th\\xF4ng Tin \\u0110\\u1EB7t Ph\\xF2ng\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-body\",children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,marginBottom:4},children:((_data$roomType5=data.roomType)===null||_data$roomType5===void 0?void 0:_data$roomType5.name)||name}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#555',marginBottom:8},children:[dateRange.checkIn||'dd/mm/yyyy',\" - \",dateRange.checkOut||'dd/mm/yyyy']}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-info-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"checkout-section-title\",style:{margin:0},children:\"Th\\xF4ng Tin Ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"checkout-inline-toggle\",onClick:()=>setShowCheckoutDetails(v=>!v),children:showCheckoutDetails?'Ẩn Thông Tin':'Xem Thông Tin'})]}),showCheckoutDetails&&/*#__PURE__*/_jsx(\"div\",{className:\"checkout-room-list\",children:selectedRooms.length===0?/*#__PURE__*/_jsx(\"div\",{children:\"Ch\\u01B0a ch\\u1ECDn ph\\xF2ng\"}):selectedRooms.map(r=>{var _sel$adults2,_sel$children2;const sel=selectedMap[String(r.id)];return/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-room\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Ph\\xF2ng: \",r.roomNumber,r.floor!=null?\" \\u2022 T\\u1EA7ng \".concat(r.floor):'']}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Ng\\u01B0\\u1EDDi l\\u1EDBn: \",(_sel$adults2=sel===null||sel===void 0?void 0:sel.adults)!==null&&_sel$adults2!==void 0?_sel$adults2:0,\" \\u2022 Tr\\u1EBB em: \",(_sel$children2=sel===null||sel===void 0?void 0:sel.children)!==null&&_sel$children2!==void 0?_sel$children2:0]}),/*#__PURE__*/_jsxs(\"div\",{className:\"rt-summary-line\",children:[\"Gi\\xE1: \",Number(r.basePrice||0).toLocaleString('vi-VN'),\" VND/\\u0111\\xEAm\"]})]},r.id);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-line\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"S\\u1ED1 \\u0111\\xEAm\"}),/*#__PURE__*/_jsxs(\"span\",{children:[nights,\" \\u0111\\xEAm\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-line\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Gi\\xE1 ph\\xF2ng\"}),/*#__PURE__*/_jsxs(\"span\",{children:[Number(totalPrice).toLocaleString('vi-VN'),\" VND\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-line\",style:{alignItems:'stretch',flexDirection:'column',gap:6},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700},children:\"Ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"checkout-pay-method\",value:payMethod,onChange:e=>setPayMethod(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"MOMO\",children:\"V\\xED \\u0111i\\u1EC7n t\\u1EED MOMO\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ZALOPAY\",children:\"ZaloPay\"}),/*#__PURE__*/_jsx(\"option\",{value:\"VNPAY\",children:\"VNPay\"}),/*#__PURE__*/_jsx(\"option\",{value:\"CARD\",children:\"Th\\u1EBB t\\xEDn d\\u1EE5ng/ghi n\\u1EE3\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"checkout-terms\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:agree,onChange:e=>setAgree(e.target.checked)}),/*#__PURE__*/_jsx(\"span\",{children:\"Vui l\\xF2ng \\u0111\\u1ECDc k\\u0129 v\\xE0 \\u0111\\u1ED3ng \\xFD v\\u1EDBi \\u0111i\\u1EC1u kho\\u1EA3n b\\u1EB1ng c\\xE1ch \\u0111\\xE1nh d\\u1EA5u v\\xE0o \\xF4 b\\xEAn c\\u1EA1nh\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-total\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"T\\u1ED5ng c\\u1ED9ng\"}),/*#__PURE__*/_jsxs(\"span\",{children:[Number(totalPrice).toLocaleString('vi-VN'),\" VND\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"checkout-actions\",style:{display:'flex',gap:8,flexWrap:'wrap'},children:/*#__PURE__*/_jsx(\"button\",{className:\"checkout-btn\",disabled:!canPay||isAdmin,onClick:()=>{var _data$roomType6,_data$roomType7,_data$roomType8;if(isAdmin){alert('Tài khoản Admin không được phép đặt phòng');return;}// Flow mới: chuyển hướng trực tiếp sang trang /payment/confirm\nconst t=Math.random().toString(36).slice(2)+Date.now().toString(36);const totals=selectedRooms.reduce((acc,r)=>{const sel=selectedMap[String(r.id)]||{adults:0,children:0};acc.ad+=Number(sel.adults||0);acc.ch+=Number(sel.children||0);return acc;},{ad:0,ch:0});const pad2=n=>String(n).padStart(2,'0');const nowD=new Date();const bookingCode=\"HMS\".concat(nowD.getFullYear()).concat(pad2(nowD.getMonth()+1)).concat(pad2(nowD.getDate()));const roomNames=selectedRooms.map(r=>\"Ph\\xF2ng \".concat(r.roomNumber).concat(r.floor!=null?\" \\u2022 T\\u1EA7ng \".concat(r.floor):'')).join(', ');let userEmail='';try{const u=localStorage.getItem('hmsUser');if(u)userEmail=(JSON.parse(u).email||'').trim();}catch(_unused2){}const grossAmount=Number(totalPrice)||0;const summary={token:t,code:bookingCode,hotelId:((_data$roomType6=data.roomType)===null||_data$roomType6===void 0?void 0:_data$roomType6.hotelId)||null,hotel:((_data$roomType7=data.roomType)===null||_data$roomType7===void 0?void 0:_data$roomType7.hotelName)||'',roomType:((_data$roomType8=data.roomType)===null||_data$roomType8===void 0?void 0:_data$roomType8.name)||name,roomNames,checkIn:dateRange.checkIn,checkOut:dateRange.checkOut,checkInTime:'14:00',checkOutTime:'12:00',payMethod,userEmail,adults:totals.ad,children:totals.ch,rooms:selectedRooms.map(r=>{const sel=selectedMap[String(r.id)]||{adults:0,children:0};return{id:r.id,number:r.roomNumber,floor:r.floor,price:r.basePrice,name:r.roomNumber,adults:sel.adults,children:sel.children};}),amount:grossAmount};// promotion fields removed from summary\ntry{localStorage.setItem('hmsBooking:'+t,JSON.stringify(summary));}catch(_unused3){}// Pass gross amount in query (PaymentConfirm will apply discount from summary)\nconst q=[\"token=\".concat(encodeURIComponent(t)),\"code=\".concat(encodeURIComponent(summary.code)),\"amount=\".concat(encodeURIComponent(grossAmount)),\"hid=\".concat(encodeURIComponent(summary.hotelId||'')),\"rn=\".concat(encodeURIComponent(roomNames)),\"rt=\".concat(encodeURIComponent(summary.roomType||'')),\"ci=\".concat(encodeURIComponent(summary.checkIn||'')),\"co=\".concat(encodeURIComponent(summary.checkOut||'')),\"ad=\".concat(encodeURIComponent(summary.adults)),\"ch=\".concat(encodeURIComponent(summary.children))].join('&');window.location.href='/payment/confirm?'+q;},children:\"THANH TO\\xC1N\"})})]})]})})]})]}),showReviews&&/*#__PURE__*/_jsx(\"div\",{className:\"qr-overlay\",onClick:()=>setShowReviews(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"qr-box\",onClick:e=>e.stopPropagation(),style:{width:680,maxWidth:'96%'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"qr-title\",style:{display:'flex',justifyContent:'space-between',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0110\\xE1nh gi\\xE1 ph\\xF2ng\"}),/*#__PURE__*/_jsx(\"button\",{className:\"qr-close\",onClick:()=>setShowReviews(false),children:\"\\u0110\\xF3ng\"})]}),reviews.loading?/*#__PURE__*/_jsx(\"div\",{style:{padding:10,color:'#666'},children:\"\\u0110ang t\\u1EA3i \\u0111\\xE1nh gi\\xE1...\"}):reviews.error?/*#__PURE__*/_jsx(\"div\",{style:{padding:10,color:'#b42318'},children:reviews.error}):reviews.list.length===0?/*#__PURE__*/_jsx(\"div\",{style:{padding:10,color:'#666'},children:\"Ch\\u01B0a c\\xF3 \\u0111\\xE1nh gi\\xE1 n\\xE0o cho ph\\xF2ng n\\xE0y.\"}):/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'left'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:800,margin:'4px 0 10px'},children:[\"Trung b\\xECnh: \",reviews.avg.toFixed(1),\" / 5.0 \\u2605\"]}),/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:360,overflowY:'auto'},children:reviews.list.map(rv=>/*#__PURE__*/_jsxs(\"div\",{style:{borderTop:'1px solid #eee',padding:'8px 0'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:700},children:rv.user||'Khách'}),/*#__PURE__*/_jsxs(\"div\",{style:{fontWeight:700,color:'#444'},children:[Number(rv.rating||0).toFixed(1),\" / 5.0 \\u2605\"]})]}),/*#__PURE__*/_jsx(\"div\",{style:{color:'#555',marginTop:4},children:rv.comment||'(Không có nhận xét)'}),/*#__PURE__*/_jsxs(\"div\",{style:{color:'#888',fontSize:12,marginTop:4},children:[rv.hotelName,rv.roomName?\" \\u2022 Ph\\xF2ng \".concat(rv.roomName):'']})]},rv.id))})]})]})}),zoomUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"rt-zoom\",onClick:()=>setZoomUrl(''),children:/*#__PURE__*/_jsx(\"img\",{src:zoomUrl,alt:\"Xem \\u1EA3nh ph\\xF2ng\"})})]});}","map":{"version":3,"names":["React","useEffect","useMemo","useState","getUserRole","getUserEmail","isLoggedIn","jsx","_jsx","jsxs","_jsxs","RoomTypeInline","_ref","_data$roomType","_data$roomType3","_data$roomType4","_data$roomType5","name","onClose","data","setData","roomType","rooms","loading","setLoading","error","setError","dateRange","setDateRange","checkIn","checkOut","roomCount","setRoomCount","selectedIndex","setSelectedIndex","selectedMap","setSelectedMap","zoomUrl","setZoomUrl","galleryIndex","setGalleryIndex","showDetails","setShowDetails","showCheckout","setShowCheckout","showCheckoutDetails","setShowCheckoutDetails","payMethod","setPayMethod","role","isAdmin","String","toLowerCase","includes","_unused","agree","setAgree","showReviews","setShowReviews","reviews","setReviews","list","avg","active","params","URLSearchParams","set","Date","now","fetch","concat","encodeURIComponent","toString","cache","then","res","ok","j","json","catch","Error","message","status","err","finally","selectedRoom","galleryImages","arr","image","push","selectedIds","Object","keys","map","id","Number","selectedRooms","filter","r","nights","inD","outD","ms","setHours","Math","ceil","baseSum","reduce","s","basePrice","totalPrice","totalGuests","sum","sel","adults","children","isValidDates","today","getFullYear","getMonth","getDate","pad2","n","padStart","fmtDate","d","todayLocal","minCheckInDate","minCheckInStr","minCheckOutStr","dateError","loggedIn","baseReady","length","canBook","canPay","max","ids","keep","Set","slice","next","forEach","toggleSelectRoom","room","isSelected","_objectSpread","updateCounts","kind","value","className","type","min","onChange","e","newIn","target","v","newOut","style","color","fontSize","marginTop","disabled","onClick","idx","hasDates","isBooked","adultsMax","maxAdults","childrenMax","maxChildren","adultsVal","childrenVal","src","alt","roomNumber","cursor","display","alignItems","gap","floor","title","toLocaleString","Array","from","_","i","_sel$adults","_sel$children","_data$roomType2","isArray","avgRating","whiteSpace","alert","onMouseEnter","currentTarget","setAttribute","onMouseLeave","removeAttribute","marginBottom","position","borderRadius","overflow","height","background","width","objectFit","justifyContent","description","fontWeight","margin","_sel$adults2","_sel$children2","flexDirection","checked","flexWrap","_data$roomType6","_data$roomType7","_data$roomType8","t","random","totals","acc","ad","ch","nowD","bookingCode","roomNames","join","userEmail","u","localStorage","getItem","JSON","parse","email","trim","_unused2","grossAmount","summary","token","code","hotelId","hotel","hotelName","checkInTime","checkOutTime","number","price","amount","setItem","stringify","_unused3","q","window","location","href","stopPropagation","maxWidth","padding","textAlign","toFixed","maxHeight","overflowY","rv","borderTop","user","rating","comment","roomName"],"sources":["D:/DA_TichHop/HMS_AI Hotel/client/src/RoomTypeInline.js"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { getUserRole, getUserEmail, isLoggedIn } from './auth';\r\nimport './HomePage.css';\r\n\r\nexport default function RoomTypeInline({ name, onClose }) {\r\n  const [data, setData] = useState({ roomType: null, rooms: [] });\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [dateRange, setDateRange] = useState({ checkIn: '', checkOut: '' });\r\n  const [roomCount, setRoomCount] = useState(1);\r\n  // Promotions feature removed\r\n  const [selectedIndex, setSelectedIndex] = useState(-1);\r\n  const [selectedMap, setSelectedMap] = useState({});\r\n  const [zoomUrl, setZoomUrl] = useState('');\r\n  const [galleryIndex, setGalleryIndex] = useState(0);\r\n  const [showDetails, setShowDetails] = useState(false);\r\n  const [showCheckout, setShowCheckout] = useState(false);\r\n  const [showCheckoutDetails, setShowCheckoutDetails] = useState(false);\r\n  const [payMethod, setPayMethod] = useState('MOMO');\r\n  const role = getUserRole();\r\n  const isAdmin = useMemo(() => { try { return String(role||'').toLowerCase().includes('admin'); } catch { return false; } }, [role]);\r\n  const [agree, setAgree] = useState(false);\r\n  // QR flow removed – only direct redirect payment flow retained\r\n  const [showReviews, setShowReviews] = useState(false);\r\n  const [reviews, setReviews] = useState({ list: [], avg: 0, loading: false, error: '' });\r\n\r\n  // Removed QR base URL detection effect\r\n\r\n  useEffect(() => {\r\n    if (!name) return;\r\n    let active = true;\r\n    setLoading(true);\r\n    setError('');\r\n    setSelectedIndex(-1);\r\n    setSelectedMap({});\r\n    const params = new URLSearchParams();\r\n    if (dateRange.checkIn) params.set('checkIn', dateRange.checkIn);\r\n    if (dateRange.checkOut) params.set('checkOut', dateRange.checkOut);\r\n  // Cache bust: ensure fresh status for red/yellow/green dots\r\n  params.set('_', String(Date.now()));\r\n  fetch(`/api/room-types/${encodeURIComponent(name)}/rooms${params.toString() ? ('?' + params.toString()) : ''}`, { cache: 'no-store' })\r\n      .then(async (res) => {\r\n        if (!res.ok) {\r\n          const j = await res.json().catch(() => ({}));\r\n          throw new Error(j.message || `HTTP ${res.status}`);\r\n        }\r\n        return res.json();\r\n      })\r\n      .then((j) => { if (active) setData(j); })\r\n      .catch((err) => { if (active) setError(err.message || 'Lỗi tải dữ liệu'); })\r\n      .finally(() => { if (active) setLoading(false); });\r\n    return () => { active = false; };\r\n  }, [name, dateRange.checkIn, dateRange.checkOut]);\r\n\r\n  const selectedRoom = useMemo(() => data.rooms[selectedIndex] || null, [data.rooms, selectedIndex]);\r\n  const galleryImages = useMemo(() => {\r\n    if (!selectedRoom) return [];\r\n    const arr = [];\r\n    if (selectedRoom.image) arr.push(selectedRoom.image);\r\n    return arr;\r\n  }, [selectedRoom]);\r\n  const selectedIds = useMemo(() => Object.keys(selectedMap).map(id => Number(id)), [selectedMap]);\r\n  const selectedRooms = useMemo(() => data.rooms.filter(r => selectedIds.includes(r.id)), [data.rooms, selectedIds]);\r\n  const nights = useMemo(() => {\r\n    if (!dateRange.checkIn || !dateRange.checkOut) return 0;\r\n    const inD = new Date(dateRange.checkIn);\r\n    const outD = new Date(dateRange.checkOut);\r\n    const ms = outD.setHours(0, 0, 0, 0) - inD.setHours(0, 0, 0, 0);\r\n    return ms > 0 ? Math.ceil(ms / (1000 * 60 * 60 * 24)) : 0;\r\n  }, [dateRange]);\r\n  const baseSum = useMemo(() => selectedRooms.reduce((s, r) => s + Number(r.basePrice || 0), 0), [selectedRooms]);\r\n  const totalPrice = useMemo(() => baseSum * (nights || 0), [baseSum, nights]);\r\n  const totalGuests = useMemo(() => selectedRooms.reduce((sum, r) => {\r\n    const sel = selectedMap[String(r.id)] || { adults: 0, children: 0 };\r\n    return sum + Number(sel.adults || 0) + Number(sel.children || 0);\r\n  }, 0), [selectedRooms, selectedMap]);\r\n  const now = new Date();\r\n  const isValidDates = useMemo(() => {\r\n    if (!dateRange.checkIn || !dateRange.checkOut) return false;\r\n    const inD = new Date(dateRange.checkIn);\r\n    const outD = new Date(dateRange.checkOut);\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    return inD > today && outD > inD;\r\n  }, [dateRange, now]);\r\n\r\n  // Helpers for date inputs and warnings\r\n  const pad2 = (n) => String(n).padStart(2, '0');\r\n  const fmtDate = (d) => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;\r\n  const todayLocal = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n  const minCheckInDate = new Date(todayLocal.getFullYear(), todayLocal.getMonth(), todayLocal.getDate() + 1);\r\n  const minCheckInStr = fmtDate(minCheckInDate);\r\n  const minCheckOutStr = useMemo(() => {\r\n    if (dateRange.checkIn) {\r\n      const inD = new Date(dateRange.checkIn);\r\n      const d = new Date(inD.getFullYear(), inD.getMonth(), inD.getDate() + 1);\r\n      return fmtDate(d);\r\n    }\r\n    const d = new Date(minCheckInDate.getFullYear(), minCheckInDate.getMonth(), minCheckInDate.getDate() + 1);\r\n    return fmtDate(d);\r\n  }, [dateRange.checkIn, now]);\r\n\r\n  const dateError = useMemo(() => {\r\n    if (!dateRange.checkIn || !dateRange.checkOut) return '';\r\n    const inD = new Date(dateRange.checkIn);\r\n    const outD = new Date(dateRange.checkOut);\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    if (!(inD > today)) return 'Ngày nhận phải sau ngày hiện tại';\r\n    if (!(outD > inD)) return 'Ngày trả phải sau ngày nhận';\r\n    return '';\r\n  }, [dateRange, now]);\r\n  const loggedIn = isLoggedIn();\r\n  // Điều kiện dữ liệu đã đủ (không xét đăng nhập)\r\n  const baseReady = useMemo(() => selectedRooms.length > 0 && totalGuests > 1 && isValidDates && nights > 0, [selectedRooms.length, totalGuests, isValidDates, nights]);\r\n  // Điều kiện thực sự có thể mở checkout\r\n  const canBook = loggedIn && baseReady;\r\n  const canPay = useMemo(() => canBook && agree && !!payMethod, [canBook, agree, payMethod]);\r\n\r\n  useEffect(() => {\r\n    // If reduced roomCount below current selected, trim selection deterministically\r\n    const max = Math.max(1, Number(roomCount || 1));\r\n    const ids = Object.keys(selectedMap);\r\n    if (ids.length > max) {\r\n      const keep = new Set(ids.slice(0, max));\r\n      const next = {};\r\n      ids.slice(0, max).forEach(id => { next[id] = selectedMap[id]; });\r\n      setSelectedMap(next);\r\n    }\r\n  }, [roomCount]);\r\n\r\n  const toggleSelectRoom = (room) => {\r\n    const id = String(room.id);\r\n    const isSelected = !!selectedMap[id];\r\n    if (isSelected) {\r\n      const next = { ...selectedMap };\r\n      delete next[id];\r\n      setSelectedMap(next);\r\n      return;\r\n    }\r\n    const max = Math.max(1, Number(roomCount || 1));\r\n    const ids = Object.keys(selectedMap);\r\n    if (ids.length >= max) {\r\n      if (max === 1) {\r\n        // replace existing selection with the new room\r\n        setSelectedMap({ [id]: { adults: 0, children: 0 } });\r\n      } else {\r\n        return; // reach limit for multi-selection\r\n      }\r\n    } else {\r\n      setSelectedMap({ ...selectedMap, [id]: { adults: 0, children: 0 } });\r\n    }\r\n  };\r\n\r\n  const updateCounts = (room, kind, value) => {\r\n    const id = String(room.id);\r\n    if (!selectedMap[id]) return;\r\n    setSelectedMap({ ...selectedMap, [id]: { ...selectedMap[id], [kind]: Number(value) } });\r\n  };\r\n\r\n  if (!name) return null;\r\n\r\n  return (\r\n    <section className=\"rt-inline\">\r\n      <div className=\"rt-toolbar\">\r\n        <div className=\"rt-field rt-field--wide\">\r\n          <label>Ngày nhận - trả phòng</label>\r\n          <div className=\"rt-date-group\">\r\n            <input\r\n              type=\"date\"\r\n              min={minCheckInStr}\r\n              aria-invalid={dateRange.checkIn ? (new Date(dateRange.checkIn) <= todayLocal) : false}\r\n              value={dateRange.checkIn}\r\n              onChange={(e) => {\r\n                const newIn = e.target.value;\r\n                setDateRange((v) => {\r\n                  let newOut = v.checkOut;\r\n                  if (newOut && !(new Date(newOut) > new Date(newIn))) {\r\n                    newOut = '';\r\n                  }\r\n                  return { ...v, checkIn: newIn, checkOut: newOut };\r\n                });\r\n              }}\r\n            />\r\n            <input\r\n              type=\"date\"\r\n              min={minCheckOutStr}\r\n              aria-invalid={dateRange.checkOut && dateRange.checkIn ? (new Date(dateRange.checkOut) <= new Date(dateRange.checkIn)) : false}\r\n              value={dateRange.checkOut}\r\n              onChange={(e) => setDateRange(v => ({ ...v, checkOut: e.target.value }))}\r\n            />\r\n          </div>\r\n          {dateError && (\r\n            <div className=\"rt-date-error\" style={{ color: '#d93025', fontSize: 12, marginTop: 6 }}>{dateError}</div>\r\n          )}\r\n        </div>\r\n        <div className=\"rt-field\">\r\n          <label>Số phòng</label>\r\n          <input type=\"number\" min={1} value={roomCount} onChange={(e) => setRoomCount(Math.max(1, Number(e.target.value)))} />\r\n        </div>\r\n        {/* Promotion input removed */}\r\n  <button className=\"rt-search-btn\" disabled={!dateRange.checkIn || !dateRange.checkOut || !isValidDates}>TÌM KIẾM</button>\r\n        {onClose && <button className=\"rt-close-btn\" onClick={onClose}>ĐÓNG</button>}\r\n      </div>\r\n\r\n      {loading && <div>Đang tải...</div>}\r\n      {error && <div style={{ color: 'red' }}>{error}</div>}\r\n\r\n      {!loading && !error && (\r\n        <div className=\"rt-grid\">\r\n          <section className=\"rt-list\">\r\n            <div className=\"rt-legend\">\r\n              <span className=\"rt-legend-item\"><span className=\"rt-status-dot red\"></span> Đã được đặt</span>\r\n              <span className=\"rt-legend-item\"><span className=\"rt-status-dot yellow\"></span> Đang được đặt</span>\r\n              <span className=\"rt-legend-item\"><span className=\"rt-status-dot green\"></span> Trống</span>\r\n            </div>\r\n            {data.rooms.length === 0 ? (\r\n              <div>Chưa có phòng nào thuộc hạng phòng này.</div>\r\n            ) : (\r\n              data.rooms.map((r, idx) => {\r\n                const isSelected = !!selectedMap[String(r.id)];\r\n                const hasDates = !!(dateRange.checkIn && dateRange.checkOut);\r\n                const isBooked = hasDates ? !!r.isBooked : (r.status === 'Occupied');\r\n                const adultsMax = Number(r.maxAdults || 0);\r\n                const childrenMax = Number(r.maxChildren || 0);\r\n                const adultsVal = isSelected ? selectedMap[String(r.id)].adults : 0;\r\n                const childrenVal = isSelected ? selectedMap[String(r.id)].children : 0;\r\n                return (\r\n                  <div className={`rt-card ${isSelected ? 'selected' : ''}`} key={r.id}>\r\n                    <div className=\"rt-main\">\r\n                      <div className=\"rt-thumb\">\r\n                        {r.image && <img src={r.image} alt={r.roomNumber} onClick={() => setZoomUrl(r.image)} />}\r\n                      </div>\r\n                      <div className=\"rt-info\">\r\n                        <h3 className=\"rt-name\" onClick={() => { setSelectedIndex(idx); setGalleryIndex(0); setShowDetails(true); }} style={{ cursor: 'pointer', display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                          <span>{`Phòng ${r.roomNumber}${r.floor != null ? ` * Tầng ${r.floor}` : ''}`}</span>\r\n                          <span className={`rt-status-dot ${isBooked ? 'red' : isSelected ? 'yellow' : 'green'}`} title={isBooked ? 'Đã đặt' : isSelected ? 'Đang đặt' : 'Trống'}></span>\r\n                        </h3>\r\n                        <div className=\"rt-cap\">Tối đa {adultsMax} người lớn | {childrenMax} trẻ em</div>\r\n                        <div className=\"rt-price\">Giá từ {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                      </div>\r\n                      <div className=\"rt-actions\">\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"rt-choose\"\r\n                          onClick={() => { if (isBooked) return; toggleSelectRoom(r); }}\r\n                          disabled={isBooked}\r\n                          title={isBooked ? 'Phòng đã được đặt trong khoảng thời gian này' : ''}\r\n                        >\r\n                          {isBooked ? 'ĐÃ ĐẶT' : (isSelected ? 'BỎ CHỌN' : 'CHỌN')}\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                    {isSelected && (\r\n                      <div className=\"rt-extra\">\r\n                        <div className=\"rt-note-row\">\r\n                          <div className=\"rt-note\">Đã bao gồm ăn sáng • Không hoàn trả phí khi hủy phòng</div>\r\n                          <div className=\"rt-selects\">\r\n                            <label>\r\n                              Chọn số người lớn\r\n                              <select value={adultsVal} onChange={(e) => updateCounts(r, 'adults', e.target.value)}>\r\n                                {Array.from({ length: adultsMax + 1 }, (_, i) => <option key={i} value={i}>{i}</option>)}\r\n                              </select>\r\n                            </label>\r\n                            <label>\r\n                              . Trẻ em\r\n                              <select value={childrenVal} onChange={(e) => updateCounts(r, 'children', e.target.value)}>\r\n                                {Array.from({ length: childrenMax + 1 }, (_, i) => <option key={i} value={i}>{i}</option>)}\r\n                              </select>\r\n                            </label>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"rt-price-2\">Giá từ {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })\r\n            )}\r\n          </section>\r\n\r\n          <aside className=\"rt-detail\">\r\n            {/* Booking info view (default) */}\r\n            {(!showDetails || !(selectedIndex >= 0 && selectedRoom)) && !showCheckout && (\r\n              <div className=\"rt-detail-inner\">\r\n                <div className=\"rt-summary\">\r\n                  <div className=\"rt-summary-title\" style={{ cursor: selectedRoom ? 'pointer' : 'default' }}\r\n                    onClick={() => { if (selectedRoom) setShowDetails(true); }}>\r\n                    Thông tin đặt phòng\r\n                  </div>\r\n                  <div className=\"rt-summary-hotel\">{data.roomType?.name || name}</div>\r\n                  <div className=\"rt-summary-dates\">{dateRange.checkIn || 'dd/mm/yyyy'} - {dateRange.checkOut || 'dd/mm/yyyy'}</div>\r\n                  <div className=\"rt-summary-sep\" />\r\n                  <div className=\"rt-summary-title\">Thông tin phòng</div>\r\n                  <div className=\"rt-summary-list\">\r\n                    {selectedRooms.length === 0 ? (\r\n                      <div className=\"rt-summary-line\">Chưa chọn phòng</div>\r\n                    ) : (\r\n                      selectedRooms.map((r) => {\r\n                        const sel = selectedMap[String(r.id)];\r\n                        return (\r\n                          <div key={r.id} className=\"rt-summary-room\">\r\n                            <div className=\"rt-summary-line\">Phòng: {r.roomNumber}{r.floor != null ? ` • Tầng ${r.floor}` : ''}</div>\r\n                            <div className=\"rt-summary-line\">Người lớn: {sel?.adults ?? 0}</div>\r\n                            <div className=\"rt-summary-line\">Trẻ em: {sel?.children ?? 0}</div>\r\n                            <div className=\"rt-summary-line\">Giá: {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                          </div>\r\n                        );\r\n                      })\r\n                    )}\r\n                  </div>\r\n                  <div className=\"rt-summary-sep\" />\r\n                  {!baseReady && (\r\n                    <div className=\"rt-warning\">Lưu ý: Hãy chọn phòng, Ngày nhận - ngày trả, và số lượng khách (tổng &gt; 1) để chuẩn bị đặt phòng.</div>\r\n                  )}\r\n                  {baseReady && !loggedIn && (\r\n                    <div className=\"rt-warning\">Bạn đã chọn đủ thông tin. Vui lòng đăng nhập để tiếp tục đặt phòng.</div>\r\n                  )}\r\n                  <div className=\"rt-summary-total\">\r\n                    <span>Tổng cộng ({nights} đêm)</span>\r\n                    <span>{Number(totalPrice).toLocaleString('vi-VN')} VND</span>\r\n                  </div>\r\n                    <div className=\"rt-actions-vertical\">\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"rt-review-btn\"\r\n                      onClick={async ()=>{\r\n                        setShowReviews(true);\r\n                        setReviews(r=>({ ...r, loading: true, error: '' }));\r\n                        try {\r\n                          const params = new URLSearchParams();\r\n                          if (selectedRoom) params.set('roomId', String(selectedRoom.id)); else params.set('roomType', data.roomType?.name || name);\r\n                          params.set('_', String(Date.now()));\r\n                          const res = await fetch(`/api/public-reviews?${params.toString()}`, { cache: 'no-store' });\r\n                          if (!res.ok) throw new Error('Không tải được đánh giá');\r\n                          const j = await res.json();\r\n                          setReviews({ list: Array.isArray(j.reviews)? j.reviews: [], avg: Number(j.avgRating||0), loading: false, error: '' });\r\n                        } catch (e) {\r\n                          setReviews({ list: [], avg: 0, loading: false, error: e.message || 'Lỗi tải đánh giá' });\r\n                        }\r\n                      }}\r\n                      style={{ whiteSpace: 'nowrap' }}\r\n                    >\r\n                      xem đánh giá\r\n                    </button>\r\n                    <button\r\n                      className={`rt-book-btn ${baseReady ? 'enabled' : ''} ${canBook ? 'can-book' : ''}`}\r\n                      disabled={!baseReady || isAdmin}\r\n                      onClick={() => {\r\n                        if (isAdmin) { alert('Tài khoản Admin không được phép đặt phòng'); return; }\r\n                        if (!loggedIn) return; // chỉ không mở checkout\r\n                        setShowCheckoutDetails(false); setShowCheckout(true);\r\n                      }}\r\n                      onMouseEnter={(e) => {\r\n                        if (baseReady && !loggedIn) {\r\n                          e.currentTarget.setAttribute('data-tip', 'Vui lòng Đăng nhập để đặt phòng!');\r\n                        }\r\n                      }}\r\n                      onMouseLeave={(e) => { e.currentTarget.removeAttribute('data-tip'); }}\r\n                    >\r\n                      {canBook ? 'ĐẶT PHÒNG' : (baseReady ? 'ĐẶT PHÒNG' : 'ĐẶT PHÒNG')}\r\n                      {!loggedIn && baseReady && <span className=\"rt-btn-hint\"> (Đăng nhập để tiếp tục)</span>}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Details view (shown when title clicked) */}\r\n            {showDetails && !showCheckout && selectedIndex >= 0 && selectedRoom && (\r\n              <div className=\"rt-detail-inner\">\r\n                <div className=\"rt-summary\">\r\n                  <div className=\"rt-summary-title\" style={{ cursor: 'pointer' }} onClick={() => setShowDetails(false)}>\r\n                    Chi tiết phòng (nhấn để quay lại đặt phòng)\r\n                  </div>\r\n                  <div className=\"rt-gallery\" style={{ marginBottom: 10 }}>\r\n                    <div style={{ position: 'relative', borderRadius: 8, overflow: 'hidden', height: 180, background: '#f5f5f5' }}>\r\n                      {galleryImages.length > 0 && (\r\n                        <img src={galleryImages[galleryIndex % galleryImages.length]} alt=\"Ảnh phòng\" style={{ width: '100%', height: '100%', objectFit: 'cover', display: 'block' }} />\r\n                      )}\r\n                    </div>\r\n                    <div className=\"rt-gallery-controls\" style={{ display: 'flex', justifyContent: 'center', gap: 10, marginTop: 8 }}>\r\n                      <button type=\"button\" className=\"btn\" disabled={galleryImages.length <= 1} onClick={() => setGalleryIndex((i) => (i - 1 + galleryImages.length) % galleryImages.length)}>{'<'}</button>\r\n                      <button type=\"button\" className=\"btn\" disabled={galleryImages.length <= 1} onClick={() => setGalleryIndex((i) => (i + 1) % galleryImages.length)}>{'>'}</button>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"rt-summary-list\">\r\n                    <div className=\"rt-summary-line\">Số phòng: {selectedRoom.roomNumber}</div>\r\n                    {selectedRoom.floor != null && (\r\n                      <div className=\"rt-summary-line\">Tầng: {selectedRoom.floor}</div>\r\n                    )}\r\n                    {typeof selectedRoom.status !== 'undefined' && (\r\n                      <div className=\"rt-summary-line\">Trạng thái: {String(selectedRoom.status)}</div>\r\n                    )}\r\n                    <div className=\"rt-summary-line\">Loại phòng: {data.roomType?.name || name}</div>\r\n                    <div className=\"rt-summary-line\">Sức chứa: {Number(selectedRoom.maxAdults || 0)} người lớn, {Number(selectedRoom.maxChildren || 0)} trẻ em</div>\r\n                    <div className=\"rt-summary-line\">Giá cơ bản: {Number(selectedRoom.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                    {data.roomType?.description && (\r\n                      <div className=\"rt-summary-line\">Mô tả: {data.roomType.description}</div>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"rt-summary-sep\" />\r\n                    <div className=\"rt-actions-vertical\">\r\n                    <button\r\n                      type=\"button\"\r\n                      className=\"rt-review-btn\"\r\n                      onClick={async ()=>{\r\n                        setShowReviews(true);\r\n                        setReviews(r=>({ ...r, loading: true, error: '' }));\r\n                        try {\r\n                          const params = new URLSearchParams();\r\n                          params.set('roomId', String(selectedRoom.id));\r\n                          params.set('_', String(Date.now()));\r\n                          const res = await fetch(`/api/public-reviews?${params.toString()}`, { cache: 'no-store' });\r\n                          if (!res.ok) throw new Error('Không tải được đánh giá');\r\n                          const j = await res.json();\r\n                          setReviews({ list: Array.isArray(j.reviews)? j.reviews: [], avg: Number(j.avgRating||0), loading: false, error: '' });\r\n                        } catch (e) {\r\n                          setReviews({ list: [], avg: 0, loading: false, error: e.message || 'Lỗi tải đánh giá' });\r\n                        }\r\n                      }}\r\n                      style={{ whiteSpace: 'nowrap' }}\r\n                    >\r\n                      xem đánh giá\r\n                    </button>\r\n                    <button\r\n                      className={`rt-book-btn ${baseReady ? 'enabled' : ''}`}\r\n                      onClick={() => { if (isAdmin) { alert('Tài khoản Admin không được phép đặt phòng'); return; } if (!loggedIn) return; setShowDetails(false); setShowCheckoutDetails(false); setShowCheckout(true); }}\r\n                      disabled={!baseReady || isAdmin}\r\n                      onMouseEnter={(e) => { if (baseReady && !loggedIn) e.currentTarget.setAttribute('data-tip', 'Vui lòng Đăng nhập để đặt phòng!'); }}\r\n                      onMouseLeave={(e) => e.currentTarget.removeAttribute('data-tip')}\r\n                    >\r\n                      {canBook ? 'ĐẶT PHÒNG' : 'ĐẶT PHÒNG'}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Checkout view */}\r\n            {showCheckout && (\r\n              <div className=\"rt-detail-inner\">\r\n                <div className=\"checkout-panel\">\r\n                  <div className=\"checkout-main-title\">Thanh Toán</div>\r\n                  <div className=\"checkout-header\">\r\n                    <div className=\"checkout-title\">Thông Tin Đặt Phòng</div>\r\n                  </div>\r\n                  <div className=\"checkout-body\">\r\n                    <div style={{ fontWeight: 800, marginBottom: 4 }}>{data.roomType?.name || name}</div>\r\n                    <div style={{ color: '#555', marginBottom: 8 }}>{(dateRange.checkIn || 'dd/mm/yyyy')} - {(dateRange.checkOut || 'dd/mm/yyyy')}</div>\r\n                    <div className=\"checkout-info-row\">\r\n                      <div className=\"checkout-section-title\" style={{ margin: 0 }}>Thông Tin Phòng</div>\r\n                      <button type=\"button\" className=\"checkout-inline-toggle\" onClick={() => setShowCheckoutDetails((v) => !v)}>\r\n                        {showCheckoutDetails ? 'Ẩn Thông Tin' : 'Xem Thông Tin'}\r\n                      </button>\r\n                    </div>\r\n                    {showCheckoutDetails && (\r\n                      <div className=\"checkout-room-list\">\r\n                        {selectedRooms.length === 0 ? (\r\n                          <div>Chưa chọn phòng</div>\r\n                        ) : (\r\n                          selectedRooms.map((r) => {\r\n                            const sel = selectedMap[String(r.id)];\r\n                            return (\r\n                              <div key={r.id} className=\"rt-summary-room\">\r\n                                <div className=\"rt-summary-line\">Phòng: {r.roomNumber}{r.floor != null ? ` • Tầng ${r.floor}` : ''}</div>\r\n                                <div className=\"rt-summary-line\">Người lớn: {sel?.adults ?? 0} • Trẻ em: {sel?.children ?? 0}</div>\r\n                                <div className=\"rt-summary-line\">Giá: {Number(r.basePrice || 0).toLocaleString('vi-VN')} VND/đêm</div>\r\n                              </div>\r\n                            );\r\n                          })\r\n                        )}\r\n                      </div>\r\n                    )}\r\n                    <div className=\"checkout-line\">\r\n                      <span>Số đêm</span>\r\n                      <span>{nights} đêm</span>\r\n                    </div>\r\n                    <div className=\"checkout-line\">\r\n                      <span>Giá phòng</span>\r\n                      <span>{Number(totalPrice).toLocaleString('vi-VN')} VND</span>\r\n                    </div>\r\n                    {/* Discount line removed */}\r\n                    {/* Phương thức thanh toán trực tuyến */}\r\n                    {\r\n                      <div className=\"checkout-line\" style={{ alignItems: 'stretch', flexDirection: 'column', gap: 6 }}>\r\n                        <div style={{ fontWeight: 700 }}>Phương thức thanh toán</div>\r\n                        <select className=\"checkout-pay-method\" value={payMethod} onChange={(e) => setPayMethod(e.target.value)}>\r\n                          <option value=\"MOMO\">Ví điện tử MOMO</option>\r\n                          <option value=\"ZALOPAY\">ZaloPay</option>\r\n                          <option value=\"VNPAY\">VNPay</option>\r\n                          <option value=\"CARD\">Thẻ tín dụng/ghi nợ</option>\r\n                        </select>\r\n                      </div>\r\n                    }\r\n                    <label className=\"checkout-terms\">\r\n                      <input type=\"checkbox\" checked={agree} onChange={(e) => setAgree(e.target.checked)} />\r\n                      <span>Vui lòng đọc kĩ và đồng ý với điều khoản bằng cách đánh dấu vào ô bên cạnh</span>\r\n                    </label>\r\n                    <div className=\"checkout-total\">\r\n                      <span>Tổng cộng</span>\r\n                      <span>{Number(totalPrice).toLocaleString('vi-VN')} VND</span>\r\n                    </div>\r\n                    <div className=\"checkout-actions\" style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\r\n                      {/* Online payment flow */}\r\n                      <button className=\"checkout-btn\" disabled={!canPay || isAdmin} onClick={() => {\r\n                        if (isAdmin) { alert('Tài khoản Admin không được phép đặt phòng'); return; }\r\n                        // Flow mới: chuyển hướng trực tiếp sang trang /payment/confirm\r\n                        const t = Math.random().toString(36).slice(2) + Date.now().toString(36);\r\n                        const totals = selectedRooms.reduce((acc, r) => {\r\n                          const sel = selectedMap[String(r.id)] || { adults: 0, children: 0 }; acc.ad += Number(sel.adults||0); acc.ch += Number(sel.children||0); return acc; }, { ad:0, ch:0 });\r\n                        const pad2 = (n)=> String(n).padStart(2,'0');\r\n                        const nowD = new Date();\r\n                        const bookingCode = `HMS${nowD.getFullYear()}${pad2(nowD.getMonth()+1)}${pad2(nowD.getDate())}`;\r\n                        const roomNames = selectedRooms.map(r=>`Phòng ${r.roomNumber}${r.floor!=null?` • Tầng ${r.floor}`:''}`).join(', ');\r\n                        let userEmail='';\r\n                        try { const u=localStorage.getItem('hmsUser'); if(u) userEmail=(JSON.parse(u).email||'').trim(); } catch {}\r\n                        const grossAmount = Number(totalPrice) || 0;\r\n                        const summary = { token:t, code:bookingCode, hotelId:data.roomType?.hotelId||null, hotel:data.roomType?.hotelName||'', roomType:data.roomType?.name||name, roomNames, checkIn:dateRange.checkIn, checkOut:dateRange.checkOut, checkInTime:'14:00', checkOutTime:'12:00', payMethod, userEmail, adults:totals.ad, children:totals.ch, rooms:selectedRooms.map(r=>{ const sel=selectedMap[String(r.id)]||{adults:0,children:0}; return { id:r.id, number:r.roomNumber, floor:r.floor, price:r.basePrice, name:r.roomNumber, adults:sel.adults, children:sel.children }; }), amount:grossAmount };\r\n                        // promotion fields removed from summary\r\n                        try { localStorage.setItem('hmsBooking:'+t, JSON.stringify(summary)); } catch {}\r\n                        // Pass gross amount in query (PaymentConfirm will apply discount from summary)\r\n                        const q=[`token=${encodeURIComponent(t)}`,`code=${encodeURIComponent(summary.code)}`,`amount=${encodeURIComponent(grossAmount)}`,`hid=${encodeURIComponent(summary.hotelId||'')}`,`rn=${encodeURIComponent(roomNames)}`,`rt=${encodeURIComponent(summary.roomType||'')}`,`ci=${encodeURIComponent(summary.checkIn||'')}`,`co=${encodeURIComponent(summary.checkOut||'')}`,`ad=${encodeURIComponent(summary.adults)}`,`ch=${encodeURIComponent(summary.children)}`].join('&');\r\n                        window.location.href = '/payment/confirm?'+q;\r\n                      }}>THANH TOÁN</button>\r\n                      {/* QR button removed */}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </aside>\r\n        </div>\r\n      )}\r\n      {/* QR overlay removed */}\r\n      {showReviews && (\r\n        <div className=\"qr-overlay\" onClick={()=> setShowReviews(false)}>\r\n          <div className=\"qr-box\" onClick={(e)=> e.stopPropagation()} style={{ width: 680, maxWidth: '96%' }}>\r\n            <div className=\"qr-title\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 8 }}>\r\n              <span>Đánh giá phòng</span>\r\n              <button className=\"qr-close\" onClick={()=> setShowReviews(false)}>Đóng</button>\r\n            </div>\r\n            {reviews.loading ? (\r\n              <div style={{ padding: 10, color: '#666' }}>Đang tải đánh giá...</div>\r\n            ) : reviews.error ? (\r\n              <div style={{ padding: 10, color: '#b42318' }}>{reviews.error}</div>\r\n            ) : reviews.list.length === 0 ? (\r\n              <div style={{ padding: 10, color: '#666' }}>Chưa có đánh giá nào cho phòng này.</div>\r\n            ) : (\r\n              <div style={{ textAlign: 'left' }}>\r\n                <div style={{ fontWeight: 800, margin: '4px 0 10px' }}>Trung bình: {reviews.avg.toFixed(1)} / 5.0 ★</div>\r\n                <div style={{ maxHeight: 360, overflowY: 'auto' }}>\r\n                  {reviews.list.map(rv => (\r\n                    <div key={rv.id} style={{ borderTop: '1px solid #eee', padding: '8px 0' }}>\r\n                      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                        <div style={{ fontWeight: 700 }}>{rv.user || 'Khách'}</div>\r\n                        <div style={{ fontWeight: 700, color: '#444' }}>{Number(rv.rating||0).toFixed(1)} / 5.0 ★</div>\r\n                      </div>\r\n                      <div style={{ color: '#555', marginTop: 4 }}>{rv.comment || '(Không có nhận xét)'}</div>\r\n                      <div style={{ color: '#888', fontSize: 12, marginTop: 4 }}>{rv.hotelName}{rv.roomName ? ` • Phòng ${rv.roomName}`: ''}</div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n      {zoomUrl && (\r\n        <div className=\"rt-zoom\" onClick={() => setZoomUrl('')}>\r\n          <img src={zoomUrl} alt=\"Xem ảnh phòng\" />\r\n        </div>\r\n      )}\r\n    </section>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}