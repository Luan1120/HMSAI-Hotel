{"ast":null,"code":"var _jsxFileName = \"D:\\\\Git\\\\HMSAI-Hotel\\\\client\\\\src\\\\PaymentConfirm.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// Renamed conceptually to PaymentPending (file name will be adjusted separately if desired)\nimport React, { useEffect, useState } from 'react';\nimport { useSearchParams, Link, useNavigate } from 'react-router-dom';\nimport './HomePage.css';\nimport showToast from './toast';\nimport { isLoggedIn } from './auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PaymentPending() {\n  _s();\n  var _serverPromo$final, _serverPromo$final2;\n  const [params] = useSearchParams();\n  const token = params.get('token') || '';\n  const amount = params.get('amount') || '';\n  const code = params.get('code') || '';\n  const rt = params.get('rt') || '';\n  const hid = params.get('hid') || '';\n  const ci = params.get('ci') || '';\n  const co = params.get('co') || '';\n  const ad = params.get('ad') || '';\n  const ch = params.get('ch') || '';\n  const rn = params.get('rn') || '';\n  const navigate = useNavigate();\n  const origin = params.get('origin') || '';\n\n  // Guard: if chưa đăng nhập chuyển hướng login (giữ lại query để quay lại nếu cần)\n  useEffect(() => {\n    if (!isLoggedIn()) {\n      try {\n        sessionStorage.setItem('hmsRedirectAfterLogin', window.location.pathname + window.location.search);\n      } catch {}\n      navigate('/login');\n    }\n  }, [navigate]);\n  const [initState, setInitState] = useState({\n    started: false,\n    success: false,\n    error: '',\n    loading: false\n  });\n  const [serverPromo, setServerPromo] = useState(null);\n  const [serverPromoError, setServerPromoError] = useState('');\n  const depositRate = 0.2;\n  // Tính số tiền hiển thị ban đầu (có thể đang chứa mã cũ chưa revalidate)\n  let initialFinalAmount = Number(amount || 0);\n  let initialDepositFromStorage = null;\n  try {\n    const raw = localStorage.getItem('hmsBooking:' + token);\n    if (raw) {\n      const s = JSON.parse(raw);\n      if (typeof (s === null || s === void 0 ? void 0 : s.finalAmount) === 'number') {\n        initialFinalAmount = Number(s.finalAmount);\n      } else if (s && s.promo && typeof s.promo.final !== 'undefined' && s.promo.final !== null) {\n        initialFinalAmount = Number(s.promo.final || initialFinalAmount);\n      } else if (s && s.promo && s.promo.code) {\n        if (s.promo.discountValue && s.promo.discountType) {\n          if (s.promo.discountType === 'PERCENT') {\n            const disc = Math.round(initialFinalAmount * (Number(s.promo.discountValue || 0) / 100));\n            initialFinalAmount = Math.max(0, initialFinalAmount - disc);\n          } else {\n            const disc = Number(s.promo.discountValue || 0);\n            initialFinalAmount = Math.max(0, initialFinalAmount - disc);\n          }\n        }\n      }\n      if (typeof (s === null || s === void 0 ? void 0 : s.depositAmount) === 'number') initialDepositFromStorage = Number(s.depositAmount);\n    }\n  } catch {}\n  const calcDeposit = num => {\n    const amountNum = Number(num) || 0;\n    return Math.max(0, Math.round(amountNum * depositRate));\n  };\n  const defaultDeposit = initialDepositFromStorage != null ? Number(initialDepositFromStorage) : calcDeposit(initialFinalAmount);\n  const [finalAmount, setFinalAmount] = useState(initialFinalAmount);\n  const [depositAmount, setDepositAmount] = useState(defaultDeposit);\n  const applyFinalAmount = value => {\n    const num = Number(value || 0);\n    if (Number.isNaN(num)) return;\n    const deposit = calcDeposit(num);\n    setFinalAmount(num);\n    setDepositAmount(deposit);\n    try {\n      const raw = localStorage.getItem('hmsBooking:' + token);\n      if (raw) {\n        const summary = JSON.parse(raw);\n        summary.finalAmount = num;\n        summary.amount = num;\n        summary.depositAmount = deposit;\n        localStorage.setItem('hmsBooking:' + token, JSON.stringify(summary));\n      }\n    } catch {}\n  };\n\n  // Helper: drop promo from local storage & reset amount\n  const dropPromo = reasonMsg => {\n    try {\n      const raw = localStorage.getItem('hmsBooking:' + token);\n      if (raw) {\n        const s = JSON.parse(raw);\n        if (s.promo) {\n          delete s.promo;\n        }\n        s.finalAmount = Number(amount || 0);\n        s.amount = Number(amount || 0);\n        s.depositAmount = calcDeposit(Number(amount || 0));\n        localStorage.setItem('hmsBooking:' + token, JSON.stringify(s));\n      }\n    } catch {}\n    applyFinalAmount(Number(amount || 0));\n    if (reasonMsg) {\n      showToast(reasonMsg, {\n        type: 'warning',\n        duration: 3200\n      });\n    }\n  };\n\n  // Re-validate promo with server to get authoritative discount & final amount\n  useEffect(() => {\n    let mounted = true;\n    (async () => {\n      try {\n        const raw = localStorage.getItem('hmsBooking:' + token);\n        if (!raw) return;\n        const s = JSON.parse(raw);\n        if (!s || !s.promo || !s.promo.code) return;\n        // request validate with gross amount\n        const gross = Number(amount || 0);\n        const url = new URL('/api/promotions/validate', window.location.origin);\n        url.searchParams.set('code', String(s.promo.code).trim());\n        url.searchParams.set('amount', String(gross));\n        if (s.hotelId) url.searchParams.set('hotelId', String(s.hotelId));\n        if (Array.isArray(s.rooms) && s.rooms.length) url.searchParams.set('roomIds', s.rooms.map(r => r.id).join(','));\n        try {\n          const resp = await fetch(url.toString());\n          if (!mounted) return;\n          if (!resp.ok) {\n            const body = await resp.json().catch(() => ({}));\n            const msg = body && body.message ? body.message : 'Mã ưu đãi không hợp lệ';\n            // Removed debug warn for promo validate non-ok\n            setServerPromoError(msg);\n            setServerPromo(null);\n            // Nếu mã thuộc khách sạn khác hoặc thiếu phòng để xác định => hủy ngay để không còn giảm ở UI\n            if (/khách sạn/i.test(msg) || /phòng đã chọn/i.test(msg) || /Thiếu phòng/i.test(msg)) {\n              dropPromo('Mã ưu đãi đã bị gỡ (không áp dụng cho khách sạn/phòng này)');\n            } else {\n              // fallback: hiển thị số tiền gốc nếu validate thất bại\n              applyFinalAmount(Number(amount || 0));\n            }\n            return;\n          }\n          const body = await resp.json();\n          // Removed debug log for promo validate response\n          if (body && body.ok) {\n            if (typeof body.final === 'number') applyFinalAmount(Number(body.final));else if (typeof body.discount === 'number') applyFinalAmount(Math.max(0, Number(amount || 0) - Number(body.discount)));\n          } else {\n            applyFinalAmount(Number(amount || 0));\n          }\n          setServerPromo(body);\n          setServerPromoError('');\n        } catch (err) {\n          console.error('[PaymentConfirm] promo validate failed', err);\n          if (!mounted) return;\n          // Provide a helpful message; in dev we include the error text\n          setServerPromoError(err && err.message ? 'Lỗi kiểm tra ưu đãi: ' + err.message : 'Lỗi kiểm tra ưu đãi');\n          setServerPromo(null);\n          applyFinalAmount(Number(amount || 0));\n        }\n      } catch (e) {\n        if (!mounted) return;\n        setServerPromoError('Lỗi kiểm tra ưu đãi');\n        setServerPromo(null);\n        applyFinalAmount(Number(amount || 0));\n      }\n    })();\n    return () => {\n      mounted = false;\n    };\n  }, [token, amount]);\n\n  // Exposed revalidate function for UI retry\n  const revalidatePromo = async () => {\n    setServerPromoError('');\n    setServerPromo(null);\n    try {\n      const raw = localStorage.getItem('hmsBooking:' + token);\n      if (!raw) return false;\n      const s = JSON.parse(raw);\n      if (!s || !s.promo || !s.promo.code) return false;\n      const gross = Number(amount || 0);\n      const url = new URL('/api/promotions/validate', window.location.origin);\n      url.searchParams.set('code', String(s.promo.code).trim());\n      url.searchParams.set('amount', String(gross));\n      if (s.hotelId) url.searchParams.set('hotelId', String(s.hotelId));\n      if (Array.isArray(s.rooms) && s.rooms.length) url.searchParams.set('roomIds', s.rooms.map(r => r.id).join(','));\n      const resp = await fetch(url.toString());\n      if (!resp.ok) {\n        const body = await resp.json().catch(() => ({}));\n        // Removed debug warn for promo validate non-ok (retry path)\n        const msg = body && body.message ? body.message : 'Mã ưu đãi không hợp lệ';\n        setServerPromoError(msg);\n        setServerPromo(null);\n        // Auto drop promo if mismatch hotel to prevent silent usage later\n        if (/khách sạn/i.test(msg) || /phòng đã chọn/i.test(msg) || /Thiếu phòng/i.test(msg)) {\n          dropPromo('Đã gỡ mã ưu đãi không phù hợp');\n        } else {\n          applyFinalAmount(Number(amount || 0));\n        }\n        return;\n      }\n      setServerPromo(body);\n      setServerPromoError('');\n      if (body && body.ok) {\n        if (typeof body.final === 'number') applyFinalAmount(Number(body.final));else if (typeof body.discount === 'number') applyFinalAmount(Math.max(0, Number(amount || 0) - Number(body.discount)));\n      } else applyFinalAmount(Number(amount || 0));\n      return true;\n    } catch (err) {\n      setServerPromoError(err && err.message ? 'Lỗi kiểm tra ưu đãi: ' + err.message : 'Lỗi kiểm tra ưu đãi');\n      setServerPromo(null);\n      applyFinalAmount(Number(amount || 0));\n      return false;\n    }\n  };\n\n  // Clear promo from local summary and proceed to initiate payment\n  const clearPromoAndProceed = async () => {\n    try {\n      const raw = localStorage.getItem('hmsBooking:' + token);\n      if (raw) {\n        const s = JSON.parse(raw);\n        delete s.promo;\n        localStorage.setItem('hmsBooking:' + token, JSON.stringify(s));\n      }\n    } catch {}\n    await initiate();\n  };\n  const [pollMsg, setPollMsg] = useState('');\n  const [paid, setPaid] = useState(false);\n  // Simple polling of transactions list to see if status turned paid (optional improvement)\n  useEffect(() => {\n    if (!initState.success || paid) return;\n    const id = setInterval(async () => {\n      try {\n        const raw = localStorage.getItem('hmsBooking:' + token);\n        if (!raw) return;\n        const s = JSON.parse(raw);\n        const email = s.userEmail;\n        if (!email) return;\n        const q = new URL('/api/transactions', window.location.origin);\n        q.searchParams.set('email', email);\n        q.searchParams.set('q', code || '');\n        const r = await fetch(q.toString());\n        if (r.ok) {\n          const j = await r.json();\n          const anyPaid = (j.items || []).some(it => String(it.code || '') === code && it.paymentStatus === 'paid');\n          if (anyPaid) {\n            setPaid(true);\n            setPollMsg('Đã xác nhận thanh toán!');\n            clearInterval(id);\n          }\n        }\n      } catch {}\n    }, 8000);\n    return () => clearInterval(id);\n  }, [initState.success, paid, token, code]);\n  const initiate = async () => {\n    setInitState(s => ({\n      ...s,\n      loading: true,\n      error: ''\n    }));\n    try {\n      const raw = localStorage.getItem('hmsBooking:' + token);\n      if (!raw) throw new Error('Không tìm thấy dữ liệu đặt phòng');\n      const s = JSON.parse(raw);\n      let email = s.userEmail || '';\n      if (!email) {\n        try {\n          const u = localStorage.getItem('hmsUser');\n          if (u) email = JSON.parse(u).email || '';\n        } catch {}\n      }\n      if (!email) throw new Error('Thiếu email');\n      const payload = {\n        token,\n        email,\n        checkIn: s.checkIn,\n        checkOut: s.checkOut,\n        method: s.payMethod || 'MOMO',\n        rooms: (s.rooms || []).map(r => ({\n          id: r.id,\n          adults: r.adults || 1,\n          children: r.children || 0,\n          price: r.price\n        }))\n      };\n      // include promo code if present so server can validate/apply on confirm\n      if (s.promo && s.promo.code) payload.promoCode = s.promo.code;\n      const resp = await fetch('/api/payments/complete', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n      });\n      if (!resp.ok) {\n        const t = await resp.text();\n        throw new Error('Tạo giao dịch lỗi: ' + t);\n      }\n      let data = {};\n      try {\n        data = await resp.json();\n      } catch {\n        data = {};\n      }\n      if (typeof data.finalTotal === 'number') applyFinalAmount(Number(data.finalTotal));\n      if (typeof data.depositTotal === 'number') setDepositAmount(Math.max(0, Math.round(Number(data.depositTotal))));\n      const bookings = Array.isArray(data.bookings) ? data.bookings : [];\n      // Lưu danh sách bookingIds vào summary để user có thể hủy nếu muốn\n      try {\n        const raw2 = localStorage.getItem('hmsBooking:' + token);\n        if (raw2) {\n          const summary = JSON.parse(raw2);\n          summary.bookingIds = bookings;\n          if (typeof data.finalTotal === 'number') {\n            summary.finalAmount = Number(data.finalTotal);\n            summary.amount = Number(data.finalTotal);\n          }\n          if (typeof data.depositTotal === 'number') summary.depositAmount = Number(data.depositTotal);\n          localStorage.setItem('hmsBooking:' + token, JSON.stringify(summary));\n        }\n      } catch {}\n      setInitState({\n        started: true,\n        success: true,\n        error: '',\n        loading: false\n      });\n    } catch (e) {\n      setInitState({\n        started: true,\n        success: false,\n        error: e.message || 'Lỗi khởi tạo',\n        loading: false\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"home-root\",\n    style: {\n      minHeight: '100vh',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: 20\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fff',\n        border: '1px solid #e5e5e5',\n        borderRadius: 12,\n        padding: 24,\n        maxWidth: 560,\n        width: '100%',\n        textAlign: 'center',\n        boxShadow: '0 2px 10px rgba(0,0,0,0.06)'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        style: {\n          marginTop: 0\n        },\n        children: \"Thanh to\\xE1n chuy\\u1EC3n kho\\u1EA3n\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          marginTop: 4\n        },\n        children: \"Qu\\xE9t m\\xE3 QR b\\xEAn d\\u01B0\\u1EDBi \\u0111\\u1EC3 chuy\\u1EC3n kho\\u1EA3n s\\u1ED1 ti\\u1EC1n \\u0111\\u1EB7t c\\u1ECDc 20% (t\\xEDnh tr\\xEAn t\\u1ED5ng chi ph\\xED). Sau \\u0111\\xF3 ch\\u1EDD qu\\u1EA3n tr\\u1ECB vi\\xEAn x\\xE1c nh\\u1EADn.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          margin: '16px auto',\n          width: 240,\n          height: 240,\n          borderRadius: 16,\n          overflow: 'hidden',\n          border: '1px solid #e2e8f0',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          background: '#fafafa'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/qr-image.jpg\",\n          alt: \"QR thanh to\\xE1n\",\n          style: {\n            width: '100%',\n            height: '100%',\n            objectFit: 'cover'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 13,\n          background: '#f1f5f9',\n          padding: 12,\n          borderRadius: 8,\n          textAlign: 'left',\n          lineHeight: 1.5,\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 8\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"T\\u1ED5ng chi ph\\xED (sau \\u01B0u \\u0111\\xE3i):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 293,\n            columnNumber: 16\n          }, this), \" \", finalAmount.toLocaleString('vi-VN'), \" VND\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Ti\\u1EC1n c\\u1ECDc ph\\u1EA3i chuy\\u1EC3n (20%):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 16\n          }, this), \" \", depositAmount.toLocaleString('vi-VN'), \" VND\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 294,\n          columnNumber: 11\n        }, this), serverPromo && serverPromo.ok && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: '#0f172a'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"M\\xE3 \\u01B0u \\u0111\\xE3i \\xE1p d\\u1EE5ng:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 20\n            }, this), \" \", serverPromo.code]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Gi\\u1EA3m gi\\xE1:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 20\n            }, this), \" \", Number(serverPromo.discount || 0).toLocaleString('vi-VN'), \" VND\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 298,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 700\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"T\\u1ED5ng sau gi\\u1EA3m:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 299,\n              columnNumber: 47\n            }, this), \" \", Number((_serverPromo$final = serverPromo.final) !== null && _serverPromo$final !== void 0 ? _serverPromo$final : finalAmount).toLocaleString('vi-VN'), \" VND\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 299,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Ti\\u1EC1n c\\u1ECDc sau \\u01B0u \\u0111\\xE3i:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 20\n            }, this), \" \", calcDeposit((_serverPromo$final2 = serverPromo.final) !== null && _serverPromo$final2 !== void 0 ? _serverPromo$final2 : finalAmount).toLocaleString('vi-VN'), \" VND\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 13\n        }, this), serverPromoError && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            color: '#b42318'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u01AFu \\u0111\\xE3i:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 305,\n              columnNumber: 20\n            }, this), \" \", serverPromoError]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 305,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginTop: 8,\n              display: 'flex',\n              gap: 8\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => {\n                revalidatePromo();\n              },\n              className: \"checkout-inline-toggle\",\n              children: \"Th\\u1EED l\\u1EA1i ki\\u1EC3m tra \\u01B0u \\u0111\\xE3i\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 307,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => {\n                clearPromoAndProceed();\n              },\n              className: \"checkout-inline-toggle\",\n              children: \"B\\u1ECF \\u01B0u \\u0111\\xE3i v\\xE0 ti\\u1EBFp t\\u1EE5c\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 308,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 306,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"details\", {\n            style: {\n              marginTop: 8\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"summary\", {\n              style: {\n                cursor: 'pointer'\n              },\n              children: \"Xem chi ti\\u1EBFt (debug)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n              style: {\n                textAlign: 'left',\n                fontSize: 12,\n                whiteSpace: 'pre-wrap',\n                marginTop: 8\n              },\n              children: JSON.stringify({\n                serverPromo,\n                serverPromoError\n              }, null, 2)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 312,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"M\\xE3 giao d\\u1ECBch:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 11\n        }, this), \" \", token || '—', /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 56\n        }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"M\\xE3 \\u0111\\u1EB7t (booking code):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 11\n        }, this), \" \", code || '—', /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 64\n        }, this), /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"N\\u1ED9i dung CK g\\u1EE3i \\xFD:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 11\n        }, this), \" \", code ? (code + \" \" + (token || '')).slice(0, 40) : token || '', /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 104\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 11\n      }, this), !initState.started && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"checkout-btn\",\n        style: {\n          marginTop: 18\n        },\n        disabled: initState.loading,\n        onClick: initiate,\n        children: initState.loading ? 'Đang tạo...' : 'BẮT ĐẦU / GHI NHẬN THANH TOÁN'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 11\n      }, this), initState.started && !initState.success && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: 14,\n          color: '#b42318',\n          fontSize: 13\n        },\n        children: initState.error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 11\n      }, this), initState.success && !paid && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: 16,\n          fontSize: 13,\n          color: '#0f172a',\n          lineHeight: 1.5\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontWeight: 600,\n            color: '#047857',\n            marginBottom: 4\n          },\n          children: \"Y\\xEAu c\\u1EA7u \\u0111\\u1EB7t ph\\xF2ng \\u0111\\xE3 g\\u1EEDi th\\xE0nh c\\xF4ng!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 13\n        }, this), \"\\u0110ang ch\\u1EDD x\\xE1c nh\\u1EADn t\\u1EEB qu\\u1EA3n tr\\u1ECB vi\\xEAn... (Trang s\\u1EBD t\\u1EF1 c\\u1EADp nh\\u1EADt tr\\u1EA1ng th\\xE1i)\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 84\n        }, this), \"B\\u1EA1n c\\xF3 th\\u1EC3 ti\\u1EBFp t\\u1EE5c duy\\u1EC7t trang kh\\xE1c; h\\u1EC7 th\\u1ED1ng s\\u1EBD g\\u1EEDi th\\xF4ng b\\xE1o khi \\u0111\\u01B0\\u1EE3c x\\xE1c nh\\u1EADn.\", /*#__PURE__*/_jsxDEV(PendingBookings, {\n          token: token\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 327,\n        columnNumber: 11\n      }, this), paid && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: 18\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 14,\n            fontWeight: 600,\n            color: '#047857'\n          },\n          children: \"\\u0110\\xC3 X\\xC1C NH\\u1EACN THANH TO\\xC1N \\u2714\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"checkout-btn\",\n          style: {\n            marginTop: 12\n          },\n          onClick: () => navigate('/payment/success?token=' + encodeURIComponent(token)),\n          children: \"Ti\\u1EBFp t\\u1EE5c\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 11\n      }, this), pollMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: 10,\n          fontSize: 12,\n          color: '#047857'\n        },\n        children: pollMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: 20\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            // Nếu có origin chứa state booking (JSON encode) -> lưu lại và điều hướng về trang chủ để mở overlay\n            if (origin) {\n              try {\n                const dec = decodeURIComponent(origin);\n                const data = JSON.parse(dec);\n                if (data && data.__roomsBookingDraft) {\n                  sessionStorage.setItem('hmsReturnBookingDraft', JSON.stringify(data.__roomsBookingDraft));\n                }\n              } catch {}\n            }\n            navigate('/?return=1');\n          },\n          className: \"checkout-inline-toggle\",\n          style: {\n            marginRight: 12\n          },\n          children: \"Quay l\\u1EA1i \\u0111\\u1EB7t ph\\xF2ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/\",\n          className: \"checkout-inline-toggle\",\n          children: \"V\\u1EC1 Trang Ch\\u1EE7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 285,\n    columnNumber: 5\n  }, this);\n}\n\n// Component hiển thị danh sách booking pending và cho phép user hủy trước khi admin xác nhận\n_s(PaymentPending, \"oLmtxc2HT70ak/apYnZasWvD9es=\", false, function () {\n  return [useSearchParams, useNavigate];\n});\n_c = PaymentPending;\nfunction PendingBookings({\n  token\n}) {\n  _s2();\n  const [list, setList] = React.useState([]);\n  const [busy, setBusy] = React.useState(null);\n  const [reloadTick, setReloadTick] = React.useState(0);\n  React.useEffect(() => {\n    try {\n      const raw = localStorage.getItem('hmsBooking:' + token);\n      if (raw) {\n        const s = JSON.parse(raw);\n        const ids = Array.isArray(s.bookingIds) ? s.bookingIds : [];\n        setList(ids.filter(b => typeof b === 'number' || typeof b === 'string'));\n      }\n    } catch {}\n  }, [token, reloadTick]);\n  const cancelOne = async bid => {\n    if (!window.confirm('Hủy booking #' + bid + ' và hoàn 85% tiền cọc?')) return;\n    setBusy(bid);\n    let email = '';\n    try {\n      const u = JSON.parse(localStorage.getItem('hmsUser') || 'null');\n      email = (u === null || u === void 0 ? void 0 : u.email) || '';\n    } catch {}\n    try {\n      const r = await fetch(`/api/payments/${bid}/cancel`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email\n        })\n      });\n      if (!r.ok) {\n        const t = await r.text();\n        throw new Error(t);\n      }\n      let j = null;\n      try {\n        j = await r.json();\n      } catch {\n        j = null;\n      }\n      // Cập nhật localStorage\n      try {\n        const raw = localStorage.getItem('hmsBooking:' + token);\n        if (raw) {\n          const s = JSON.parse(raw);\n          s.bookingIds = (s.bookingIds || []).filter(x => x !== bid);\n          localStorage.setItem('hmsBooking:' + token, JSON.stringify(s));\n        }\n      } catch {}\n      setList(ls => ls.filter(x => x !== bid));\n      const refundText = j && typeof j.refundAmount === 'number' ? ` • Hoàn ${Number(j.refundAmount).toLocaleString('vi-VN')} VND tiền cọc` : '';\n      showToast('Đã hủy booking #' + bid + refundText, {\n        type: 'success',\n        duration: 2600\n      });\n    } catch (e) {\n      showToast(e.message || 'Hủy thất bại', {\n        type: 'error',\n        duration: 2600\n      });\n    } finally {\n      setBusy(null);\n    }\n  };\n  if (!list.length) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: 14,\n      padding: 12,\n      background: '#f8fafc',\n      border: '1px solid #e2e8f0',\n      borderRadius: 8,\n      textAlign: 'left'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        fontWeight: 600,\n        fontSize: 12,\n        marginBottom: 6\n      },\n      children: \"Danh s\\xE1ch booking ch\\u1EDD x\\xE1c nh\\u1EADn:\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      style: {\n        margin: 0,\n        paddingLeft: 18,\n        fontSize: 12\n      },\n      children: list.map(id => /*#__PURE__*/_jsxDEV(\"li\", {\n        style: {\n          marginBottom: 4\n        },\n        children: [\"Booking #\", id, \" \\xA0\", /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          onClick: () => cancelOne(id),\n          disabled: busy === id,\n          className: \"checkout-inline-toggle\",\n          style: {\n            fontSize: 11\n          },\n          children: busy === id ? 'Đang hủy...' : 'Hủy'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 13\n        }, this)]\n      }, id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 11\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 6,\n        fontSize: 11,\n        color: '#475569'\n      },\n      children: \"B\\u1EA1n c\\xF3 th\\u1EC3 h\\u1EE7y tr\\u01B0\\u1EDBc khi qu\\u1EA3n tr\\u1ECB vi\\xEAn x\\xE1c nh\\u1EADn (ph\\xED 15%).\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      onClick: () => setReloadTick(t => t + 1),\n      className: \"checkout-inline-toggle\",\n      style: {\n        marginTop: 8,\n        fontSize: 11\n      },\n      children: \"L\\xE0m m\\u1EDBi\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 406,\n    columnNumber: 5\n  }, this);\n}\n_s2(PendingBookings, \"K/YnBgN0n9SPmLupmxPiKQry5yg=\");\n_c2 = PendingBookings;\nvar _c, _c2;\n$RefreshReg$(_c, \"PaymentPending\");\n$RefreshReg$(_c2, \"PendingBookings\");","map":{"version":3,"names":["React","useEffect","useState","useSearchParams","Link","useNavigate","showToast","isLoggedIn","jsxDEV","_jsxDEV","PaymentPending","_s","_serverPromo$final","_serverPromo$final2","params","token","get","amount","code","rt","hid","ci","co","ad","ch","rn","navigate","origin","sessionStorage","setItem","window","location","pathname","search","initState","setInitState","started","success","error","loading","serverPromo","setServerPromo","serverPromoError","setServerPromoError","depositRate","initialFinalAmount","Number","initialDepositFromStorage","raw","localStorage","getItem","s","JSON","parse","finalAmount","promo","final","discountValue","discountType","disc","Math","round","max","depositAmount","calcDeposit","num","amountNum","defaultDeposit","setFinalAmount","setDepositAmount","applyFinalAmount","value","isNaN","deposit","summary","stringify","dropPromo","reasonMsg","type","duration","mounted","gross","url","URL","searchParams","set","String","trim","hotelId","Array","isArray","rooms","length","map","r","id","join","resp","fetch","toString","ok","body","json","catch","msg","message","test","discount","err","console","e","revalidatePromo","clearPromoAndProceed","initiate","pollMsg","setPollMsg","paid","setPaid","setInterval","email","userEmail","q","j","anyPaid","items","some","it","paymentStatus","clearInterval","Error","u","payload","checkIn","checkOut","method","payMethod","adults","children","price","promoCode","headers","t","text","data","finalTotal","depositTotal","bookings","raw2","bookingIds","className","style","minHeight","display","alignItems","justifyContent","padding","background","border","borderRadius","maxWidth","width","textAlign","boxShadow","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","margin","height","overflow","src","alt","objectFit","fontSize","lineHeight","flexDirection","gap","toLocaleString","color","fontWeight","onClick","cursor","whiteSpace","slice","disabled","marginBottom","PendingBookings","encodeURIComponent","dec","decodeURIComponent","__roomsBookingDraft","marginRight","to","_c","_s2","list","setList","busy","setBusy","reloadTick","setReloadTick","ids","filter","b","cancelOne","bid","confirm","x","ls","refundText","refundAmount","paddingLeft","_c2","$RefreshReg$"],"sources":["D:/Git/HMSAI-Hotel/client/src/PaymentConfirm.js"],"sourcesContent":["// Renamed conceptually to PaymentPending (file name will be adjusted separately if desired)\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useSearchParams, Link, useNavigate } from 'react-router-dom';\r\nimport './HomePage.css';\r\nimport showToast from './toast';\r\nimport { isLoggedIn } from './auth';\r\n\r\nexport default function PaymentPending() {\r\n  const [params] = useSearchParams();\r\n  const token = params.get('token') || '';\r\n  const amount = params.get('amount') || '';\r\n  const code = params.get('code') || '';\r\n  const rt = params.get('rt') || '';\r\n  const hid = params.get('hid') || '';\r\n  const ci = params.get('ci') || '';\r\n  const co = params.get('co') || '';\r\n  const ad = params.get('ad') || '';\r\n  const ch = params.get('ch') || '';\r\n  const rn = params.get('rn') || '';\r\n  const navigate = useNavigate();\r\n  const origin = params.get('origin') || '';\r\n\r\n  // Guard: if chưa đăng nhập chuyển hướng login (giữ lại query để quay lại nếu cần)\r\n  useEffect(() => {\r\n    if (!isLoggedIn()) {\r\n      try { sessionStorage.setItem('hmsRedirectAfterLogin', window.location.pathname + window.location.search); } catch {}\r\n      navigate('/login');\r\n    }\r\n  }, [navigate]);\r\n\r\n  const [initState, setInitState] = useState({ started:false, success:false, error:'', loading:false });\r\n  const [serverPromo, setServerPromo] = useState(null);\r\n  const [serverPromoError, setServerPromoError] = useState('');\r\n  const depositRate = 0.2;\r\n  // Tính số tiền hiển thị ban đầu (có thể đang chứa mã cũ chưa revalidate)\r\n  let initialFinalAmount = Number(amount||0);\r\n  let initialDepositFromStorage = null;\r\n  try {\r\n    const raw = localStorage.getItem('hmsBooking:'+token);\r\n    if (raw) {\r\n      const s = JSON.parse(raw);\r\n      if (typeof s?.finalAmount === 'number') {\r\n        initialFinalAmount = Number(s.finalAmount);\r\n      } else if (s && s.promo && typeof s.promo.final !== 'undefined' && s.promo.final !== null) {\r\n        initialFinalAmount = Number(s.promo.final || initialFinalAmount);\r\n      } else if (s && s.promo && s.promo.code) {\r\n        if (s.promo.discountValue && s.promo.discountType) {\r\n          if (s.promo.discountType === 'PERCENT') {\r\n            const disc = Math.round(initialFinalAmount * (Number(s.promo.discountValue||0) / 100));\r\n            initialFinalAmount = Math.max(0, initialFinalAmount - disc);\r\n          } else {\r\n            const disc = Number(s.promo.discountValue||0);\r\n            initialFinalAmount = Math.max(0, initialFinalAmount - disc);\r\n          }\r\n        }\r\n      }\r\n      if (typeof s?.depositAmount === 'number') initialDepositFromStorage = Number(s.depositAmount);\r\n    }\r\n  } catch {}\r\n  const calcDeposit = (num) => {\r\n    const amountNum = Number(num) || 0;\r\n    return Math.max(0, Math.round(amountNum * depositRate));\r\n  };\r\n  const defaultDeposit = initialDepositFromStorage != null ? Number(initialDepositFromStorage) : calcDeposit(initialFinalAmount);\r\n  const [finalAmount, setFinalAmount] = useState(initialFinalAmount);\r\n  const [depositAmount, setDepositAmount] = useState(defaultDeposit);\r\n\r\n  const applyFinalAmount = (value) => {\r\n    const num = Number(value || 0);\r\n    if (Number.isNaN(num)) return;\r\n    const deposit = calcDeposit(num);\r\n    setFinalAmount(num);\r\n    setDepositAmount(deposit);\r\n    try {\r\n      const raw = localStorage.getItem('hmsBooking:'+token);\r\n      if (raw) {\r\n        const summary = JSON.parse(raw);\r\n        summary.finalAmount = num;\r\n        summary.amount = num;\r\n        summary.depositAmount = deposit;\r\n        localStorage.setItem('hmsBooking:'+token, JSON.stringify(summary));\r\n      }\r\n    } catch {}\r\n  };\r\n\r\n  // Helper: drop promo from local storage & reset amount\r\n  const dropPromo = (reasonMsg) => {\r\n    try {\r\n      const raw = localStorage.getItem('hmsBooking:'+token);\r\n      if(raw){\r\n        const s = JSON.parse(raw);\r\n        if(s.promo){ delete s.promo; }\r\n        s.finalAmount = Number(amount||0);\r\n        s.amount = Number(amount||0);\r\n        s.depositAmount = calcDeposit(Number(amount||0));\r\n        localStorage.setItem('hmsBooking:'+token, JSON.stringify(s));\r\n      }\r\n    } catch {}\r\n    applyFinalAmount(Number(amount||0));\r\n    if (reasonMsg) {\r\n      showToast(reasonMsg, { type:'warning', duration: 3200 });\r\n    }\r\n  };\r\n\r\n  // Re-validate promo with server to get authoritative discount & final amount\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      try {\r\n        const raw = localStorage.getItem('hmsBooking:'+token);\r\n        if (!raw) return;\r\n        const s = JSON.parse(raw);\r\n        if (!s || !s.promo || !s.promo.code) return;\r\n        // request validate with gross amount\r\n        const gross = Number(amount || 0);\r\n  const url = new URL('/api/promotions/validate', window.location.origin);\r\n  url.searchParams.set('code', String(s.promo.code).trim());\r\n  url.searchParams.set('amount', String(gross));\r\n  if (s.hotelId) url.searchParams.set('hotelId', String(s.hotelId));\r\n  if (Array.isArray(s.rooms) && s.rooms.length) url.searchParams.set('roomIds', s.rooms.map(r=>r.id).join(','));\r\n        try {\r\n          const resp = await fetch(url.toString());\r\n          if (!mounted) return;\r\n          if (!resp.ok) {\r\n            const body = await resp.json().catch(()=>({}));\r\n            const msg = body && body.message ? body.message : 'Mã ưu đãi không hợp lệ';\r\n            // Removed debug warn for promo validate non-ok\r\n            setServerPromoError(msg);\r\n            setServerPromo(null);\r\n            // Nếu mã thuộc khách sạn khác hoặc thiếu phòng để xác định => hủy ngay để không còn giảm ở UI\r\n            if (/khách sạn/i.test(msg) || /phòng đã chọn/i.test(msg) || /Thiếu phòng/i.test(msg)) {\r\n              dropPromo('Mã ưu đãi đã bị gỡ (không áp dụng cho khách sạn/phòng này)');\r\n            } else {\r\n              // fallback: hiển thị số tiền gốc nếu validate thất bại\r\n              applyFinalAmount(Number(amount||0));\r\n            }\r\n            return;\r\n          }\r\n          const body = await resp.json();\r\n          // Removed debug log for promo validate response\r\n            if (body && body.ok) {\r\n              if (typeof body.final === 'number') applyFinalAmount(Number(body.final));\r\n              else if (typeof body.discount === 'number') applyFinalAmount(Math.max(0, Number(amount||0) - Number(body.discount)));\r\n            } else {\r\n              applyFinalAmount(Number(amount||0));\r\n            }\r\n          setServerPromo(body);\r\n          setServerPromoError('');\r\n        } catch (err) {\r\n          console.error('[PaymentConfirm] promo validate failed', err);\r\n          if (!mounted) return;\r\n          // Provide a helpful message; in dev we include the error text\r\n          setServerPromoError((err && err.message) ? ('Lỗi kiểm tra ưu đãi: ' + err.message) : 'Lỗi kiểm tra ưu đãi');\r\n          setServerPromo(null);\r\n          applyFinalAmount(Number(amount||0));\r\n        }\r\n      } catch (e) {\r\n        if (!mounted) return;\r\n        setServerPromoError('Lỗi kiểm tra ưu đãi');\r\n        setServerPromo(null);\r\n        applyFinalAmount(Number(amount||0));\r\n      }\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, [token, amount]);\r\n  \r\n  // Exposed revalidate function for UI retry\r\n  const revalidatePromo = async () => {\r\n    setServerPromoError('');\r\n    setServerPromo(null);\r\n    try {\r\n      const raw = localStorage.getItem('hmsBooking:' + token);\r\n      if (!raw) return false;\r\n      const s = JSON.parse(raw);\r\n      if (!s || !s.promo || !s.promo.code) return false;\r\n      const gross = Number(amount || 0);\r\n      const url = new URL('/api/promotions/validate', window.location.origin);\r\n  url.searchParams.set('code', String(s.promo.code).trim());\r\n  url.searchParams.set('amount', String(gross));\r\n  if (s.hotelId) url.searchParams.set('hotelId', String(s.hotelId));\r\n  if (Array.isArray(s.rooms) && s.rooms.length) url.searchParams.set('roomIds', s.rooms.map(r=>r.id).join(','));\r\n      const resp = await fetch(url.toString());\r\n          if (!resp.ok) {\r\n            const body = await resp.json().catch(()=>({}));\r\n            // Removed debug warn for promo validate non-ok (retry path)\r\n            const msg = body && body.message ? body.message : 'Mã ưu đãi không hợp lệ';\r\n            setServerPromoError(msg);\r\n            setServerPromo(null);\r\n            // Auto drop promo if mismatch hotel to prevent silent usage later\r\n            if (/khách sạn/i.test(msg) || /phòng đã chọn/i.test(msg) || /Thiếu phòng/i.test(msg)) {\r\n              dropPromo('Đã gỡ mã ưu đãi không phù hợp');\r\n            } else {\r\n              applyFinalAmount(Number(amount||0));\r\n            }\r\n            return;\r\n          }\r\n      setServerPromo(body);\r\n      setServerPromoError('');\r\n      if (body && body.ok) {\r\n        if (typeof body.final === 'number') applyFinalAmount(Number(body.final));\r\n        else if (typeof body.discount === 'number') applyFinalAmount(Math.max(0, Number(amount||0) - Number(body.discount)));\r\n      } else applyFinalAmount(Number(amount||0));\r\n      return true;\r\n    } catch (err) {\r\n      setServerPromoError((err && err.message) ? ('Lỗi kiểm tra ưu đãi: ' + err.message) : 'Lỗi kiểm tra ưu đãi');\r\n      setServerPromo(null);\r\n      applyFinalAmount(Number(amount||0));\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Clear promo from local summary and proceed to initiate payment\r\n  const clearPromoAndProceed = async () => {\r\n    try {\r\n      const raw = localStorage.getItem('hmsBooking:' + token);\r\n      if (raw) {\r\n        const s = JSON.parse(raw);\r\n        delete s.promo;\r\n        localStorage.setItem('hmsBooking:' + token, JSON.stringify(s));\r\n      }\r\n    } catch {}\r\n    await initiate();\r\n  };\r\n  const [pollMsg, setPollMsg] = useState('');\r\n  const [paid, setPaid] = useState(false);\r\n  // Simple polling of transactions list to see if status turned paid (optional improvement)\r\n  useEffect(()=>{\r\n    if(!initState.success || paid) return;\r\n    const id = setInterval(async ()=>{\r\n      try {\r\n        const raw = localStorage.getItem('hmsBooking:'+token);\r\n        if(!raw) return; const s = JSON.parse(raw);\r\n        const email = s.userEmail; if(!email) return;\r\n        const q = new URL('/api/transactions', window.location.origin);\r\n        q.searchParams.set('email', email);\r\n        q.searchParams.set('q', code||'');\r\n        const r = await fetch(q.toString());\r\n        if(r.ok){ const j = await r.json();\r\n          const anyPaid = (j.items||[]).some(it=> String(it.code||'')===code && it.paymentStatus==='paid');\r\n          if(anyPaid){ setPaid(true); setPollMsg('Đã xác nhận thanh toán!'); clearInterval(id); }\r\n        }\r\n      } catch {}\r\n    }, 8000);\r\n    return ()=> clearInterval(id);\r\n  }, [initState.success, paid, token, code]);\r\n\r\n  const initiate = async () => {\r\n    setInitState(s=>({...s, loading:true, error:''}));\r\n    try {\r\n      const raw = localStorage.getItem('hmsBooking:' + token);\r\n      if(!raw) throw new Error('Không tìm thấy dữ liệu đặt phòng');\r\n      const s = JSON.parse(raw);\r\n      let email = s.userEmail || '';\r\n      if (!email) { try { const u = localStorage.getItem('hmsUser'); if (u) email = JSON.parse(u).email || ''; } catch {} }\r\n      if(!email) throw new Error('Thiếu email');\r\n  const payload = { token, email, checkIn: s.checkIn, checkOut: s.checkOut, method: s.payMethod || 'MOMO', rooms: (s.rooms||[]).map(r=>({ id:r.id, adults:r.adults||1, children:r.children||0, price:r.price })) };\r\n  // include promo code if present so server can validate/apply on confirm\r\n  if (s.promo && s.promo.code) payload.promoCode = s.promo.code;\r\n  const resp = await fetch('/api/payments/complete', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });\r\n      if(!resp.ok){ const t=await resp.text(); throw new Error('Tạo giao dịch lỗi: '+t); }\r\n      let data = {};\r\n      try { data = await resp.json(); } catch { data = {}; }\r\n      if (typeof data.finalTotal === 'number') applyFinalAmount(Number(data.finalTotal));\r\n      if (typeof data.depositTotal === 'number') setDepositAmount(Math.max(0, Math.round(Number(data.depositTotal))));\r\n      const bookings = Array.isArray(data.bookings) ? data.bookings : [];\r\n      // Lưu danh sách bookingIds vào summary để user có thể hủy nếu muốn\r\n      try {\r\n        const raw2 = localStorage.getItem('hmsBooking:'+token);\r\n        if(raw2){\r\n          const summary = JSON.parse(raw2);\r\n          summary.bookingIds = bookings;\r\n          if (typeof data.finalTotal === 'number') {\r\n            summary.finalAmount = Number(data.finalTotal);\r\n            summary.amount = Number(data.finalTotal);\r\n          }\r\n          if (typeof data.depositTotal === 'number') summary.depositAmount = Number(data.depositTotal);\r\n          localStorage.setItem('hmsBooking:'+token, JSON.stringify(summary));\r\n        }\r\n      } catch {}\r\n      setInitState({ started:true, success:true, error:'', loading:false });\r\n    } catch(e){ setInitState({ started:true, success:false, error:e.message||'Lỗi khởi tạo', loading:false }); }\r\n  };\r\n\r\n  return (\r\n    <div className=\"home-root\" style={{ minHeight:'100vh', display:'flex', alignItems:'center', justifyContent:'center', padding:20 }}>\r\n      <div style={{ background:'#fff', border:'1px solid #e5e5e5', borderRadius:12, padding:24, maxWidth:560, width:'100%', textAlign:'center', boxShadow:'0 2px 10px rgba(0,0,0,0.06)' }}>\r\n        <h1 style={{ marginTop:0 }}>Thanh toán chuyển khoản</h1>\r\n        <p style={{ marginTop:4 }}>Quét mã QR bên dưới để chuyển khoản số tiền đặt cọc 20% (tính trên tổng chi phí). Sau đó chờ quản trị viên xác nhận.</p>\r\n        <div style={{ margin:'16px auto', width:240, height:240, borderRadius:16, overflow:'hidden', border:'1px solid #e2e8f0', display:'flex', alignItems:'center', justifyContent:'center', background:'#fafafa' }}>\r\n          <img src=\"/qr-image.jpg\" alt=\"QR thanh toán\" style={{ width:'100%', height:'100%', objectFit:'cover' }} />\r\n        </div>\r\n          <div style={{ fontSize:13, background:'#f1f5f9', padding:12, borderRadius:8, textAlign:'left', lineHeight:1.5, display:'flex', flexDirection:'column', gap:8 }}>\r\n          <div><strong>Tổng chi phí (sau ưu đãi):</strong> {finalAmount.toLocaleString('vi-VN')} VND</div>\r\n          <div><strong>Tiền cọc phải chuyển (20%):</strong> {depositAmount.toLocaleString('vi-VN')} VND</div>\r\n          {serverPromo && serverPromo.ok && (\r\n            <div style={{ color:'#0f172a' }}>\r\n              <div><strong>Mã ưu đãi áp dụng:</strong> {serverPromo.code}</div>\r\n              <div><strong>Giảm giá:</strong> {Number(serverPromo.discount||0).toLocaleString('vi-VN')} VND</div>\r\n              <div style={{ fontWeight:700 }}><strong>Tổng sau giảm:</strong> {Number(serverPromo.final ?? finalAmount).toLocaleString('vi-VN')} VND</div>\r\n              <div><strong>Tiền cọc sau ưu đãi:</strong> {calcDeposit(serverPromo.final ?? finalAmount).toLocaleString('vi-VN')} VND</div>\r\n            </div>\r\n          )}\r\n          {serverPromoError && (\r\n            <div style={{ color:'#b42318' }}>\r\n              <div><strong>Ưu đãi:</strong> {serverPromoError}</div>\r\n              <div style={{ marginTop:8, display:'flex', gap:8 }}>\r\n                <button type=\"button\" onClick={() => { revalidatePromo(); }} className=\"checkout-inline-toggle\">Thử lại kiểm tra ưu đãi</button>\r\n                <button type=\"button\" onClick={() => { clearPromoAndProceed(); }} className=\"checkout-inline-toggle\">Bỏ ưu đãi và tiếp tục</button>\r\n              </div>\r\n              <details style={{ marginTop:8 }}>\r\n                <summary style={{ cursor:'pointer' }}>Xem chi tiết (debug)</summary>\r\n                <pre style={{ textAlign:'left', fontSize:12, whiteSpace:'pre-wrap', marginTop:8 }}>{JSON.stringify({ serverPromo, serverPromoError }, null, 2)}</pre>\r\n              </details>\r\n            </div>\r\n          )}\r\n          <strong>Mã giao dịch:</strong> {token || '—'}<br/>\r\n          <strong>Mã đặt (booking code):</strong> {code || '—'}<br/>\r\n          <strong>Nội dung CK gợi ý:</strong> {code ? (code+\" \"+(token||'')).slice(0,40) : (token||'')}<br/>\r\n        </div>\r\n        {!initState.started && (\r\n          <button className=\"checkout-btn\" style={{ marginTop:18 }} disabled={initState.loading} onClick={initiate}>{initState.loading? 'Đang tạo...' : 'BẮT ĐẦU / GHI NHẬN THANH TOÁN'}</button>\r\n        )}\r\n        {initState.started && !initState.success && (\r\n          <div style={{ marginTop:14, color:'#b42318', fontSize:13 }}>{initState.error}</div>\r\n        )}\r\n        {initState.success && !paid && (\r\n          <div style={{ marginTop:16, fontSize:13, color:'#0f172a', lineHeight:1.5 }}>\r\n            <div style={{ fontWeight:600, color:'#047857', marginBottom:4 }}>Yêu cầu đặt phòng đã gửi thành công!</div>\r\n            Đang chờ xác nhận từ quản trị viên... (Trang sẽ tự cập nhật trạng thái)<br/>\r\n            Bạn có thể tiếp tục duyệt trang khác; hệ thống sẽ gửi thông báo khi được xác nhận.\r\n            <PendingBookings token={token} />\r\n          </div>\r\n        )}\r\n        {paid && (\r\n          <div style={{ marginTop:18 }}>\r\n            <div style={{ fontSize:14, fontWeight:600, color:'#047857' }}>ĐÃ XÁC NHẬN THANH TOÁN ✔</div>\r\n            <button className=\"checkout-btn\" style={{ marginTop:12 }} onClick={()=> navigate('/payment/success?token='+encodeURIComponent(token))}>Tiếp tục</button>\r\n          </div>\r\n        )}\r\n        {pollMsg && <div style={{ marginTop:10, fontSize:12, color:'#047857' }}>{pollMsg}</div>}\r\n        <div style={{ marginTop: 20 }}>\r\n          <button\r\n            onClick={()=> {\r\n              // Nếu có origin chứa state booking (JSON encode) -> lưu lại và điều hướng về trang chủ để mở overlay\r\n              if(origin){\r\n                try {\r\n                  const dec = decodeURIComponent(origin);\r\n                  const data = JSON.parse(dec);\r\n                  if(data && data.__roomsBookingDraft){\r\n                    sessionStorage.setItem('hmsReturnBookingDraft', JSON.stringify(data.__roomsBookingDraft));\r\n                  }\r\n                } catch {}\r\n              }\r\n              navigate('/?return=1');\r\n            }}\r\n            className=\"checkout-inline-toggle\" style={{ marginRight:12 }}\r\n          >Quay lại đặt phòng</button>\r\n          <Link to=\"/\" className=\"checkout-inline-toggle\">Về Trang Chủ</Link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Component hiển thị danh sách booking pending và cho phép user hủy trước khi admin xác nhận\r\nfunction PendingBookings({ token }) {\r\n  const [list, setList] = React.useState([]);\r\n  const [busy, setBusy] = React.useState(null);\r\n  const [reloadTick, setReloadTick] = React.useState(0);\r\n\r\n  React.useEffect(()=>{\r\n    try {\r\n      const raw = localStorage.getItem('hmsBooking:'+token);\r\n      if(raw){\r\n        const s = JSON.parse(raw);\r\n        const ids = Array.isArray(s.bookingIds)? s.bookingIds : [];\r\n        setList(ids.filter(b=> typeof b === 'number' || typeof b === 'string'));\r\n      }\r\n    } catch {}\r\n  }, [token, reloadTick]);\r\n\r\n  const cancelOne = async (bid) => {\r\n    if(!window.confirm('Hủy booking #' + bid + ' và hoàn 85% tiền cọc?')) return;\r\n    setBusy(bid);\r\n    let email = '';\r\n    try { const u = JSON.parse(localStorage.getItem('hmsUser')||'null'); email = u?.email||''; } catch {}\r\n    try {\r\n      const r = await fetch(`/api/payments/${bid}/cancel`, { method:'PUT', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ email }) });\r\n      if(!r.ok){ const t=await r.text(); throw new Error(t); }\r\n      let j = null;\r\n      try { j = await r.json(); } catch { j = null; }\r\n      // Cập nhật localStorage\r\n      try {\r\n        const raw = localStorage.getItem('hmsBooking:'+token);\r\n        if(raw){ const s = JSON.parse(raw); s.bookingIds = (s.bookingIds||[]).filter(x=> x!==bid); localStorage.setItem('hmsBooking:'+token, JSON.stringify(s)); }\r\n      } catch {}\r\n      setList(ls=> ls.filter(x=> x!==bid));\r\n      const refundText = (j && typeof j.refundAmount === 'number') ? ` • Hoàn ${Number(j.refundAmount).toLocaleString('vi-VN')} VND tiền cọc` : '';\r\n      showToast('Đã hủy booking #' + bid + refundText, { type: 'success', duration: 2600 });\r\n    } catch(e){ showToast(e.message||'Hủy thất bại', { type: 'error', duration: 2600 }); }\r\n    finally { setBusy(null); }\r\n  };\r\n\r\n  if(!list.length) return null;\r\n  return (\r\n    <div style={{ marginTop:14, padding:12, background:'#f8fafc', border:'1px solid #e2e8f0', borderRadius:8, textAlign:'left' }}>\r\n      <div style={{ fontWeight:600, fontSize:12, marginBottom:6 }}>Danh sách booking chờ xác nhận:</div>\r\n      <ul style={{ margin:0, paddingLeft:18, fontSize:12 }}>\r\n        {list.map(id => (\r\n          <li key={id} style={{ marginBottom:4 }}>\r\n            Booking #{id} &nbsp;\r\n            <button\r\n              type=\"button\"\r\n              onClick={()=> cancelOne(id)}\r\n              disabled={busy===id}\r\n              className=\"checkout-inline-toggle\"\r\n              style={{ fontSize:11 }}\r\n            >{busy===id ? 'Đang hủy...' : 'Hủy'}</button>\r\n          </li>\r\n        ))}\r\n      </ul>\r\n      <div style={{ marginTop:6, fontSize:11, color:'#475569' }}>Bạn có thể hủy trước khi quản trị viên xác nhận (phí 15%).</div>\r\n      <button type=\"button\" onClick={()=> setReloadTick(t=>t+1)} className=\"checkout-inline-toggle\" style={{ marginTop:8, fontSize:11 }}>Làm mới</button>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}