{"ast":null,"code":"import _objectSpread from\"D:/DA_TichHop/HMS_AI Hotel/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useMemo,useRef,useState}from'react';import{useNavigate}from'react-router-dom';import'./Profile.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Profile(_ref){let{isModal=false,onClose}=_ref;const navigate=useNavigate();const[form,setForm]=useState({name:'',email:'',phone:'',address:'',birthDate:'',country:'Vietnam'});const[error,setError]=useState('');const[success,setSuccess]=useState('');const[avatarFile,setAvatarFile]=useState(null);const[avatarUrl,setAvatarUrl]=useState('');const fileRef=useRef(null);const[dragging,setDragging]=useState(false);const[removedAvatar,setRemovedAvatar]=useState(false);const[toast,setToast]=useState('');const[overTrash,setOverTrash]=useState(false);const[showDatePicker,setShowDatePicker]=useState(false);// Gi·ªØ l·∫°i role hi·ªán t·∫°i ƒë·ªÉ kh√¥ng b·ªã m·∫•t khi c·∫≠p nh·∫≠t localStorage (tr√°nh m·∫•t menu theo quy·ªÅn)\nconst existingRoleRef=useRef('');const toInputDate=v=>{if(!v)return'';try{if(v instanceof Date){const y=v.getFullYear();const m=String(v.getMonth()+1).padStart(2,'0');const d=String(v.getDate()).padStart(2,'0');return\"\".concat(y,\"-\").concat(m,\"-\").concat(d);}const s=String(v).trim();// If already yyyy-mm-dd\nif(/^\\d{4}-\\d{2}-\\d{2}$/.test(s))return s;// If mm/dd/yyyy\nconst md=s.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);if(md){const y=md[3];const m=String(md[1]).padStart(2,'0');const d=String(md[2]).padStart(2,'0');return\"\".concat(y,\"-\").concat(m,\"-\").concat(d);}const d=new Date(s);if(!isNaN(d.getTime()))return toInputDate(d);}catch(_unused){}return'';};// Max DOB (>= 18 tu·ªïi)\nconst maxDobStr=useMemo(()=>{const now=new Date();const d=new Date(now.getFullYear()-18,now.getMonth(),now.getDate());const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const da=String(d.getDate()).padStart(2,'0');return\"\".concat(y,\"-\").concat(m,\"-\").concat(da);},[]);useEffect(()=>{// Load from localStorage quickly\nlet email='';try{const raw=localStorage.getItem('hmsUser');const u=raw?JSON.parse(raw):null;if(u){email=u.email||'';existingRoleRef.current=u.role||existingRoleRef.current;// l∆∞u role ban ƒë·∫ßu\nsetForm(f=>_objectSpread(_objectSpread({},f),{},{name:u.name||'',email:u.email||'',phone:u.phone||'',address:u.address||'',birthDate:toInputDate(u.birthDate||u.date_of_birth),country:u.country||'Vietnam'}));if(u.avatar)setAvatarUrl(u.avatar);}}catch(_unused2){/* ignore */}// Then fetch latest from DB\nconst fetchDb=async()=>{if(!email)return;try{const res=await fetch(\"/api/users/profile?email=\".concat(encodeURIComponent(email)));if(!res.ok)return;// keep local values if not found\nconst j=await res.json();const u=j.user||{};setForm(f=>_objectSpread(_objectSpread({},f),{},{name:u.name||f.name,email:u.email||f.email,phone:u.phone||f.phone,address:u.address||f.address,birthDate:toInputDate(u.date_of_birth)||f.birthDate,country:u.country||f.country}));if(u.avatar)setAvatarUrl(u.avatar);// Sync localStorage\nconst next={name:u.name||'',email:u.email||email,phone:u.phone||'',address:u.address||'',birthDate:toInputDate(u.date_of_birth)||'',country:u.country||'Vietnam',avatar:u.avatar||'',role:u.role||existingRoleRef.current||''// gi·ªØ l·∫°i role\n};try{localStorage.setItem('hmsUser',JSON.stringify(next));}catch(_unused3){}}catch(_unused4){/* ignore fetch errors */}};fetchDb();},[]);const update=k=>e=>setForm(f=>_objectSpread(_objectSpread({},f),{},{[k]:e.target.value}));const onSubmit=async e=>{var _form$name,_form$email;e.preventDefault();setError('');setSuccess('');if(!((_form$name=form.name)!==null&&_form$name!==void 0&&_form$name.trim())){setError('Vui l√≤ng nh·∫≠p h·ªç v√† t√™n');return;}if(!((_form$email=form.email)!==null&&_form$email!==void 0&&_form$email.trim())){setError('Thi·∫øu email');return;}// Validate age >= 18\nif(form.birthDate){const bd=new Date(form.birthDate);if(!isNaN(bd.getTime())){const now=new Date();const age=now.getFullYear()-bd.getFullYear()-(now.getMonth()<bd.getMonth()||now.getMonth()===bd.getMonth()&&now.getDate()<bd.getDate()?1:0);if(age<18){setError('Ng√†y sinh kh√¥ng h·ª£p l·ªá: ph·∫£i ƒë·ªß 18 tu·ªïi tr·ªü l√™n');return;}}}const ok=window.confirm('B·∫°n c√≥ ch·∫Øc mu·ªën c·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n?');if(!ok)return;try{var _form$phone,_form$address,_j$user$name,_j$user,_j$user$email,_j$user2,_j$user$phone,_j$user3,_form$phone2,_j$user$address,_j$user4,_form$address2,_j$user$date_of_birth,_j$user5,_j$user$country,_j$user6,_j$user$avatar,_j$user7,_j$user$role,_j$user8;const fd=new FormData();fd.append('email',form.email.trim());fd.append('originalEmail',form.email.trim());fd.append('name',form.name.trim());fd.append('phone',((_form$phone=form.phone)===null||_form$phone===void 0?void 0:_form$phone.trim())||'');fd.append('address',((_form$address=form.address)===null||_form$address===void 0?void 0:_form$address.trim())||'');fd.append('birthDate',form.birthDate||'');fd.append('country',form.country||'');if(avatarFile)fd.append('avatar',avatarFile);if(removedAvatar&&!avatarFile)fd.append('removeAvatar','1');const res=await fetch('/api/users/profile',{method:'PUT',body:fd});if(!res.ok){const j=await res.json().catch(()=>({}));throw new Error(j.message||\"HTTP \".concat(res.status));}const j=await res.json();// L·∫•y role hi·ªán t·∫°i tr∆∞·ªõc khi ghi ƒë√®\nlet existingRole=existingRoleRef.current;try{const rawPrev=localStorage.getItem('hmsUser');if(rawPrev)existingRole=JSON.parse(rawPrev).role||existingRole;}catch(_unused5){/* ignore */}const next={name:(_j$user$name=(_j$user=j.user)===null||_j$user===void 0?void 0:_j$user.name)!==null&&_j$user$name!==void 0?_j$user$name:form.name.trim(),email:(_j$user$email=(_j$user2=j.user)===null||_j$user2===void 0?void 0:_j$user2.email)!==null&&_j$user$email!==void 0?_j$user$email:form.email.trim(),phone:((_j$user$phone=(_j$user3=j.user)===null||_j$user3===void 0?void 0:_j$user3.phone)!==null&&_j$user$phone!==void 0?_j$user$phone:(_form$phone2=form.phone)===null||_form$phone2===void 0?void 0:_form$phone2.trim())||'',address:((_j$user$address=(_j$user4=j.user)===null||_j$user4===void 0?void 0:_j$user4.address)!==null&&_j$user$address!==void 0?_j$user$address:(_form$address2=form.address)===null||_form$address2===void 0?void 0:_form$address2.trim())||'',birthDate:((_j$user$date_of_birth=(_j$user5=j.user)===null||_j$user5===void 0?void 0:_j$user5.date_of_birth)!==null&&_j$user$date_of_birth!==void 0?_j$user$date_of_birth:form.birthDate)||'',country:((_j$user$country=(_j$user6=j.user)===null||_j$user6===void 0?void 0:_j$user6.country)!==null&&_j$user$country!==void 0?_j$user$country:form.country)||'',avatar:(_j$user$avatar=(_j$user7=j.user)===null||_j$user7===void 0?void 0:_j$user7.avatar)!==null&&_j$user$avatar!==void 0?_j$user$avatar:avatarUrl,// ƒê·∫∑t ngo·∫∑c ƒë·ªÉ tr√°nh l·ªói Babel khi k·∫øt h·ª£p ?? v√† ||\nrole:((_j$user$role=(_j$user8=j.user)===null||_j$user8===void 0?void 0:_j$user8.role)!==null&&_j$user$role!==void 0?_j$user$role:existingRole)||''};existingRoleRef.current=next.role||existingRoleRef.current;localStorage.setItem('hmsUser',JSON.stringify(next));try{window.dispatchEvent(new Event('hms-auth-change'));}catch(_unused6){}setSuccess('C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!');setToast('C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng');setTimeout(()=>setToast(''),2000);}catch(err){setError(err.message||'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin');}};const avatarPreview=useMemo(()=>{if(avatarFile)return URL.createObjectURL(avatarFile);return avatarUrl||'';},[avatarFile,avatarUrl]);const content=/*#__PURE__*/_jsxs(\"div\",{className:\"profile-card\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"profile-title\",children:\"Th\\xF4ng Tin C\\xE1 Nh\\xE2n\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-msg\",role:\"alert\",children:error}),success&&/*#__PURE__*/_jsx(\"div\",{className:\"success-msg\",role:\"status\",children:success}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:onSubmit,noValidate:true,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-avatar-row\",children:[/*#__PURE__*/_jsx(\"input\",{ref:fileRef,type:\"file\",accept:\"image/*\",style:{display:'none'},onChange:e=>{const f=e.target.files&&e.target.files[0];if(f)setAvatarFile(f);}}),/*#__PURE__*/_jsx(\"button\",{className:\"profile-avatar clickable \".concat(dragging?'dragging':'',\" \").concat(overTrash?'drag-red':''),type:\"button\",draggable:true,onDragStart:()=>setDragging(true),onDragEnd:()=>{setDragging(false);setOverTrash(false);},onClick:()=>fileRef.current&&fileRef.current.click(),title:\"Nh\\u1EA5p \\u0111\\u1EC3 ch\\u1ECDn \\u1EA3nh \\u0111\\u1EA1i di\\u1EC7n\",children:avatarPreview?/*#__PURE__*/_jsx(\"img\",{src:avatarPreview,alt:\"avatar\"}):/*#__PURE__*/_jsx(\"div\",{className:\"profile-avatar-empty\",children:\"\\u1EA2nh\"})})]}),dragging&&/*#__PURE__*/_jsx(\"div\",{className:\"profile-trash\",onDragOver:e=>{e.preventDefault();const el=e.currentTarget;el.classList.add('over');setOverTrash(true);},onDragLeave:e=>{e.preventDefault();e.currentTarget.classList.remove('over');setOverTrash(false);},onDrop:e=>{e.preventDefault();setDragging(false);setAvatarFile(null);setAvatarUrl('');setRemovedAvatar(true);e.currentTarget.classList.remove('over');setOverTrash(false);},children:\"\\uD83D\\uDDD1\\uFE0F K\\xE9o v\\xE0o \\u0111\\xE2y \\u0111\\u1EC3 x\\xF3a \\u1EA3nh\"}),/*#__PURE__*/_jsx(\"label\",{children:\"H\\u1ECD v\\xE0 T\\xEAn\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:form.name,onChange:update('name'),placeholder:\"Nh\\u1EADp h\\u1ECD v\\xE0 t\\xEAn\"}),/*#__PURE__*/_jsx(\"label\",{children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:form.email,onChange:update('email'),placeholder:\"name@example.com\",readOnly:true,title:\"Email d\\xF9ng \\u0111\\u1EC3 \\u0111\\u1ECBnh danh; kh\\xF4ng th\\u1EC3 s\\u1EEDa t\\u1EA1i \\u0111\\xE2y\"}),/*#__PURE__*/_jsx(\"label\",{children:\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",value:form.phone,onChange:update('phone'),placeholder:\"0901234567\"}),/*#__PURE__*/_jsx(\"label\",{children:\"\\u0110\\u1ECBa ch\\u1EC9\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:form.address,onChange:update('address'),placeholder:\"S\\u1ED1 nh\\xE0, \\u0111\\u01B0\\u1EDDng, qu\\u1EADn/huy\\u1EC7n, t\\u1EC9nh/th\\xE0nh\"}),/*#__PURE__*/_jsx(\"label\",{children:\"Ng\\xE0y sinh\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:form.birthDate,onChange:update('birthDate'),max:maxDobStr}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"date-icon\",onClick:()=>setShowDatePicker(v=>!v),title:\"Ch\\u1ECDn ng\\xE0y/th\\xE1ng/n\\u0103m\",\"aria-label\":\"Ch\\u1ECDn ng\\xE0y\",children:/*#__PURE__*/_jsx(\"img\",{src:\"/icon-schedule.png\",alt:\"Ch\\u1ECDn ng\\xE0y\"})})]}),showDatePicker&&/*#__PURE__*/_jsx(DateTriple,{date:form.birthDate,max:maxDobStr,onApply:v=>{setForm(f=>_objectSpread(_objectSpread({},f),{},{birthDate:v}));setShowDatePicker(false);},onClose:()=>setShowDatePicker(false)}),/*#__PURE__*/_jsx(\"label\",{children:\"Qu\\u1ED1c gia\"}),/*#__PURE__*/_jsx(\"select\",{value:form.country,onChange:update('country'),children:['Vietnam','United States','Japan','South Korea','China','Thailand','Singapore','Malaysia','France','Germany','United Kingdom','Australia'].map(c=>/*#__PURE__*/_jsx(\"option\",{value:c,children:c},c))}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-actions\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn-primary\",style:{width:'auto',minWidth:160},children:\"C\\u1EADp Nh\\u1EADt\"})})]})]});if(isModal){return/*#__PURE__*/_jsxs(\"div\",{className:\"profile-overlay\",role:\"dialog\",\"aria-modal\":\"true\",onMouseDown:e=>{if(e.target===e.currentTarget)onClose&&onClose();},children:[/*#__PURE__*/_jsx(\"button\",{className:\"profile-back\",type:\"button\",\"aria-label\":\"Quay l\\u1EA1i\",onClick:()=>onClose&&onClose(),children:\"\\u2190 Quay l\\u1EA1i\"}),toast&&/*#__PURE__*/_jsx(\"div\",{className:\"profile-toast\",role:\"status\",children:toast}),/*#__PURE__*/_jsx(\"div\",{className:\"profile-modal\",onMouseDown:e=>e.stopPropagation(),children:content})]});}return/*#__PURE__*/_jsx(\"div\",{className:\"profile-page\",children:content});}function DateTriple(_ref2){let{date,onApply,onClose,max}=_ref2;const parse=s=>{if(!s)return{y:'',m:'',d:''};const m=String(s).match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);if(!m)return{y:'',m:'',d:''};return{y:m[1],m:m[2],d:m[3]};};const init=parse(date);const[y,setY]=useState(init.y);const[m,setM]=useState(init.m);const[d,setD]=useState(init.d);const toDays=(yy,mm)=>{const year=Number(yy||2000);const month=Number(mm||1);return new Date(year,month,0).getDate();};const now=new Date();const maxDate=max&&/^\\d{4}-\\d{2}-\\d{2}$/.test(max)?new Date(max):new Date(now.getFullYear()-18,now.getMonth(),now.getDate());const maxYear=maxDate.getFullYear();const maxMonth=maxDate.getMonth()+1;// 1-12\nconst maxDay=maxDate.getDate();const years=Array.from({length:120},(_,i)=>String(maxYear-i));const allMonths=Array.from({length:12},(_,i)=>String(i+1).padStart(2,'0'));const months=y&&Number(y)===maxYear?allMonths.filter(mm=>Number(mm)<=maxMonth):allMonths;const candidateMaxDays=toDays(y||String(maxYear),m||'01');let days=Array.from({length:candidateMaxDays},(_,i)=>String(i+1).padStart(2,'0'));if(y&&Number(y)===maxYear&&m&&Number(m)===maxMonth){days=days.filter(dd=>Number(dd)<=maxDay);}const apply=()=>{if(!y||!m||!d)return onClose();const chosen=\"\".concat(y,\"-\").concat(m,\"-\").concat(d);// Validate 18+\nconst bd=new Date(chosen);if(!isNaN(bd.getTime())){const now=new Date();const age=now.getFullYear()-bd.getFullYear()-(now.getMonth()<bd.getMonth()||now.getMonth()===bd.getMonth()&&now.getDate()<bd.getDate()?1:0);if(age<18){alert('Ng√†y sinh kh√¥ng h·ª£p l·ªá: Ph·∫£i ƒë·ªß 18 tu·ªïi tr·ªü l√™n');return;}}onApply(chosen);};return/*#__PURE__*/_jsxs(\"div\",{className:\"date-popover\",children:[/*#__PURE__*/_jsxs(\"select\",{value:d,onChange:e=>setD(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Ng\\xE0y\"}),days.map(x=>/*#__PURE__*/_jsx(\"option\",{value:x,children:x},x))]}),/*#__PURE__*/_jsxs(\"select\",{value:m,onChange:e=>setM(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Th\\xE1ng\"}),months.map(x=>/*#__PURE__*/_jsx(\"option\",{value:x,children:x},x))]}),/*#__PURE__*/_jsxs(\"select\",{value:y,onChange:e=>setY(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"N\\u0103m\"}),years.map(x=>/*#__PURE__*/_jsx(\"option\",{value:x,children:x},x))]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"date-apply\",onClick:apply,children:\"\\xC1p d\\u1EE5ng\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"date-cancel\",onClick:onClose,children:\"\\u0110\\xF3ng\"})]});}","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","useNavigate","jsx","_jsx","jsxs","_jsxs","Profile","_ref","isModal","onClose","navigate","form","setForm","name","email","phone","address","birthDate","country","error","setError","success","setSuccess","avatarFile","setAvatarFile","avatarUrl","setAvatarUrl","fileRef","dragging","setDragging","removedAvatar","setRemovedAvatar","toast","setToast","overTrash","setOverTrash","showDatePicker","setShowDatePicker","existingRoleRef","toInputDate","v","Date","y","getFullYear","m","String","getMonth","padStart","d","getDate","concat","s","trim","test","md","match","isNaN","getTime","_unused","maxDobStr","now","da","raw","localStorage","getItem","u","JSON","parse","current","role","f","_objectSpread","date_of_birth","avatar","_unused2","fetchDb","res","fetch","encodeURIComponent","ok","j","json","user","next","setItem","stringify","_unused3","_unused4","update","k","e","target","value","onSubmit","_form$name","_form$email","preventDefault","bd","age","window","confirm","_form$phone","_form$address","_j$user$name","_j$user","_j$user$email","_j$user2","_j$user$phone","_j$user3","_form$phone2","_j$user$address","_j$user4","_form$address2","_j$user$date_of_birth","_j$user5","_j$user$country","_j$user6","_j$user$avatar","_j$user7","_j$user$role","_j$user8","fd","FormData","append","method","body","catch","Error","message","status","existingRole","rawPrev","_unused5","dispatchEvent","Event","_unused6","setTimeout","err","avatarPreview","URL","createObjectURL","content","className","children","noValidate","ref","type","accept","style","display","onChange","files","draggable","onDragStart","onDragEnd","onClick","click","title","src","alt","onDragOver","el","currentTarget","classList","add","onDragLeave","remove","onDrop","placeholder","readOnly","max","DateTriple","date","onApply","map","c","width","minWidth","onMouseDown","stopPropagation","_ref2","init","setY","setM","setD","toDays","yy","mm","year","Number","month","maxDate","maxYear","maxMonth","maxDay","years","Array","from","length","_","i","allMonths","months","filter","candidateMaxDays","days","dd","apply","chosen","alert","x"],"sources":["D:/DA_TichHop/HMS_AI Hotel/client/src/Profile.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './Profile.css';\r\n\r\nexport default function Profile({ isModal = false, onClose }) {\r\n  const navigate = useNavigate();\r\n  const [form, setForm] = useState({\r\n    name: '',\r\n    email: '',\r\n    phone: '',\r\n    address: '',\r\n    birthDate: '',\r\n    country: 'Vietnam',\r\n  });\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState('');\r\n  const [avatarFile, setAvatarFile] = useState(null);\r\n  const [avatarUrl, setAvatarUrl] = useState('');\r\n  const fileRef = useRef(null);\r\n  const [dragging, setDragging] = useState(false);\r\n  const [removedAvatar, setRemovedAvatar] = useState(false);\r\n  const [toast, setToast] = useState('');\r\n  const [overTrash, setOverTrash] = useState(false);\r\n  const [showDatePicker, setShowDatePicker] = useState(false);\r\n  // Gi·ªØ l·∫°i role hi·ªán t·∫°i ƒë·ªÉ kh√¥ng b·ªã m·∫•t khi c·∫≠p nh·∫≠t localStorage (tr√°nh m·∫•t menu theo quy·ªÅn)\r\n  const existingRoleRef = useRef('');\r\n\r\n  const toInputDate = (v) => {\r\n    if (!v) return '';\r\n    try {\r\n      if (v instanceof Date) {\r\n        const y = v.getFullYear();\r\n        const m = String(v.getMonth() + 1).padStart(2, '0');\r\n        const d = String(v.getDate()).padStart(2, '0');\r\n        return `${y}-${m}-${d}`;\r\n      }\r\n      const s = String(v).trim();\r\n      // If already yyyy-mm-dd\r\n      if (/^\\d{4}-\\d{2}-\\d{2}$/.test(s)) return s;\r\n      // If mm/dd/yyyy\r\n      const md = s.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})$/);\r\n      if (md) {\r\n        const y = md[3];\r\n        const m = String(md[1]).padStart(2, '0');\r\n        const d = String(md[2]).padStart(2, '0');\r\n        return `${y}-${m}-${d}`;\r\n      }\r\n      const d = new Date(s);\r\n      if (!isNaN(d.getTime())) return toInputDate(d);\r\n    } catch {}\r\n    return '';\r\n  };\r\n\r\n  // Max DOB (>= 18 tu·ªïi)\r\n  const maxDobStr = useMemo(() => {\r\n    const now = new Date();\r\n    const d = new Date(now.getFullYear() - 18, now.getMonth(), now.getDate());\r\n    const y = d.getFullYear();\r\n    const m = String(d.getMonth() + 1).padStart(2, '0');\r\n    const da = String(d.getDate()).padStart(2, '0');\r\n    return `${y}-${m}-${da}`;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Load from localStorage quickly\r\n    let email = '';\r\n    try {\r\n      const raw = localStorage.getItem('hmsUser');\r\n      const u = raw ? JSON.parse(raw) : null;\r\n      if (u) {\r\n        email = u.email || '';\r\n        existingRoleRef.current = u.role || existingRoleRef.current; // l∆∞u role ban ƒë·∫ßu\r\n        setForm((f) => ({\r\n          ...f,\r\n          name: u.name || '',\r\n          email: u.email || '',\r\n          phone: u.phone || '',\r\n          address: u.address || '',\r\n          birthDate: toInputDate(u.birthDate || u.date_of_birth),\r\n          country: u.country || 'Vietnam',\r\n        }));\r\n        if (u.avatar) setAvatarUrl(u.avatar);\r\n      }\r\n    } catch { /* ignore */ }\r\n\r\n    // Then fetch latest from DB\r\n    const fetchDb = async () => {\r\n      if (!email) return;\r\n      try {\r\n        const res = await fetch(`/api/users/profile?email=${encodeURIComponent(email)}`);\r\n        if (!res.ok) return; // keep local values if not found\r\n        const j = await res.json();\r\n        const u = j.user || {};\r\n        setForm((f) => ({\r\n          ...f,\r\n          name: u.name || f.name,\r\n          email: u.email || f.email,\r\n          phone: u.phone || f.phone,\r\n          address: u.address || f.address,\r\n          birthDate: toInputDate(u.date_of_birth) || f.birthDate,\r\n          country: u.country || f.country,\r\n        }));\r\n        if (u.avatar) setAvatarUrl(u.avatar);\r\n        // Sync localStorage\r\n        const next = {\r\n          name: u.name || '',\r\n          email: u.email || email,\r\n          phone: u.phone || '',\r\n            address: u.address || '',\r\n          birthDate: toInputDate(u.date_of_birth) || '',\r\n          country: u.country || 'Vietnam',\r\n          avatar: u.avatar || '',\r\n          role: u.role || existingRoleRef.current || '' // gi·ªØ l·∫°i role\r\n        };\r\n        try { localStorage.setItem('hmsUser', JSON.stringify(next)); } catch {}\r\n      } catch { /* ignore fetch errors */ }\r\n    };\r\n    fetchDb();\r\n  }, []);\r\n\r\n  const update = (k) => (e) => setForm((f) => ({ ...f, [k]: e.target.value }));\r\n\r\n  const onSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setSuccess('');\r\n    if (!form.name?.trim()) {\r\n      setError('Vui l√≤ng nh·∫≠p h·ªç v√† t√™n');\r\n      return;\r\n    }\r\n    if (!form.email?.trim()) {\r\n      setError('Thi·∫øu email');\r\n      return;\r\n    }\r\n    // Validate age >= 18\r\n    if (form.birthDate) {\r\n      const bd = new Date(form.birthDate);\r\n      if (!isNaN(bd.getTime())) {\r\n        const now = new Date();\r\n        const age = now.getFullYear() - bd.getFullYear() - ((now.getMonth() < bd.getMonth() || (now.getMonth() === bd.getMonth() && now.getDate() < bd.getDate())) ? 1 : 0);\r\n        if (age < 18) {\r\n          setError('Ng√†y sinh kh√¥ng h·ª£p l·ªá: ph·∫£i ƒë·ªß 18 tu·ªïi tr·ªü l√™n');\r\n          return;\r\n        }\r\n      }\r\n    }\r\n    const ok = window.confirm('B·∫°n c√≥ ch·∫Øc mu·ªën c·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n?');\r\n    if (!ok) return;\r\n    try {\r\n      const fd = new FormData();\r\n  fd.append('email', form.email.trim());\r\n  fd.append('originalEmail', form.email.trim());\r\n      fd.append('name', form.name.trim());\r\n      fd.append('phone', form.phone?.trim() || '');\r\n      fd.append('address', form.address?.trim() || '');\r\n      fd.append('birthDate', form.birthDate || '');\r\n      fd.append('country', form.country || '');\r\n  if (avatarFile) fd.append('avatar', avatarFile);\r\n  if (removedAvatar && !avatarFile) fd.append('removeAvatar', '1');\r\n\r\n      const res = await fetch('/api/users/profile', { method: 'PUT', body: fd });\r\n      if (!res.ok) {\r\n        const j = await res.json().catch(() => ({}));\r\n        throw new Error(j.message || `HTTP ${res.status}`);\r\n      }\r\n      const j = await res.json();\r\n      // L·∫•y role hi·ªán t·∫°i tr∆∞·ªõc khi ghi ƒë√®\r\n      let existingRole = existingRoleRef.current;\r\n      try {\r\n        const rawPrev = localStorage.getItem('hmsUser');\r\n        if (rawPrev) existingRole = JSON.parse(rawPrev).role || existingRole;\r\n      } catch { /* ignore */ }\r\n      const next = {\r\n        name: j.user?.name ?? form.name.trim(),\r\n        email: j.user?.email ?? form.email.trim(),\r\n        phone: (j.user?.phone ?? form.phone?.trim()) || '',\r\n        address: (j.user?.address ?? form.address?.trim()) || '',\r\n        birthDate: (j.user?.date_of_birth ?? form.birthDate) || '',\r\n        country: (j.user?.country ?? form.country) || '',\r\n        avatar: j.user?.avatar ?? avatarUrl,\r\n        // ƒê·∫∑t ngo·∫∑c ƒë·ªÉ tr√°nh l·ªói Babel khi k·∫øt h·ª£p ?? v√† ||\r\n        role: (j.user?.role ?? existingRole) || ''\r\n      };\r\n      existingRoleRef.current = next.role || existingRoleRef.current;\r\n      localStorage.setItem('hmsUser', JSON.stringify(next));\r\n      try { window.dispatchEvent(new Event('hms-auth-change')); } catch { }\r\n      setSuccess('C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng!');\r\n      setToast('C·∫≠p nh·∫≠t th√¥ng tin th√†nh c√¥ng');\r\n      setTimeout(() => setToast(''), 2000);\r\n    } catch (err) {\r\n      setError(err.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t th√¥ng tin');\r\n    }\r\n  };\r\n\r\n  const avatarPreview = useMemo(() => {\r\n    if (avatarFile) return URL.createObjectURL(avatarFile);\r\n    return avatarUrl || '';\r\n  }, [avatarFile, avatarUrl]);\r\n\r\n  const content = (\r\n    <div className=\"profile-card\">\r\n        <h2 className=\"profile-title\">Th√¥ng Tin C√° Nh√¢n</h2>\r\n        {error && <div className=\"error-msg\" role=\"alert\">{error}</div>}\r\n        {success && <div className=\"success-msg\" role=\"status\">{success}</div>}\r\n        <form onSubmit={onSubmit} noValidate>\r\n          <div className=\"profile-avatar-row\">\r\n            <input\r\n              ref={fileRef}\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              style={{ display: 'none' }}\r\n              onChange={(e) => {\r\n                const f = e.target.files && e.target.files[0];\r\n                if (f) setAvatarFile(f);\r\n              }}\r\n            />\r\n            <button\r\n              className={`profile-avatar clickable ${dragging ? 'dragging' : ''} ${overTrash ? 'drag-red' : ''}`}\r\n              type=\"button\"\r\n              draggable\r\n              onDragStart={() => setDragging(true)}\r\n              onDragEnd={() => { setDragging(false); setOverTrash(false); }}\r\n              onClick={() => fileRef.current && fileRef.current.click()}\r\n              title=\"Nh·∫•p ƒë·ªÉ ch·ªçn ·∫£nh ƒë·∫°i di·ªán\"\r\n            >\r\n              {avatarPreview ? (\r\n                <img src={avatarPreview} alt=\"avatar\" />\r\n              ) : (\r\n                <div className=\"profile-avatar-empty\">·∫¢nh</div>\r\n              )}\r\n            </button>\r\n          </div>\r\n          {dragging && (\r\n            <div\r\n              className=\"profile-trash\"\r\n              onDragOver={(e) => {\r\n                e.preventDefault();\r\n                const el = e.currentTarget;\r\n                el.classList.add('over');\r\n                setOverTrash(true);\r\n              }}\r\n              onDragLeave={(e) => {\r\n                e.preventDefault();\r\n                e.currentTarget.classList.remove('over');\r\n                setOverTrash(false);\r\n              }}\r\n              onDrop={(e) => {\r\n                e.preventDefault();\r\n                setDragging(false);\r\n                setAvatarFile(null);\r\n                setAvatarUrl('');\r\n                setRemovedAvatar(true);\r\n                e.currentTarget.classList.remove('over');\r\n                setOverTrash(false);\r\n              }}\r\n            >\r\n              üóëÔ∏è K√©o v√†o ƒë√¢y ƒë·ªÉ x√≥a ·∫£nh\r\n            </div>\r\n          )}\r\n\r\n          <label>H·ªç v√† T√™n</label>\r\n          <input\r\n            type=\"text\"\r\n            value={form.name}\r\n            onChange={update('name')}\r\n            placeholder=\"Nh·∫≠p h·ªç v√† t√™n\"\r\n          />\r\n\r\n          <label>Email</label>\r\n          <input\r\n            type=\"email\"\r\n            value={form.email}\r\n            onChange={update('email')}\r\n            placeholder=\"name@example.com\"\r\n            readOnly\r\n            title=\"Email d√πng ƒë·ªÉ ƒë·ªãnh danh; kh√¥ng th·ªÉ s·ª≠a t·∫°i ƒë√¢y\"\r\n          />\r\n\r\n          <label>S·ªë ƒëi·ªán tho·∫°i</label>\r\n          <input\r\n            type=\"tel\"\r\n            value={form.phone}\r\n            onChange={update('phone')}\r\n            placeholder=\"0901234567\"\r\n          />\r\n\r\n          <label>ƒê·ªãa ch·ªâ</label>\r\n          <input\r\n            type=\"text\"\r\n            value={form.address}\r\n            onChange={update('address')}\r\n            placeholder=\"S·ªë nh√†, ƒë∆∞·ªùng, qu·∫≠n/huy·ªán, t·ªânh/th√†nh\"\r\n          />\r\n\r\n          <label>Ng√†y sinh</label>\r\n          <div className=\"date-group\">\r\n            <input\r\n              type=\"date\"\r\n              value={form.birthDate}\r\n              onChange={update('birthDate')}\r\n              max={maxDobStr}\r\n            />\r\n            <button type=\"button\" className=\"date-icon\" onClick={() => setShowDatePicker((v) => !v)} title=\"Ch·ªçn ng√†y/th√°ng/nƒÉm\" aria-label=\"Ch·ªçn ng√†y\">\r\n              <img src=\"/icon-schedule.png\" alt=\"Ch·ªçn ng√†y\" />\r\n            </button>\r\n          </div>\r\n          {showDatePicker && (\r\n            <DateTriple\r\n              date={form.birthDate}\r\n              max={maxDobStr}\r\n              onApply={(v) => { setForm((f) => ({ ...f, birthDate: v })); setShowDatePicker(false); }}\r\n              onClose={() => setShowDatePicker(false)}\r\n            />\r\n          )}\r\n\r\n          <label>Qu·ªëc gia</label>\r\n          <select value={form.country} onChange={update('country')}>\r\n            {[\r\n              'Vietnam','United States','Japan','South Korea','China','Thailand','Singapore','Malaysia','France','Germany','United Kingdom','Australia'\r\n            ].map((c) => (\r\n              <option key={c} value={c}>{c}</option>\r\n            ))}\r\n          </select>\r\n\r\n          <div className=\"profile-actions\">\r\n            <button type=\"submit\" className=\"btn-primary\" style={{ width: 'auto', minWidth: 160 }}>\r\n              C·∫≠p Nh·∫≠t\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n  );\r\n\r\n  if (isModal) {\r\n    return (\r\n      <div\r\n        className=\"profile-overlay\"\r\n        role=\"dialog\"\r\n        aria-modal=\"true\"\r\n        onMouseDown={(e)=>{ if (e.target === e.currentTarget) onClose && onClose(); }}\r\n      >\r\n        <button className=\"profile-back\" type=\"button\" aria-label=\"Quay l·∫°i\" onClick={() => onClose && onClose()}>\r\n          ‚Üê Quay l·∫°i\r\n        </button>\r\n        {toast && <div className=\"profile-toast\" role=\"status\">{toast}</div>}\r\n        <div className=\"profile-modal\" onMouseDown={(e)=> e.stopPropagation()}>\r\n          {content}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"profile-page\">\r\n      {content}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction DateTriple({ date, onApply, onClose, max }) {\r\n  const parse = (s) => {\r\n    if (!s) return { y: '', m: '', d: '' };\r\n    const m = String(s).match(/^(\\d{4})-(\\d{2})-(\\d{2})$/);\r\n    if (!m) return { y: '', m: '', d: '' };\r\n    return { y: m[1], m: m[2], d: m[3] };\r\n  };\r\n  const init = parse(date);\r\n  const [y, setY] = useState(init.y);\r\n  const [m, setM] = useState(init.m);\r\n  const [d, setD] = useState(init.d);\r\n\r\n  const toDays = (yy, mm) => {\r\n    const year = Number(yy || 2000);\r\n    const month = Number(mm || 1);\r\n    return new Date(year, month, 0).getDate();\r\n  };\r\n  const now = new Date();\r\n  const maxDate = max && /^\\d{4}-\\d{2}-\\d{2}$/.test(max) ? new Date(max) : new Date(now.getFullYear() - 18, now.getMonth(), now.getDate());\r\n  const maxYear = maxDate.getFullYear();\r\n  const maxMonth = maxDate.getMonth() + 1; // 1-12\r\n  const maxDay = maxDate.getDate();\r\n\r\n  const years = Array.from({ length: 120 }, (_, i) => String(maxYear - i));\r\n  const allMonths = Array.from({ length: 12 }, (_, i) => String(i + 1).padStart(2, '0'));\r\n  const months = (y && Number(y) === maxYear)\r\n    ? allMonths.filter((mm) => Number(mm) <= maxMonth)\r\n    : allMonths;\r\n  const candidateMaxDays = toDays(y || String(maxYear), m || '01');\r\n  let days = Array.from({ length: candidateMaxDays }, (_, i) => String(i + 1).padStart(2, '0'));\r\n  if (y && Number(y) === maxYear && m && Number(m) === maxMonth) {\r\n    days = days.filter((dd) => Number(dd) <= maxDay);\r\n  }\r\n\r\n  const apply = () => {\r\n    if (!y || !m || !d) return onClose();\r\n    const chosen = `${y}-${m}-${d}`;\r\n    // Validate 18+\r\n    const bd = new Date(chosen);\r\n    if (!isNaN(bd.getTime())) {\r\n      const now = new Date();\r\n      const age = now.getFullYear() - bd.getFullYear() - ((now.getMonth() < bd.getMonth() || (now.getMonth() === bd.getMonth() && now.getDate() < bd.getDate())) ? 1 : 0);\r\n      if (age < 18) {\r\n        alert('Ng√†y sinh kh√¥ng h·ª£p l·ªá: Ph·∫£i ƒë·ªß 18 tu·ªïi tr·ªü l√™n');\r\n        return;\r\n      }\r\n    }\r\n    onApply(chosen);\r\n  };\r\n\r\n  return (\r\n    <div className=\"date-popover\">\r\n      <select value={d} onChange={(e) => setD(e.target.value)}>\r\n        <option value=\"\">Ng√†y</option>\r\n        {days.map((x) => <option key={x} value={x}>{x}</option>)}\r\n      </select>\r\n      <select value={m} onChange={(e) => setM(e.target.value)}>\r\n        <option value=\"\">Th√°ng</option>\r\n        {months.map((x) => <option key={x} value={x}>{x}</option>)}\r\n      </select>\r\n      <select value={y} onChange={(e) => setY(e.target.value)}>\r\n        <option value=\"\">NƒÉm</option>\r\n        {years.map((x) => <option key={x} value={x}>{x}</option>)}\r\n      </select>\r\n      <button type=\"button\" className=\"date-apply\" onClick={apply}>√Åp d·ª•ng</button>\r\n      <button type=\"button\" className=\"date-cancel\" onClick={onClose}>ƒê√≥ng</button>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}